/**
 * @license
 * lodash 3.8.0 (Custom Build) lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
 * Build: `lodash modern -o ./lodash.js`
 */

define("utils/Analytics",[],function(){"use strict";return{sendEvent:function(e,t,n,r){var i={hitType:"event",eventCategory:e,eventAction:t,eventLabel:n,eventValue:r||1};ga&&(ga("A.send",i),ga("B.send",i),ga("C.send",i))},sendPageview:function(e,t){var n={hitType:"pageview"};e&&(n.page=e),t&&(n.title=t),ga&&(ga("A.send",n),ga("B.send",n),ga("C.send",n))}}}),define("report/config",[],function(){var e="http://gis-gfw.wri.org/arcgis/rest/services/Utilities/Geometry/GeometryServer",t="http://gis-gfw.wri.org/arcgis/rest/services/commodities/FORMA50_2014/ImageServer",n="http://gis-gfw.wri.org/arcgis/rest/services/GFW/analysis/ImageServer",r="http://gis-potico.wri.org/arcgis/rest/services/suitabilitymapper/kpss_mosaic/ImageServer",i="http://gis-potico.wri.org/arcgis/rest/services/Fires/Global_Fires/MapServer",s="http://www.wri.org/publication/how-identify-degraded-land-sustainable-palm-oil-indonesia",o="http://gis-gfw.wri.org/arcgis/rest/services/GFW/analysis_wm/ImageServer",u="http://gis.wri.org/arcgis/rest/services/CountryBoundaries/CountryBoundaries/MapServer/0",a=[1,13],f=[2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013],l=["31 - 50%","51 - 74%","75 - 100%"],c=[1,3],h=["#ccf1a5","#859a59","#4b5923"],p=[0,3],d=["#87CEEB","#00AA00","#DD0000","#8A2BE2"],v=["Primary Degraded","Primary Intact"],m=[1,2],g=["#259F1F","#186513"],y=["Convertible Production Forest","Limited Production Forest","Non-forest","Production Forest","Protected Area"],b=[1,5],w=["rgb(230, 152, 0)","rgb(116, 196, 118)","rgb(255, 255, 190)","rgb(199, 233, 192)","rgb(35, 139, 69)"],E=["Moratorium area"],S=[0,1],x=["#5fc29a"],T=["Protected Area"],N=[0,1],C=["#296eaa"],k=["0","1 - 10","11 - 20","21- 35","36 - 70","71 - 100","101 - 150","151 - 200","201 - 300","Greater than 300"],L=[0,9],A=["#fdffcc","#faeeb9","#f6ddaa","#f4ca99","#f1bc8b","#eca97a","#e89c6f","#e08b5e","#db7c54","#d56f4a"],O=["Intact Forest"],M=[0,1],_=["#186513"],D=["Peat"],P=[0,1],H=["#161D9C"],B=["Agriculture","Mixed agriculture and forest","Open broadleaved forest","Closed broadleaved forest","Open needleleaved forest","Closed needleleaved forest","Open mixed forest","Mixed forest and grassland","Grassland / shrub","Flooded forest","Wetland","Settlements","Bare land","Water bodies","Snow / ice","No data"],j=[1,16],F=["#E0A828","#8BFB3B","#51952F","#287310","#B6D6A1","#89C364","#888749","#B98D5A","#FFFEC1","#19A785","#689AA7","#FCB7CB","#D3CE63","#77B5FC","#FFFFFF","#B3B3B3"],I=["Agriculture","Agroforestry","Fish pond","Grassland / Shrub","Mining","Oil Palm Plantation","Primary Forest","Rubber Plantation","Secondary Forest","Settlements","Swamp","Timber Plantation","Water Bodies"],q=[1,13],R=["#d89827","#26fc79","#b1e3fc","#fdffb6","#000","#d89827","#5fa965","#eeb368","#c7ffb6","#fca0bf","#538996","#745b37","#65a2f8"],U=["Agriculture","Estate crop plantation","Fish pond","Grassland / Shrub","Mining","Primary Forest","Secondary Forest","Settlements","Swamp","Timber Plantation","Water Bodies"],z=[1,11],W=["#d89827","#eeb368","#b1e3fc","#fdffb6","#000","#5fa965","#c7ffb6","#fca0bf","#538996","#745b37","#65a2f8"];return{corsEnabledServers:["http://gis-potico.wri.org","http://175.41.139.43","http://54.164.126.73","http://46.137.239.227","https://gfw-fires.wri.org","http://gis-gfw.wri.org"],urls:{imageService:"http://gis-gfw.wri.org/arcgis/rest/services/GFW/analysis/ImageServer"},messages:{largeAreaWarning:"The area for this analysis request is quite large and may take some time to process."},rasterFunctions:{range:{rasterFunction:"histogram16bit",outputPixelType:"U16",rasterFunctionArguments:{Rasters:["$529"]}},combination:{rasterFunction:"Combination",variableName:"AnalysisRaster",rasterFunctionArguments:{RasterRange:[1,140],Raster2Length:[4],Raster:{rasterFunction:"Combination",variableName:"AnalysisRaster",rasterFunctionArguments:{RasterRange:[1,14],Raster2Length:[10],Raster:"$521",Raster2:"$2"}},Raster2:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[946,946,947,947,948,948,949,949],OutputValues:[1,2,3,4],Raster:"$529",AllowUnmatched:!1},variableName:"Raster"}}}},boundariesUrl:u,geometryServiceUrl:e,imageServiceUrl:n,clearanceAnalysisUrl:o,printUrl:"http://gis-potico.wri.org/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task/execute",alertUrl:{forma:"http://gfw-apis.appspot.com/subscribe",fires:"https://gfw-fires.wri.org/subscribe_by_polygon"},millPointInfo:{concession:{title:"Concession Analysis",content:"A risk assessment for concession areas within a 50km sourcing radius of a palm oil mill."},radius:{title:"Radius Analysis",content:"A risk assessment for the entire area within a 50km sourcing radius around a palm oil mill."}},pixelSize:100,totalLoss:{rasterId:"$521",bounds:a,labels:f},clearanceAlerts:{rasterId:"$2"},millPoints:{url:"http://update.risk-api.appspot.com/",title:"Palm Oil Mill Risk Assessment",rootNode:"millPoints"},suitability:{url:r,title:"Suitability",rootNode:"suitabilityAnalysis",rasterFunction:"PalmOilSuitability_Histogram",geometryType:"esriGeometryPolygon",lcHistogram:{renderRule:{rasterFunction:"lc_histogram",rasterFunctionArguments:{LCRaster:"$12",LCInpR:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8],LCOutV:[0,1,2,3,4,5,6,7,8]}},renderRuleSuitable:{rasterFunction:"classify_suitability",rasterFunctionArguments:{TargetRaster:"$12",InpTarget:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8],OutVTarget:[0,1,2,3,4,5,6,7,8]}},classIndices:{convertible:[1],production:[2,4],other:[3]}},roadHisto:{mosaicRule:{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[14],ascending:!0,mosaicOperation:"MT_FIRST"},className:"ROAD_DISTANCE_KM"},concessions:{url:"http://gis-potico.wri.org/arcgis/rest/services/CommoditiesAnalyzer/moremaps2_EN/MapServer",layer:"10"},localRights:{content:"Local rights/interests:  Unknown.  To be determined through field assessments.",fieldAssessmentUrl:s,fieldAssessmentLabel:"Learn about field assessments."},chart:{title:"Suitability by Legal Classification",suitable:{color:"#461D7C",name:"Suitable",id:"donut-Suitable"},unsuitable:{color:"#FDD023",name:"Unsuitable",id:"donut-Unsuitable"},childrenLabels:["HP/HPT","HPK","APL"],childrenColors:["#74C476","#E69800","#FFFFBE"]}},clearanceBounds:{url:t,baseYearLabel:14},rspo:{rootNode:"rspoData",title:"RSPO Land Use Change Analysis",rasterId:"$5",bounds:p,lossBounds:[5,13],colors:d},primaryForest:{rootNode:"primaryForest",title:"Primary Forests - Indonesia",rasterId:"$519",formaId:"$11",bounds:m,labels:v,clearanceChart:{title:"Clearance Alerts in Primary Forests since Jan 2013",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) in Primary Forests",removeBelowYear:2005},compositionAnalysis:{rasterId:519,histogramSlice:1},colors:g,fireKey:"primaryForest"},treeCover:{rootNode:"treeCoverDensity",title:"Tree Cover Density",rasterId:"$520",formaId:"$12",includeFormaIdInRemap:!0,rasterRemap:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[31,51,51,75,75,101],OutputValues:[1,2,3],Raster:"$520",AllowUnmatched:!1}},bounds:c,labels:l,clearanceChart:{title:"Clearance Alerts on Tree Cover Density since Jan 2013",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Tree Cover Density"},compositionAnalysis:{title:"Tree Cover Density (30%-100%)",rasterId:520,histogramSlice:31},colors:h,fireKey:"treeCover",errors:{composition:"No Tree Cover Density greater than 30% detected in this area."}},treeCoverLoss:{rootNode:"treeCoverLoss",title:"Tree Cover Loss",rasterId:"$517",mosaicRule:{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[521],ascending:!0,mosaicOperation:"MT_FIRST"},lossChart:{title:"Annual Tree Cover Loss (in hectares)"},compositionAnalysis:{rasterId:521,histogramSlice:1},bounds:c,color:"#DB6598",labels:[]},legalClass:{rootNode:"legalClasses",title:"Legal Classifications",rasterId:"$7",bounds:b,labels:y,clearanceChart:{title:"Clearance Alerts on Legal Classifications since Jan 2013",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Legal Classifications",removeBelowYear:2005},colors:w,fireKey:"legalClass"},indonesiaMoratorium:{rootNode:"indoMoratorium",title:"Indonesia Moratorium",rasterId:"$522",formaId:"$14",bounds:S,labels:E,clearanceChart:{title:"Clearance alerts on Moratorium Areas since Jan 2013",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Indonesia Moratorium",removeBelowYear:2011},colors:x,fireKey:"indonesiaMoratorium",compositionAnalysis:{rasterId:522,histogramSlice:1}},protectedArea:{rootNode:"protectedAreas",title:"Protected Areas",rasterId:"$10",bounds:N,labels:T,clearanceChart:{title:"Clearance Alerts on Protected Areas since Jan 2013",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Protected Areas"},compositionAnalysis:{rasterId:10,histogramSlice:1},colors:C,fireKey:"protectedArea",errors:{composition:"No protected areas detected in this area."}},carbonStock:{rootNode:"carbonStocks",title:"Forest Carbon Stocks",rasterId:"$1",bounds:L,labels:k,clearanceChart:{title:"Clearance Alerts on Forest Carbon Stocks since Jan 2013",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Forest Carbon Stocks (Mg C /Ha)",removeBelowYear:2005},colors:A,fireKey:"carbonStock"},intactForest:{rootNode:"intactForestLandscape",title:"Intact Forest Landscapes",rasterId:"$9",bounds:M,labels:O,clearanceChart:{title:"Clearance Alerts on Intact Forest Landscapes since Jan 2013",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Intact Forest Landscapes"},colors:_,fireKey:"intactForest",errors:{composition:"No intact forest landscapes data available in this area."}},peatLands:{rootNode:"peatLands",title:"Peat Lands",rasterId:"$8",bounds:P,labels:D,clearanceChart:{title:"Clearance Alerts on Peat Lands since Jan 2013",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Peat Lands",removeBelowYear:2002},compositionAnalysis:{rasterId:8,histogramSlice:1},colors:H,fireKey:"peatLands",errors:{composition:"Np peat land detected in this area according to indonesia peat data."}},landCoverGlobal:{rootNode:"globalLandCover",title:"Land Cover - Global",rasterId:"$525",bounds:j,labels:B,clearanceChart:{title:"Clearance Alerts on Land Cover - Global since Jan 2013",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Land Cover - Global",removeBelowYear:2004},colors:F,fireKey:"landCoverGlobal"},landCoverAsia:{rootNode:"asiaLandCover",title:"Land Cover - Southeast Asia",rasterId:"$4",bounds:q,labels:I,clearanceChart:{title:"Clearance Alerts on Land Cover - Southeast Asia since Jan 2013",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Land Cover - Southeast Asia",removeBelowYear:2005},colors:R,fireKey:"landCoverAsia"},landCoverIndo:{rootNode:"indoLandCover",title:"Land Cover - Indonesia",rasterId:"$6",bounds:z,labels:U,clearanceChart:{title:"Clearance Alerts on Land Cover - Indonesia since Jan 2013",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Land Cover - Indonesia",removeBelowYear:2006},colors:W,fireKey:"landCoverIndo"},fires:{url:i,primaryForest:{type:"pie",field:"primary_fo",labels:v,bounds:m,colors:g,title:"Active Fires in Primary Forests over the past 7 days",badgeDesc:"in primary forests out of"},treeCover:{type:"pie",field:"treecover",labels:l,bounds:[1,5],colors:h,title:"Active Fires by Tree Cover Density over the past 7 days",badgeDesc:"on tree cover density out of"},legalClass:{type:"pie",field:"legal",labels:y,bounds:b,colors:w,title:"Active Fires by Legal Classifications over the past 7 days",badgeDesc:"on legal classes out of"},carbonStock:{type:"pie",field:"carbon",labels:k,bounds:L,colors:A,title:"Active Fires by Forest Carbon Stocks over the past 7 days",badgeDesc:"on forest carbon stocks out of"},protectedArea:{type:"badge",field:"wdpa",badgeDesc:"in protected areas out of"},intactForest:{type:"badge",field:"ifl",badgeDesc:"on intact forest landscapes out of"},peatLands:{type:"badge",field:"peat",badgeDesc:"on peat lands out of"},landCoverGlobal:{type:"pie",field:"lc_global",labels:B,bounds:j,colors:F,title:"Active Fires by Land Cover - Global over the past 7 days",badgeDesc:"on land cover global out of"},landCoverAsia:{type:"pie",field:"lc_seasia",labels:I,bounds:q,colors:R,title:"Active Fires by Land Cover - Southeast Asia over the past 7 days",badgeDesc:"on land cover southeast asia out of"},landCoverIndo:{type:"pie",field:"lc_ind",labels:U,bounds:z,colors:W,title:"Active Fires by Land Cover - Indonesia over the past 7 days",badgeDesc:"on land cover indonesia out of"},indonesiaMoratorium:{type:"badge",field:"moratorium",badgeDesc:"on indonesia moratorium out of"}}}}),function(){function e(e,t){if(e!==t){var n=e===e,r=t===t;if(e>t||!n||e===w&&r)return 1;if(e<t||!r||t===w&&n)return-1}return 0}function t(e,t,n){for(var r=e.length,i=n?r:-1;n?i--:++i<r;)if(t(e[i],i,e))return i;return-1}function n(e,t,n){if(t!==t)return h(e,n);n-=1;for(var r=e.length;++n<r;)if(e[n]===t)return n;return-1}function r(e){return typeof e=="function"||!1}function i(e){return typeof e=="string"?e:null==e?"":e+""}function s(e){return e.charCodeAt(0)}function o(e,t){for(var n=-1,r=e.length;++n<r&&-1<t.indexOf(e.charAt(n)););return n}function u(e,t){for(var n=e.length;n--&&-1<t.indexOf(e.charAt(n)););return n}function a(t,n){return e(t.a,n.a)||t.b-n.b}function f(e){return Bt[e]}function l(e){return jt[e]}function c(e){return"\\"+qt[e]}function h(e,t,n){var r=e.length;for(t+=n?0:-1;n?t--:++t<r;){var i=e[t];if(i!==i)return t}return-1}function p(e){return!!e&&typeof e=="object"}function d(e){return 160>=e&&9<=e&&13>=e||32==e||160==e||5760==e||6158==e||8192<=e&&(8202>=e||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function v(e,t){for(var n=-1,r=e.length,i=-1,s=[];++n<r;)e[n]===t&&(e[n]=I,s[++i]=n);return s}function m(e){for(var t=-1,n=e.length;++t<n&&d(e.charCodeAt(t)););return t}function g(e){for(var t=e.length;t--&&d(e.charCodeAt(t)););return t}function y(e){return Ft[e]}function b(d){function Bt(e){if(p(e)&&!(gu(e)||e instanceof It)){if(e instanceof Ft)return e;if(Ds.call(e,"__chain__")&&Ds.call(e,"__wrapped__"))return Si(e)}return new Ft(e)}function jt(){}function Ft(e,t,n){this.__wrapped__=e,this.__actions__=n||[],this.__chain__=!!t}function It(e){this.__wrapped__=e,this.__actions__=null,this.__dir__=1,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=ho,this.__views__=null}function qt(){this.__data__={}}function Rt(e){var t=e?e.length:0;for(this.data={hash:no(null),set:new Js};t--;)this.push(e[t])}function Ut(e,t){var n=e.data;return(typeof t=="string"||Ki(t)?n.set.has(t):n.hash[t])?0:-1}function zt(e,t){var n=-1,r=e.length;for(t||(t=ys(r));++n<r;)t[n]=e[n];return t}function Wt(e,t){for(var n=-1,r=e.length;++n<r&&!1!==t(e[n],n,e););return e}function Xt(e,t){for(var n=-1,r=e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function Jt(e,t){for(var n=-1,r=e.length,i=-1,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[++i]=o)}return s}function Kt(e,t){for(var n=-1,r=e.length,i=ys(r);++n<r;)i[n]=t(e[n],n,e);return i}function Qt(e,t,n,r){var i=-1,s=e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function Gt(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Yt(e,t){return e===w?t:e}function Zt(e,t,n,r){return e!==w&&Ds.call(r,n)?e:t}function Ln(e,t,n){var r=Au(t);Xs.apply(r,Do(t));for(var i=-1,s=r.length;++i<s;){var o=r[i],u=e[o],a=n(u,t[o],o,e,t);(a===a?a===u:u!==u)&&(u!==w||o in e)||(e[o]=a)}return e}function Mn(e,t){for(var n=-1,r=null==e,i=!r&&ai(e),s=i&&e.length,o=t.length,u=ys(o);++n<o;){var a=t[n];u[n]=i?fi(a,s)?e[a]:w:r?w:e[a]}return u}function Dn(e,t,n){n||(n={});for(var r=-1,i=t.length;++r<i;){var s=t[r];n[s]=e[s]}return n}function Pn(e,t,n){var r=typeof e;return"function"==r?t===w?e:xr(e,t,n):null==e?ps:"object"==r?ir(e):t===w?gs(e):sr(e,t)}function Hn(e,t,n,r,i,s,o){var u;if(n&&(u=i?n(e,r,i):n(e)),u!==w)return u;if(!Ki(e))return e;if(r=gu(e)){if(u=ii(e),!t)return zt(e,u)}else{var a=Hs.call(e),f=a==X;if(a!=$&&a!=q&&(!f||i))return Pt[a]?oi(e,a,t):i?e:{};if(u=si(f?{}:e),!t)return So(u,e)}for(s||(s=[]),o||(o=[]),i=s.length;i--;)if(s[i]==e)return o[i];return s.push(e),o.push(u),(r?Wt:Kn)(e,function(r,i){u[i]=Hn(r,t,n,i,e,s,o)}),u}function Bn(e,t,n){if(typeof e!="function")throw new ks(F);return Ks(function(){e.apply(w,n)},t)}function qn(e,t){var r=e?e.length:0,i=[];if(!r)return i;var s=-1,o=ri(),u=o==n,a=u&&200<=t.length?Ao(t):null,f=t.length;a&&(o=Ut,u=!1,t=a);e:for(;++s<r;)if(a=e[s],u&&a===a){for(var l=f;l--;)if(t[l]===a)continue e;i.push(a)}else 0>o(t,a,0)&&i.push(a);return i}function zn(e,t){var n=!0;return To(e,function(e,r,i){return n=!!t(e,r,i)}),n}function Xn(e,t){var n=[];return To(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function Vn(e,t,n,r){var i;return n(e,function(e,n,s){return t(e,n,s)?(i=r?n:e,!1):void 0}),i}function $n(e,t,n){for(var r=-1,i=e.length,s=-1,o=[];++r<i;){var u=e[r];if(p(u)&&ai(u)&&(n||gu(u)||Vi(u))){t&&(u=$n(u,t,n));for(var a=-1,f=u.length;++a<f;)o[++s]=u[a]}else n||(o[++s]=u)}return o}function Jn(e,t){Co(e,t,rs)}function Kn(e,t){return Co(e,t,Au)}function Qn(e,t){return ko(e,t,Au)}function Gn(e,t){for(var n=-1,r=t.length,i=-1,s=[];++n<r;){var o=t[n];bu(e[o])&&(s[++i]=o)}return s}function er(e,t,n){if(null!=e){n!==w&&n in wi(e)&&(t=[n]),n=-1;for(var r=t.length;null!=e&&++n<r;)e=e[t[n]];return n&&n==r?e:w}}function tr(e,t,n,r,i,s){if(e===t)return!0;var o=typeof e,u=typeof t;if("function"!=o&&"object"!=o&&"function"!=u&&"object"!=u||null==e||null==t)e=e!==e&&t!==t;else e:{var o=tr,u=gu(e),a=gu(t),f=R,l=R;u||(f=Hs.call(e),f==q?f=$:f!=$&&(u=es(e))),a||(l=Hs.call(t),l==q?l=$:l!=$&&es(t));var c=f==$,a=l==$,l=f==l;if(!l||u||c){if(!r&&(f=c&&Ds.call(e,"__wrapped__"),a=a&&Ds.call(t,"__wrapped__"),f||a)){e=o(f?e.value():e,a?t.value():t,n,r,i,s);break e}if(l){for(i||(i=[]),s||(s=[]),f=i.length;f--;)if(i[f]==e){e=s[f]==t;break e}i.push(e),s.push(t),e=(u?Yr:ei)(e,t,o,n,r,i,s),i.pop(),s.pop()}else e=!1}else e=Zr(e,t,f)}return e}function nr(e,t,n,r,i){for(var s=-1,o=t.length,u=!i;++s<o;)if(u&&r[s]?n[s]!==e[t[s]]:!(t[s]in e))return!1;for(s=-1;++s<o;){var a=t[s],f=e[a],l=n[s];if(u&&r[s]?a=f!==w||a in e:(a=i?i(f,l,a):w,a===w&&(a=tr(l,f,i,!0))),!a)return!1}return!0}function rr(e,t){var n=-1,r=ai(e)?ys(e.length):[];return To(e,function(e,i,s){r[++n]=t(e,i,s)}),r}function ir(e){var t=Au(e),n=t.length;if(!n)return hs(!0);if(1==n){var r=t[0],i=e[r];if(di(i))return function(e){return null==e?!1:e[r]===i&&(i!==w||r in wi(e))}}for(var s=ys(n),o=ys(n);n--;)i=e[t[n]],s[n]=i,o[n]=di(i);return function(e){return null!=e&&nr(wi(e),t,s,o)}}function sr(e,t){var n=gu(e),r=ci(e)&&di(t),i=e+"";return e=Ei(e),function(s){if(null==s)return!1;var o=i;if(s=wi(s),!(!n&&r||o in s)){if(s=1==e.length?s:er(s,hr(e,0,-1)),null==s)return!1;o=ki(e),s=wi(s)}return s[o]===t?t!==w||o in s:tr(t,s[o],null,!0)}}function or(e,t,n,r,i){if(!Ki(e))return e;var s=ai(t)&&(gu(t)||es(t));if(!s){var o=Au(t);Xs.apply(o,Do(t))}return Wt(o||t,function(u,a){if(o&&(a=u,u=t[a]),p(u)){r||(r=[]),i||(i=[]);e:{for(var f=a,l=r,c=i,h=l.length,d=t[f];h--;)if(l[h]==d){e[f]=c[h];break e}var h=e[f],v=n?n(h,d,f,e,t):w,m=v===w;m&&(v=d,ai(d)&&(gu(d)||es(d))?v=gu(h)?h:ai(h)?zt(h):[]:wu(d)||Vi(d)?v=Vi(h)?ts(h):wu(h)?h:{}:m=!1),l.push(d),c.push(v),m?e[f]=or(v,d,n,l,c):(v===v?v!==h:h===h)&&(e[f]=v)}}else f=e[a],l=n?n(f,u,a,e,t):w,(c=l===w)&&(l=u),!s&&l===w||!c&&(l===l?l===f:f!==f)||(e[a]=l)}),e}function ur(e){return function(t){return null==t?w:t[e]}}function ar(e){var t=e+"";return e=Ei(e),function(n){return er(n,e,t)}}function fr(e,t){for(var n=e?t.length:0;n--;){var r=parseFloat(t[n]);if(r!=i&&fi(r)){var i=r;Qs.call(e,r,1)}}}function lr(e,t){return e+Us(lo()*(t-e+1))}function cr(e,t,n,r,i){return i(e,function(e,i,s){n=r?(r=!1,e):t(n,e,i,s)}),n}function hr(e,t,n){var r=-1,i=e.length;for(t=null==t?0:+t||0,0>t&&(t=-t>i?0:i+t),n=n===w||n>i?i:+n||0,0>n&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0,n=ys(i);++r<i;)n[r]=e[r+t];return n}function pr(e,t){var n;return To(e,function(e,r,i){return n=t(e,r,i),!n}),!!n}function dr(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].c;return e}function vr(t,n,r){var i=ni(),s=-1;return n=Kt(n,function(e){return i(e)}),t=rr(t,function(e){return{a:Kt(n,function(t){return t(e)}),b:++s,c:e}}),dr(t,function(t,n){var i;e:{i=-1;for(var s=t.a,o=n.a,u=s.length,a=r.length;++i<u;){var f=e(s[i],o[i]);if(f){i=i<a?f*(r[i]?1:-1):f;break e}}i=t.b-n.b}return i})}function mr(e,t){var n=0;return To(e,function(e,r,i){n+=+t(e,r,i)||0}),n}function gr(e,t){var r=-1,i=ri(),s=e.length,o=i==n,u=o&&200<=s,a=u?Ao():null,f=[];a?(i=Ut,o=!1):(u=!1,a=t?[]:f);e:for(;++r<s;){var l=e[r],c=t?t(l,r,e):l;if(o&&l===l){for(var h=a.length;h--;)if(a[h]===c)continue e;t&&a.push(c),f.push(l)}else 0>i(a,c,0)&&((t||u)&&a.push(c),f.push(l))}return f}function yr(e,t){for(var n=-1,r=t.length,i=ys(r);++n<r;)i[n]=e[t[n]];return i}function br(e,t,n,r){for(var i=e.length,s=r?i:-1;(r?s--:++s<i)&&t(e[s],s,e););return n?hr(e,r?0:s,r?s+1:i):hr(e,r?s+1:0,r?i:s)}function wr(e,t){var n=e;n instanceof It&&(n=n.value());for(var r=-1,i=t.length;++r<i;){var n=[n],s=t[r];Xs.apply(n,s.args),n=s.func.apply(s.thisArg,n)}return n}function Er(e,t,n){var r=0,i=e?e.length:r;if(typeof t=="number"&&t===t&&i<=mo){for(;r<i;){var s=r+i>>>1,o=e[s];(n?o<=t:o<t)?r=s+1:i=s}return i}return Sr(e,t,ps,n)}function Sr(e,t,n,r){t=n(t);for(var i=0,s=e?e.length:0,o=t!==t,u=t===w;i<s;){var a=Us((i+s)/2),f=n(e[a]),l=f===f;(o?l||r:u?l&&(r||f!==w):r?f<=t:f<t)?i=a+1:s=a}return oo(s,vo)}function xr(e,t,n){if(typeof e!="function")return ps;if(t===w)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)};case 5:return function(n,r,i,s,o){return e.call(t,n,r,i,s,o)}}return function(){return e.apply(t,arguments)}}function Tr(e){return Is.call(e,0)}function Nr(e,t,n){for(var r=n.length,i=-1,s=so(e.length-r,0),o=-1,u=t.length,a=ys(s+u);++o<u;)a[o]=t[o];for(;++i<r;)a[n[i]]=e[i];for(;s--;)a[o++]=e[i++];return a}function Cr(e,t,n){for(var r=-1,i=n.length,s=-1,o=so(e.length-i,0),u=-1,a=t.length,f=ys(o+a);++s<o;)f[s]=e[s];for(o=s;++u<a;)f[o+u]=t[u];for(;++r<i;)f[o+n[r]]=e[s++];return f}function kr(e,t){return function(n,r,i){var s=t?t():{};if(r=ni(r,i,3),gu(n)){i=-1;for(var o=n.length;++i<o;){var u=n[i];e(s,u,r(u,i,n),n)}}else To(n,function(t,n,i){e(s,t,r(t,n,i),i)});return s}}function Lr(e){return Xi(function(t,n){var r=-1,i=null==t?0:n.length,s=2<i&&n[i-2],o=2<i&&n[2],u=1<i&&n[i-1];for(typeof s=="function"?(s=xr(s,u,5),i-=2):(s=typeof u=="function"?u:null,i-=s?1:0),o&&li(n[0],n[1],o)&&(s=3>i?null:s,i=1);++r<i;)(o=n[r])&&e(t,o,s);return t})}function Ar(e,t){return function(n,r){var i=n?_o(n):0;if(!pi(i))return e(n,r);for(var s=t?i:-1,o=wi(n);(t?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function Or(e){return function(t,n,r){var i=wi(t);r=r(t);for(var s=r.length,o=e?s:-1;e?o--:++o<s;){var u=r[o];if(!1===n(i[u],u,i))break}return t}}function Mr(e,t){function n(){return(this&&this!==Vt&&this instanceof n?r:e).apply(t,arguments)}var r=Dr(e);return n}function _r(e){return function(t){var n=-1;t=ls(ss(t));for(var r=t.length,i="";++n<r;)i=e(i,t[n],n);return i}}function Dr(e){return function(){var t=xo(e.prototype),n=e.apply(t,arguments);return Ki(n)?n:t}}function Pr(e){function t(n,r,i){return i&&li(n,r,i)&&(r=null),n=Gr(n,e,null,null,null,null,null,r),n.placeholder=t.placeholder,n}return t}function Hr(e,t){return function(n,r,i){i&&li(n,r,i)&&(r=null);var o=ni(),u=null==r;if(o===Pn&&u||(u=!1,r=o(r,i,3)),u){if(r=gu(n),r||!Zi(n))return e(r?n:bi(n));r=s}return ti(n,r,t)}}function Br(e,n){return function(r,i,s){return i=ni(i,s,3),gu(r)?(i=t(r,i,n),-1<i?r[i]:w):Vn(r,i,e)}}function jr(e){return function(n,r,i){return n&&n.length?(r=ni(r,i,3),t(n,r,e)):-1}}function Fr(e){return function(t,n,r){return n=ni(n,r,3),Vn(t,n,e,!0)}}function Ir(e){return function(){var t=arguments.length;if(!t)return function(){return arguments[0]};for(var n,r=e?t:-1,i=0,s=ys(t);e?r--:++r<t;){var o=s[i++]=arguments[r];if(typeof o!="function")throw new ks(F);var u=n?"":Mo(o);n="wrapper"==u?new Ft([]):n}for(r=n?-1:t;++r<t;)o=s[r],u=Mo(o),n=(i="wrapper"==u?Oo(o):null)&&hi(i[0])&&i[1]==(A|N|k|O)&&!i[4].length&&1==i[9]?n[Mo(i[0])].apply(n,i[3]):1==o.length&&hi(o)?n[u]():n.thru(o);return function(){var e=arguments;if(n&&1==e.length&&gu(e[0]))return n.plant(e[0]).value();for(var r=0,e=s[r].apply(this,e);++r<t;)e=s[r].call(this,e);return e}}}function qr(e,t){return function(n,r,i){return typeof r=="function"&&i===w&&gu(n)?e(n,r):t(n,xr(r,i,3))}}function Rr(e){return function(t,n,r){return(typeof n!="function"||r!==w)&&(n=xr(n,r,3)),e(t,n,rs)}}function Ur(e){return function(t,n,r){return(typeof n!="function"||r!==w)&&(n=xr(n,r,3)),e(t,n)}}function zr(e){return function(t,n,r){var i={};return n=ni(n,r,3),Kn(t,function(t,r,s){s=n(t,r,s),r=e?s:r,t=e?t:s,i[r]=t}),i}}function Wr(e){return function(t,n,r){return t=i(t),(e?t:"")+Jr(t,n,r)+(e?"":t)}}function Xr(e){var t=Xi(function(n,r){var i=v(r,t.placeholder);return Gr(n,e,null,r,i)});return t}function Vr(e,t){return function(n,r,i,s){var o=3>arguments.length;return typeof r=="function"&&s===w&&gu(n)?e(n,r,i,o):cr(n,ni(r,s,4),i,o,t)}}function $r(e,t,n,r,i,s,o,u,a,f){function l(){for(var E=arguments.length,T=E,N=ys(E);T--;)N[T]=arguments[T];if(r&&(N=Nr(N,r,i)),s&&(N=Cr(N,s,o)),d||g){var T=l.placeholder,C=v(N,T),E=E-C.length;if(E<f){var A=u?zt(u):null,E=so(f-E,0),O=d?C:null,C=d?null:C,M=d?N:null,N=d?null:N;return t|=d?k:L,t&=~(d?L:k),m||(t&=~(S|x)),N=[e,t,n,M,O,N,C,A,a,E],A=$r.apply(w,N),hi(e)&&Po(A,N),A.placeholder=T,A}}if(T=h?n:this,p&&(e=T[b]),u)for(A=N.length,E=oo(u.length,A),O=zt(N);E--;)C=u[E],N[E]=fi(C,A)?O[C]:w;return c&&a<N.length&&(N.length=a),(this&&this!==Vt&&this instanceof l?y||Dr(e):e).apply(T,N)}var c=t&A,h=t&S,p=t&x,d=t&N,m=t&T,g=t&C,y=!p&&Dr(e),b=e;return l}function Jr(e,t,n){return e=e.length,t=+t,e<t&&ro(t)?(t-=e,n=null==n?" ":n+"",as(n,qs(t/n.length)).slice(0,t)):""}function Kr(e,t,n,r){function i(){for(var t=-1,u=arguments.length,a=-1,f=r.length,l=ys(u+f);++a<f;)l[a]=r[a];for(;u--;)l[a++]=arguments[++t];return(this&&this!==Vt&&this instanceof i?o:e).apply(s?n:this,l)}var s=t&S,o=Dr(e);return i}function Qr(e){return function(t,n,r,i){var s=ni(r);return s===Pn&&null==r?Er(t,n,e):Sr(t,n,s(r,i,1),e)}}function Gr(e,t,n,r,i,s,o,u){var a=t&x;if(!a&&typeof e!="function")throw new ks(F);var f=r?r.length:0;if(f||(t&=~(k|L),r=i=null),f-=i?i.length:0,t&L){var l=r,c=i;r=i=null}var h=a?null:Oo(e);return n=[e,t,n,r,i,l,c,s,o,u],h&&(r=n[1],t=h[1],u=r|t,i=t==A&&r==N||t==A&&r==O&&n[7].length<=h[8]||t==(A|O)&&r==N,(u<A||i)&&(t&S&&(n[2]=h[2],u|=r&S?0:T),(r=h[3])&&(i=n[3],n[3]=i?Nr(i,r,h[4]):zt(r),n[4]=i?v(n[3],I):zt(h[4])),(r=h[5])&&(i=n[5],n[5]=i?Cr(i,r,h[6]):zt(r),n[6]=i?v(n[5],I):zt(h[6])),(r=h[7])&&(n[7]=zt(r)),t&A&&(n[8]=null==n[8]?h[8]:oo(n[8],h[8])),null==n[9]&&(n[9]=h[9]),n[0]=h[0],n[1]=u),t=n[1],u=n[9]),n[9]=null==u?a?0:e.length:so(u-f,0)||0,(h?Lo:Po)(t==S?Mr(n[0],n[2]):t!=k&&t!=(S|k)||n[4].length?$r.apply(w,n):Kr.apply(w,n),n)}function Yr(e,t,n,r,i,s,o){var u=-1,a=e.length,f=t.length,l=!0;if(a!=f&&(!i||f<=a))return!1;for(;l&&++u<a;){var c=e[u],h=t[u],l=w;if(r&&(l=i?r(h,c,u):r(c,h,u)),l===w)if(i)for(var p=f;p--&&(h=t[p],!(l=c&&c===h||n(c,h,r,i,s,o))););else l=c&&c===h||n(c,h,r,i,s,o)}return!!l}function Zr(e,t,n){switch(n){case U:case z:return+e==+t;case W:return e.name==t.name&&e.message==t.message;case V:return e!=+e?t!=+t:e==+t;case J:case K:return e==t+""}return!1}function ei(e,t,n,r,i,s,o){var u=Au(e),a=u.length,f=Au(t).length;if(a!=f&&!i)return!1;for(var f=i,l=-1;++l<a;){var c=u[l],h=i?c in t:Ds.call(t,c);if(h){var p=e[c],d=t[c],h=w;r&&(h=i?r(d,p,c):r(p,d,c)),h===w&&(h=p&&p===d||n(p,d,r,i,s,o))}if(!h)return!1;f||(f="constructor"==c)}return f||(n=e.constructor,r=t.constructor,!(n!=r&&"constructor"in e&&"constructor"in t)||typeof n=="function"&&n instanceof n&&typeof r=="function"&&r instanceof r)?!0:!1}function ti(e,t,n){var r=n?ho:co,i=r,s=i;return To(e,function(e,o,u){o=t(e,o,u),((n?o<i:o>i)||o===r&&o===s)&&(i=o,s=e)}),s}function ni(e,t,n){var r=Bt.callback||cs,r=r===cs?Pn:r;return n?r(e,t,n):r}function ri(e,t,r){var i=Bt.indexOf||Ci,i=i===Ci?n:i;return e?i(e,t,r):i}function ii(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Ds.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function si(e){return e=e.constructor,typeof e=="function"&&e instanceof e||(e=Ts),new e}function oi(e,t,n){var r=e.constructor;switch(t){case Q:return Tr(e);case U:case z:return new r(+e);case G:case Y:case Z:case et:case tt:case nt:case rt:case it:case st:return t=e.buffer,new r(n?Tr(t):t,e.byteOffset,e.length);case V:case K:return new r(e);case J:var i=new r(e.source,Tt.exec(e));i.lastIndex=e.lastIndex}return i}function ui(e,t,n){return null==e||ci(t,e)||(t=Ei(t),e=1==t.length?e:er(e,hr(t,0,-1)),t=ki(t)),t=null==e?e:e[t],null==t?w:t.apply(e,n)}function ai(e){return null!=e&&pi(_o(e))}function fi(e,t){return e=+e,t=null==t?yo:t,-1<e&&0==e%1&&e<t}function li(e,t,n){if(!Ki(n))return!1;var r=typeof t;return("number"==r?ai(n)&&fi(t,n.length):"string"==r&&t in n)?(t=n[t],e===e?e===t:t!==t):!1}function ci(e,t){var n=typeof e;return"string"==n&&gt.test(e)||"number"==n?!0:gu(e)?!1:!mt.test(e)||null!=t&&e in wi(t)}function hi(e){var t=Mo(e);return!!t&&e===Bt[t]&&t in It.prototype}function pi(e){return typeof e=="number"&&-1<e&&0==e%1&&e<=yo}function di(e){return e===e&&!Ki(e)}function vi(e,t){e=wi(e);for(var n=-1,r=t.length,i={};++n<r;){var s=t[n];s in e&&(i[s]=e[s])}return i}function mi(e,t){var n={};return Jn(e,function(e,r,i){t(e,r,i)&&(n[r]=e)}),n}function gi(e){var t;if(!p(e)||Hs.call(e)!=$||!(Ds.call(e,"constructor")||(t=e.constructor,typeof t!="function"||t instanceof t)))return!1;var n;return Jn(e,function(e,t){n=t}),n===w||Ds.call(e,n)}function yi(e){for(var t=rs(e),n=t.length,r=n&&e.length,i=Bt.support,i=r&&pi(r)&&(gu(e)||i.nonEnumArgs&&Vi(e)),s=-1,o=[];++s<n;){var u=t[s];(i&&fi(u,r)||Ds.call(e,u))&&o.push(u)}return o}function bi(e){return null==e?[]:ai(e)?Ki(e)?e:Ts(e):is(e)}function wi(e){return Ki(e)?e:Ts(e)}function Ei(e){if(gu(e))return e;var t=[];return i(e).replace(yt,function(e,n,r,i){t.push(r?i.replace(St,"$1"):n||e)}),t}function Si(e){return e instanceof It?e.clone():new Ft(e.__wrapped__,e.__chain__,zt(e.__actions__))}function xi(e,t,n){return e&&e.length?((n?li(e,t,n):null==t)&&(t=1),hr(e,0>t?0:t)):[]}function Ti(e,t,n){var r=e?e.length:0;return r?((n?li(e,t,n):null==t)&&(t=1),t=r-(+t||0),hr(e,0,0>t?0:t)):[]}function Ni(e){return e?e[0]:w}function Ci(e,t,r){var i=e?e.length:0;if(!i)return-1;if(typeof r=="number")r=0>r?so(i+r,0):r;else if(r)return r=Er(e,t),e=e[r],(t===t?t===e:e!==e)?r:-1;return n(e,t,r||0)}function ki(e){var t=e?e.length:0;return t?e[t-1]:w}function Li(e){return xi(e,1)}function Ai(e,t,r,i){if(!e||!e.length)return[];null!=t&&typeof t!="boolean"&&(i=r,r=li(e,t,i)?null:t,t=!1);var s=ni();if((s!==Pn||null!=r)&&(r=s(r,i,3)),t&&ri()==n){t=r;var o;r=-1,i=e.length;for(var s=-1,u=[];++r<i;){var a=e[r],f=t?t(a,r,e):a;r&&o===f||(o=f,u[++s]=a)}e=u}else e=gr(e,r);return e}function Oi(e){if(!e||!e.length)return[];var t=-1,n=0;e=Jt(e,function(e){return ai(e)?(n=so(e.length,n),!0):void 0});for(var r=ys(n);++t<n;)r[t]=Kt(e,ur(t));return r}function Mi(e,t,n){return e&&e.length?(e=Oi(e),null==t?e:(t=xr(t,n,4),Kt(e,function(e){return Qt(e,t,w,!0)}))):[]}function _i(e,t){var n=-1,r=e?e.length:0,i={};for(!r||t||gu(e[0])||(t=[]);++n<r;){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function Di(e){return e=Bt(e),e.__chain__=!0,e}function Pi(e,t,n){return t.call(n,e)}function Hi(e,t,n){var r=gu(e)?Xt:zn;return n&&li(e,t,n)&&(t=null),(typeof t!="function"||n!==w)&&(t=ni(t,n,3)),r(e,t)}function Bi(e,t,n){var r=gu(e)?Jt:Xn;return t=ni(t,n,3),r(e,t)}function ji(e,t,n,r){var i=e?_o(e):0;return pi(i)||(e=is(e),i=e.length),i?(n=typeof n!="number"||r&&li(t,n,r)?0:0>n?so(i+n,0):n||0,typeof e=="string"||!gu(e)&&Zi(e)?n<i&&-1<e.indexOf(t,n):-1<ri(e,t,n)):!1}function Fi(e,t,n){var r=gu(e)?Kt:rr;return t=ni(t,n,3),r(e,t)}function Ii(e,t,n){return(n?li(e,t,n):null==t)?(e=bi(e),t=e.length,0<t?e[lr(0,t-1)]:w):(e=qi(e),e.length=oo(0>t?0:+t||0,e.length),e)}function qi(e){e=bi(e);for(var t=-1,n=e.length,r=ys(n);++t<n;){var i=lr(0,t);t!=i&&(r[t]=r[i]),r[i]=e[t]}return r}function Ri(e,t,n){var r=gu(e)?Gt:pr;return n&&li(e,t,n)&&(t=null),(typeof t!="function"||n!==w)&&(t=ni(t,n,3)),r(e,t)}function Ui(e,t){var n;if(typeof t!="function"){if(typeof e!="function")throw new ks(F);var r=e;e=t,t=r}return function(){return 0<--e&&(n=t.apply(this,arguments)),1>=e&&(t=null),n}}function zi(e,t,n){function r(){var n=t-(iu()-f);0>=n||n>t?(u&&Rs(u),n=h,u=c=h=w,n&&(p=iu(),a=e.apply(l,o),c||u||(o=l=null))):c=Ks(r,n)}function i(){c&&Rs(c),u=c=h=w,(v||d!==t)&&(p=iu(),a=e.apply(l,o),c||u||(o=l=null))}function s(){if(o=arguments,f=iu(),l=this,h=v&&(c||!m),!1===d)var n=m&&!c;else{u||m||(p=f);var s=d-(f-p),g=0>=s||s>d;g?(u&&(u=Rs(u)),p=f,a=e.apply(l,o)):u||(u=Ks(i,s))}return g&&c?c=Rs(c):c||t===d||(c=Ks(r,t)),n&&(g=!0,a=e.apply(l,o)),!g||c||u||(o=l=null),a}var o,u,a,f,l,c,h,p=0,d=!1,v=!0;if(typeof e!="function")throw new ks(F);if(t=0>t?0:+t||0,!0===n)var m=!0,v=!1;else Ki(n)&&(m=n.leading,d="maxWait"in n&&so(+n.maxWait||0,t),v="trailing"in n?n.trailing:v);return s.cancel=function(){c&&Rs(c),u&&Rs(u),u=c=h=w},s}function Wi(e,t){function n(){var r=arguments,i=n.cache,s=t?t.apply(this,r):r[0];return i.has(s)?i.get(s):(r=e.apply(this,r),i.set(s,r),r)}if(typeof e!="function"||t&&typeof t!="function")throw new ks(F);return n.cache=new Wi.Cache,n}function Xi(e,t){if(typeof e!="function")throw new ks(F);return t=so(t===w?e.length-1:+t||0,0),function(){for(var n=arguments,r=-1,i=so(n.length-t,0),s=ys(i);++r<i;)s[r]=n[t+r];switch(t){case 0:return e.call(this,s);case 1:return e.call(this,n[0],s);case 2:return e.call(this,n[0],n[1],s)}for(i=ys(t+1),r=-1;++r<t;)i[r]=n[r];return i[t]=s,e.apply(this,i)}}function Vi(e){return p(e)&&ai(e)&&Hs.call(e)==q}function $i(e){return!!e&&1===e.nodeType&&p(e)&&-1<Hs.call(e).indexOf("Element")}function Ji(e){return p(e)&&typeof e.message=="string"&&Hs.call(e)==W}function Ki(e){var t=typeof e;return"function"==t||!!e&&"object"==t}function Qi(e){return null==e?!1:Hs.call(e)==X?js.test(_s.call(e)):p(e)&&Ct.test(e)}function Gi(e){return typeof e=="number"||p(e)&&Hs.call(e)==V}function Yi(e){return p(e)&&Hs.call(e)==J}function Zi(e){return typeof e=="string"||p(e)&&Hs.call(e)==K}function es(e){return p(e)&&pi(e.length)&&!!Dt[Hs.call(e)]}function ts(e){return Dn(e,rs(e))}function ns(e){return Gn(e,rs(e))}function rs(e){if(null==e)return[];Ki(e)||(e=Ts(e));for(var t=e.length,t=t&&pi(t)&&(gu(e)||Eo.nonEnumArgs&&Vi(e))&&t||0,n=e.constructor,r=-1,n=typeof n=="function"&&n.prototype===e,i=ys(t),s=0<t;++r<t;)i[r]=r+"";for(var o in e)s&&fi(o,t)||"constructor"==o&&(n||!Ds.call(e,o))||i.push(o);return i}function is(e){return yr(e,Au(e))}function ss(e){return(e=i(e))&&e.replace(kt,f).replace(Et,"")}function os(e){return(e=i(e))&&wt.test(e)?e.replace(bt,"\\$&"):e}function us(e,t,n){return n&&li(e,t,n)&&(t=0),fo(e,t)}function as(e,t){var n="";if(e=i(e),t=+t,1>t||!e||!ro(t))return n;do t%2&&(n+=e),t=Us(t/2),e+=e;while(t);return n}function fs(e,t,n){var r=e;return(e=i(e))?(n?li(r,t,n):null==t)?e.slice(m(e),g(e)+1):(t+="",e.slice(o(e,t),u(e,t)+1)):e}function ls(e,t,n){return n&&li(e,t,n)&&(t=null),e=i(e),e.match(t||Ot)||[]}function cs(e,t,n){return n&&li(e,t,n)&&(t=null),p(e)?ds(e):Pn(e,t)}function hs(e){return function(){return e}}function ps(e){return e}function ds(e){return ir(Hn(e,!0))}function vs(e,t,n){if(null==n){var r=Ki(t),i=r&&Au(t);((i=i&&i.length&&Gn(t,i))?i.length:r)||(i=!1,n=t,t=e,e=this)}i||(i=Gn(t,Au(t)));var s=!0,r=-1,o=bu(e),u=i.length;!1===n?s=!1:Ki(n)&&"chain"in n&&(s=n.chain);for(;++r<u;){n=i[r];var a=t[n];e[n]=a,o&&(e.prototype[n]=function(t){return function(){var n=this.__chain__;if(s||n){var r=e(this.__wrapped__);return(r.__actions__=zt(this.__actions__)).push({func:t,args:arguments,thisArg:e}),r.__chain__=n,r}return n=[this.value()],Xs.apply(n,arguments),t.apply(e,n)}}(a))}return e}function ms(){}function gs(e){return ci(e)?ur(e):ar(e)}d=d?$t.defaults(Vt.Object(),d,$t.pick(Vt,_t)):Vt;var ys=d.Array,bs=d.Date,ws=d.Error,Es=d.Function,Ss=d.Math,xs=d.Number,Ts=d.Object,Ns=d.RegExp,Cs=d.String,ks=d.TypeError,Ls=ys.prototype,As=Ts.prototype,Os=Cs.prototype,Ms=(Ms=d.window)&&Ms.document,_s=Es.prototype.toString,Ds=As.hasOwnProperty,Ps=0,Hs=As.toString,Bs=d._,js=Ns("^"+os(Hs).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fs=Qi(Fs=d.ArrayBuffer)&&Fs,Is=Qi(Is=Fs&&(new Fs(0)).slice)&&Is,qs=Ss.ceil,Rs=d.clearTimeout,Us=Ss.floor,zs=Qi(zs=Ts.getOwnPropertySymbols)&&zs,Ws=Qi(Ws=Ts.getPrototypeOf)&&Ws,Xs=Ls.push,Vs=Qi(Vs=Ts.preventExtensions)&&Vs,$s=As.propertyIsEnumerable,Js=Qi(Js=d.Set)&&Js,Ks=d.setTimeout,Qs=Ls.splice,Gs=Qi(Gs=d.Uint8Array)&&Gs,Ys=Qi(Ys=d.WeakMap)&&Ys,Zs=function(){try{var e=Qi(e=d.Float64Array)&&e,t=new e(new Fs(10),0,1)&&e}catch(n){}return t}(),eo=function(){var e=Vs&&Qi(e=Ts.assign)&&e;try{if(e){var t=Vs({1:0});t[0]=1}}catch(n){try{e(t,"xo")}catch(r){}return!t[1]&&e}return!1}(),to=Qi(to=ys.isArray)&&to,no=Qi(no=Ts.create)&&no,ro=d.isFinite,io=Qi(io=Ts.keys)&&io,so=Ss.max,oo=Ss.min,uo=Qi(uo=bs.now)&&uo,ao=Qi(ao=xs.isFinite)&&ao,fo=d.parseInt,lo=Ss.random,co=xs.NEGATIVE_INFINITY,ho=xs.POSITIVE_INFINITY,po=Ss.pow(2,32)-1,vo=po-1,mo=po>>>1,go=Zs?Zs.BYTES_PER_ELEMENT:0,yo=Ss.pow(2,53)-1,bo=Ys&&new Ys,wo={},Eo=Bt.support={};!function(e){function t(){this.x=e}var n=arguments,r=[];t.prototype={valueOf:e,y:e};for(var i in new t)r.push(i);Eo.funcDecomp=/\bthis\b/.test(function(){return this}),Eo.funcNames=typeof Es.name=="string";try{Eo.dom=11===Ms.createDocumentFragment().nodeType}catch(s){Eo.dom=!1}try{Eo.nonEnumArgs=!$s.call(n,1)}catch(o){Eo.nonEnumArgs=!0}}(1,0),Bt.templateSettings={escape:pt,evaluate:dt,interpolate:vt,variable:"",imports:{_:Bt}};var So=eo||function(e,t){return null==t?e:Dn(t,Do(t),Dn(t,Au(t),e))},xo=function(){function e(){}return function(t){if(Ki(t)){e.prototype=t;var n=new e;e.prototype=null}return n||d.Object()}}(),To=Ar(Kn),No=Ar(Qn,!0),Co=Or(),ko=Or(!0),Lo=bo?function(e,t){return bo.set(e,t),e}:ps;Is||(Tr=Fs&&Gs?function(e){var t=e.byteLength,n=Zs?Us(t/go):0,r=n*go,i=new Fs(t);if(n){var s=new Zs(i,0,n);s.set(new Zs(e,0,n))}return t!=r&&(s=new Gs(i,r),s.set(new Gs(e,r))),i}:hs(null));var Ao=no&&Js?function(e){return new Rt(e)}:hs(null),Oo=bo?function(e){return bo.get(e)}:ms,Mo=function(){return Eo.funcNames?"constant"==hs.name?ur("name"):function(e){for(var t=e.name,n=wo[t],r=n?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==e)return i.name}return t}:hs("")}(),_o=ur("length"),Do=zs?function(e){return zs(wi(e))}:hs([]),Po=function(){var e=0,t=0;return function(n,r){var i=iu(),s=P-(i-t);if(t=i,0<s){if(++e>=D)return n}else e=0;return Lo(n,r)}}(),Ho=Xi(function(e,t){return ai(e)?qn(e,$n(t,!1,!0)):[]}),Bo=jr(),jo=jr(!0),Fo=Xi(function(t,n){n=$n(n);var r=Mn(t,n);return fr(t,n.sort(e)),r}),Io=Qr(),qo=Qr(!0),Ro=Xi(function(e){return gr($n(e,!1,!0))}),Uo=Xi(function(e,t){return ai(e)?qn(e,t):[]}),zo=Xi(Oi),Wo=Xi(function(e){var t=e.length,n=e[t-2],r=e[t-1];return 2<t&&typeof n=="function"?t-=2:(n=1<t&&typeof r=="function"?(--t,r):w,r=w),e.length=t,Mi(e,n,r)}),Xo=Xi(function(e,t){return Mn(e,$n(t))}),Vo=kr(function(e,t,n){Ds.call(e,n)?++e[n]:e[n]=1}),$o=Br(To),Jo=Br(No,!0),Ko=qr(Wt,To),Qo=qr(function(e,t){for(var n=e.length;n--&&!1!==t(e[n],n,e););return e},No),Go=kr(function(e,t,n){Ds.call(e,n)?e[n].push(t):e[n]=[t]}),Yo=kr(function(e,t,n){e[n]=t}),Zo=Xi(function(e,t,n){var r=-1,i=typeof t=="function",s=ci(t),o=ai(e)?ys(e.length):[];return To(e,function(e){var u=i?t:s&&null!=e&&e[t];o[++r]=u?u.apply(e,n):ui(e,t,n)}),o}),eu=kr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),tu=Vr(Qt,To),nu=Vr(function(e,t,n,r){var i=e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n},No),ru=Xi(function(e,t){if(null==e)return[];var n=t[2];return n&&li(t[0],t[1],n)&&(t.length=1),vr(e,$n(t),[])}),iu=uo||function(){return(new bs).getTime()},su=Xi(function(e,t,n){var r=S;if(n.length)var i=v(n,su.placeholder),r=r|k;return Gr(e,r,t,n,i)}),ou=Xi(function(e,t){t=t.length?$n(t):ns(e);for(var n=-1,r=t.length;++n<r;){var i=t[n];e[i]=Gr(e[i],S,e)}return e}),uu=Xi(function(e,t,n){var r=S|x;if(n.length)var i=v(n,uu.placeholder),r=r|k;return Gr(t,r,e,n,i)}),au=Pr(N),fu=Pr(C),lu=Xi(function(e,t){return Bn(e,1,t)}),cu=Xi(function(e,t,n){return Bn(e,t,n)}),hu=Ir(),pu=Ir(!0),du=Xr(k),vu=Xr(L),mu=Xi(function(e,t){return Gr(e,O,null,null,null,$n(t))}),gu=to||function(e){return p(e)&&pi(e.length)&&Hs.call(e)==R};Eo.dom||($i=function(e){return!!e&&1===e.nodeType&&p(e)&&!wu(e)});var yu=ao||function(e){return typeof e=="number"&&ro(e)},bu=r(/x/)||Gs&&!r(Gs)?function(e){return Hs.call(e)==X}:r,wu=Ws?function(e){if(!e||Hs.call(e)!=$)return!1;var t=e.valueOf,n=Qi(t)&&(n=Ws(t))&&Ws(n);return n?e==n||Ws(e)==n:gi(e)}:gi,Eu=Lr(function(e,t,n){return n?Ln(e,t,n):So(e,t)}),Su=Xi(function(e){var t=e[0];return null==t?t:(e.push(Yt),Eu.apply(w,e))}),xu=Fr(Kn),Tu=Fr(Qn),Nu=Rr(Co),Cu=Rr(ko),ku=Ur(Kn),Lu=Ur(Qn),Au=io?function(e){var t=null!=e&&e.constructor;return typeof t=="function"&&t.prototype===e||typeof e!="function"&&ai(e)?yi(e):Ki(e)?io(e):[]}:yi,Ou=zr(!0),Mu=zr(),_u=Lr(or),Du=Xi(function(e,t){if(null==e)return{};if("function"!=typeof t[0])return t=Kt($n(t),Cs),vi(e,qn(rs(e),t));var n=xr(t[0],t[1],3);return mi(e,function(e,t,r){return!n(e,t,r)})}),Pu=Xi(function(e,t){return null==e?{}:"function"==typeof t[0]?mi(e,xr(t[0],t[1],3)):vi(e,$n(t))}),Hu=_r(function(e,t,n){return t=t.toLowerCase(),e+(n?t.charAt(0).toUpperCase()+t.slice(1):t)}),Bu=_r(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),ju=Wr(),Fu=Wr(!0);8!=fo(Mt+"08")&&(us=function(e,t,n){return(n?li(e,t,n):null==t)?t=0:t&&(t=+t),e=fs(e),fo(e,t||(Nt.test(e)?16:10))});var Iu=_r(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),qu=_r(function(e,t,n){return e+(n?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),Ru=Xi(function(e,t){try{return e.apply(w,t)}catch(n){return Ji(n)?n:new ws(n)}}),Uu=Xi(function(e,t){return function(n){return ui(n,e,t)}}),zu=Xi(function(e,t){return function(n){return ui(e,n,t)}}),Wu=Hr(function(e){for(var t=-1,n=e.length,r=co;++t<n;){var i=e[t];i>r&&(r=i)}return r}),Xu=Hr(function(e){for(var t=-1,n=e.length,r=ho;++t<n;){var i=e[t];i<r&&(r=i)}return r},!0);return Bt.prototype=jt.prototype,Ft.prototype=xo(jt.prototype),Ft.prototype.constructor=Ft,It.prototype=xo(jt.prototype),It.prototype.constructor=It,qt.prototype["delete"]=function(e){return this.has(e)&&delete this.__data__[e]},qt.prototype.get=function(e){return"__proto__"==e?w:this.__data__[e]},qt.prototype.has=function(e){return"__proto__"!=e&&Ds.call(this.__data__,e)},qt.prototype.set=function(e,t){return"__proto__"!=e&&(this.__data__[e]=t),this},Rt.prototype.push=function(e){var t=this.data;typeof e=="string"||Ki(e)?t.set.add(e):t.hash[e]=!0},Wi.Cache=qt,Bt.after=function(e,t){if(typeof t!="function"){if(typeof e!="function")throw new ks(F);var n=e;e=t,t=n}return e=ro(e=+e)?e:0,function(){return 1>--e?t.apply(this,arguments):void 0}},Bt.ary=function(e,t,n){return n&&li(e,t,n)&&(t=null),t=e&&null==t?e.length:so(+t||0,0),Gr(e,A,null,null,null,null,t)},Bt.assign=Eu,Bt.at=Xo,Bt.before=Ui,Bt.bind=su,Bt.bindAll=ou,Bt.bindKey=uu,Bt.callback=cs,Bt.chain=Di,Bt.chunk=function(e,t,n){t=(n?li(e,t,n):null==t)?1:so(+t||1,1),n=0;for(var r=e?e.length:0,i=-1,s=ys(qs(r/t));n<r;)s[++i]=hr(e,n,n+=t);return s},Bt.compact=function(e){for(var t=-1,n=e?e.length:0,r=-1,i=[];++t<n;){var s=e[t];s&&(i[++r]=s)}return i},Bt.constant=hs,Bt.countBy=Vo,Bt.create=function(e,t,n){var r=xo(e);return n&&li(e,t,n)&&(t=null),t?So(r,t):r},Bt.curry=au,Bt.curryRight=fu,Bt.debounce=zi,Bt.defaults=Su,Bt.defer=lu,Bt.delay=cu,Bt.difference=Ho,Bt.drop=xi,Bt.dropRight=Ti,Bt.dropRightWhile=function(e,t,n){return e&&e.length?br(e,ni(t,n,3),!0,!0):[]},Bt.dropWhile=function(e,t,n){return e&&e.length?br(e,ni(t,n,3),!0):[]},Bt.fill=function(e,t,n,r){var i=e?e.length:0;if(!i)return[];for(n&&typeof n!="number"&&li(e,t,n)&&(n=0,r=i),i=e.length,n=null==n?0:+n||0,0>n&&(n=-n>i?0:i+n),r=r===w||r>i?i:+r||0,0>r&&(r+=i),i=n>r?0:r>>>0,n>>>=0;n<i;)e[n++]=t;return e},Bt.filter=Bi,Bt.flatten=function(e,t,n){var r=e?e.length:0;return n&&li(e,t,n)&&(t=!1),r?$n(e,t):[]},Bt.flattenDeep=function(e){return e&&e.length?$n(e,!0):[]},Bt.flow=hu,Bt.flowRight=pu,Bt.forEach=Ko,Bt.forEachRight=Qo,Bt.forIn=Nu,Bt.forInRight=Cu,Bt.forOwn=ku,Bt.forOwnRight=Lu,Bt.functions=ns,Bt.groupBy=Go,Bt.indexBy=Yo,Bt.initial=function(e){return Ti(e,1)},Bt.intersection=function(){for(var e=[],t=-1,r=arguments.length,i=[],s=ri(),o=s==n,u=[];++t<r;){var a=arguments[t];ai(a)&&(e.push(a),i.push(o&&120<=a.length?Ao(t&&a):null))}if(r=e.length,2>r)return u;var o=e[0],f=-1,l=o?o.length:0,c=i[0];e:for(;++f<l;)if(a=o[f],0>(c?Ut(c,a):s(u,a,0))){for(t=r;--t;){var h=i[t];if(0>(h?Ut(h,a):s(e[t],a,0)))continue e}c&&c.push(a),u.push(a)}return u},Bt.invert=function(e,t,n){n&&li(e,t,n)&&(t=null),n=-1;for(var r=Au(e),i=r.length,s={};++n<i;){var o=r[n],u=e[o];t?Ds.call(s,u)?s[u].push(o):s[u]=[o]:s[u]=o}return s},Bt.invoke=Zo,Bt.keys=Au,Bt.keysIn=rs,Bt.map=Fi,Bt.mapKeys=Ou,Bt.mapValues=Mu,Bt.matches=ds,Bt.matchesProperty=function(e,t){return sr(e,Hn(t,!0))},Bt.memoize=Wi,Bt.merge=_u,Bt.method=Uu,Bt.methodOf=zu,Bt.mixin=vs,Bt.negate=function(e){if(typeof e!="function")throw new ks(F);return function(){return!e.apply(this,arguments)}},Bt.omit=Du,Bt.once=function(e){return Ui(2,e)},Bt.pairs=function(e){for(var t=-1,n=Au(e),r=n.length,i=ys(r);++t<r;){var s=n[t];i[t]=[s,e[s]]}return i},Bt.partial=du,Bt.partialRight=vu,Bt.partition=eu,Bt.pick=Pu,Bt.pluck=function(e,t){return Fi(e,gs(t))},Bt.property=gs,Bt.propertyOf=function(e){return function(t){return er(e,Ei(t),t+"")}},Bt.pull=function(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var n=0,r=ri(),i=e.length;++n<i;)for(var s=0,o=e[n];-1<(s=r(t,o,s));)Qs.call(t,s,1);return t},Bt.pullAt=Fo,Bt.range=function(e,t,n){n&&li(e,t,n)&&(t=n=null),e=+e||0,n=null==n?1:+n||0,null==t?(t=e,e=0):t=+t||0;var r=-1;t=so(qs((t-e)/(n||1)),0);for(var i=ys(t);++r<t;)i[r]=e,e+=n;return i},Bt.rearg=mu,Bt.reject=function(e,t,n){var r=gu(e)?Jt:Xn;return t=ni(t,n,3),r(e,function(e,n,r){return!t(e,n,r)})},Bt.remove=function(e,t,n){var r=[];if(!e||!e.length)return r;var i=-1,s=[],o=e.length;for(t=ni(t,n,3);++i<o;)n=e[i],t(n,i,e)&&(r.push(n),s.push(i));return fr(e,s),r},Bt.rest=Li,Bt.restParam=Xi,Bt.set=function(e,t,n){if(null==e)return e;var r=t+"";t=null!=e[r]||ci(t,e)?[r]:Ei(t);for(var r=-1,i=t.length,s=i-1,o=e;null!=o&&++r<i;){var u=t[r];Ki(o)&&(r==s?o[u]=n:null==o[u]&&(o[u]=fi(t[r+1])?[]:{})),o=o[u]}return e},Bt.shuffle=qi,Bt.slice=function(e,t,n){var r=e?e.length:0;return r?(n&&typeof n!="number"&&li(e,t,n)&&(t=0,n=r),hr(e,t,n)):[]},Bt.sortBy=function(e,t,n){if(null==e)return[];n&&li(e,t,n)&&(t=null);var r=-1;return t=ni(t,n,3),e=rr(e,function(e,n,i){return{a:t(e,n,i),b:++r,c:e}}),dr(e,a)},Bt.sortByAll=ru,Bt.sortByOrder=function(e,t,n,r){return null==e?[]:(r&&li(t,n,r)&&(n=null),gu(t)||(t=null==t?[]:[t]),gu(n)||(n=null==n?[]:[n]),vr(e,t,n))},Bt.spread=function(e){if(typeof e!="function")throw new ks(F);return function(t){return e.apply(this,t)}},Bt.take=function(e,t,n){return e&&e.length?((n?li(e,t,n):null==t)&&(t=1),hr(e,0,0>t?0:t)):[]},Bt.takeRight=function(e,t,n){var r=e?e.length:0;return r?((n?li(e,t,n):null==t)&&(t=1),t=r-(+t||0),hr(e,0>t?0:t)):[]},Bt.takeRightWhile=function(e,t,n){return e&&e.length?br(e,ni(t,n,3),!1,!0):[]},Bt.takeWhile=function(e,t,n){return e&&e.length?br(e,ni(t,n,3)):[]},Bt.tap=function(e,t,n){return t.call(n,e),e},Bt.throttle=function(e,t,n){var r=!0,i=!0;if(typeof e!="function")throw new ks(F);return!1===n?r=!1:Ki(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Ht.leading=r,Ht.maxWait=+t,Ht.trailing=i,zi(e,t,Ht)},Bt.thru=Pi,Bt.times=function(e,t,n){if(e=Us(e),1>e||!ro(e))return[];var r=-1,i=ys(oo(e,po));for(t=xr(t,n,1);++r<e;)r<po?i[r]=t(r):t(r);return i},Bt.toArray=function(e){var t=e?_o(e):0;return pi(t)?t?zt(e):[]:is(e)},Bt.toPlainObject=ts,Bt.transform=function(e,t,n,r){var i=gu(e)||es(e);return t=ni(t,r,4),null==n&&(i||Ki(e)?(r=e.constructor,n=i?gu(e)?new r:[]:xo(bu(r)&&r.prototype)):n={}),(i?Wt:Kn)(e,function(e,r,i){return t(n,e,r,i)}),n},Bt.union=Ro,Bt.uniq=Ai,Bt.unzip=Oi,Bt.unzipWith=Mi,Bt.values=is,Bt.valuesIn=function(e){return yr(e,rs(e))},Bt.where=function(e,t){return Bi(e,ir(t))},Bt.without=Uo,Bt.wrap=function(e,t){return t=null==t?ps:t,Gr(t,k,null,[e],[])},Bt.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(ai(n))var r=r?qn(r,n).concat(qn(n,r)):n}return r?gr(r):[]},Bt.zip=zo,Bt.zipObject=_i,Bt.zipWith=Wo,Bt.backflow=pu,Bt.collect=Fi,Bt.compose=pu,Bt.each=Ko,Bt.eachRight=Qo,Bt.extend=Eu,Bt.iteratee=cs,Bt.methods=ns,Bt.object=_i,Bt.select=Bi,Bt.tail=Li,Bt.unique=Ai,vs(Bt,Bt),Bt.add=function(e,t){return(+e||0)+(+t||0)},Bt.attempt=Ru,Bt.camelCase=Hu,Bt.capitalize=function(e){return(e=i(e))&&e.charAt(0).toUpperCase()+e.slice(1)},Bt.clone=function(e,t,n,r){return t&&typeof t!="boolean"&&li(e,t,n)?t=!1:typeof t=="function"&&(r=n,n=t,t=!1),n=typeof n=="function"&&xr(n,r,1),Hn(e,t,n)},Bt.cloneDeep=function(e,t,n){return t=typeof t=="function"&&xr(t,n,1),Hn(e,!0,t)},Bt.deburr=ss,Bt.endsWith=function(e,t,n){e=i(e),t+="";var r=e.length;return n=n===w?r:oo(0>n?0:+n||0,r),n-=t.length,0<=n&&e.indexOf(t,n)==n},Bt.escape=function(e){return(e=i(e))&&ht.test(e)?e.replace(lt,l):e},Bt.escapeRegExp=os,Bt.every=Hi,Bt.find=$o,Bt.findIndex=Bo,Bt.findKey=xu,Bt.findLast=Jo,Bt.findLastIndex=jo,Bt.findLastKey=Tu,Bt.findWhere=function(e,t){return $o(e,ir(t))},Bt.first=Ni,Bt.get=function(e,t,n){return e=null==e?w:er(e,Ei(t),t+""),e===w?n:e},Bt.has=function(e,t){if(null==e)return!1;var n=Ds.call(e,t);return n||ci(t)||(t=Ei(t),e=1==t.length?e:er(e,hr(t,0,-1)),t=ki(t),n=null!=e&&Ds.call(e,t)),n},Bt.identity=ps,Bt.includes=ji,Bt.indexOf=Ci,Bt.inRange=function(e,t,n){return t=+t||0,"undefined"==typeof n?(n=t,t=0):n=+n||0,e>=oo(t,n)&&e<so(t,n)},Bt.isArguments=Vi,Bt.isArray=gu,Bt.isBoolean=function(e){return!0===e||!1===e||p(e)&&Hs.call(e)==U},Bt.isDate=function(e){return p(e)&&Hs.call(e)==z},Bt.isElement=$i,Bt.isEmpty=function(e){return null==e?!0:ai(e)&&(gu(e)||Zi(e)||Vi(e)||p(e)&&bu(e.splice))?!e.length:!Au(e).length},Bt.isEqual=function(e,t,n,r){return n=typeof n=="function"&&xr(n,r,3),!n&&di(e)&&di(t)?e===t:(r=n?n(e,t):w,r===w?tr(e,t,n):!!r)},Bt.isError=Ji,Bt.isFinite=yu,Bt.isFunction=bu,Bt.isMatch=function(e,t,n,r){var i=Au(t),s=i.length;if(!s)return!0;if(null==e)return!1;if(n=typeof n=="function"&&xr(n,r,3),e=wi(e),!n&&1==s){var o=i[0];if(r=t[o],di(r))return r===e[o]&&(r!==w||o in e)}for(var o=ys(s),u=ys(s);s--;)r=o[s]=t[i[s]],u[s]=di(r);return nr(e,i,o,u,n)},Bt.isNaN=function(e){return Gi(e)&&e!=+e},Bt.isNative=Qi,Bt.isNull=function(e){return null===e},Bt.isNumber=Gi,Bt.isObject=Ki,Bt.isPlainObject=wu,Bt.isRegExp=Yi,Bt.isString=Zi,Bt.isTypedArray=es,Bt.isUndefined=function(e){return e===w},Bt.kebabCase=Bu,Bt.last=ki,Bt.lastIndexOf=function(e,t,n){var r=e?e.length:0;if(!r)return-1;var i=r;if(typeof n=="number")i=(0>n?so(r+n,0):oo(n||0,r-1))+1;else if(n)return i=Er(e,t,!0)-1,e=e[i],(t===t?t===e:e!==e)?i:-1;if(t!==t)return h(e,i,!0);for(;i--;)if(e[i]===t)return i;return-1},Bt.max=Wu,Bt.min=Xu,Bt.noConflict=function(){return d._=Bs,this},Bt.noop=ms,Bt.now=iu,Bt.pad=function(e,t,n){e=i(e),t=+t;var r=e.length;return r<t&&ro(t)?(r=(t-r)/2,t=Us(r),r=qs(r),n=Jr("",r,n),n.slice(0,t)+e+n):e},Bt.padLeft=ju,Bt.padRight=Fu,Bt.parseInt=us,Bt.random=function(e,t,n){n&&li(e,t,n)&&(t=n=null);var r=null==e,i=null==t;return null==n&&(i&&typeof e=="boolean"?(n=e,e=1):typeof t=="boolean"&&(n=t,i=!0)),r&&i&&(t=1,i=!1),e=+e||0,i?(t=e,e=0):t=+t||0,n||e%1||t%1?(n=lo(),oo(e+n*(t-e+parseFloat("1e-"+((n+"").length-1))),t)):lr(e,t)},Bt.reduce=tu,Bt.reduceRight=nu,Bt.repeat=as,Bt.result=function(e,t,n){var r=null==e?w:e[t];return r===w&&(null==e||ci(t,e)||(t=Ei(t),e=1==t.length?e:er(e,hr(t,0,-1)),r=null==e?w:e[ki(t)]),r=r===w?n:r),bu(r)?r.call(e):r},Bt.runInContext=b,Bt.size=function(e){var t=e?_o(e):0;return pi(t)?t:Au(e).length},Bt.snakeCase=Iu,Bt.some=Ri,Bt.sortedIndex=Io,Bt.sortedLastIndex=qo,Bt.startCase=qu,Bt.startsWith=function(e,t,n){return e=i(e),n=null==n?0:oo(0>n?0:+n||0,e.length),e.lastIndexOf(t,n)==n},Bt.sum=function(e,t,n){n&&li(e,t,n)&&(t=null);var r=ni(),i=null==t;if(r===Pn&&i||(i=!1,t=r(t,n,3)),i){for(e=gu(e)?e:bi(e),t=e.length,n=0;t--;)n+=+e[t]||0;e=n}else e=mr(e,t);return e},Bt.template=function(e,t,n){var r=Bt.templateSettings;n&&li(e,t,n)&&(t=n=null),e=i(e),t=Ln(So({},n||t),r,Zt),n=Ln(So({},t.imports),r.imports,Zt);var s,o,u=Au(n),a=yr(n,u),f=0;n=t.interpolate||Lt;var l="__p+='";n=Ns((t.escape||Lt).source+"|"+n.source+"|"+(n===vt?xt:Lt).source+"|"+(t.evaluate||Lt).source+"|$","g");var h="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";if(e.replace(n,function(t,n,r,i,u,a){return r||(r=i),l+=e.slice(f,a).replace(At,c),n&&(s=!0,l+="'+__e("+n+")+'"),u&&(o=!0,l+="';"+u+";\n__p+='"),r&&(l+="'+((__t=("+r+"))==null?'':__t)+'"),f=a+t.length,t}),l+="';",(t=t.variable)||(l="with(obj){"+l+"}"),l=(o?l.replace(ot,""):l).replace(ut,"$1").replace(at,"$1;"),l="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(s?",__e=_.escape":"")+(o?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}",t=Ru(function(){return Es(u,h+"return "+l).apply(w,a)}),t.source=l,Ji(t))throw t;return t},Bt.trim=fs,Bt.trimLeft=function(e,t,n){var r=e;return(e=i(e))?e.slice((n?li(r,t,n):null==t)?m(e):o(e,t+"")):e},Bt.trimRight=function(e,t,n){var r=e;return(e=i(e))?(n?li(r,t,n):null==t)?e.slice(0,g(e)+1):e.slice(0,u(e,t+"")+1):e},Bt.trunc=function(e,t,n){n&&li(e,t,n)&&(t=null);var r=M;if(n=_,null!=t)if(Ki(t)){var s="separator"in t?t.separator:s,r="length"in t?+t.length||0:r;n="omission"in t?i(t.omission):n}else r=+t||0;if(e=i(e),r>=e.length)return e;if(r-=n.length,1>r)return n;if(t=e.slice(0,r),null==s)return t+n;if(Yi(s)){if(e.slice(r).search(s)){var o,u=e.slice(0,r);for(s.global||(s=Ns(s.source,(Tt.exec(s)||"")+"g")),s.lastIndex=0;e=s.exec(u);)o=e.index;t=t.slice(0,null==o?r:o)}}else e.indexOf(s,r)!=r&&(s=t.lastIndexOf(s),-1<s&&(t=t.slice(0,s)));return t+n},Bt.unescape=function(e){return(e=i(e))&&ct.test(e)?e.replace(ft,y):e},Bt.uniqueId=function(e){var t=++Ps;return i(e)+t},Bt.words=ls,Bt.all=Hi,Bt.any=Ri,Bt.contains=ji,Bt.detect=$o,Bt.foldl=tu,Bt.foldr=nu,Bt.head=Ni,Bt.include=ji,Bt.inject=tu,vs(Bt,function(){var e={};return Kn(Bt,function(t,n){Bt.prototype[n]||(e[n]=t)}),e}(),!1),Bt.sample=Ii,Bt.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return Ii(t,e)}):Ii(this.value())},Bt.VERSION=E,Wt("bind bindKey curry curryRight partial partialRight".split(" "),function(e){Bt[e].placeholder=Bt}),Wt(["dropWhile","filter","map","takeWhile"],function(e,t){var n=t!=j,r=t==H;It.prototype[e]=function(e,i){var s=this.__filtered__,o=s&&r?new It(this):this.clone();return(o.__iteratees__||(o.__iteratees__=[])).push({done:!1,count:0,index:0,iteratee:ni(e,i,1),limit:-1,type:t}),o.__filtered__=s||n,o}}),Wt(["drop","take"],function(e,t){var n=e+"While";It.prototype[e]=function(n){var r=this.__filtered__,i=r&&!t?this.dropWhile():this.clone();return n=null==n?1:so(Us(n)||0,0),r?t?i.__takeCount__=oo(i.__takeCount__,n):ki(i.__iteratees__).limit=n:(i.__views__||(i.__views__=[])).push({size:n,type:e+(0>i.__dir__?"Right":"")}),i},It.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()},It.prototype[e+"RightWhile"]=function(e,t){return this.reverse()[n](e,t).reverse()}}),Wt(["first","last"],function(e,t){var n="take"+(t?"Right":"");It.prototype[e]=function(){return this[n](1).value()[0]}}),Wt(["initial","rest"],function(e,t){var n="drop"+(t?"":"Right");It.prototype[e]=function(){return this[n](1)}}),Wt(["pluck","where"],function(e,t){var n=t?"filter":"map",r=t?ir:gs;It.prototype[e]=function(e){return this[n](r(e))}}),It.prototype.compact=function(){return this.filter(ps)},It.prototype.reject=function(e,t){return e=ni(e,t,1),this.filter(function(t){return!e(t)})},It.prototype.slice=function(e,t){e=null==e?0:+e||0;var n=this;return 0>e?n=this.takeRight(-e):e&&(n=this.drop(e)),t!==w&&(t=+t||0,n=0>t?n.dropRight(-t):n.take(t-e)),n},It.prototype.toArray=function(){return this.drop(0)},Kn(It.prototype,function(e,t){var n=Bt[t];if(n){var r=/^(?:filter|map|reject)|While$/.test(t),i=/^(?:first|last)$/.test(t);Bt.prototype[t]=function(){function t(e){return e=[e],Xs.apply(e,s),n.apply(Bt,e)}var s=arguments,o=this.__chain__,u=this.__wrapped__,a=!!this.__actions__.length,f=u instanceof It,l=s[0],c=f||gu(u);return c&&r&&typeof l=="function"&&1!=l.length&&(f=c=!1),f=f&&!a,i&&!o?f?e.call(u):n.call(Bt,this.value()):c?(u=e.apply(f?u:new It(this),s),i||!a&&!u.__actions__||(u.__actions__||(u.__actions__=[])).push({func:Pi,args:[t],thisArg:Bt}),new Ft(u,o)):this.thru(t)}}}),Wt("concat join pop push replace shift sort splice split unshift".split(" "),function(e){var t=(/^(?:replace|split)$/.test(e)?Os:Ls)[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:join|pop|replace|shift)$/.test(e);Bt.prototype[e]=function(){var e=arguments;return r&&!this.__chain__?t.apply(this.value(),e):this[n](function(n){return t.apply(n,e)})}}),Kn(It.prototype,function(e,t){var n=Bt[t];if(n){var r=n.name;(wo[r]||(wo[r]=[])).push({name:t,func:n})}}),wo[$r(null,x).name]=[{name:"wrapper",func:null}],It.prototype.clone=function(){var e=this.__actions__,t=this.__iteratees__,n=this.__views__,r=new It(this.__wrapped__);return r.__actions__=e?zt(e):null,r.__dir__=this.__dir__,r.__filtered__=this.__filtered__,r.__iteratees__=t?zt(t):null,r.__takeCount__=this.__takeCount__,r.__views__=n?zt(n):null,r},It.prototype.reverse=function(){if(this.__filtered__){var e=new It(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e},It.prototype.value=function(){var e=this.__wrapped__.value();if(!gu(e))return wr(e,this.__actions__);var t,n=this.__dir__,r=0>n;t=e.length;for(var i=this.__views__,s=0,o=-1,u=i?i.length:0;++o<u;){var a=i[o],f=a.size;switch(a.type){case"drop":s+=f;break;case"dropRight":t-=f;break;case"take":t=oo(t,s+f);break;case"takeRight":s=so(s,t-f)}}t={start:s,end:t},i=t.start,s=t.end,t=s-i,i=r?s:i-1,s=oo(t,this.__takeCount__),u=(o=this.__iteratees__)?o.length:0,a=0,f=[];e:for(;t--&&a<s;){for(var i=i+n,l=-1,c=e[i];++l<u;){var h=o[l],p=h.iteratee,d=h.type;if(d==H){if(h.done&&(r?i>h.index:i<h.index)&&(h.count=0,h.done=!1),h.index=i,!(h.done||(d=h.limit,h.done=-1<d?h.count++>=d:!p(c))))continue e}else if(h=p(c),d==j)c=h;else if(!h){if(d==B)continue e;break e}}f[a++]=c}return f},Bt.prototype.chain=function(){return Di(this)},Bt.prototype.commit=function(){return new Ft(this.value(),this.__chain__)},Bt.prototype.plant=function(e){for(var t,n=this;n instanceof jt;){var r=Si(n);t?i.__wrapped__=r:t=r;var i=r,n=n.__wrapped__}return i.__wrapped__=e,t},Bt.prototype.reverse=function(){var e=this.__wrapped__;return e instanceof It?(this.__actions__.length&&(e=new It(this)),new Ft(e.reverse(),this.__chain__)):this.thru(function(e){return e.reverse()})},Bt.prototype.toString=function(){return this.value()+""},Bt.prototype.run=Bt.prototype.toJSON=Bt.prototype.valueOf=Bt.prototype.value=function(){return wr(this.__wrapped__,this.__actions__)},Bt.prototype.collect=Bt.prototype.map,Bt.prototype.head=Bt.prototype.first,Bt.prototype.select=Bt.prototype.filter,Bt.prototype.tail=Bt.prototype.rest,Bt}var w,E="3.8.0",S=1,x=2,T=4,N=8,C=16,k=32,L=64,A=128,O=256,M=30,_="...",D=150,P=16,H=0,B=1,j=2,F="Expected a function",I="__lodash_placeholder__",q="[object Arguments]",R="[object Array]",U="[object Boolean]",z="[object Date]",W="[object Error]",X="[object Function]",V="[object Number]",$="[object Object]",J="[object RegExp]",K="[object String]",Q="[object ArrayBuffer]",G="[object Float32Array]",Y="[object Float64Array]",Z="[object Int8Array]",et="[object Int16Array]",tt="[object Int32Array]",nt="[object Uint8Array]",rt="[object Uint8ClampedArray]",it="[object Uint16Array]",st="[object Uint32Array]",ot=/\b__p\+='';/g,ut=/\b(__p\+=)''\+/g,at=/(__e\(.*?\)|\b__t\))\+'';/g,ft=/&(?:amp|lt|gt|quot|#39|#96);/g,lt=/[&<>"'`]/g,ct=RegExp(ft.source),ht=RegExp(lt.source),pt=/<%-([\s\S]+?)%>/g,dt=/<%([\s\S]+?)%>/g,vt=/<%=([\s\S]+?)%>/g,mt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,gt=/^\w*$/,yt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,bt=/[.*+?^${}()|[\]\/\\]/g,wt=RegExp(bt.source),Et=/[\u0300-\u036f\ufe20-\ufe23]/g,St=/\\(\\)?/g,xt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Tt=/\w*$/,Nt=/^0[xX]/,Ct=/^\[object .+?Constructor\]$/,kt=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Lt=/($^)/,At=/['\n\r\u2028\u2029\\]/g,Ot=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),Mt=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",_t="Array ArrayBuffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Math Number Object RegExp Set String _ clearTimeout document isFinite parseInt setTimeout TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap window".split(" "),Dt={};Dt[G]=Dt[Y]=Dt[Z]=Dt[et]=Dt[tt]=Dt[nt]=Dt[rt]=Dt[it]=Dt[st]=!0,Dt[q]=Dt[R]=Dt[Q]=Dt[U]=Dt[z]=Dt[W]=Dt[X]=Dt["[object Map]"]=Dt[V]=Dt[$]=Dt[J]=Dt["[object Set]"]=Dt[K]=Dt["[object WeakMap]"]=!1;var Pt={};Pt[q]=Pt[R]=Pt[Q]=Pt[U]=Pt[z]=Pt[G]=Pt[Y]=Pt[Z]=Pt[et]=Pt[tt]=Pt[V]=Pt[$]=Pt[J]=Pt[K]=Pt[nt]=Pt[rt]=Pt[it]=Pt[st]=!0,Pt[W]=Pt[X]=Pt["[object Map]"]=Pt["[object Set]"]=Pt["[object WeakMap]"]=!1;var Ht={leading:!1,maxWait:0,trailing:!1},Bt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},jt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ft={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},It={"function":!0,object:!0},qt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Rt=It[typeof exports]&&exports&&!exports.nodeType&&exports,Ut=It[typeof module]&&module&&!module.nodeType&&module,zt=It[typeof self]&&self&&self.Object&&self,Wt=It[typeof window]&&window&&window.Object&&window,Xt=Ut&&Ut.exports===Rt&&Rt,Vt=Rt&&Ut&&typeof global=="object"&&global&&global.Object&&global||Wt!==(this&&this.window)&&Wt||zt||this,$t=b();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(Vt._=$t,define("lodash",[],function(){return $t})):Rt&&Ut?Xt?(Ut.exports=$t)._=$t:Rt._=$t:Vt._=$t}.call(this),define("report/CSVExporter",["dojo/_base/array"],function(e){"use strict";function t(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n,r,i,s,o,u,a,f,l=0,c=0,h="",p=[];if(!e)return e;do n=e.charCodeAt(l++),r=e.charCodeAt(l++),i=e.charCodeAt(l++),f=n<<16|r<<8|i,s=f>>18&63,o=f>>12&63,u=f>>6&63,a=f&63,p[c++]=t.charAt(s)+t.charAt(o)+t.charAt(u)+t.charAt(a);while(l<e.length);h=p.join("");var d=e.length%3;return(d?h.slice(0,d-3):h)+"===".slice(d||3)}function n(e,t){t=t||"";var n=1024,r=atob(e),i=r.length,s=Math.ceil(i/n),o=new Array(s);for(var u=0;u<s;++u){var a=u*n,f=Math.min(a+n,i),l=new Array(f-a),c=0;for(var h=a;h<f;++c,++h)l[c]=r[h].charCodeAt(0);o[u]=new Uint8Array(l)}return new Blob(o,{type:t})}function r(t){var n=t.series,r=[],i=[];return e.forEach(n[0].data,function(e){i.push(e.category)}),r.push("Suitability,"+i.join(",")),e.forEach(n,function(t){i=[],i.push(t.name),e.forEach(t.data,function(e){i.push(Math.abs(e.y.toFixed(2)))}),r.push(i.join(","))}),r}function i(t){var n=t.series,r=[],i=[],s;return s=t.xAxis[0].categories,e.forEach(s,function(e){i.push(e)}),r.push("Type,"+i.join(",")),e.forEach(n,function(t){i=[],i.push(t.name),e.forEach(t.data,function(e){i.push(e.y)}),r.push(i.join(","))}),r}function s(t){var n=["Unsuitable"],r=["Suitable"],i=t.series,s=0,o=0,u=0,a=0,f=0,l=0,c=[],h=[],p;return c.push("Suitability,Total,HP/HPT,HPK,APL"),p=i[0],e.forEach(p.data,function(e){e.name==="Suitable"?r.push(e.y):n.push(e.y)}),p=i[1],e.forEach(p.data,function(e){switch(e.name){case"HP/HPT":e.parentId==="donut-Suitable"?a=e.y||0:s=e.y||0;break;case"APL":e.parentId==="donut-Suitable"?l=e.y||0:u=e.y||0;break;case"HPK":e.parentId==="donut-Suitable"?f=e.y||0:o=e.y||0}}),r=r.concat([a,f,l]),n=n.concat([s,o,u]),c.push(r.join(",")),c.push(n.join(",")),c}function o(){var t=document.getElementById("title").innerHTML,n=$("#suitabilityAnalysis_content tr"),r=[],i;return r.push("Suitability Statistics"),r.push(t),r.push("Parameter, Value"),e.forEach(n,function(e){i=e.cells[1].innerHTML.replace(",",""),r.push(e.cells[0].innerHTML+","+i)}),r}var u={exportCSV:function(e){var r="data:application/vnd.ms-excel;base64,",i="text/csv;charset=utf-8",s="data.csv",o=document.createElement("a"),u;saveAs&&!!(new Blob)?(u=n(t(e),i),saveAs(u,s)):o.download===""?(o.href=r+t(e),o.target="_blank",o.download=s,o.click()):window.open(r+t(e))},exportSuitabilityByLegalClass:s,exportSuitabilityStatistics:o,exportCompositionAnalysis:r,exportSimpleChartAnalysis:i};return u}),define("report/Renderer",["report/config","dojo/number","dijit/Dialog","dojo/_base/array","dojo/on","dojo/dom","dojo/dom-style","report/CSVExporter","utils/Analytics"],function(e,t,n,r,i,s,o,u,a){"use strict";var f="url(./app/css/images/download-icon.svg)";return{renderContainers:function(e){var t=document.createDocumentFragment(),n=document.createElement("div"),r=document.getElementById("print-map");n.id=e.rootNode,n.className="result-container",n.innerHTML="<div class='title'>"+e.title+"</div>"+"<div class='result-block total-loss'>"+"<div class='top-panel' id='"+e.rootNode+"_composition'></div>"+"<div class='left-panel'>"+"<div class='loss-chart' id='"+e.rootNode+"_loss'><div class='loader-wheel'>total loss</div></div>"+"</div>"+"<div class='right-panel'>"+"<div class='fires-chart' id='"+e.rootNode+"_fire'><div class='loader-wheel'>active fires</div></div>"+"</div>"+"</div>"+"<div class='result-block clearance-alerts'>"+"<div class='clearance-chart' id='"+e.rootNode+"_clearance'><div class='loader-wheel'>clearance alerts</div></div>"+"</div>"+"<div class='result-block mill-points'>"+"<div class='mill-table' id='"+e.rootNode+"_mill'></div>"+"</div>",t.appendChild(n),document.getElementById("report-results-section").insertBefore(t,r)},renderTotalLossContainer:function(e){var t=document.createDocumentFragment(),n=document.createElement("div"),r=document.getElementById("print-map");n.id=e.rootNode,n.className="result-container",n.innerHTML="<div class='title'>"+e.title+"</div>"+"<div class='result-block total-loss'>"+"<div class='top-panel' id='"+e.rootNode+"_composition'></div>"+"<div class='left-panel'>"+"<div class='loss-chart' id='"+e.rootNode+"_loss'><div class='loader-wheel'>total loss</div></div>"+"</div>"+"</div>",t.appendChild(n),document.getElementById("report-results-section").insertBefore(t,r)},renderRSPOContainer:function(e){var t=document.createDocumentFragment(),n=document.createElement("div"),r=document.getElementById("print-map");n.id=e.rootNode,n.className="result-container",n.innerHTML="<div class='title'>"+e.title+"</div>"+"<div class='rspo-table-container' id='"+e.rootNode+"_table'><div class='loader-wheel'>rspo analysis</div></div>"+"<div class='rspo-chart-container' id='"+e.rootNode+"_chart'></div>",t.appendChild(n),document.getElementById("report-results-section").insertBefore(t,r)},renderSuitabilityContainer:function(e){var t=document.createDocumentFragment(),n=document.createElement("div"),r=document.getElementById("print-map");n.id=e.rootNode,n.className="result-container",n.innerHTML="<div class='title'>"+e.title+"</div>"+"<div class='suitability-container'>"+"<div class='left-panel'>"+"<div id='suitability-table-csv' class='csv-download' title='Download CSV'></div>"+"<div id='"+e.rootNode+"_content' class='suitability-content'><div class='loader-wheel'>suitability</div></div>"+"</div>"+"<div class='right-panel'>"+"<div id='"+e.rootNode+"_chart' class='suitability-chart'><div class='loader-wheel'>suitability</div></div>"+"</div>"+"<div class='clearFix'></div>"+"<div class='left-panel'>"+"<div class='suitability-settings-table-header'>Suitability Settings</div>"+"<div id='suitability-settings-csv' class='csv-download' title='Download CSV'></div>"+"<div id='suitability-settings-table'></div>"+"</div>"+"<div class='right-panel'>"+"<div id='suitability-composition-analysis'><div class='loader-wheel'>composition</div></div>"+"</div>"+"</div>",t.appendChild(n),document.getElementById("report-results-section").insertBefore(t,r)},renderMillContainer:function(e){var t=document.createDocumentFragment(),n=document.createElement("div"),r=document.getElementById("print-map");n.id=e.rootNode,n.className="result-container relative",n.innerHTML="<div class='title'>"+e.title+"</div>"+"<div class='mill-table-container' id='"+e.rootNode+"_table'><div class='loader-wheel'>risk assessment</div></div>",t.appendChild(n),document.getElementById("report-results-section").insertBefore(t,r)},renderCompositionAnalysisLoader:function(e){document.getElementById(e.rootNode+"_composition").innerHTML='<div class="loader-wheel">composition analysis</div>'},renderCompositionAnalysis:function(e,n,r){var i=document.createDocumentFragment(),s=document.createElement("div"),o=document.getElementById(r.rootNode+"_composition"),u=r.compositionAnalysis,a=u.title||r.title,f,l,c;u.histogramSlice&&(c=e.slice(u.histogramSlice));if(c.length===0){this.renderAsUnavailable("composition",r);return}c=c.reduce(function(e,t){return e+t})*n*n/1e4,f=t.format(c),report.areaPromise.then(function(){l=t.format(c/report.area*100,{places:0}),s.className="composition-analysis-container",s.innerHTML="<div>Total "+a+" in selected area: "+f+" ha</div>"+"<div>Percent of total area comprised of "+a+": "+l+"%</div>",i.appendChild(s),o.innerHTML="",o.appendChild(i)})},renderLossData:function(t,n,i,s,o){var u=e.totalLoss,a=i.labels,l=u.labels,c=arrayFromBounds(i.bounds),h=arrayFromBounds(u.bounds),p=function(e){return e*n*n/1e4},d=[],v=[],m,g,y,b,w;if(o){y=t.slice(1).map(p);if(y.length!==l.length)for(var E=0;E<l.length;E++)y[E]===undefined&&(y[E]=0);d.push({name:a[0],data:y}),v.push(i.colors[0])}else for(b=0;b<c.length;b++){y=[];for(w=0;w<h.length;w++)m=s.encode(h[w],c[b]),y.push(t[m]||0);d.push({name:a[b],data:y.map(p)}),v.push(i.colors[b])}i.lossChart.removeBelowYear&&(g=l.indexOf(i.lossChart.removeBelowYear),l=l.slice(g),r.forEach(d,function(e){e.data=e.data.slice(g)})),$("#"+i.rootNode+"_loss").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null,type:"bar",events:{load:function(){}}},colors:v,title:{text:i.lossChart.title},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:f}}},xAxis:{categories:l,maxPadding:.35,title:{text:null}},yAxis:{stackLabels:{enabled:!0},title:{text:null}},legend:{enabled:!0,verticalAlign:"bottom"},plotOptions:{series:{stacking:"normal"}},series:d,credits:{enabled:!1}})},renderTreeCoverLossData:function(t,n,i){var s=e.totalLoss,o=i.labels,u=s.labels,a=arrayFromBounds(i.bounds),l=arrayFromBounds(s.bounds),c=function(e){return e*n*n/1e4},h=[],p=[],d,v,m,g,y;h.push({name:o[0],data:t.slice(1).map(c)}),p.push(i.color),i.lossChart.removeBelowYear&&(v=u.indexOf(i.lossChart.removeBelowYear),u=u.slice(v),r.forEach(h,function(e){e.data=e.data.slice(v)}));if(h[0].data.length!==u.length)for(var b=0;b<u.length;b++)h[0].data[b]===undefined&&(h[0].data[b]=0);$("#"+i.rootNode+"_loss").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null,type:"bar",events:{load:function(){}}},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:f}}},colors:p,title:{text:i.lossChart.title},xAxis:{categories:u,maxPadding:.35,title:{text:null}},yAxis:{stackLabels:{enabled:!0},title:{text:null}},legend:{enabled:!1,verticalAlign:"bottom"},plotOptions:{series:{stacking:"normal"}},series:h,credits:{enabled:!1}})},renderClearanceData:function(e,t,n,r,i){var s=n.labels,o=arrayFromBounds(n.bounds),u=arrayFromBounds(report.clearanceBounds),a=[],l=[],c,h,p,d;if(n.clearanceChart.type==="pie"){for(p=0;p<o.length;p++){h=0,l=[];for(d=0;d<u.length;d++)c=r.encode(u[d],o[p]),l.push(e[c]||0);a.push({name:s[p],data:l})}$("#"+n.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:f}}},colors:n.colors,title:{text:n.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!0},credits:{enabled:!1},series:a})}else{if(i){a=e.slice(1);if(a.length!==u.length)for(var v=0;v<u.length;v++)a[v]===undefined&&(a[v]=0)}else for(p=0;p<u.length;p++){h=0;for(d=0;d<o.length;d++)c=r.encode(u[p],o[d]),h+=e[c]||0;a.push(h)}$("#"+n.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:f}}},colors:["#fb00b3"],title:{text:n.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!1},credits:{enabled:!1},series:[{name:n.title,data:a}]})}},renderFireData:function(n,i){function h(e,n,r,i){var s=document.createDocumentFragment(),o=document.createElement("div"),u=document.getElementById(e+"_fire");o.className="active-fires-badge",o.innerHTML="<div>There are currently</div><div class='active-fires-label'><div>"+t.format(n)+"</div>"+"<span>active fires</span>"+"</div>"+"<div>"+i+"</div>"+"<div class='total-active-fires-label'><span>"+t.format(r)+" total active fires</span></div>",s.appendChild(o),u.innerHTML="",u.appendChild(s)}function p(e,n,r,i,s){var o=document.createDocumentFragment(),u=document.createElement("div"),a=document.getElementById(e+"_fire"),f=[];for(var l=0;l<n.length;l++)l>=r[0]&&l<=r[1]&&f.push(n[l]);u.className="active-fires-badge special",u.innerHTML="<div>Active fires are detected in:</div><div class='active-fires-label'><span>"+i[0]+" Forests</span>"+"<div>"+t.format(f[0]||0)+"</div>"+"</div>"+"<div class='active-fires-label'>"+"<span>"+i[1]+" Forests</span>"+"<div>"+t.format(f[1]||0)+"</div>"+"</div>"+"<div class='total-active-fires-label'><span>out of "+t.format(s)+" total active fires</span></div>"+"</div>",o.appendChild(u),a.innerHTML="",a.appendChild(o)}function d(e,t,n,r,i,o,u){var a=[],l=0,c=[],d;for(d=0;d<t.length;d++)d>=i[0]&&d<=i[1]&&(t[d]!==0&&!isNaN(t[d])&&(a.push([n[l],t[d]]),c.push(r[l])),l++);a.length===0?h(e,0,0,u):n.length===2?p(e,t,i,n,s.length):$("#"+e+"_fire").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null},colors:c,title:{text:"Active Fires"},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:f}}},plotOptions:{pie:{size:"75%",allowPointSelect:!0,cursor:"pointer",showInLegend:!0,dataLabels:{enabled:!1}}},credits:{enabled:!0},legend:{enabled:!1},series:[{type:"pie",name:"Fires",data:a}]})}var s=i[0].features,o,u,a,l,c;r.forEach(n,function(t){a=t.rootNode,l=e.fires[t.fireKey];if(i.length>1&&t.fireKey==="indonesiaMoratorium"){var n=0;r.forEach(i[1].features,function(e){n+=+e.attributes[l.field]}),h(a,n,s.length,l.badgeDesc);return}if(s.length===0)h(a,0,0,l.badgeDesc);else if(l.type==="pie"){u=[];for(c=0;c<=l.labels.length;c++)u[c]=0;r.forEach(s,function(e){u[e.attributes[l.field]]++}),d(a,u,l.labels,l.colors,l.bounds,l.title,l.badgeDesc)}else o=0,r.forEach(s,function(e){o+=isNaN(parseInt(e.attributes[l.field]))?0:parseInt(e.attributes[l.field])}),h(a,o,s.length,l.badgeDesc)})},renderRSPOData:function(n,i,s){var o=arrayFromBounds(e.rspo.lossBounds),f=this;if(!(n.histograms.length>0)){document.getElementById(i.rootNode+"_table").innerHTML="<div class='data-not-available'>No RSPO Data Available for this Site.</div>";return}var l=2005,c=8,h="",p="",d="",v="",m="",g=[],y=[],b=[],w=[],E=[],S,x,T,N,C;h="<div id='rspo-table-csv' class='csv-download' title='Download CSV'></div><table class='rspo-results-table'><tr><th>Forest Type</th>";for(T=0;T<=c;T++)g.push(l+T),h+="<th>"+(l+T)+"</th>";h+="</tr>",x=n.histograms[0].counts;for(N=0;N<o.length;N++)S=s.encode(o[N],2),b.push(x[S]||0),S=s.encode(o[N],3),w.push(x[S]||0),S=s.encode(o[N],1),y.push(x[S]||0),S=s.encode(o[N],0),E.push(x[S]||0);d="<tr><td>Primary</td>",v="<tr><td>Secondary</td>",p="<tr><td>Agroforestry</td>",m="<tr><td>Non-Forest</td>";for(C=0;C<b.length;C++)d+="<td>"+(t.format(b[C])||0)+"</td>",v+="<td>"+(t.format(w[C])||0)+"</td>",p+="<td>"+(t.format(y[C])||0)+"</td>",m+="<td>"+(t.format(E[C])||0)+"</td>";d+="</tr>",v+="</tr>",p+="</tr>",m+="</tr>",h+=d+v+p+m+"</table>",h+="<div class='change-area-unit'>(Change in Hectares)</div>",document.getElementById(i.rootNode+"_table").innerHTML=h,this.renderRSPOChart(i,b,w,y,E,g),$("#rspo-table-csv").click(function(){var e="\r\n",t=[],n=[],i="";t.push("RSPO Land Use Change Analysis"),t.push(document.getElementById("title").innerHTML),r.forEach(g,function(e){n.push(e)}),t.push("Forest Type,"+n.join(",")),n=[],r.forEach(b,function(e){n.push(e)}),t.push("Primary,"+n.join(",")),n=[],r.forEach(w,function(e){n.push(e)}),t.push("Secondary,"+n.join(",")),n=[],r.forEach(y,function(e){n.push(e)}),t.push("Agroforestry,"+n.join(",")),n=[],r.forEach(E,function(e){n.push(e)}),t.push("Non-Forest,"+n.join(",")),i=t.join(e),u.exportCSV(i),a.sendEvent("Event","Download CSV","User downloaded RSPO results table.")})},renderRSPOChart:function(e,n,r,i,s,o){var u={color:"#000"},a={style:u};$("#"+e.rootNode+"_chart").highcharts({chart:{backgroundColor:"#FFF",type:"column"},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:f}}},colors:e.colors,title:{text:null},legend:{align:"center",verticalAlign:"top",enabled:!0},xAxis:{categories:o,labels:a},yAxis:{title:{text:"",style:u},labels:a},plotOptions:{column:{stacking:"normal"}},tooltip:{formatter:function(){return"<strong>"+this.key+"</strong><br/>"+this.series.name+": "+t.format(this.y)+"<br/>"+"Total: "+t.format(this.point.stackTotal)}},credits:{enabled:!1},series:[{name:"Primary",data:n},{name:"Secondary",data:r},{name:"Agroforestry",data:i},{name:"Non-Forest",data:s}]})},renderSuitabilityData:function(e,n){var r=e.lcHistogram.classIndices,i="<table>",s,o,u,a,f,l,c,h,p,d;d=n[0],d?(s=Math.pow(d.pixelSize/100,2),d.data.counts[1]?(u=t.format(d.data.counts[1]*s)||d.data.counts[1],o=t.format(d.data.counts[0]*s)||d.data.counts[0]):(u=0,o=t.format(d.data.counts[0]*s))):(u="N/A",o="N/A"),d=n[1];if(d){s=Math.pow(d.pixelSize/100,2);var v=function(e){var n=0;for(var r=0;r<e.length;r++)d.data.counts[e[r]]&&(n+=d.data.counts[e[r]]*s);return t.format(n)};c=v(r.production),h=v(r.convertible),p=v(r.other)}else c="N/A",h="N/A",p="N/A";d=n[2],d?f=parseFloat(d.data.min/1e3).toFixed(1):f="N/A",d=n[3],d?l=d.value:l="N/A",i+="<tr><td>Suitable(ha):</td><td>"+u+"</td></tr>",i+="<tr><td>Unsuitable(ha):</td><td>"+o+"</td></tr>",i+="<tr><td>Distance to nearest road(km):</td><td>"+f+"</td></tr>",i+="<tr><td>Existing concessions(Yes/No):</td><td>"+l+"</td></tr>",i+="<tr><td>Legal Classification(ha):</td><td></td></tr>",i+="<tr><td class='child-row'>Production forest(HP/HPT):</td><td>"+c+"</td></tr>",i+="<tr><td class='child-row'>Convertible forest(HPK):</td><td>"+h+"</td></tr>",i+="<tr><td class='child-row'>Other land uses(APL):</td><td>"+p+"</td></tr>",i+="</table>",i+="<p>"+e.localRights.content+"</p>",i+="<div class='field-assessment-link'><a href='"+e.localRights.fieldAssessmentUrl+"'>"+e.localRights.fieldAssessmentLabel+"</a>"+"</div>",document.getElementById(e.rootNode+"_content").innerHTML=i,this.renderSuitabilityChart(e,n[4]),this.renderSuitabilitySettingsTable()},renderSuitabilitySettingsTable:function(){var e=payload&&payload.suitability&&payload.suitability.csv,t="<table><thead><tr>",n,i,s,o,u,a;e&&(s=e.split("\n"),n=s.splice(1),i=s[0].split(","),t+="<th>Parameter</th><th>Setting</th></tr></thead><tbody>",r.forEach(n,function(e){a=e.split(","),o=a[0],u=a[1],o!==undefined&&o!==""&&(t+="<tr><td>"+o+"</td><td>"+u.replace(/\;/g,",")+"</td></tr>")}),t+="</tbody></table>",$("#suitability-settings-table").html(t))},renderSuitabilityCompositionChart:function(e){var t=[],n=[],i=[],s;r.forEach(e,function(e){s=e.suitable+e.unsuitable,e.suitable=e.suitable/s*100,e.unsuitable=e.unsuitable/s*100*-1}),e.sort(function(e,t){return e.suitable>t.suitable?1:t.suitable>e.suitable?-1:0}),r.forEach(e,function(e){t.push(e.unsuitable),n.push(e.suitable),i.push(e.label)}),$("#suitability-composition-analysis").highcharts({chart:{type:"bar"},title:{text:"Suitability Composition Analysis"},colors:["#FDD023","#461D7C"],credits:{enabled:!1},xAxis:[{categories:i,reversed:!1},{labels:{enabled:!1},opposite:!0,reversed:!1,linkedTo:0,tickLength:0}],yAxis:{title:{text:null},min:-100,max:100,labels:{formatter:function(){return Math.abs(this.value)+(this.value!==0?"%":"")}}},tooltip:{formatter:function(){return"<b>"+this.point.category+"</b><br/>"+"<b>"+this.series.name+":</b>	"+Highcharts.numberFormat(Math.abs(this.point.y),2)+"%"}},plotOptions:{series:{stacking:"normal"}},series:[{name:"Unsuitable",data:t},{name:"Suitable",data:n}],exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:f}}}})},renderSuitabilityChart:function(e,t){function h(e){var n={suitable:0,unsuitable:0};for(var i=0;i<e.length;i++)t.data.counts[e[i]]&&(n.unsuitable+=t.data.counts[e[i]]*r,n.suitable+=t.data.counts[e[i]+10]*r);return n}if(!t){document.getElementById(e.rootNode+"_chart").innerHTML="<div class='data-not-available'>No Suitability Data Available to chart for this Site.</div>";return}var n=e.lcHistogram.classIndices,r=Math.pow(t.pixelSize/100,2),i=e.chart,s=[],o=[],u=[],a,l,c;a=h(n.convertible),l=h(n.production),c=h(n.other),s.push({y:a.suitable+l.suitable+c.suitable,color:i.suitable.color,name:i.suitable.name,id:i.suitable.id,children:{categories:i.childrenLabels,colors:i.childrenColors,data:[l.suitable,a.suitable,c.suitable]}}),s.push({y:a.unsuitable+l.unsuitable+c.unsuitable,color:i.unsuitable.color,name:i.unsuitable.name,id:i.unsuitable.id,children:{categories:i.childrenLabels,colors:i.childrenColors,data:[l.unsuitable,a.unsuitable,c.unsuitable]}});for(var p=0;p<s.length;p++)if(s[p].y>0){o.push({color:s[p].color,name:s[p].name,id:s[p].id,y:s[p].y});for(var d=0;d<s[p].children.data.length;d++)s[p].children.data[d]>0&&u.push({name:s[p].children.categories[d],color:s[p].children.colors[d],y:s[p].children.data[d],parentId:s[p].id})}$("#"+e.rootNode+"_chart").highcharts({chart:{type:"pie",backgroundColor:"#FFF",plotBorderWidth:null},title:{text:i.title},tooltip:{valueSuffix:""},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:f}}},plotOptions:{series:{point:{events:{legendItemClick:function(){var e=this.id,t=this.series.chart.series[1].data;t.forEach(function(t){t.parentId===e&&(t.visible?t.setVisible(!1):t.setVisible(!0))})}}}}},legend:{itemStyle:{color:"#000"}},credits:{enabled:!1},series:[{name:"Area",data:o,size:"60%",showInLegend:!0,dataLabels:{enabled:!1}},{name:"Legal Area",data:u,size:"80%",innerSize:"60%",dataLabels:{color:"black",distance:5}}]})},renderMillAssessment:function(e,t){function o(e,t,n){var r="data-row"+(n?" child "+n:""),i="<tr class='"+r+"'><td class='row-name'><span>"+e+"</span></td>";return i+="<td class='"+t.concession.risk+"'><span class='large-swatch'></span><span class='risk-label'>"+t.concession.risk+"</span></td>",i+="<td class='"+t.radius.risk+"'><span class='large-swatch'></span><span class='risk-label'>"+t.radius.risk+"</span></td>",i+="</tr>",i}function u(e,t,n,r){var i="data-row parent",s="<tr class='"+i+"' data-class='"+n+"'><td class='row-name'>"+"<span class='toggle-icon'></span><span>"+e+"</span></td>";return s+="<td class='"+(t[r+"_concession"]||"N/A")+"'><span class='large-swatch'></span><span class='risk-label'>"+(t[r+"_concession"]||"N/A")+"</span></td>",s+="<td class='"+(t[r+"_radius"]||"N/A")+"'><span class='large-swatch'></span><span class='risk-label'>"+(t[r+"_radius"]||"N/A")+"</span></td>",s+="</tr>",s}function a(e,t,n){var r="<tr class='data-row'><td class='row-name'><span>"+e+"</span></td>",i=n?t[n+"_concession"]:t.concession.risk,s=n?t[n+"_radius"]:t.radius.risk;return r+="<td class='"+i+"'><span class='large-swatch'></span><span class='risk-label'>"+i+"</span></td>",r+="<td class='"+s+"'><span class='large-swatch'></span><span class='risk-label'>"+s+"</span></td>",r+="</tr>",r}function f(e){var t=e.currentTarget,n=t.dataset?t.dataset.class:t.getAttribute("data-class");$(".mill-table-container .data-row.child."+n).toggle(),$(t).toggleClass("open")}var n=[],i="",s;r.forEach(e,function(e,t){e.mill_name?s=e.mill_name:report.mills&&r.some(report.mills,function(t){if(e.id===t.millId)return s=t.label,!0}),s===undefined&&(s=window.payload.title),i="<div class='mill-header'><span class='mill-title'>"+s+"</span>"+"<span class='mill-risk-level "+e.total_mill_priority_level+"'><span class='large-swatch'></span>"+"Total Mill Priority Level: <span class='overall-risk'>"+e.total_mill_priority_level+"</span></span>"+"<span class='mill-rspo-certification'>RSPO Certification: <span>"+(e.rspo.risk?"Yes":"No")+"</span></span></div>",i+="<table><tr><th></th><th>Concession<span class='info-icon' data-type='concession'></span></th><th>Radius<span class='info-icon' data-type='radius'></span></th></tr>",i+=a("Priority Level",e,"priority_level"),i+=u("Deforestation",e.deforestation,"deforest-"+e.id,"deforestation"),i+=o("Total tree cover loss",e.deforestation.umd_loss,"deforest-"+e.id),i+=o("Tree cover loss on primary forest",e.deforestation.umd_loss_primary,"deforest-"+e.id),i+=o("Total clearance alerts",e.deforestation.forma,"deforest-"+e.id),i+=o("Clearance alerts on primary forest",e.deforestation.forma_primary,"deforest-"+e.id),i+=o("Tree cover loss on carbon stock",e.deforestation.carbon,"deforest-"+e.id),e.deforestation.area_carbon&&(i+=o("Area in high carbon density",e.deforestation.area_carbon,"deforest-"+e.id),i+=o("Alerts on high carbon density",e.deforestation.forma_carbon,"deforest-"+e.id),i+=o("Clearance alerts on primary forest/IFL",e.deforestation.forma_primary,"deforest-"+e.id)),i+=a("Legality",e.legal),i+=u("Peat",e.peat,"peat-"+e.id,"peat"),i+=o("Presence of peat",e.peat.presence,"peat-"+e.id),i+=o("Clearance on peat",e.peat.clearance,"peat-"+e.id),e.peat.alerts&&(i+=o("Clearance alerts on peat",e.peat.alerts,"peat-"+e.id)),i+=a("Fires",e.fire),i+="</table>",n.push(i)}),document.getElementById(t.rootNode+"_table").innerHTML=n.join("<br />"),$(".mill-table-container tr.parent").click(f),$(".mill-table-container .info-icon").click(this.showMillPointInfo),$(".mill-table-container .data-row.child").toggle()},showMillPointInfo:function(t){var r=t.currentTarget,i=r.dataset?r.dataset.type:r.getAttribute("data-type"),s=e.millPointInfo[i],o;o=new n({title:s.title,content:s.content,style:"width: 300px;"}),o.show()},renderAsUnavailable:function(e,t){var n=document.getElementById(t.rootNode+"_"+e),r="";e==="loss"?r="No tree cover loss detected.":e==="clearance"?r="No clearance alerts occured in this area.":e==="composition"?r=t.errors&&t.errors.composition||"No Composition Analysis Data Available for this site.":r="No Mill Point Data Available for this site.",n&&(n.innerHTML=r)}}}),define("report/riskRequests",["dojo/Deferred","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/ImageServiceIdentifyTask","esri/tasks/ImageServiceIdentifyParameters","esri/tasks/StatisticDefinition","esri/request","esri/tasks/AreasAndLengthsParameters","esri/tasks/GeometryService","esri/SpatialReference","esri/tasks/ProjectParameters","esri/tasks/BufferParameters"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h={},p=function(e,t){for(param in t)t.hasOwnProperty(param)&&t[param]&&(e[param]=t[param]);return e},d=function(e){return e.lengthUnit=a[e.lengthUnit],e.areaUnit=a[e.areaUnit],e},v=function(t,n,r){var i=new e;return r=r||"execute",t[r](n,function(e){i.resolve(e)},function(e){i.resolve(e)}),i};return h.getAreasLengths=function(t,n){var r=new e;n=d(n);var i=p(new u,n),s=new a(t);return s.areasAndLengths(i).then(function(e){r.resolve(e)}),r},h.project=function(t,n,r){var i=new e;n.outSR=new f(r);var s=new a(t),o=p(new l,n);return s.project(o).then(function(e){i.resolve(e)}),i},h.buffer=function(t,n,r){var i=new e,s=p(new c,n);s.unit=a[n.unit],s.spatialReference=n.geometries[0].spatialReference,s.outSpatialReference=new f(r);var o=new a(t);return o.buffer(s).then(function(e){i.resolve(e)}),i},h.loadServiceInfo=function(t){var n=new e,r=esri.request({url:t,content:{f:"json"},handleAs:"json"});return r.then(function(e){console.log("Success: ",e.layers),n.resolve(e)},function(e){console.log("Error: ",e.message),n.resolve(e)}),n},h.queryForStats=function(t,n,r){var i=new e,o=r.map(function(e){return p(new s,e)});return n.outStatistics=o,h.queryEsri(t,n)},h.queryEsri=function(e,r,i){var s=new t(e),o=p(new n,r),u=v(s,o,i);return u},h.computeHistogram=function(e,t){return o({url:e+"/computeHistograms",content:t,handleAs:"json",callbackParamName:"callback",timeout:6e4},{usePost:!0})},h.queryJson=function(){},h}),define("report/riskController",["lodash","dojo/Deferred","dojo/promise/all","dojo/_base/lang","esri/geometry/geometryEngine","esri/geometry/Polygon","report/riskRequests","report/config"],function(e,t,n,r,i,s,o,u){var a={},f=54012,l=102100,c=["","low","medium","high"];u.carbonDensity={rasterId:"$524"};var h={commodities:"http://gis-gfw.wri.org/arcgis/rest/services/GFW/analysis/ImageServer",fires:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0",concessions:"http://gis-gfw.wri.org/arcgis/rest/services/CommoditiesAnalyzer/moremaps2_EN/MapServer/27"},p=function(){u.treeCoverLoss.rasterId="$13",u.clearanceAlerts.rasterId="$2",u.intactForest.rasterId="$9",u.primaryForest.rasterId="$11",u.legalClass.rasterId="$7",u.protectedArea.rasterId="$10",u.peatLands.rasterId="$8",u.carbonDensity.rasterId="$15"};return a.getRiskByGeometry=function(i,s,a,f,l,p,d){var v=s,m=function(e,t,n){return n>t?3:n<=e?1:2},g=function(e,t){return function(n){if(!n.histograms[0])return 1;var r=n.histograms[0].counts[1]||0;return r>t?3:r<=e?1:2}},y=function(e,t,n){return function(r){if(!r.histograms[0])return m(e,t,0);var i=r.histograms[0].counts[1]||0,s=k(i,n),o=s/v,u={low:e,high:t};return m(e,t,o)}},b=function(e){if(!e.histograms.length)return 1;var t=e.histograms[0].counts[1];return t>0?3:1},w=function(e){if(!e.histograms.length)return 1;var t=e.histograms[0].counts;return t[2]?3:t[1]?3:1},E=function(e,t,n){return{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:e,OutputValues:t,Raster:n,AllowUnmatched:!1},variableName:"Raster"}},S=function(e){return E([0,1,1,14],[0,1],e)},x=function(e){return E([1,22],[1],e)},T=function(e){return E([1,20,20,369],[0,1],e)},N=function(e,t,n){return{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:e,Raster2:t,Operation:n}}},C=function(e){return{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[parseInt(e.replace("$",""))],ascending:!0,mosaicOperation:"MT_FIRST"}},k=function(e,t){var n=t*t,r=e*n;return r},L={histogram:o.computeHistogram,query:o.queryEsri},A=function(e,t,n){},O={low:7,high:12},M=[{label:"legal",categories:["legal"],singleIndicator:!0},{label:"deforestation",high:21,low:13},{label:"peat",high:7,low:4},{label:"rspo",categories:["rspo"]},{label:"fire",categories:["fire"],singleIndicator:!0}],D=[{key:"carbon",category:"deforestation",service:h.commodities,request:L.histogram,params:{renderingRule:N(S(u.treeCoverLoss.rasterId),E([0,20,20,80,80,100],[0,1,2],u.carbonDensity.rasterId),3),pixelSize:100},callbacks:{radius:w,concession:w}},{key:"forma",category:"deforestation",service:h.commodities,request:L.histogram,params:{renderingRule:x(u.clearanceAlerts.rasterId),pixelSize:500},callbacks:{radius:g(1,5),concession:g(25,295)}},{key:"forma_carbon",category:"deforestation",service:h.commodities,request:L.histogram,params:{renderingRule:N(x(u.clearanceAlerts.rasterId),T(u.carbonDensity.rasterId),3),pixelSize:30},callbacks:{radius:b,concession:b}},{key:"area_carbon",category:"deforestation",service:h.commodities,request:L.histogram,params:{renderingRule:T(u.carbonDensity.rasterId),pixelSize:30},callbacks:{radius:y(.747,.913,30),concession:y(0,.2,30)}},{key:"area_primary",category:"deforestation",service:h.commodities,request:L.histogram,ind_params:{renderingRule:E([0,1,1,3],[0,1],u.primaryForest.rasterId),pixelSize:100},params:{renderingRule:E([0,1,1,3],[0,1],u.intactForest.rasterId),pixelSize:100},callbacks:{radius:y(.12,.18,100),concession:y(0,.2,100)}},{key:"forma_primary",category:"deforestation",service:h.commodities,request:L.histogram,ind_params:{renderingRule:N(x(u.clearanceAlerts.rasterId),E([1,3],[1],u.primaryForest.rasterId),3),pixelSize:30},params:{renderingRule:N(x(u.clearanceAlerts.rasterId),u.intactForest.rasterId,3),pixelSize:30},callbacks:{radius:b,concession:b}},{key:"umd_loss",category:"deforestation",service:h.commodities,request:L.histogram,params:{renderingRule:S(u.treeCoverLoss.rasterId),pixelSize:30},callbacks:{radius:y(.001,.28*.02,30),concession:y(.05,.28,30)}},{key:"umd_loss_primary",category:"deforestation",service:h.commodities,request:L.histogram,ind_params:{renderingRule:N(S(u.treeCoverLoss.rasterId),u.primaryForest.rasterId,3),pixelSize:100},params:{renderingRule:N(S(u.treeCoverLoss.rasterId),u.intactForest.rasterId,3),pixelSize:100},callbacks:{radius:b,concession:b}},{key:"fire",category:"fire",service:h.fires,request:L.query,params:{where:"BRIGHTNESS>=330 AND CONFIDENCE>=30",geometry:""},execution:"executeForCount",callback:function(e,t){return e>0?3:1},callbacks:{radius:function(e,t){return e>0?3:1},concession:function(e,t){return e>0?3:1}}},{key:"legal",category:"legal",service:h.commodities,request:L.histogram,ind_params:{renderingRule:E([0,1,1,2,2,3,3,4,4,7],[1,0,1,0,1],u.legalClass.rasterId),pixelSize:100},params:{renderingRule:C(u.protectedArea.rasterId),pixelSize:100},callbacks:{radius:b,concession:b},ind_callback:b},{key:"clearance",category:"peat",service:h.commodities,request:L.histogram,params:{renderingRule:N(S(u.treeCoverLoss.rasterId),u.peatLands.rasterId,3),pixelSize:100},callbacks:{radius:b,concession:b}},{key:"alerts",category:"peat",service:h.commodities,request:L.histogram,params:{renderingRule:N(x(u.clearanceAlerts.rasterId),u.peatLands.rasterId,3),pixelSize:100},callbacks:{radius:b,concession:b}},{key:"presence",category:"peat",service:h.commodities,request:L.histogram,params:{renderingRule:E([0,1,1,2],[0,1],u.peatLands.rasterId),pixelSize:100},callbacks:{radius:y(.00531,.00693),concession:y(.00531,.00693)}}],P=function(t){var n=e.groupBy(D,"key"),t=n[t][0].category;return t},H=function(t,n){var i=r.clone(M),s=0;return e.forIn(t,function(t,r){var i=P(r);p[i]||(p[i]={});var o=e.result(e.find(M,{label:i}),"singleIndicator");o?(p[i][n]={risk:c[t]},s+=t):(p[i][r]||(p[i][r]={}),p[i][r][n]={risk:c[t]})}),i.forEach(function(r){var i=0;if(!r.high)return;var o=[],u=e.pluck(e.groupBy(D,"category")[r.label],"key");D.forEach(function(e,n){i+=t[e],s+=t[e],o.push({key:e,risk:t[e]})}),r.categories=o;var a=m(r.high,r.low,i),f=r.label;r.risk=a,p[f]||(p[f]={});var l=r.label+"_"+n;p[f][l]=c[a]}),s=m(O.low,O.high,s),p["priority_level_"+n]=c[s],s>p.total_mill_priority_level&&(p.total_mill_priority_level=s),p},B=new t;f=f,l=l,p.total_mill_priority_level=p.total_mill_priority_level||0;var j=[];if(!i){var F={};return e.pluck(D,"key").forEach(function(e){F[e]=0}),H(F,a),B.resolve(F),B.promise}var I=function(t,r,i,s){var o=t.map(function(e){return i.geometry=JSON.stringify(e),r.request(r.service,i,r.execution)});n(o).then(function(t){var n={histograms:[{counts:[]}]},i=e.pluck(e.flatten(e.pluck(t,"histograms")),"counts");i.forEach(function(e){e.forEach(function(e,t){n.histograms[0].counts[t]=n.histograms[0].counts[t]||0,n.histograms[0].counts[t]+=e})});var o={},u=r.callbacks[a];r.results=n,o[r.key]=u(n,s),s.resolve(o)},function(e){console.log("SPLIT ERROR",e)})};return D.forEach(function(e){var n=new t,r=l&&e.ind_params?e.ind_params:e.params;e.request==o.computeHistogram?(r.renderingRule=JSON.stringify(r.renderingRule),r.mosaicRule=r.mosaicRule?JSON.stringify(r.mosaicRule):"",r.geometryType="esriGeometryPolygon",r.geometry=JSON.stringify(i)):r.geometry=i,r.f="json",e.request(e.service,r,e.execution).then(function(t){var r={},i=e.callbacks[a];e.results=t,r[e.key]=i(t,n),n.resolve(r)},function(t){console.log("HISTOGRAM ERROR",t),d&&I(d,e,r,n)}),j.push(n.promise)}),n(j).then(function(e){var t={};e.forEach(function(e){r.mixin(t,e)});var n=H(t,a);B.resolve(n)}),B.promise},a.getGeometryArea=function(e,n){var r=new t,i={areaUnit:"UNIT_SQUARE_METERS",lengthUnit:"UNIT_METERS",calculationType:"geodesic",polygons:[n]};return o.getAreasLengths(e,i).then(function(e){r.resolve(e.areas[0])}),r},a.getConcessionRisk=function(e,n,r,f){var c=new t,p=h.concessions,d=new s(e),v={geometry:d,where:"CERT_SCHEME = 'RSPO' AND TYPE = 'Oil palm concession'",outFields:["OBJECTID"],returnGeometry:!0};return o.queryEsri(p,v).then(function(e){var t=u.geometryServiceUrl,h=e.features.map(function(e){return e.geometry});if(h.length<1){var p={};a.getRiskByGeometry(!1,0,"concession",n,r,f),c.resolve();return}var d=i.union(h),v=i.simplify(d),m=new s(v),g={geometries:[m]};o.project(t,g,l).then(function(e){var i=new s(e[0]);a.getGeometryArea(t,i).then(function(t){var i=a.getRiskByGeometry(e[0],t,"concession",n,r,f,h);i.then(function(e){c.resolve()})})})}),c},a.printProjectGeom=function(e){var t=u.geometryServiceUrl,n=new s(e),r={geometries:[n]};o.project(t,r,102100).then(function(e){console.log("BUFFER GEOM",JSON.stringify(e[0]))})},a.getRadiusBuffer=function(e,n){var r=u.geometryServiceUrl,i=new t,s={unit:"UNIT_KILOMETER",distances:[n],geometries:[e]};return o.buffer(r,s,l).then(function(e){var t=e[0];a.getGeometryArea(r,t).then(function(t){i.resolve({geometry:e[0],area:t})})}),i},a.getRisk=function(e,i,s,o){var u=new t,f={};return a.getRadiusBuffer(e,i).then(function(e){var t=i*1e3*i*1e3*Math.PI,l=e.geometry,h=a.getRiskByGeometry(l,t,"radius",s,o,f),p=a.getConcessionRisk(l,s,o,f);n([h,p]).then(function(e){f.total_mill_priority_level=c[f.total_mill_priority_level],u.resolve(r.clone(f))})}),u},a}),define("report/RiskHelper",["report/config","dojo/Deferred","dojo/_base/lang","dojo/promise/all","dojo/_base/array","esri/tasks/query","esri/tasks/QueryTask","report/riskController","esri/geometry/geometryEngine"],function(e,t,n,r,i,s,o,u,a){"use strict";var f={prepareFeatures:function(e){var n=new t,s=[],o=this;return i.forEach(e,function(e){var n=new t;o.getAreaAndIndoIntersect(e).then(function(e){n.resolve({feature:e.feature,inIndonesia:e.inIndonesia})}),s.push(n.promise)}),r(s).then(function(e){o.performAnalysis(e).then(function(e){n.resolve(e)})}),n.promise},getAreaAndIndoIntersect:function(e){var n=new t;return this.getIntersectionStatus(e).then(function(t){n.resolve({feature:e,inIndonesia:t})}),n.promise},getIntersectionStatus:function(n){var r=new t,i,u;return u=new o(e.boundariesUrl),i=new s,i.returnGeometry=!0,i.outFields=["OBJECTID"],i.where="ISO3 = 'IDN'",i.geometryPrecision=1,u.execute(i,function(e){var t=e.features[0]&&e.features[0].geometry;r.resolve(a.contains(t,n.geometry))},function(e){r.resolve(!1)}),r.promise},performAnalysis:function(e){var n=new t,s=this,o=[],a,f,l,c;return i.forEach(e,function(e){var n=new t;c=e.feature.isRSPO||!1,f=e.feature.geometry.getExtent().getCenter(),a=e.inIndonesia,l=JSON.parse(e.feature.buffer),r([u.getRisk(f,l,c,a)]).then(function(t){n.resolve({feature:e.feature,results:t})}),o.push(n)}),r(o).then(function(e){var t=s.formatData(e);n.resolve(t)}),n.promise},formatData:function(e){var t=[],r;return i.forEach(e,function(e){r=n.clone(e.results[0]),r.id=e.feature.millId,r.rspo={risk:e.feature.isRSPO},t.push(r)}),t}};return f}),define("report/Suitability",["esri/request","esri/tasks/query","esri/tasks/QueryTask","esri/geometry/Polygon","report/config","utils/Analytics","dojo/Deferred","dojo/_base/lang","dojo/_base/array","dojo/promise/all","report/CSVExporter"],function(e,t,n,r,i,s,o,u,a,f,l){return{getSuitabilityData:function(){function n(n){e.resolve(n),t.attachEvents()}var e=new o,t=this;return f([this.getSuitableAreas(),this.getLCHistogramData(),this.getRoadData(),this.getConcessionData(),this.computeLegalHistogram()]).then(n),e.promise},attachEvents:function(){$("#suitability-table-csv").click(this.downloadSuitabilityTable),$("#suitability-settings-csv").click(this.downloadSuitabiltiySettings)},downloadSuitabilityTable:function(){var e="\r\n",t,n;n=l.exportSuitabilityStatistics(),t=n.join(e),l.exportCSV(t),s.sendEvent("Event","Download CSV","User downloaded Suitability results table.")},downloadSuitabiltiySettings:function(){l.exportCSV(payload.suitability.csv),s.sendEvent("Event","Download CSV","User downloaded Suitability settings.")},getSuitableAreas:function(e){function l(e){e.histograms.length>0?(f.data=e.histograms[0],f.pixelSize=a.pixelSize,t.resolve(f)):t.resolve(!1)}function c(e){e.details?e.details[0]==="The requested image exceeds the size limit."&&a.pixelSize!==500?(a.pixelSize=500,s.getHistogram(r,a,l,c)):t.resolve(!1):t.resolve(!1)}var t=new o,n=u.clone(report.suitable.renderRule),r=i.suitability.url,s=this,a={f:"json",pixelSize:i.pixelSize,geometryType:i.suitability.geometryType,geometry:JSON.stringify(report.geometry)},f={};return n.rasterFunction=i.suitability.rasterFunction,a.renderingRule=JSON.stringify(n),this.getHistogram(r,a,l,c),t.promise},getLCHistogramData:function(){function f(t){t.histograms.length>0?(a.data=t.histograms[0],a.pixelSize=u.pixelSize,e.resolve(a)):e.resolve(!1)}function l(t){t.details?t.details[0]==="The requested image exceeds the size limit."&&u.pixelSize!==500?(u.pixelSize=500,s.getHistogram(r,u,f,l)):e.resolve(!1):e.resolve(!1)}var e=new o,t=i.suitability.lcHistogram,n=t.renderRule,r=i.suitability.url,s=this,u={f:"json",pixelSize:i.pixelSize,geometryType:i.suitability.geometryType,geometry:JSON.stringify(report.geometry),renderingRule:JSON.stringify(n)},a={};return this.getHistogram(r,u,f,l),e.promise},getRoadData:function(){function f(t){t.histograms.length>0?(a.data=t.histograms[0],a.pixelSize=u.pixelSize,e.resolve(a)):e.resolve(!1)}function l(t){t.details?t.details[0]==="The requested image exceeds the size limit."&&u.pixelSize!==500?(u.pixelSize=500,s.getHistogram(n,u,f,l)):e.resolve(!1):e.resolve(!1)}var e=new o,t=i.suitability.roadHisto,n=i.suitability.url,r=t.mosaicRule,s=this,u={f:"json",pixelSize:i.pixelSize,geometryType:i.suitability.geometryType,geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify(r)},a={};return this.getHistogram(n,u,f,l),e.promise},getConcessionData:function(){var e=new o,s=i.suitability.concessions,u=new t,a=new n(s.url+"/"+s.layer);return u.returnGeometry=!1,u.geometry=new r(report.geometry),a.executeForCount(u,function(t){e.resolve({value:t>0?"Yes":"No"})},function(t){e.resolve(!1)}),e.promise},computeLegalHistogram:function(){function c(t){t.histograms.length>0?(l.data=t.histograms[0],l.pixelSize=f.pixelSize,e.resolve(l)):e.resolve(!1)}function h(t){t.details?t.details[0]==="The requested image exceeds the size limit."&&f.pixelSize!==500?(f.pixelSize=500,a.getHistogram(s,f,c,h)):e.resolve(!1):e.resolve(!1)}var e=new o,t=u.clone(report.suitable.renderRule),n=i.suitability.lcHistogram,r=n.renderRuleSuitable,s=i.suitability.url,a=this,f={f:"json",pixelSize:i.pixelSize,geometryType:i.suitability.geometryType,geometry:JSON.stringify(report.geometry)},l={};return u.mixin(t.rasterFunctionArguments,r.rasterFunctionArguments),t.rasterFunction=r.rasterFunction,f.renderingRule=JSON.stringify(t),this.getHistogram(s,f,c,h),e.promise},getCompositionAnalysis:function(){var e=new o,t=[],n=this;return f([n.getElevationComposition(),n.getSlopeComposition(),n.getWaterComposition(),n.getConservationComposition()]).then(function(t){f([n.getSoilTypeComposition(),n.getSoilDepthComposition(),n.getPeatComposition(),n.getSoilAcidityComposition()]).then(function(r){f([n.getSoilDrainComposition(),n.getRainfallComposition(),n.getLandCoverComposition()]).then(function(n){e.resolve(t.concat(r.concat(n)))})})}),e.promise},getElevationComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$1","ElevInpR","ElevOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Elevation"),e.resolve(i)}),e.promise},getSlopeComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$2","SlopeInpR","SlopeOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Slope"),e.resolve(i)}),e.promise},getWaterComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$3","WaterInpR","WaterOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Water Resource Buffers"),e.resolve(i)}),e.promise},getConservationComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$4","ConsInpR","ConsOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Conservation Area Buffers"),e.resolve(i)}),e.promise},getSoilTypeComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$5","STypeInpR","STypeOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Soil Type"),e.resolve(i)}),e.promise},getSoilDepthComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$6","SDepthInpR","SDepthOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Soil Depth"),e.resolve(i)}),e.promise},getPeatComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$7","PeatInpR","PeatOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Peat Depth"),e.resolve(i)}),e.promise},getSoilAcidityComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$8","SAcidInpR","SAcidOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Soil Acidity"),e.resolve(i)}),e.promise},getSoilDrainComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$9","SDrainInpR","SDrainOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Soil Drainage"),e.resolve(i)}),e.promise},getRainfallComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$10","RainfallInpR","RainfallOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Rainfall"),e.resolve(i)}),e.promise},getLandCoverComposition:function(){var e=new o,t=this,n,r,i;return n=this.getCompositionRemapRule("$11","LCInpR","LCOutV"),this.queryComposition(n,function(n){i=t.formatCompositionResults(n,"Land Cover"),e.resolve(i)}),e.promise},getCompositionRemapRule:function(e,t,n){var r=u.clone(report.suitable.renderRule);return{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:r.rasterFunctionArguments[t],OutputValues:r.rasterFunctionArguments[n],Raster:e},outputPixelType:"U2"}},queryComposition:function(e,t){function o(e){var n;e.histograms.length>0?(n=e.histograms[0]&&e.histograms[0].counts||[0,0],t(n)):(n=[0,0],t(n))}function u(e){e.details?e.details[0]==="The requested image exceeds the size limit."&&r.pixelSize!==500?(r.pixelSize=500,self.getHistogram(n,r,o,u)):t(!1):t(!1)}var n=i.suitability.url,r={f:"json",pixelSize:i.pixelSize,geometryType:i.suitability.geometryType,geometry:JSON.stringify(report.geometry),renderingRule:JSON.stringify(e)},s;this.getHistogram(n,r,o,u)},formatCompositionResults:function(e,t){return{unsuitable:e[0]||0,suitable:e[1]||0,label:t}},getHistogram:function(t,n,r,i){var s=e({url:t+"/computeHistograms?",content:n,handleAs:"json",callbackParamName:"callback"});s.then(r,i)}}}),define("map/Symbols",["esri/Color","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol"],function(e,t,n,r){"use strict";var i={getPolygonSymbol:function(){return new t(t.STYLE_SOLID,new n(n.STYLE_SOLID,new e([255,0,0]),2),new e([103,200,255,0]))},getPointSymbol:function(){return new r(r.STYLE_CIRCLE,10,new n(n.STYLE_SOLID,new e([255,0,0]),1),new e([0,0,0,.25]))},getHighlightPolygonSymbol:function(){return new t(t.STYLE_SOLID,new n(n.STYLE_SOLID,new e([0,255,255]),2),new e([103,200,255,0]))},getHighlightPointSymbol:function(){return new r(r.STYLE_CIRCLE,10,new n(n.STYLE_SOLID,new e([0,255,255]),1),new e([0,0,0,.25]))}};return i}),define("utils/assert",[],function(){"use strict";return function(e,t){if(e)return;throw new Error(["Assertion Error:",t].join(" "))}}),define("utils/request",["esri/request"],function(e){"use strict";return{get:function(t,n,r,i){var s=e({callbackParamName:"callback",content:n,handleAs:"json",url:t});s.then(r,i)},computeHistogram:function(t,n,r,i){var s=e({url:t+"/computeHistograms",callbackParamName:"callback",content:n,handleAs:"json",timeout:6e4},{usePost:!0});s.then(r,i)}}}),define("report/rasterArea",["lodash","utils/assert","utils/request","report/config","dojo/Deferred"],function(e,t,n,r,i){"use strict";function o(e){function u(e){e.histograms.length>0?t.resolve(e.histograms[0]):t.reject()}var t=new i,o={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(e),renderingRule:JSON.stringify(r.rasterFunctions.range),pixelSize:s,f:"json"};return n.computeHistogram(r.urls.imageService,o,u,c),t}function u(t){var n=t.counts,r=e.findIndex(n,function(e){return e>0}),i=t.size,o=0;while(r<i)o+=r*n[r]*Math.pow(s/30,2),++r;return o}function a(t){var n=e.findIndex(t.counts,function(e){return e>0}),r=t.size,i=[];while(n<r)i.push(n),i.push(n),++n;return i}function f(t,o,u){function v(e){console.log(e)}var a=new i,f=e.clone(r.rasterFunctions.combination),l=[],h;if(u.simpleRule)f.rasterFunctionArguments.RasterRange=[1,2],f.rasterFunctionArguments.Raster=u.simpleRule;else{var p=u.raster.bounds[1]*u.raster2.length[0]+u.raster.bounds[1];f.rasterFunctionArguments.RasterRange=[1,p],f.rasterFunctionArguments.Raster.rasterFunctionArguments={RasterRange:u.raster.bounds,Raster2Length:u.raster2.length,Raster:u.raster.id,Raster2:u.raster2.id}}for(var d=0;d<o.length/2;d++)l.push(d+1);return f.rasterFunctionArguments.Raster2.rasterFunctionArguments.InputRanges=o,f.rasterFunctionArguments.Raster2.rasterFunctionArguments.OutputValues=l,h={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(t),renderingRule:JSON.stringify(f),pixelSize:s,f:"json"},n.computeHistogram(r.urls.imageService,h,v,c),a}function l(){}function c(e){console.error(e)}var s=90;return{getArea:function(e,n){t(e&&e.type==="polygon","Invalid Parameter");var r=new i,s,l;return o(e).then(function(t){if(n===undefined){l=u(t),r.resolve(l);return}s=a(t),f(e,s,n).then(function(e){},c)},c),r}}}),define("report/Fetcher",["lodash","dojo/number","dojo/Deferred","dojo/promise/all","dojo/_base/array","report/config","report/Renderer","report/RiskHelper","report/Suitability","map/Symbols","esri/map","esri/request","esri/tasks/query","esri/dijit/Scalebar","esri/tasks/QueryTask","esri/SpatialReference","esri/geometry/Polygon","esri/tasks/GeometryService","esri/geometry/geometryEngine","esri/tasks/AreasAndLengthsParameters","esri/Color","esri/graphic","report/rasterArea"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){"use strict";var x=[];return{getAreaFromGeometry:function(e){function c(e){e.areas.length===1?(l=t.format(e.areas[0],{places:0}),report.area=e.areas[0],r.resolve(l)):(l=f,r.resolve(!1))}function h(e){r.resolve(!1)}this._debug("Fetcher >>> getAreaFromGeometry");var r=new n,i=new g(s.geometryServiceUrl),o=new b,u=new v(54012),a=new m(e),f="Not Available",l;return o.areaUnit=g.UNIT_HECTARES,i.project([a],u,function(e){e.length>0?(a.rings=e[0].rings,a.setSpatialReference(u)):h(),i.simplify([a],function(e){o.polygons=e,i.areasAndLengths(o,c,h)},h)},h),r.promise},setupMap:function(){function i(){r.graphics.clear(),r.resize(),e=new p({map:r,scalebarUnit:"metric"}),n=y.simplify(new m(report.geometry)),t=new E,t.setGeometry(n),t.setSymbol(f.getPolygonSymbol()),r.graphics.add(t),r.setExtent(t.geometry.getExtent().expand(3),!0)}var e,t,n,r;r=new l("print-map",{basemap:"topo",sliderPosition:"top-right"}),r.loaded?i():r.on("load",i)},getPrimaryForestResults:function(){this._debug("Fetcher >>> getPrimaryForestResults");var e=new n,t=s.primaryForest;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getTreeCoverResults:function(){this._debug("Fetcher >>> getTreeCoverResults");var e=new n,t=s.treeCover;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getTreeCoverLossResults:function(){function f(n){n.histograms.length>0?(o.renderTreeCoverLossData(n.histograms[0].counts,u.pixelSize,t),o.renderCompositionAnalysis(n.histograms[0].counts,u.pixelSize,t)):o.renderAsUnavailable("loss",t),e.resolve(!0)}function l(t){t.details?t.details[0]==="The requested image exceeds the size limit."&&u.pixelSize!==500?(u.pixelSize=500,a._computeHistogram(r,u,f,l)):e.resolve(!1):e.resolve(!1)}this._debug("Fetcher >>> getTreeCoverLossResults");var e=new n,t=s.treeCoverLoss,r=s.imageServiceUrl,i=t.rasterId,u={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify(t.mosaicRule),pixelSize:s.pixelSize,f:"json"},a=this;return o.renderTotalLossContainer(t),o.renderCompositionAnalysisLoader(t),this._computeHistogram(r,u,f,l),e.promise},getLegalClassResults:function(){this._debug("Fetcher >>> getLegalClassResults");var e=new n,t=s.legalClass;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getIndonesiaMoratoriumResults:function(){this._debug("Fetcher >>> getProtectedAreaResults");var e=new n,t=s.indonesiaMoratorium;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getProtectedAreaResults:function(){this._debug("Fetcher >>> getProtectedAreaResults");var e=new n,t=s.protectedArea;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getCarbonStocksResults:function(){this._debug("Fetcher >>> getCarbonStocksResults");var e=new n,t=s.carbonStock;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getIntactForestResults:function(){this._debug("Fetcher >>> getIntactForestResults");var e=new n,t=s.intactForest;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0)]).then(function(){e.resolve(!0)}),e.promise},getLandCoverGlobalResults:function(){this._debug("Fetcher >>> getLandCoverGlobalResults");var e=new n,t=s.landCoverGlobal;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getLandCoverAsiaResults:function(){this._debug("Fetcher >>> getLandCoverAsiaResults");var e=new n,t=s.landCoverAsia;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getLandCoverIndonesiaResults:function(){this._debug("Fetcher >>> getLandCoverIndonesiaResults");var e=new n,t=s.landCoverIndo;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getPeatLandsResults:function(){this._debug("Fetcher >>> getPeatLandsResults");var e=new n,t=s.peatLands;return o.renderContainers(t),x.push(t),r([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getRSPOResults:function(){function l(n){o.renderRSPOData(n,t,i),e.resolve(!0)}function c(t){t.details?t.details[0]==="The requested image exceeds the size limit."&&a.pixelSize!==500?(a.pixelSize=500,f._computeHistogram(r,a,l,c)):e.resolve(!1):e.resolve(!1)}this._debug("Fetcher >>> getRSPOResults");var e=new n,t=s.rspo,r=s.imageServiceUrl,i=this._getEncodingFunction(t.lossBounds,t.bounds),u=i.render(s.totalLoss.rasterId,t.rasterId),a={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:u,pixelSize:s.pixelSize,f:"json"},f=this;return o.renderRSPOContainer(t),this._computeHistogram(r,a,l,c),e.promise},_getTotalLossAnalysis:function(e,t){function p(n){if(n.histograms.length>0)o.renderLossData(n.histograms[0].counts,c.pixelSize,e,a,t);else{var s=Array.apply(null,new Array(i.labels.length)).map(Number.prototype.valueOf,0);o.renderLossData(s,c.pixelSize,e,a,t)}r.resolve(!0)}function d(e){e.details?e.details[0]==="The requested image exceeds the size limit."&&c.pixelSize!==500?(c.pixelSize=500,h._computeHistogram(u,c,p,d)):r.resolve(!1):r.resolve(!1)}this._debug("Fetcher >>> _getTotalLossAnalysis");var r=new n,i=s.totalLoss,u=s.imageServiceUrl,a=this._getEncodingFunction(i.bounds,e.bounds),f=e.rasterRemap?e.rasterRemap:e.rasterId,l=t?a.getSimpleRule(i.rasterId,f):a.render(i.rasterId,f),c={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:l,pixelSize:s.pixelSize,f:"json"},h=this;return this._computeHistogram(u,c,p,d),r.promise},_getClearanceAlertAnalysis:function(t,r){function d(e){if(e.histograms.length>0)o.renderClearanceData(e.histograms[0].counts,h.pixelSize,t,p,r);else{var n=Array.apply(null,new Array(report.clearanceLabels.length)).map(Number.prototype.valueOf,0);o.renderClearanceData(n,h.pixelSize,t,p,r)}i.resolve(!0)}function v(e){i.resolve(!1)}this._debug("Fetcher >>> _getClearanceAlertAnalysis");var i=new n,u=s.clearanceAlerts,a=s.clearanceAnalysisUrl,f=this,l,c,h,p;return t=e.clone(t),t.formaId&&(t.rasterId=t.formaId,t.includeFormaIdInRemap&&(t.rasterRemap.rasterFunctionArguments.Raster=t.formaId)),p=this._getEncodingFunction(report.clearanceBounds,t.bounds),c=t.rasterRemap?t.rasterRemap:t.rasterId,l=r?p.getSimpleRule(u.rasterId,c):p.render(u.rasterId,c),h={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:l,pixelSize:500,f:"json"},this._computeHistogram(a,h,d,v),i.promise},_getCompositionAnalysis:function(e){function f(n){n.histograms.length>0?o.renderCompositionAnalysis(n.histograms[0].counts,u.pixelSize,e):o.renderAsUnavailable("composition",e),t.resolve(!0)}function l(e){e.details?e.details[0]==="The requested image exceeds the size limit."&&u.pixelSize!==500?(u.pixelSize=500,a._computeHistogram(r,u,f,l)):t.resolve(!1):t.resolve(!1)}o.renderCompositionAnalysisLoader(e);var t=new n,r=s.imageServiceUrl,i=e.compositionAnalysis,u={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify({mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[i.rasterId],ascending:!0,mosaicOperation:"MT_FIRST"}),pixelSize:s.pixelSize,f:"json"},a=this;return this._computeHistogram(r,u,f,l),t.promise},_getSuitabilityAnalysis:function(){this._debug("Fetcher >>> _getSuitabilityAnalysis");var e=new n,t=s.suitability;return o.renderSuitabilityContainer(t),a.getSuitabilityData().then(function(n){o.renderSuitabilityData(t,n),a.getCompositionAnalysis().then(function(t){o.renderSuitabilityCompositionChart(t),e.resolve(!0)})}),e.promise},_getMillPointAnalysis:function(){function h(){var e=new XMLHttpRequest,n;e.open("POST",t.url,!0),e.onreadystatechange=function(t){e.readyState===4&&(e.status===200?(n=JSON.parse(e.response),n.mills?f.resolve(n.mills):f.resolve(!1)):f.resolve(!1))},e.addEventListener("error",function(){f.resolve(!1)},!1);var r=new FormData;r.append("mills",c.map(function(e){return e.millId}).join(",")),e.send(r)}function p(){u.prepareFeatures(l).then(function(e){a.resolve(e)})}this._debug("Fetcher >>> _getMillPointAnalysis");var e=new n,t=s.millPoints,a=new n,f=new n,l=[],c=[];return o.renderMillContainer(t),i.forEach(report.mills,function(e){e.isCustom?l.push(e):c.push(e)}),c.length>0?h():f.resolve(),l.length>0?p():a.resolve(!1),r([a,f]).then(function(n){var r=[];i.forEach(n,function(e){e&&(r=r.concat(e))}),o.renderMillAssessment(r,t),e.resolve(!0)}),e.promise},_getFireAlertAnalysis:function(){this._debug("Fetcher >>> _getFireAlertAnalysis");var e=new n,t=new m(report.geometry),i=new Date,u="",a=0,f=this,l=[],c,p,v,g;return p=new h,g=new d(s.fires.url+"/4"),p.geometry=t,p.returnGeometry=!1,p.outFields=["*"],p.where="1 = 1",v=new d("http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0"),c=new h,c.geometry=t,c.returnGeometry=!1,c.outFields=["moratorium"],i.setDate(i.getDate()-8),u=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds(),c.where="ACQ_DATE > date '"+u+"'",r([g.execute(p),v.execute(c)]).then(function(t){o.renderFireData(x,t),e.resolve(!0)}),g.on("error",function(){e.resolve(!1)}),e.promise},_getClearanceBounds:function(){this._debug("Fetcher >>> _getClearanceBounds");var e=s.clearanceBounds,t=new n,r=0,i,o;return o=c({url:e.url,content:{f:"pjson"},handleAs:"json",callbackParamName:"callback"}),o.then(function(n){report.clearanceBounds=[n.minValues[0],n.maxValues[0]],report.clearanceLabels=[];for(var s=n.minValues[0],o=n.maxValues[0];s<=o;s++)i=s%12===0?12:s%12,report.clearanceLabels.push(i+"-"+(e.baseYearLabel+r)),s%12===0&&++r;t.resolve(!0)},function(e){t.resolve(!1,e)}),t.promise},_getEncodingFunction:function(e,t,n){var r=this;return{A:arrayFromBounds(e),B:arrayFromBounds(t),getSimpleRule:function(e,t){return JSON.stringify({rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:e,Raster2:t,Operation:3}})},renderRule:function(e,t){return{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[this.A[0],this.A[this.A.length-1]+1],OutputValues:[this.B.length],Raster:e,AllowUnmatched:!1}},Raster2:e,Operation:3}},Raster2:t,Operation:1}}},render:function(e,t){return JSON.stringify(this.renderRule(e,t))},encode:function(e,t){return this.B.length*e+t},decode:function(e){var t=e%this.B.length,n=(e-t)/this.B.length;return[n,t]}}},_computeHistogram:function(e,t,n,r){var i=c({url:e+"/computeHistograms",content:t,handleAs:"json",callbackParamName:"callback",timeout:6e4},{usePost:!0});i.then(n,r)},_debug:function(e){console.log(e)}}}),define("report/Generator",["dojo/on","dojo/dom","dojo/query","esri/config","dojo/request/xhr","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/promise/all","dojo/_base/array","dijit/Dialog","dojox/validate/web","esri/geometry/Point","esri/geometry/Polygon","esri/SpatialReference","esri/tasks/GeometryService","esri/geometry/geometryEngine","esri/geometry/webMercatorUtils","utils/Analytics","report/config","report/Fetcher","report/CSVExporter","esri/units","esri/geometry/Circle"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x){"use strict";return window.report={},{init:function(){window.payload&&(this.addConfigurations(),this.addContentAndEvents(),this.prepareForAnalysis())},addConfigurations:function(){f.forEach(b.corsEnabledServers,function(e){r.defaults.io.corsEnabledServers.push(e)}),Highcharts.setOptions({chart:{style:{fontFamily:"'Fira Sans', 'fira_sans_otregular', Georgia, serif"}}})},addContentAndEvents:function(){this.setTitle(window.payload.title),this.setupHeader(),this.addSubscriptionDialog(),this.addCSVOptionToHighcharts()},setTitle:function(e){document.getElementById("title").innerHTML=e},setupHeader:function(){var n=t.byId("total-area-info-icon");e(n,"click",function(e){o.remove("total-area-info-popup","hidden")}),n=t.byId("total-area-close-info-icon"),e(n,"click",function(e){o.add("total-area-info-popup","hidden")})},addSubscriptionDialog:function(){var n=new l({title:"Subscribe to Alerts!",style:"width: 300px;"}),r=this,i="<div class='subscription-content'><div class='checkbox-container'><label><input id='forma_check' type='checkbox' value='clearance' />Monthly Clearance Alerts</label></div><div class='checkbox-container'><label><input id='fires_check' type='checkbox' value='fires' />Fire Alerts</label></div><div class='email-container'><input id='user-email' type='text' placeholder='something@gmail.com'/></div><div class='submit-container'><button id='subscribe-now'>Subscribe</button></div><div id='form-response' class='message-container'></div></div>";n.setContent(i),e(t.byId("subscribeToAlerts"),"click",function(){n.show()}),e(t.byId("subscribe-now"),"click",function(){t.byId("form-response").innerHTML="<div class='loader-wheel subscribe'>subscribing</div>",r.subscribeToAlerts()})},addCSVOptionToHighcharts:function(){function t(){var e=document.getElementById("title").innerHTML,t=this,n=t.options.chart.type,r="\r\n",i=[],s,o;i.push(n==="column"?"RSPO Land Use Change Analysis":t.title.textStr),i.push(e),n==="bar"&&t.xAxis.length>1?(s=E.exportCompositionAnalysis(t),i=i.concat(s)):n==="pie"?(s=E.exportSuitabilityByLegalClass(t),i=i.concat(s)):(s=E.exportSimpleChartAnalysis(t),i=i.concat(s)),i.length>1&&(o=i.join(r)),o&&E.exportCSV(o);var u=n==="column"?"RSPO Land Use Change Analysis":t.title.textStr;y.sendEvent("Event","Download CSV",u)}var e=this;Highcharts.getOptions().exporting.buttons.contextButton.menuItems.push({text:"Download CSV",onclick:t})},prepareForAnalysis:function(){var e=this,t=new v(b.geometryServiceUrl),n=new d(102100),r,i,s,o;report.suitable=window.payload.suitability,report.datasets=window.payload.datasets;var u=JSON.parse(window.payload.geometry);if(u.length===1){var a=u[0];a.geometry.radius?(o=new p(n),o.addRing(a.geometry.rings[a.geometry.rings.length-1]),report.geometry=o,a.geometry=report.geometry,report.mills=[a]):a.geometry.type==="polygon"&&(report.geometry=new p(a.geometry)),this.beginAnalysis()}else i=[],f.forEach(u,function(e){e.geometry.type==="polygon"&&(o=new p(e.geometry),i.push(o)),e.geometry.center&&(o=new p(n),o.addRing(e.geometry.rings[e.geometry.rings.length-1]),i.push(o),e.geometry=o)}),report.mills=u,t.union(i,function(t){o=new p(t),report.geometry=o,e.beginAnalysis()})},beginAnalysis:function(){function r(){e.length>0?(n=e.shift(),a(t._getDeferredsForItems(n)).then(r)):t.getFiresAnalysis()}var e=this._getArrayOfRequests(),t=this,n;report.geometry=m.simplify(report.geometry);var i=m.planarArea(report.geometry)/1e4;i>3e6&&(b.pixelSize=500,alert(b.messages.largeAreaWarning)),report.areaPromise=w.getAreaFromGeometry(report.geometry),report.areaPromise.then(function(e){document.getElementById("total-area").innerHTML=e?e:"Not Available"}),a([w._getClearanceBounds()]).then(function(){e.length<3?a(t._getDeferredsForItems(e)).then(t.getFiresAnalysis.bind(t)):(e=arrayChunk(e,3),r())})},getFiresAnalysis:function(){var e=this;a([w._getFireAlertAnalysis()]).then(e.analysisComplete)},analysisComplete:function(){w.setupMap(),o.remove("print","disabled"),e(t.byId("print"),"click",function(){u.set("total-area-info-popup","visibility","hidden"),window.print()}),n(".loader-wheel").forEach(function(e){e.parentNode.id!=="total-area"&&e.parentNode.id!=="print-map"&&(e.parentNode.innerHTML="There was an error getting these results at this time.")})},_getArrayOfRequests:function(){var e=[];for(var t in report.datasets)report.datasets[t]&&e.push(t);return e},_getDeferredsForItems:function(e){var t=[];return f.forEach(e,function(e){switch(e){case"suit":t.push(w._getSuitabilityAnalysis());break;case"mill":t.push(w._getMillPointAnalysis());break;case"carbon":t.push(w.getCarbonStocksResults());break;case"intact":t.push(w.getIntactForestResults());break;case"landCoverGlob":t.push(w.getLandCoverGlobalResults());break;case"landCoverAsia":t.push(w.getLandCoverAsiaResults());break;case"landCoverIndo":t.push(w.getLandCoverIndonesiaResults());break;case"legal":t.push(w.getLegalClassResults());break;case"peat":t.push(w.getPeatLandsResults());break;case"primForest":t.push(w.getPrimaryForestResults());break;case"protected":t.push(w.getProtectedAreaResults());break;case"rspo":t.push(w.getRSPOResults());break;case"treeDensity":t.push(w.getTreeCoverResults());break;case"treeCoverLoss":t.push(w.getTreeCoverLossResults());break;case"indonesiaMoratorium":t.push(w.getIndonesiaMoratoriumResults());break;default:}}),t},subscribeToAlerts:function(){var e=this.convertGeometryToGeometric(report.geometry),n=t.byId("user-email").value,r=t.byId("forma_check").checked,i=t.byId("fires_check").checked,s=[],o={};o.invalidEmail="You must provide a valid email in the form.",o.noSelection="You must select at least one checkbox from the form.",o.formaSuccess="Thank you for subscribing to Forma Alerts.  You should receive a confirmation email soon.",o.formaFail="There was an error with your request to subscribe to Forma alerts.  Please try again later.",o.fireSuccess="Thank you for subscribing to Fires Alerts.  You should receive a confirmation email soon.",o.fireFail="There was an error with your request to subscribe to Fires alerts.  Please try again later.",c.isEmailAddress(n)||s.push(o.invalidEmail),!r&&!i&&s.push(o.noSelection);if(s.length>0)alert("Please fill in the following:\n"+s.join("\n"));else if(r&&i){var u=[];a([this.subscribeToForma(e,n),this.subscribeToFires(report.geometry,n)]).then(function(e){e[0]?u.push(o.formaSuccess):u.push(o.formaFail),e[1]?u.push(o.fireSuccess):u.push(o.fireFail),t.byId("form-response").innerHTML=u.join("<br />")})}else r?this.subscribeToForma(e,n).then(function(e){e?t.byId("form-response").innerHTML=o.formaSuccess:t.byId("form-response").innerHTML=o.formaFail}):i&&this.subscribeToFires(report.geometry,n).then(function(e){e?t.byId("form-response").innerHTML=o.fireSuccess:t.byId("form-response").innerHTML=o.fireFail})},subscribeToForma:function(e,t){var n=b.alertUrl.forma,r=new s,i=new XMLHttpRequest,o=JSON.stringify({topic:"updates/forma",geom:'{"type": "'+e.type+'", "coordinates":['+JSON.stringify(e.geom)+"]}",email:t}),u;return i.open("POST",n,!0),i.onreadystatechange=function(){i.readyState===4&&(u=JSON.parse(i.response),r.resolve(u.subscribe))},i.addEventListener("error",function(){r.resolve(!1)},!1),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(o),r.promise},subscribeToFires:function(e,t){var n=b.alertUrl.fires,r=new s,o={features:JSON.stringify({rings:e.rings,spatialReference:e.spatialReference}),msg_addr:t,msg_type:"email",area_name:payload.title},u;return i(n,{handleAs:"json",method:"POST",data:o}).then(function(){r.resolve(!0)},function(e){r.resolve(!1)}),r.promise},convertGeometryToGeometric:function(e){function o(e,t){var n=!1;return f.forEach(e,function(e){e[0]===t[0]&&e[1]===t[1]&&(n=!0)}),n}var t=new d({wkid:102100}),n=[],r=[],i,s;return f.forEach(e.rings,function(e){f.forEach(e,function(e){s=new h(e,t),i=g.xyToLngLat(s.x,s.y),o(r,i)?(r.push(i),n.push(r),r=[]):r.push(i)})}),{geom:n.length>1?n:n[0],type:n.length>1?"MultiPolygon":"Polygon"}}}}),function(){function e(e,t){var n,r,i;r=!1,n=document.createElement("script"),n.type="text/javascript",n.src=e,n.onload=n.onreadystatechange=function(){!r&&(!this.readyState||this.readyState=="complete")&&(r=!0,t())},i=document.getElementsByTagName("script")[0],i.parentNode.insertBefore(n,i)}var t=function(e){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)};t("http://js.arcgis.com/3.13/esri/css/esri.css"),t("http://js.arcgis.com/3.13/dijit/themes/tundra/tundra.css"),t("app/css/report.css"),window.arrayFromBounds=function(e){var t=[],n=e[0],r=e[1];for(n;n<=r;n++)t.push(n);return t},window.arrayChunk=function(e,t){var n=[],r=0;for(r;r<e.length;r+=t)n.push(e.slice(r,r+t));return n},window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}(),require(["report/Generator"],function(t){var n=!1;e("http://code.jquery.com/jquery-1.11.0.min.js",function(){e("http://code.highcharts.com/highcharts.js",function(){e("http://code.highcharts.com/modules/exporting.js",function(){localStorage?(window.payload=JSON.parse(localStorage.getItem("payload")),window.payload&&(n=!0)):window.payload&&(n=!0),n?t.init():(document.addEventListener("PayloadReady",function(){n=!0}),setTimeout(function(){n&&window.payload?t.init():alert("There was an error generating the report at this time.  Please make sure your pop-up blocker is disabled and try again.")},5e3))})})})})}(),define("app/js/report/reportBundle",function(){});