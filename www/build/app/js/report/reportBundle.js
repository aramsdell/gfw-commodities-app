/**
 * @license
 * lodash 3.8.0 (Custom Build) lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
 * Build: `lodash modern -o ./lodash.js`
 */

define("utils/Analytics",[],function(){"use strict";return{sendEvent:function(e,t,r,n){var o={hitType:"event",eventCategory:e,eventAction:t,eventLabel:r,eventValue:n||1};ga&&(ga("A.send",o),ga("B.send",o),ga("C.send",o))},sendPageview:function(e,t){var r={hitType:"pageview"};e&&(r.page=e),t&&(r.title=t),ga&&(ga("A.send",r),ga("B.send",r),ga("C.send",r))}}}),function(){function e(e,t){if(e!==t){var r=e===e,n=t===t;if(e>t||!r||e===_&&n)return 1;if(t>e||!n||t===_&&r)return-1}return 0}function t(e,t,r){for(var n=e.length,o=r?n:-1;r?o--:++o<n;)if(t(e[o],o,e))return o;return-1}function r(e,t,r){if(t!==t)return p(e,r);r-=1;for(var n=e.length;++r<n;)if(e[r]===t)return r;return-1}function n(e){return"function"==typeof e||!1}function o(e){return"string"==typeof e?e:null==e?"":e+""}function i(e){return e.charCodeAt(0)}function a(e,t){for(var r=-1,n=e.length;++r<n&&-1<t.indexOf(e.charAt(r)););return r}function s(e,t){for(var r=e.length;r--&&-1<t.indexOf(e.charAt(r)););return r}function l(t,r){return e(t.a,r.a)||t.b-r.b}function u(e){return Be[e]}function c(e){return De[e]}function d(e){return"\\"+je[e]}function p(e,t,r){var n=e.length;for(t+=r?0:-1;r?t--:++t<n;){var o=e[t];if(o!==o)return t}return-1}function f(e){return!!e&&"object"==typeof e}function m(e){return 160>=e&&e>=9&&13>=e||32==e||160==e||5760==e||6158==e||e>=8192&&(8202>=e||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function g(e,t){for(var r=-1,n=e.length,o=-1,i=[];++r<n;)e[r]===t&&(e[r]=M,i[++o]=r);return i}function h(e){for(var t=-1,r=e.length;++t<r&&m(e.charCodeAt(t)););return t}function y(e){for(var t=e.length;t--&&m(e.charCodeAt(t)););return t}function v(e){return ze[e]}function b(m){function Be(e){if(f(e)&&!(Oi(e)||e instanceof Me)){if(e instanceof ze)return e;if(Wn.call(e,"__chain__")&&Wn.call(e,"__wrapped__"))return Dr(e)}return new ze(e)}function De(){}function ze(e,t,r){this.__wrapped__=e,this.__actions__=r||[],this.__chain__=!!t}function Me(e){this.__wrapped__=e,this.__actions__=null,this.__dir__=1,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=To,this.__views__=null}function je(){this.__data__={}}function Ue(e){var t=e?e.length:0;for(this.data={hash:bo(null),set:new co};t--;)this.push(e[t])}function He(e,t){var r=e.data;return("string"==typeof t||dn(t)?r.set.has(t):r.hash[t])?0:-1}function Ge(e,t){var r=-1,n=e.length;for(t||(t=Pn(n));++r<n;)t[r]=e[r];return t}function $e(e,t){for(var r=-1,n=e.length;++r<n&&!1!==t(e[r],r,e););return e}function Ye(e,t){for(var r=-1,n=e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function Je(e,t){for(var r=-1,n=e.length,o=-1,i=[];++r<n;){var a=e[r];t(a,r,e)&&(i[++o]=a)}return i}function We(e,t){for(var r=-1,n=e.length,o=Pn(n);++r<n;)o[r]=t(e[r],r,e);return o}function Ke(e,t,r,n){var o=-1,i=e.length;for(n&&i&&(r=e[++o]);++o<i;)r=t(r,e[o],o,e);return r}function Xe(e,t){for(var r=-1,n=e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function Ze(e,t){return e===_?t:e}function Qe(e,t,r,n){return e!==_&&Wn.call(n,r)?e:t}function et(e,t,r){var n=Yi(t);so.apply(n,Wo(t));for(var o=-1,i=n.length;++o<i;){var a=n[o],s=e[a],l=r(s,t[a],a,e,t);(l===l?l===s:s!==s)&&(s!==_||a in e)||(e[a]=l)}return e}function tt(e,t){for(var r=-1,n=null==e,o=!n&&Ar(e),i=o&&e.length,a=t.length,s=Pn(a);++r<a;){var l=t[r];s[r]=o?wr(l,i)?e[l]:_:n?_:e[l]}return s}function rt(e,t,r){r||(r={});for(var n=-1,o=t.length;++n<o;){var i=t[n];r[i]=e[i]}return r}function nt(e,t,r){var n=typeof e;return"function"==n?t===_?e:zt(e,t,r):null==e?Tn:"object"==n?bt(e):t===_?On(e):_t(e,t)}function ot(e,t,r,n,o,i,a){var s;if(r&&(s=o?r(e,n,o):r(e)),s!==_)return s;if(!dn(e))return e;if(n=Oi(e)){if(s=br(e),!t)return Ge(e,s)}else{var l=Xn.call(e),u=l==Y;if(l!=q&&l!=j&&(!u||o))return Pe[l]?Sr(e,l,t):o?e:{};if(s=_r(u?{}:e),!t)return zo(s,e)}for(i||(i=[]),a||(a=[]),o=i.length;o--;)if(i[o]==e)return a[o];return i.push(e),a.push(s),(n?$e:pt)(e,function(n,o){s[o]=ot(n,t,r,o,e,i,a)}),s}function it(e,t,r){if("function"!=typeof e)throw new Gn(z);return po(function(){e.apply(_,r)},t)}function at(e,t){var n=e?e.length:0,o=[];if(!n)return o;var i=-1,a=vr(),s=a==r,l=s&&200<=t.length?Yo(t):null,u=t.length;l&&(a=He,s=!1,t=l);e:for(;++i<n;)if(l=e[i],s&&l===l){for(var c=u;c--;)if(t[c]===l)continue e;o.push(l)}else 0>a(t,l,0)&&o.push(l);return o}function st(e,t){var r=!0;return jo(e,function(e,n,o){return r=!!t(e,n,o)}),r}function lt(e,t){var r=[];return jo(e,function(e,n,o){t(e,n,o)&&r.push(e)}),r}function ut(e,t,r,n){var o;return r(e,function(e,r,i){return t(e,r,i)?(o=n?r:e,!1):void 0}),o}function ct(e,t,r){for(var n=-1,o=e.length,i=-1,a=[];++n<o;){var s=e[n];if(f(s)&&Ar(s)&&(r||Oi(s)||ln(s))){t&&(s=ct(s,t,r));for(var l=-1,u=s.length;++l<u;)a[++i]=s[l]}else r||(a[++i]=s)}return a}function dt(e,t){Ho(e,t,bn)}function pt(e,t){return Ho(e,t,Yi)}function ft(e,t){return Go(e,t,Yi)}function mt(e,t){for(var r=-1,n=t.length,o=-1,i=[];++r<n;){var a=t[r];Ni(e[a])&&(i[++o]=a)}return i}function gt(e,t,r){if(null!=e){r!==_&&r in Nr(e)&&(t=[r]),r=-1;for(var n=t.length;null!=e&&++r<n;)e=e[t[r]];return r&&r==n?e:_}}function ht(e,t,r,n,o,i){if(e===t)return!0;var a=typeof e,s=typeof t;if("function"!=a&&"object"!=a&&"function"!=s&&"object"!=s||null==e||null==t)e=e!==e&&t!==t;else e:{var a=ht,s=Oi(e),l=Oi(t),u=U,c=U;s||(u=Xn.call(e),u==j?u=q:u!=q&&(s=hn(e))),l||(c=Xn.call(t),c==j?c=q:c!=q&&hn(t));var d=u==q,l=c==q,c=u==c;if(!c||s||d){if(!n&&(u=d&&Wn.call(e,"__wrapped__"),l=l&&Wn.call(t,"__wrapped__"),u||l)){e=a(u?e.value():e,l?t.value():t,r,n,o,i);break e}if(c){for(o||(o=[]),i||(i=[]),u=o.length;u--;)if(o[u]==e){e=i[u]==t;break e}o.push(e),i.push(t),e=(s?fr:gr)(e,t,a,r,n,o,i),o.pop(),i.pop()}else e=!1}else e=mr(e,t,u)}return e}function yt(e,t,r,n,o){for(var i=-1,a=t.length,s=!o;++i<a;)if(s&&n[i]?r[i]!==e[t[i]]:!(t[i]in e))return!1;for(i=-1;++i<a;){var l=t[i],u=e[l],c=r[i];if(s&&n[i]?l=u!==_||l in e:(l=o?o(u,c,l):_,l===_&&(l=ht(c,u,o,!0))),!l)return!1}return!0}function vt(e,t){var r=-1,n=Ar(e)?Pn(e.length):[];return jo(e,function(e,o,i){n[++r]=t(e,o,i)}),n}function bt(e){var t=Yi(e),r=t.length;if(!r)return xn(!0);if(1==r){var n=t[0],o=e[n];if(Tr(o))return function(e){return null==e?!1:e[n]===o&&(o!==_||n in Nr(e))}}for(var i=Pn(r),a=Pn(r);r--;)o=e[t[r]],i[r]=o,a[r]=Tr(o);return function(e){return null!=e&&yt(Nr(e),t,i,a)}}function _t(e,t){var r=Oi(e),n=Er(e)&&Tr(t),o=e+"";return e=Br(e),function(i){if(null==i)return!1;var a=o;if(i=Nr(i),!(!r&&n||a in i)){if(i=1==e.length?i:gt(i,It(e,0,-1)),null==i)return!1;a=Hr(e),i=Nr(i)}return i[a]===t?t!==_||a in i:ht(t,i[a],null,!0)}}function St(e,t,r,n,o){if(!dn(e))return e;var i=Ar(t)&&(Oi(t)||hn(t));if(!i){var a=Yi(t);so.apply(a,Wo(t))}return $e(a||t,function(s,l){if(a&&(l=s,s=t[l]),f(s)){n||(n=[]),o||(o=[]);e:{for(var u=l,c=n,d=o,p=c.length,m=t[u];p--;)if(c[p]==m){e[u]=d[p];break e}var p=e[u],g=r?r(p,m,u,e,t):_,h=g===_;h&&(g=m,Ar(m)&&(Oi(m)||hn(m))?g=Oi(p)?p:Ar(p)?Ge(p):[]:Bi(m)||ln(m)?g=ln(p)?yn(p):Bi(p)?p:{}:h=!1),c.push(m),d.push(g),h?e[u]=St(g,m,r,c,d):(g===g?g!==p:p===p)&&(e[u]=g)}}else u=e[l],c=r?r(u,s,l,e,t):_,(d=c===_)&&(c=s),!i&&c===_||!d&&(c===c?c===u:u!==u)||(e[l]=c)}),e}function Rt(e){return function(t){return null==t?_:t[e]}}function At(e){var t=e+"";return e=Br(e),function(r){return gt(r,e,t)}}function wt(e,t){for(var r=e?t.length:0;r--;){var n=parseFloat(t[r]);if(n!=o&&wr(n)){var o=n;fo.call(e,n,1)}}}function Ct(e,t){return e+oo(Io()*(t-e+1))}function Et(e,t,r,n,o){return o(e,function(e,o,i){r=n?(n=!1,e):t(r,e,o,i)}),r}function It(e,t,r){var n=-1,o=e.length;for(t=null==t?0:+t||0,0>t&&(t=-t>o?0:o+t),r=r===_||r>o?o:+r||0,0>r&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0,r=Pn(o);++n<o;)r[n]=e[n+t];return r}function xt(e,t){var r;return jo(e,function(e,n,o){return r=t(e,n,o),!r}),!!r}function Tt(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].c;return e}function Ft(t,r,n){var o=yr(),i=-1;return r=We(r,function(e){return o(e)}),t=vt(t,function(e){return{a:We(r,function(t){return t(e)}),b:++i,c:e}}),Tt(t,function(t,r){var o;e:{o=-1;for(var i=t.a,a=r.a,s=i.length,l=n.length;++o<s;){var u=e(i[o],a[o]);if(u){o=l>o?u*(n[o]?1:-1):u;break e}}o=t.b-r.b}return o})}function kt(e,t){var r=0;return jo(e,function(e,n,o){r+=+t(e,n,o)||0}),r}function Lt(e,t){var n=-1,o=vr(),i=e.length,a=o==r,s=a&&i>=200,l=s?Yo():null,u=[];l?(o=He,a=!1):(s=!1,l=t?[]:u);e:for(;++n<i;){var c=e[n],d=t?t(c,n,e):c;if(a&&c===c){for(var p=l.length;p--;)if(l[p]===d)continue e;t&&l.push(d),u.push(c)}else 0>o(l,d,0)&&((t||s)&&l.push(d),u.push(c))}return u}function Ot(e,t){for(var r=-1,n=t.length,o=Pn(n);++r<n;)o[r]=e[t[r]];return o}function Pt(e,t,r,n){for(var o=e.length,i=n?o:-1;(n?i--:++i<o)&&t(e[i],i,e););return r?It(e,n?0:i,n?i+1:o):It(e,n?i+1:0,n?o:i)}function Nt(e,t){var r=e;r instanceof Me&&(r=r.value());for(var n=-1,o=t.length;++n<o;){var r=[r],i=t[n];so.apply(r,i.args),r=i.func.apply(i.thisArg,r)}return r}function Bt(e,t,r){var n=0,o=e?e.length:n;if("number"==typeof t&&t===t&&Lo>=o){for(;o>n;){var i=n+o>>>1,a=e[i];(r?t>=a:t>a)?n=i+1:o=i}return o}return Dt(e,t,Tn,r)}function Dt(e,t,r,n){t=r(t);for(var o=0,i=e?e.length:0,a=t!==t,s=t===_;i>o;){var l=oo((o+i)/2),u=r(e[l]),c=u===u;(a?c||n:s?c&&(n||u!==_):n?t>=u:t>u)?o=l+1:i=l}return Ao(i,ko)}function zt(e,t,r){if("function"!=typeof e)return Tn;if(t===_)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,o){return e.call(t,r,n,o)};case 4:return function(r,n,o,i){return e.call(t,r,n,o,i)};case 5:return function(r,n,o,i,a){return e.call(t,r,n,o,i,a)}}return function(){return e.apply(t,arguments)}}function Mt(e){return to.call(e,0)}function jt(e,t,r){for(var n=r.length,o=-1,i=Ro(e.length-n,0),a=-1,s=t.length,l=Pn(i+s);++a<s;)l[a]=t[a];for(;++o<n;)l[r[o]]=e[o];for(;i--;)l[a++]=e[o++];return l}function Ut(e,t,r){for(var n=-1,o=r.length,i=-1,a=Ro(e.length-o,0),s=-1,l=t.length,u=Pn(a+l);++i<a;)u[i]=e[i];for(a=i;++s<l;)u[a+s]=t[s];for(;++n<o;)u[a+r[n]]=e[i++];return u}function Ht(e,t){return function(r,n,o){var i=t?t():{};if(n=yr(n,o,3),Oi(r)){o=-1;for(var a=r.length;++o<a;){var s=r[o];e(i,s,n(s,o,r),r)}}else jo(r,function(t,r,o){e(i,t,n(t,r,o),o)});return i}}function Gt(e){return sn(function(t,r){var n=-1,o=null==t?0:r.length,i=o>2&&r[o-2],a=o>2&&r[2],s=o>1&&r[o-1];for("function"==typeof i?(i=zt(i,s,5),o-=2):(i="function"==typeof s?s:null,o-=i?1:0),a&&Cr(r[0],r[1],a)&&(i=3>o?null:i,o=1);++n<o;)(a=r[n])&&e(t,a,i);return t})}function $t(e,t){return function(r,n){var o=r?Jo(r):0;if(!xr(o))return e(r,n);for(var i=t?o:-1,a=Nr(r);(t?i--:++i<o)&&!1!==n(a[i],i,a););return r}}function Yt(e){return function(t,r,n){var o=Nr(t);n=n(t);for(var i=n.length,a=e?i:-1;e?a--:++a<i;){var s=n[a];if(!1===r(o[s],s,o))break}return t}}function Vt(e,t){function r(){return(this&&this!==Ve&&this instanceof r?n:e).apply(t,arguments)}var n=Jt(e);return r}function qt(e){return function(t){var r=-1;t=En(Sn(t));for(var n=t.length,o="";++r<n;)o=e(o,t[r],r);return o}}function Jt(e){return function(){var t=Mo(e.prototype),r=e.apply(t,arguments);return dn(r)?r:t}}function Wt(e){function t(r,n,o){return o&&Cr(r,n,o)&&(n=null),r=pr(r,e,null,null,null,null,null,n),r.placeholder=t.placeholder,r}return t}function Kt(e,t){return function(r,n,o){o&&Cr(r,n,o)&&(n=null);var a=yr(),s=null==n;if(a===nt&&s||(s=!1,n=a(n,o,3)),s){if(n=Oi(r),n||!gn(r))return e(n?r:Pr(r));n=i}return hr(r,n,t)}}function Xt(e,r){return function(n,o,i){return o=yr(o,i,3),Oi(n)?(o=t(n,o,r),o>-1?n[o]:_):ut(n,o,e)}}function Zt(e){return function(r,n,o){return r&&r.length?(n=yr(n,o,3),t(r,n,e)):-1}}function Qt(e){return function(t,r,n){return r=yr(r,n,3),ut(t,r,e,!0)}}function er(e){return function(){var t=arguments.length;if(!t)return function(){return arguments[0]};for(var r,n=e?t:-1,o=0,i=Pn(t);e?n--:++n<t;){var a=i[o++]=arguments[n];if("function"!=typeof a)throw new Gn(z);var s=r?"":qo(a);r="wrapper"==s?new ze([]):r}for(n=r?-1:t;++n<t;)a=i[n],s=qo(a),r=(o="wrapper"==s?Vo(a):null)&&Ir(o[0])&&o[1]==(T|C|I|F)&&!o[4].length&&1==o[9]?r[qo(o[0])].apply(r,o[3]):1==a.length&&Ir(a)?r[s]():r.thru(a);return function(){var e=arguments;if(r&&1==e.length&&Oi(e[0]))return r.plant(e[0]).value();for(var n=0,e=i[n].apply(this,e);++n<t;)e=i[n].call(this,e);return e}}}function tr(e,t){return function(r,n,o){return"function"==typeof n&&o===_&&Oi(r)?e(r,n):t(r,zt(n,o,3))}}function rr(e){return function(t,r,n){return("function"!=typeof r||n!==_)&&(r=zt(r,n,3)),e(t,r,bn)}}function nr(e){return function(t,r,n){return("function"!=typeof r||n!==_)&&(r=zt(r,n,3)),e(t,r)}}function or(e){return function(t,r,n){var o={};return r=yr(r,n,3),pt(t,function(t,n,i){i=r(t,n,i),n=e?i:n,t=e?t:i,o[n]=t}),o}}function ir(e){return function(t,r,n){return t=o(t),(e?t:"")+ur(t,r,n)+(e?"":t)}}function ar(e){var t=sn(function(r,n){var o=g(n,t.placeholder);return pr(r,e,null,n,o)});return t}function sr(e,t){return function(r,n,o,i){var a=3>arguments.length;return"function"==typeof n&&i===_&&Oi(r)?e(r,n,o,a):Et(r,yr(n,i,4),o,a,t)}}function lr(e,t,r,n,o,i,a,s,l,u){function c(){for(var S=arguments.length,w=S,C=Pn(S);w--;)C[w]=arguments[w];if(n&&(C=jt(C,n,o)),i&&(C=Ut(C,i,a)),m||y){var w=c.placeholder,E=g(C,w),S=S-E.length;if(u>S){var T=s?Ge(s):null,S=Ro(u-S,0),F=m?E:null,E=m?null:E,k=m?C:null,C=m?null:C;return t|=m?I:x,t&=~(m?x:I),h||(t&=~(R|A)),C=[e,t,r,k,F,C,E,T,l,S],T=lr.apply(_,C),Ir(e)&&Ko(T,C),T.placeholder=w,T}}if(w=p?r:this,f&&(e=w[b]),s)for(T=C.length,S=Ao(s.length,T),F=Ge(C);S--;)E=s[S],C[S]=wr(E,T)?F[E]:_;return d&&l<C.length&&(C.length=l),(this&&this!==Ve&&this instanceof c?v||Jt(e):e).apply(w,C)}var d=t&T,p=t&R,f=t&A,m=t&C,h=t&w,y=t&E,v=!f&&Jt(e),b=e;return c}function ur(e,t,r){return e=e.length,t=+t,t>e&&_o(t)?(t-=e,r=null==r?" ":r+"",wn(r,ro(t/r.length)).slice(0,t)):""}function cr(e,t,r,n){function o(){for(var t=-1,s=arguments.length,l=-1,u=n.length,c=Pn(s+u);++l<u;)c[l]=n[l];for(;s--;)c[l++]=arguments[++t];return(this&&this!==Ve&&this instanceof o?a:e).apply(i?r:this,c)}var i=t&R,a=Jt(e);return o}function dr(e){return function(t,r,n,o){var i=yr(n);return i===nt&&null==n?Bt(t,r,e):Dt(t,r,i(n,o,1),e)}}function pr(e,t,r,n,o,i,a,s){var l=t&A;if(!l&&"function"!=typeof e)throw new Gn(z);var u=n?n.length:0;if(u||(t&=~(I|x),n=o=null),u-=o?o.length:0,t&x){var c=n,d=o;n=o=null}var p=l?null:Vo(e);return r=[e,t,r,n,o,c,d,i,a,s],p&&(n=r[1],t=p[1],s=n|t,o=t==T&&n==C||t==T&&n==F&&r[7].length<=p[8]||t==(T|F)&&n==C,(T>s||o)&&(t&R&&(r[2]=p[2],s|=n&R?0:w),(n=p[3])&&(o=r[3],r[3]=o?jt(o,n,p[4]):Ge(n),r[4]=o?g(r[3],M):Ge(p[4])),(n=p[5])&&(o=r[5],r[5]=o?Ut(o,n,p[6]):Ge(n),r[6]=o?g(r[5],M):Ge(p[6])),(n=p[7])&&(r[7]=Ge(n)),t&T&&(r[8]=null==r[8]?p[8]:Ao(r[8],p[8])),null==r[9]&&(r[9]=p[9]),r[0]=p[0],r[1]=s),t=r[1],s=r[9]),r[9]=null==s?l?0:e.length:Ro(s-u,0)||0,(p?$o:Ko)(t==R?Vt(r[0],r[2]):t!=I&&t!=(R|I)||r[4].length?lr.apply(_,r):cr.apply(_,r),r)}function fr(e,t,r,n,o,i,a){var s=-1,l=e.length,u=t.length,c=!0;if(l!=u&&(!o||l>=u))return!1;for(;c&&++s<l;){var d=e[s],p=t[s],c=_;if(n&&(c=o?n(p,d,s):n(d,p,s)),c===_)if(o)for(var f=u;f--&&(p=t[f],!(c=d&&d===p||r(d,p,n,o,i,a))););else c=d&&d===p||r(d,p,n,o,i,a)}return!!c}function mr(e,t,r){switch(r){case H:case G:return+e==+t;case $:return e.name==t.name&&e.message==t.message;case V:return e!=+e?t!=+t:e==+t;case J:case W:return e==t+""}return!1}function gr(e,t,r,n,o,i,a){var s=Yi(e),l=s.length,u=Yi(t).length;if(l!=u&&!o)return!1;for(var u=o,c=-1;++c<l;){var d=s[c],p=o?d in t:Wn.call(t,d);if(p){var f=e[d],m=t[d],p=_;n&&(p=o?n(m,f,d):n(f,m,d)),p===_&&(p=f&&f===m||r(f,m,n,o,i,a))}if(!p)return!1;u||(u="constructor"==d)}return u||(r=e.constructor,n=t.constructor,!(r!=n&&"constructor"in e&&"constructor"in t)||"function"==typeof r&&r instanceof r&&"function"==typeof n&&n instanceof n)?!0:!1}function hr(e,t,r){var n=r?To:xo,o=n,i=o;return jo(e,function(e,a,s){a=t(e,a,s),((r?o>a:a>o)||a===n&&a===i)&&(o=a,i=e)}),i}function yr(e,t,r){var n=Be.callback||In,n=n===In?nt:n;return r?n(e,t,r):n}function vr(e,t,n){var o=Be.indexOf||Ur,o=o===Ur?r:o;return e?o(e,t,n):o}function br(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Wn.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function _r(e){return e=e.constructor,"function"==typeof e&&e instanceof e||(e=jn),new e}function Sr(e,t,r){var n=e.constructor;switch(t){case K:return Mt(e);case H:case G:return new n(+e);case X:case Z:case Q:case ee:case te:case re:case ne:case oe:case ie:return t=e.buffer,new n(r?Mt(t):t,e.byteOffset,e.length);case V:case W:return new n(e);case J:var o=new n(e.source,we.exec(e));o.lastIndex=e.lastIndex}return o}function Rr(e,t,r){return null==e||Er(t,e)||(t=Br(t),e=1==t.length?e:gt(e,It(t,0,-1)),t=Hr(t)),t=null==e?e:e[t],null==t?_:t.apply(e,r)}function Ar(e){return null!=e&&xr(Jo(e))}function wr(e,t){return e=+e,t=null==t?Po:t,e>-1&&0==e%1&&t>e}function Cr(e,t,r){if(!dn(r))return!1;var n=typeof t;return("number"==n?Ar(r)&&wr(t,r.length):"string"==n&&t in r)?(t=r[t],e===e?e===t:t!==t):!1}function Er(e,t){var r=typeof e;return"string"==r&&ye.test(e)||"number"==r?!0:Oi(e)?!1:!he.test(e)||null!=t&&e in Nr(t)}function Ir(e){var t=qo(e);return!!t&&e===Be[t]&&t in Me.prototype}function xr(e){return"number"==typeof e&&e>-1&&0==e%1&&Po>=e}function Tr(e){return e===e&&!dn(e)}function Fr(e,t){e=Nr(e);for(var r=-1,n=t.length,o={};++r<n;){var i=t[r];i in e&&(o[i]=e[i])}return o}function kr(e,t){var r={};return dt(e,function(e,n,o){t(e,n,o)&&(r[n]=e)}),r}function Lr(e){var t;if(!f(e)||Xn.call(e)!=q||!(Wn.call(e,"constructor")||(t=e.constructor,"function"!=typeof t||t instanceof t)))return!1;var r;return dt(e,function(e,t){r=t}),r===_||Wn.call(e,r)}function Or(e){for(var t=bn(e),r=t.length,n=r&&e.length,o=Be.support,o=n&&xr(n)&&(Oi(e)||o.nonEnumArgs&&ln(e)),i=-1,a=[];++i<r;){var s=t[i];(o&&wr(s,n)||Wn.call(e,s))&&a.push(s)}return a}function Pr(e){return null==e?[]:Ar(e)?dn(e)?e:jn(e):_n(e)}function Nr(e){return dn(e)?e:jn(e)}function Br(e){if(Oi(e))return e;var t=[];return o(e).replace(ve,function(e,r,n,o){t.push(n?o.replace(Re,"$1"):r||e)}),t}function Dr(e){return e instanceof Me?e.clone():new ze(e.__wrapped__,e.__chain__,Ge(e.__actions__))}function zr(e,t,r){return e&&e.length?((r?Cr(e,t,r):null==t)&&(t=1),It(e,0>t?0:t)):[]}function Mr(e,t,r){var n=e?e.length:0;return n?((r?Cr(e,t,r):null==t)&&(t=1),t=n-(+t||0),It(e,0,0>t?0:t)):[]}function jr(e){return e?e[0]:_}function Ur(e,t,n){var o=e?e.length:0;if(!o)return-1;if("number"==typeof n)n=0>n?Ro(o+n,0):n;else if(n)return n=Bt(e,t),e=e[n],(t===t?t===e:e!==e)?n:-1;return r(e,t,n||0)}function Hr(e){var t=e?e.length:0;return t?e[t-1]:_}function Gr(e){return zr(e,1)}function $r(e,t,n,o){if(!e||!e.length)return[];null!=t&&"boolean"!=typeof t&&(o=n,n=Cr(e,t,o)?null:t,t=!1);var i=yr();if((i!==nt||null!=n)&&(n=i(n,o,3)),t&&vr()==r){t=n;var a;n=-1,o=e.length;for(var i=-1,s=[];++n<o;){var l=e[n],u=t?t(l,n,e):l;n&&a===u||(a=u,s[++i]=l)}e=s}else e=Lt(e,n);return e}function Yr(e){if(!e||!e.length)return[];var t=-1,r=0;e=Je(e,function(e){return Ar(e)?(r=Ro(e.length,r),!0):void 0});for(var n=Pn(r);++t<r;)n[t]=We(e,Rt(t));return n}function Vr(e,t,r){return e&&e.length?(e=Yr(e),null==t?e:(t=zt(t,r,4),We(e,function(e){return Ke(e,t,_,!0)}))):[]}function qr(e,t){var r=-1,n=e?e.length:0,o={};for(!n||t||Oi(e[0])||(t=[]);++r<n;){var i=e[r];t?o[i]=t[r]:i&&(o[i[0]]=i[1])}return o}function Jr(e){return e=Be(e),e.__chain__=!0,e}function Wr(e,t,r){return t.call(r,e)}function Kr(e,t,r){var n=Oi(e)?Ye:st;return r&&Cr(e,t,r)&&(t=null),("function"!=typeof t||r!==_)&&(t=yr(t,r,3)),n(e,t)}function Xr(e,t,r){var n=Oi(e)?Je:lt;return t=yr(t,r,3),n(e,t)}function Zr(e,t,r,n){var o=e?Jo(e):0;return xr(o)||(e=_n(e),o=e.length),o?(r="number"!=typeof r||n&&Cr(t,r,n)?0:0>r?Ro(o+r,0):r||0,"string"==typeof e||!Oi(e)&&gn(e)?o>r&&-1<e.indexOf(t,r):-1<vr(e,t,r)):!1}function Qr(e,t,r){var n=Oi(e)?We:vt;return t=yr(t,r,3),n(e,t)}function en(e,t,r){return(r?Cr(e,t,r):null==t)?(e=Pr(e),t=e.length,t>0?e[Ct(0,t-1)]:_):(e=tn(e),e.length=Ao(0>t?0:+t||0,e.length),e)}function tn(e){e=Pr(e);for(var t=-1,r=e.length,n=Pn(r);++t<r;){var o=Ct(0,t);t!=o&&(n[t]=n[o]),n[o]=e[t]}return n}function rn(e,t,r){var n=Oi(e)?Xe:xt;return r&&Cr(e,t,r)&&(t=null),("function"!=typeof t||r!==_)&&(t=yr(t,r,3)),n(e,t)}function nn(e,t){var r;if("function"!=typeof t){if("function"!=typeof e)throw new Gn(z);var n=e;e=t,t=n}return function(){return 0<--e&&(r=t.apply(this,arguments)),1>=e&&(t=null),r}}function on(e,t,r){function n(){var r=t-(_i()-u);0>=r||r>t?(s&&no(s),r=p,s=d=p=_,r&&(f=_i(),l=e.apply(c,a),d||s||(a=c=null))):d=po(n,r)}function o(){d&&no(d),s=d=p=_,(g||m!==t)&&(f=_i(),l=e.apply(c,a),d||s||(a=c=null))}function i(){if(a=arguments,u=_i(),c=this,p=g&&(d||!h),!1===m)var r=h&&!d;else{s||h||(f=u);var i=m-(u-f),y=0>=i||i>m;y?(s&&(s=no(s)),f=u,l=e.apply(c,a)):s||(s=po(o,i))}return y&&d?d=no(d):d||t===m||(d=po(n,t)),r&&(y=!0,l=e.apply(c,a)),!y||d||s||(a=c=null),l}var a,s,l,u,c,d,p,f=0,m=!1,g=!0;if("function"!=typeof e)throw new Gn(z);if(t=0>t?0:+t||0,!0===r)var h=!0,g=!1;else dn(r)&&(h=r.leading,m="maxWait"in r&&Ro(+r.maxWait||0,t),g="trailing"in r?r.trailing:g);return i.cancel=function(){d&&no(d),s&&no(s),s=d=p=_},i}function an(e,t){function r(){var n=arguments,o=r.cache,i=t?t.apply(this,n):n[0];return o.has(i)?o.get(i):(n=e.apply(this,n),o.set(i,n),n)}if("function"!=typeof e||t&&"function"!=typeof t)throw new Gn(z);return r.cache=new an.Cache,r}function sn(e,t){if("function"!=typeof e)throw new Gn(z);return t=Ro(t===_?e.length-1:+t||0,0),function(){for(var r=arguments,n=-1,o=Ro(r.length-t,0),i=Pn(o);++n<o;)i[n]=r[t+n];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,r[0],i);case 2:return e.call(this,r[0],r[1],i)}for(o=Pn(t+1),n=-1;++n<t;)o[n]=r[n];return o[t]=i,e.apply(this,o)}}function ln(e){return f(e)&&Ar(e)&&Xn.call(e)==j}function un(e){return!!e&&1===e.nodeType&&f(e)&&-1<Xn.call(e).indexOf("Element")}function cn(e){return f(e)&&"string"==typeof e.message&&Xn.call(e)==$}function dn(e){var t=typeof e;return"function"==t||!!e&&"object"==t}function pn(e){return null==e?!1:Xn.call(e)==Y?Qn.test(Jn.call(e)):f(e)&&Ee.test(e)}function fn(e){return"number"==typeof e||f(e)&&Xn.call(e)==V}function mn(e){return f(e)&&Xn.call(e)==J}function gn(e){return"string"==typeof e||f(e)&&Xn.call(e)==W}function hn(e){return f(e)&&xr(e.length)&&!!Oe[Xn.call(e)]}function yn(e){return rt(e,bn(e))}function vn(e){return mt(e,bn(e))}function bn(e){if(null==e)return[];dn(e)||(e=jn(e));for(var t=e.length,t=t&&xr(t)&&(Oi(e)||Do.nonEnumArgs&&ln(e))&&t||0,r=e.constructor,n=-1,r="function"==typeof r&&r.prototype===e,o=Pn(t),i=t>0;++n<t;)o[n]=n+"";for(var a in e)i&&wr(a,t)||"constructor"==a&&(r||!Wn.call(e,a))||o.push(a);return o}function _n(e){return Ot(e,Yi(e))}function Sn(e){return(e=o(e))&&e.replace(Ie,u).replace(Se,"")}function Rn(e){return(e=o(e))&&_e.test(e)?e.replace(be,"\\$&"):e}function An(e,t,r){return r&&Cr(e,t,r)&&(t=0),Eo(e,t)}function wn(e,t){var r="";if(e=o(e),t=+t,1>t||!e||!_o(t))return r;do t%2&&(r+=e),t=oo(t/2),e+=e;while(t);return r}function Cn(e,t,r){var n=e;return(e=o(e))?(r?Cr(n,t,r):null==t)?e.slice(h(e),y(e)+1):(t+="",e.slice(a(e,t),s(e,t)+1)):e}function En(e,t,r){return r&&Cr(e,t,r)&&(t=null),e=o(e),e.match(t||Fe)||[]}function In(e,t,r){return r&&Cr(e,t,r)&&(t=null),f(e)?Fn(e):nt(e,t)}function xn(e){return function(){return e}}function Tn(e){return e}function Fn(e){return bt(ot(e,!0))}function kn(e,t,r){if(null==r){var n=dn(t),o=n&&Yi(t);((o=o&&o.length&&mt(t,o))?o.length:n)||(o=!1,r=t,t=e,e=this)}o||(o=mt(t,Yi(t)));var i=!0,n=-1,a=Ni(e),s=o.length;!1===r?i=!1:dn(r)&&"chain"in r&&(i=r.chain);for(;++n<s;){r=o[n];var l=t[r];e[r]=l,a&&(e.prototype[r]=function(t){return function(){var r=this.__chain__;if(i||r){var n=e(this.__wrapped__);return(n.__actions__=Ge(this.__actions__)).push({func:t,args:arguments,thisArg:e}),n.__chain__=r,n}return r=[this.value()],so.apply(r,arguments),t.apply(e,r)}}(l))}return e}function Ln(){}function On(e){return Er(e)?Rt(e):At(e)}m=m?qe.defaults(Ve.Object(),m,qe.pick(Ve,Le)):Ve;var Pn=m.Array,Nn=m.Date,Bn=m.Error,Dn=m.Function,zn=m.Math,Mn=m.Number,jn=m.Object,Un=m.RegExp,Hn=m.String,Gn=m.TypeError,$n=Pn.prototype,Yn=jn.prototype,Vn=Hn.prototype,qn=(qn=m.window)&&qn.document,Jn=Dn.prototype.toString,Wn=Yn.hasOwnProperty,Kn=0,Xn=Yn.toString,Zn=m._,Qn=Un("^"+Rn(Xn).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),eo=pn(eo=m.ArrayBuffer)&&eo,to=pn(to=eo&&new eo(0).slice)&&to,ro=zn.ceil,no=m.clearTimeout,oo=zn.floor,io=pn(io=jn.getOwnPropertySymbols)&&io,ao=pn(ao=jn.getPrototypeOf)&&ao,so=$n.push,lo=pn(lo=jn.preventExtensions)&&lo,uo=Yn.propertyIsEnumerable,co=pn(co=m.Set)&&co,po=m.setTimeout,fo=$n.splice,mo=pn(mo=m.Uint8Array)&&mo,go=pn(go=m.WeakMap)&&go,ho=function(){try{var e=pn(e=m.Float64Array)&&e,t=new e(new eo(10),0,1)&&e}catch(r){}return t}(),yo=function(){var e=lo&&pn(e=jn.assign)&&e;try{if(e){var t=lo({1:0});t[0]=1}}catch(r){try{e(t,"xo")}catch(n){}return!t[1]&&e}return!1}(),vo=pn(vo=Pn.isArray)&&vo,bo=pn(bo=jn.create)&&bo,_o=m.isFinite,So=pn(So=jn.keys)&&So,Ro=zn.max,Ao=zn.min,wo=pn(wo=Nn.now)&&wo,Co=pn(Co=Mn.isFinite)&&Co,Eo=m.parseInt,Io=zn.random,xo=Mn.NEGATIVE_INFINITY,To=Mn.POSITIVE_INFINITY,Fo=zn.pow(2,32)-1,ko=Fo-1,Lo=Fo>>>1,Oo=ho?ho.BYTES_PER_ELEMENT:0,Po=zn.pow(2,53)-1,No=go&&new go,Bo={},Do=Be.support={};!function(e){function t(){this.x=e}var r=arguments,n=[];t.prototype={valueOf:e,y:e};for(var o in new t)n.push(o);Do.funcDecomp=/\bthis\b/.test(function(){return this}),Do.funcNames="string"==typeof Dn.name;try{Do.dom=11===qn.createDocumentFragment().nodeType}catch(i){Do.dom=!1}try{Do.nonEnumArgs=!uo.call(r,1)}catch(a){Do.nonEnumArgs=!0}}(1,0),Be.templateSettings={escape:fe,evaluate:me,interpolate:ge,variable:"",imports:{_:Be}};var zo=yo||function(e,t){return null==t?e:rt(t,Wo(t),rt(t,Yi(t),e))},Mo=function(){function e(){}return function(t){if(dn(t)){e.prototype=t;var r=new e;e.prototype=null}return r||m.Object()}}(),jo=$t(pt),Uo=$t(ft,!0),Ho=Yt(),Go=Yt(!0),$o=No?function(e,t){return No.set(e,t),e}:Tn;to||(Mt=eo&&mo?function(e){var t=e.byteLength,r=ho?oo(t/Oo):0,n=r*Oo,o=new eo(t);if(r){var i=new ho(o,0,r);i.set(new ho(e,0,r))}return t!=n&&(i=new mo(o,n),i.set(new mo(e,n))),o}:xn(null));var Yo=bo&&co?function(e){return new Ue(e)}:xn(null),Vo=No?function(e){return No.get(e)}:Ln,qo=function(){return Do.funcNames?"constant"==xn.name?Rt("name"):function(e){for(var t=e.name,r=Bo[t],n=r?r.length:0;n--;){var o=r[n],i=o.func;if(null==i||i==e)return o.name}return t}:xn("")}(),Jo=Rt("length"),Wo=io?function(e){return io(Nr(e))}:xn([]),Ko=function(){var e=0,t=0;return function(r,n){var o=_i(),i=P-(o-t);if(t=o,i>0){if(++e>=O)return r}else e=0;return $o(r,n)}}(),Xo=sn(function(e,t){return Ar(e)?at(e,ct(t,!1,!0)):[]}),Zo=Zt(),Qo=Zt(!0),ei=sn(function(t,r){r=ct(r);var n=tt(t,r);return wt(t,r.sort(e)),n}),ti=dr(),ri=dr(!0),ni=sn(function(e){return Lt(ct(e,!1,!0))}),oi=sn(function(e,t){return Ar(e)?at(e,t):[]}),ii=sn(Yr),ai=sn(function(e){var t=e.length,r=e[t-2],n=e[t-1];return t>2&&"function"==typeof r?t-=2:(r=t>1&&"function"==typeof n?(--t,n):_,n=_),e.length=t,Vr(e,r,n)}),si=sn(function(e,t){return tt(e,ct(t))}),li=Ht(function(e,t,r){Wn.call(e,r)?++e[r]:e[r]=1}),ui=Xt(jo),ci=Xt(Uo,!0),di=tr($e,jo),pi=tr(function(e,t){for(var r=e.length;r--&&!1!==t(e[r],r,e););return e},Uo),fi=Ht(function(e,t,r){Wn.call(e,r)?e[r].push(t):e[r]=[t]}),mi=Ht(function(e,t,r){e[r]=t}),gi=sn(function(e,t,r){var n=-1,o="function"==typeof t,i=Er(t),a=Ar(e)?Pn(e.length):[];return jo(e,function(e){var s=o?t:i&&null!=e&&e[t];a[++n]=s?s.apply(e,r):Rr(e,t,r)}),a}),hi=Ht(function(e,t,r){e[r?0:1].push(t)},function(){return[[],[]]}),yi=sr(Ke,jo),vi=sr(function(e,t,r,n){var o=e.length;for(n&&o&&(r=e[--o]);o--;)r=t(r,e[o],o,e);return r},Uo),bi=sn(function(e,t){if(null==e)return[];var r=t[2];return r&&Cr(t[0],t[1],r)&&(t.length=1),Ft(e,ct(t),[])}),_i=wo||function(){return(new Nn).getTime()},Si=sn(function(e,t,r){var n=R;if(r.length)var o=g(r,Si.placeholder),n=n|I;return pr(e,n,t,r,o)}),Ri=sn(function(e,t){t=t.length?ct(t):vn(e);for(var r=-1,n=t.length;++r<n;){var o=t[r];e[o]=pr(e[o],R,e)}return e}),Ai=sn(function(e,t,r){var n=R|A;if(r.length)var o=g(r,Ai.placeholder),n=n|I;return pr(t,n,e,r,o)}),wi=Wt(C),Ci=Wt(E),Ei=sn(function(e,t){return it(e,1,t)}),Ii=sn(function(e,t,r){return it(e,t,r)}),xi=er(),Ti=er(!0),Fi=ar(I),ki=ar(x),Li=sn(function(e,t){return pr(e,F,null,null,null,ct(t))}),Oi=vo||function(e){return f(e)&&xr(e.length)&&Xn.call(e)==U};Do.dom||(un=function(e){return!!e&&1===e.nodeType&&f(e)&&!Bi(e)});var Pi=Co||function(e){return"number"==typeof e&&_o(e)},Ni=n(/x/)||mo&&!n(mo)?function(e){return Xn.call(e)==Y}:n,Bi=ao?function(e){if(!e||Xn.call(e)!=q)return!1;var t=e.valueOf,r=pn(t)&&(r=ao(t))&&ao(r);return r?e==r||ao(e)==r:Lr(e)}:Lr,Di=Gt(function(e,t,r){return r?et(e,t,r):zo(e,t)}),zi=sn(function(e){var t=e[0];return null==t?t:(e.push(Ze),Di.apply(_,e))}),Mi=Qt(pt),ji=Qt(ft),Ui=rr(Ho),Hi=rr(Go),Gi=nr(pt),$i=nr(ft),Yi=So?function(e){var t=null!=e&&e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&Ar(e)?Or(e):dn(e)?So(e):[]}:Or,Vi=or(!0),qi=or(),Ji=Gt(St),Wi=sn(function(e,t){if(null==e)return{};if("function"!=typeof t[0])return t=We(ct(t),Hn),Fr(e,at(bn(e),t));var r=zt(t[0],t[1],3);return kr(e,function(e,t,n){return!r(e,t,n)})}),Ki=sn(function(e,t){return null==e?{}:"function"==typeof t[0]?kr(e,zt(t[0],t[1],3)):Fr(e,ct(t))}),Xi=qt(function(e,t,r){return t=t.toLowerCase(),e+(r?t.charAt(0).toUpperCase()+t.slice(1):t)}),Zi=qt(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}),Qi=ir(),ea=ir(!0);8!=Eo(ke+"08")&&(An=function(e,t,r){return(r?Cr(e,t,r):null==t)?t=0:t&&(t=+t),e=Cn(e),Eo(e,t||(Ce.test(e)?16:10))});var ta=qt(function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}),ra=qt(function(e,t,r){return e+(r?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),na=sn(function(e,t){try{return e.apply(_,t)}catch(r){return cn(r)?r:new Bn(r)}}),oa=sn(function(e,t){return function(r){return Rr(r,e,t)}}),ia=sn(function(e,t){return function(r){return Rr(e,r,t)}}),aa=Kt(function(e){for(var t=-1,r=e.length,n=xo;++t<r;){var o=e[t];o>n&&(n=o)}return n}),sa=Kt(function(e){for(var t=-1,r=e.length,n=To;++t<r;){var o=e[t];n>o&&(n=o)}return n},!0);return Be.prototype=De.prototype,ze.prototype=Mo(De.prototype),ze.prototype.constructor=ze,Me.prototype=Mo(De.prototype),Me.prototype.constructor=Me,je.prototype["delete"]=function(e){return this.has(e)&&delete this.__data__[e]},je.prototype.get=function(e){return"__proto__"==e?_:this.__data__[e]},je.prototype.has=function(e){return"__proto__"!=e&&Wn.call(this.__data__,e)},je.prototype.set=function(e,t){return"__proto__"!=e&&(this.__data__[e]=t),this},Ue.prototype.push=function(e){var t=this.data;"string"==typeof e||dn(e)?t.set.add(e):t.hash[e]=!0},an.Cache=je,Be.after=function(e,t){if("function"!=typeof t){if("function"!=typeof e)throw new Gn(z);var r=e;e=t,t=r}return e=_o(e=+e)?e:0,function(){return 1>--e?t.apply(this,arguments):void 0}},Be.ary=function(e,t,r){return r&&Cr(e,t,r)&&(t=null),t=e&&null==t?e.length:Ro(+t||0,0),pr(e,T,null,null,null,null,t)},Be.assign=Di,Be.at=si,Be.before=nn,Be.bind=Si,Be.bindAll=Ri,Be.bindKey=Ai,Be.callback=In,Be.chain=Jr,Be.chunk=function(e,t,r){t=(r?Cr(e,t,r):null==t)?1:Ro(+t||1,1),r=0;for(var n=e?e.length:0,o=-1,i=Pn(ro(n/t));n>r;)i[++o]=It(e,r,r+=t);return i},Be.compact=function(e){for(var t=-1,r=e?e.length:0,n=-1,o=[];++t<r;){var i=e[t];i&&(o[++n]=i)}return o},Be.constant=xn,Be.countBy=li,Be.create=function(e,t,r){var n=Mo(e);return r&&Cr(e,t,r)&&(t=null),t?zo(n,t):n},Be.curry=wi,Be.curryRight=Ci,Be.debounce=on,Be.defaults=zi,Be.defer=Ei,Be.delay=Ii,Be.difference=Xo,Be.drop=zr,Be.dropRight=Mr,Be.dropRightWhile=function(e,t,r){return e&&e.length?Pt(e,yr(t,r,3),!0,!0):[]},Be.dropWhile=function(e,t,r){return e&&e.length?Pt(e,yr(t,r,3),!0):[]},Be.fill=function(e,t,r,n){var o=e?e.length:0;if(!o)return[];for(r&&"number"!=typeof r&&Cr(e,t,r)&&(r=0,n=o),o=e.length,r=null==r?0:+r||0,0>r&&(r=-r>o?0:o+r),n=n===_||n>o?o:+n||0,0>n&&(n+=o),o=r>n?0:n>>>0,r>>>=0;o>r;)e[r++]=t;return e},Be.filter=Xr,Be.flatten=function(e,t,r){var n=e?e.length:0;return r&&Cr(e,t,r)&&(t=!1),n?ct(e,t):[]},Be.flattenDeep=function(e){return e&&e.length?ct(e,!0):[];
},Be.flow=xi,Be.flowRight=Ti,Be.forEach=di,Be.forEachRight=pi,Be.forIn=Ui,Be.forInRight=Hi,Be.forOwn=Gi,Be.forOwnRight=$i,Be.functions=vn,Be.groupBy=fi,Be.indexBy=mi,Be.initial=function(e){return Mr(e,1)},Be.intersection=function(){for(var e=[],t=-1,n=arguments.length,o=[],i=vr(),a=i==r,s=[];++t<n;){var l=arguments[t];Ar(l)&&(e.push(l),o.push(a&&120<=l.length?Yo(t&&l):null))}if(n=e.length,2>n)return s;var a=e[0],u=-1,c=a?a.length:0,d=o[0];e:for(;++u<c;)if(l=a[u],0>(d?He(d,l):i(s,l,0))){for(t=n;--t;){var p=o[t];if(0>(p?He(p,l):i(e[t],l,0)))continue e}d&&d.push(l),s.push(l)}return s},Be.invert=function(e,t,r){r&&Cr(e,t,r)&&(t=null),r=-1;for(var n=Yi(e),o=n.length,i={};++r<o;){var a=n[r],s=e[a];t?Wn.call(i,s)?i[s].push(a):i[s]=[a]:i[s]=a}return i},Be.invoke=gi,Be.keys=Yi,Be.keysIn=bn,Be.map=Qr,Be.mapKeys=Vi,Be.mapValues=qi,Be.matches=Fn,Be.matchesProperty=function(e,t){return _t(e,ot(t,!0))},Be.memoize=an,Be.merge=Ji,Be.method=oa,Be.methodOf=ia,Be.mixin=kn,Be.negate=function(e){if("function"!=typeof e)throw new Gn(z);return function(){return!e.apply(this,arguments)}},Be.omit=Wi,Be.once=function(e){return nn(2,e)},Be.pairs=function(e){for(var t=-1,r=Yi(e),n=r.length,o=Pn(n);++t<n;){var i=r[t];o[t]=[i,e[i]]}return o},Be.partial=Fi,Be.partialRight=ki,Be.partition=hi,Be.pick=Ki,Be.pluck=function(e,t){return Qr(e,On(t))},Be.property=On,Be.propertyOf=function(e){return function(t){return gt(e,Br(t),t+"")}},Be.pull=function(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var r=0,n=vr(),o=e.length;++r<o;)for(var i=0,a=e[r];-1<(i=n(t,a,i));)fo.call(t,i,1);return t},Be.pullAt=ei,Be.range=function(e,t,r){r&&Cr(e,t,r)&&(t=r=null),e=+e||0,r=null==r?1:+r||0,null==t?(t=e,e=0):t=+t||0;var n=-1;t=Ro(ro((t-e)/(r||1)),0);for(var o=Pn(t);++n<t;)o[n]=e,e+=r;return o},Be.rearg=Li,Be.reject=function(e,t,r){var n=Oi(e)?Je:lt;return t=yr(t,r,3),n(e,function(e,r,n){return!t(e,r,n)})},Be.remove=function(e,t,r){var n=[];if(!e||!e.length)return n;var o=-1,i=[],a=e.length;for(t=yr(t,r,3);++o<a;)r=e[o],t(r,o,e)&&(n.push(r),i.push(o));return wt(e,i),n},Be.rest=Gr,Be.restParam=sn,Be.set=function(e,t,r){if(null==e)return e;var n=t+"";t=null!=e[n]||Er(t,e)?[n]:Br(t);for(var n=-1,o=t.length,i=o-1,a=e;null!=a&&++n<o;){var s=t[n];dn(a)&&(n==i?a[s]=r:null==a[s]&&(a[s]=wr(t[n+1])?[]:{})),a=a[s]}return e},Be.shuffle=tn,Be.slice=function(e,t,r){var n=e?e.length:0;return n?(r&&"number"!=typeof r&&Cr(e,t,r)&&(t=0,r=n),It(e,t,r)):[]},Be.sortBy=function(e,t,r){if(null==e)return[];r&&Cr(e,t,r)&&(t=null);var n=-1;return t=yr(t,r,3),e=vt(e,function(e,r,o){return{a:t(e,r,o),b:++n,c:e}}),Tt(e,l)},Be.sortByAll=bi,Be.sortByOrder=function(e,t,r,n){return null==e?[]:(n&&Cr(t,r,n)&&(r=null),Oi(t)||(t=null==t?[]:[t]),Oi(r)||(r=null==r?[]:[r]),Ft(e,t,r))},Be.spread=function(e){if("function"!=typeof e)throw new Gn(z);return function(t){return e.apply(this,t)}},Be.take=function(e,t,r){return e&&e.length?((r?Cr(e,t,r):null==t)&&(t=1),It(e,0,0>t?0:t)):[]},Be.takeRight=function(e,t,r){var n=e?e.length:0;return n?((r?Cr(e,t,r):null==t)&&(t=1),t=n-(+t||0),It(e,0>t?0:t)):[]},Be.takeRightWhile=function(e,t,r){return e&&e.length?Pt(e,yr(t,r,3),!1,!0):[]},Be.takeWhile=function(e,t,r){return e&&e.length?Pt(e,yr(t,r,3)):[]},Be.tap=function(e,t,r){return t.call(r,e),e},Be.throttle=function(e,t,r){var n=!0,o=!0;if("function"!=typeof e)throw new Gn(z);return!1===r?n=!1:dn(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),Ne.leading=n,Ne.maxWait=+t,Ne.trailing=o,on(e,t,Ne)},Be.thru=Wr,Be.times=function(e,t,r){if(e=oo(e),1>e||!_o(e))return[];var n=-1,o=Pn(Ao(e,Fo));for(t=zt(t,r,1);++n<e;)Fo>n?o[n]=t(n):t(n);return o},Be.toArray=function(e){var t=e?Jo(e):0;return xr(t)?t?Ge(e):[]:_n(e)},Be.toPlainObject=yn,Be.transform=function(e,t,r,n){var o=Oi(e)||hn(e);return t=yr(t,n,4),null==r&&(o||dn(e)?(n=e.constructor,r=o?Oi(e)?new n:[]:Mo(Ni(n)&&n.prototype)):r={}),(o?$e:pt)(e,function(e,n,o){return t(r,e,n,o)}),r},Be.union=ni,Be.uniq=$r,Be.unzip=Yr,Be.unzipWith=Vr,Be.values=_n,Be.valuesIn=function(e){return Ot(e,bn(e))},Be.where=function(e,t){return Xr(e,bt(t))},Be.without=oi,Be.wrap=function(e,t){return t=null==t?Tn:t,pr(t,I,null,[e],[])},Be.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var r=arguments[e];if(Ar(r))var n=n?at(n,r).concat(at(r,n)):r}return n?Lt(n):[]},Be.zip=ii,Be.zipObject=qr,Be.zipWith=ai,Be.backflow=Ti,Be.collect=Qr,Be.compose=Ti,Be.each=di,Be.eachRight=pi,Be.extend=Di,Be.iteratee=In,Be.methods=vn,Be.object=qr,Be.select=Xr,Be.tail=Gr,Be.unique=$r,kn(Be,Be),Be.add=function(e,t){return(+e||0)+(+t||0)},Be.attempt=na,Be.camelCase=Xi,Be.capitalize=function(e){return(e=o(e))&&e.charAt(0).toUpperCase()+e.slice(1)},Be.clone=function(e,t,r,n){return t&&"boolean"!=typeof t&&Cr(e,t,r)?t=!1:"function"==typeof t&&(n=r,r=t,t=!1),r="function"==typeof r&&zt(r,n,1),ot(e,t,r)},Be.cloneDeep=function(e,t,r){return t="function"==typeof t&&zt(t,r,1),ot(e,!0,t)},Be.deburr=Sn,Be.endsWith=function(e,t,r){e=o(e),t+="";var n=e.length;return r=r===_?n:Ao(0>r?0:+r||0,n),r-=t.length,r>=0&&e.indexOf(t,r)==r},Be.escape=function(e){return(e=o(e))&&pe.test(e)?e.replace(ce,c):e},Be.escapeRegExp=Rn,Be.every=Kr,Be.find=ui,Be.findIndex=Zo,Be.findKey=Mi,Be.findLast=ci,Be.findLastIndex=Qo,Be.findLastKey=ji,Be.findWhere=function(e,t){return ui(e,bt(t))},Be.first=jr,Be.get=function(e,t,r){return e=null==e?_:gt(e,Br(t),t+""),e===_?r:e},Be.has=function(e,t){if(null==e)return!1;var r=Wn.call(e,t);return r||Er(t)||(t=Br(t),e=1==t.length?e:gt(e,It(t,0,-1)),t=Hr(t),r=null!=e&&Wn.call(e,t)),r},Be.identity=Tn,Be.includes=Zr,Be.indexOf=Ur,Be.inRange=function(e,t,r){return t=+t||0,"undefined"==typeof r?(r=t,t=0):r=+r||0,e>=Ao(t,r)&&e<Ro(t,r)},Be.isArguments=ln,Be.isArray=Oi,Be.isBoolean=function(e){return!0===e||!1===e||f(e)&&Xn.call(e)==H},Be.isDate=function(e){return f(e)&&Xn.call(e)==G},Be.isElement=un,Be.isEmpty=function(e){return null==e?!0:Ar(e)&&(Oi(e)||gn(e)||ln(e)||f(e)&&Ni(e.splice))?!e.length:!Yi(e).length},Be.isEqual=function(e,t,r,n){return r="function"==typeof r&&zt(r,n,3),!r&&Tr(e)&&Tr(t)?e===t:(n=r?r(e,t):_,n===_?ht(e,t,r):!!n)},Be.isError=cn,Be.isFinite=Pi,Be.isFunction=Ni,Be.isMatch=function(e,t,r,n){var o=Yi(t),i=o.length;if(!i)return!0;if(null==e)return!1;if(r="function"==typeof r&&zt(r,n,3),e=Nr(e),!r&&1==i){var a=o[0];if(n=t[a],Tr(n))return n===e[a]&&(n!==_||a in e)}for(var a=Pn(i),s=Pn(i);i--;)n=a[i]=t[o[i]],s[i]=Tr(n);return yt(e,o,a,s,r)},Be.isNaN=function(e){return fn(e)&&e!=+e},Be.isNative=pn,Be.isNull=function(e){return null===e},Be.isNumber=fn,Be.isObject=dn,Be.isPlainObject=Bi,Be.isRegExp=mn,Be.isString=gn,Be.isTypedArray=hn,Be.isUndefined=function(e){return e===_},Be.kebabCase=Zi,Be.last=Hr,Be.lastIndexOf=function(e,t,r){var n=e?e.length:0;if(!n)return-1;var o=n;if("number"==typeof r)o=(0>r?Ro(n+r,0):Ao(r||0,n-1))+1;else if(r)return o=Bt(e,t,!0)-1,e=e[o],(t===t?t===e:e!==e)?o:-1;if(t!==t)return p(e,o,!0);for(;o--;)if(e[o]===t)return o;return-1},Be.max=aa,Be.min=sa,Be.noConflict=function(){return m._=Zn,this},Be.noop=Ln,Be.now=_i,Be.pad=function(e,t,r){e=o(e),t=+t;var n=e.length;return t>n&&_o(t)?(n=(t-n)/2,t=oo(n),n=ro(n),r=ur("",n,r),r.slice(0,t)+e+r):e},Be.padLeft=Qi,Be.padRight=ea,Be.parseInt=An,Be.random=function(e,t,r){r&&Cr(e,t,r)&&(t=r=null);var n=null==e,o=null==t;return null==r&&(o&&"boolean"==typeof e?(r=e,e=1):"boolean"==typeof t&&(r=t,o=!0)),n&&o&&(t=1,o=!1),e=+e||0,o?(t=e,e=0):t=+t||0,r||e%1||t%1?(r=Io(),Ao(e+r*(t-e+parseFloat("1e-"+((r+"").length-1))),t)):Ct(e,t)},Be.reduce=yi,Be.reduceRight=vi,Be.repeat=wn,Be.result=function(e,t,r){var n=null==e?_:e[t];return n===_&&(null==e||Er(t,e)||(t=Br(t),e=1==t.length?e:gt(e,It(t,0,-1)),n=null==e?_:e[Hr(t)]),n=n===_?r:n),Ni(n)?n.call(e):n},Be.runInContext=b,Be.size=function(e){var t=e?Jo(e):0;return xr(t)?t:Yi(e).length},Be.snakeCase=ta,Be.some=rn,Be.sortedIndex=ti,Be.sortedLastIndex=ri,Be.startCase=ra,Be.startsWith=function(e,t,r){return e=o(e),r=null==r?0:Ao(0>r?0:+r||0,e.length),e.lastIndexOf(t,r)==r},Be.sum=function(e,t,r){r&&Cr(e,t,r)&&(t=null);var n=yr(),o=null==t;if(n===nt&&o||(o=!1,t=n(t,r,3)),o){for(e=Oi(e)?e:Pr(e),t=e.length,r=0;t--;)r+=+e[t]||0;e=r}else e=kt(e,t);return e},Be.template=function(e,t,r){var n=Be.templateSettings;r&&Cr(e,t,r)&&(t=r=null),e=o(e),t=et(zo({},r||t),n,Qe),r=et(zo({},t.imports),n.imports,Qe);var i,a,s=Yi(r),l=Ot(r,s),u=0;r=t.interpolate||xe;var c="__p+='";r=Un((t.escape||xe).source+"|"+r.source+"|"+(r===ge?Ae:xe).source+"|"+(t.evaluate||xe).source+"|$","g");var p="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";if(e.replace(r,function(t,r,n,o,s,l){return n||(n=o),c+=e.slice(u,l).replace(Te,d),r&&(i=!0,c+="'+__e("+r+")+'"),s&&(a=!0,c+="';"+s+";\n__p+='"),n&&(c+="'+((__t=("+n+"))==null?'':__t)+'"),u=l+t.length,t}),c+="';",(t=t.variable)||(c="with(obj){"+c+"}"),c=(a?c.replace(ae,""):c).replace(se,"$1").replace(le,"$1;"),c="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(i?",__e=_.escape":"")+(a?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+c+"return __p}",t=na(function(){return Dn(s,p+"return "+c).apply(_,l)}),t.source=c,cn(t))throw t;return t},Be.trim=Cn,Be.trimLeft=function(e,t,r){var n=e;return(e=o(e))?e.slice((r?Cr(n,t,r):null==t)?h(e):a(e,t+"")):e},Be.trimRight=function(e,t,r){var n=e;return(e=o(e))?(r?Cr(n,t,r):null==t)?e.slice(0,y(e)+1):e.slice(0,s(e,t+"")+1):e},Be.trunc=function(e,t,r){r&&Cr(e,t,r)&&(t=null);var n=k;if(r=L,null!=t)if(dn(t)){var i="separator"in t?t.separator:i,n="length"in t?+t.length||0:n;r="omission"in t?o(t.omission):r}else n=+t||0;if(e=o(e),n>=e.length)return e;if(n-=r.length,1>n)return r;if(t=e.slice(0,n),null==i)return t+r;if(mn(i)){if(e.slice(n).search(i)){var a,s=e.slice(0,n);for(i.global||(i=Un(i.source,(we.exec(i)||"")+"g")),i.lastIndex=0;e=i.exec(s);)a=e.index;t=t.slice(0,null==a?n:a)}}else e.indexOf(i,n)!=n&&(i=t.lastIndexOf(i),i>-1&&(t=t.slice(0,i)));return t+r},Be.unescape=function(e){return(e=o(e))&&de.test(e)?e.replace(ue,v):e},Be.uniqueId=function(e){var t=++Kn;return o(e)+t},Be.words=En,Be.all=Kr,Be.any=rn,Be.contains=Zr,Be.detect=ui,Be.foldl=yi,Be.foldr=vi,Be.head=jr,Be.include=Zr,Be.inject=yi,kn(Be,function(){var e={};return pt(Be,function(t,r){Be.prototype[r]||(e[r]=t)}),e}(),!1),Be.sample=en,Be.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return en(t,e)}):en(this.value())},Be.VERSION=S,$e("bind bindKey curry curryRight partial partialRight".split(" "),function(e){Be[e].placeholder=Be}),$e(["dropWhile","filter","map","takeWhile"],function(e,t){var r=t!=D,n=t==N;Me.prototype[e]=function(e,o){var i=this.__filtered__,a=i&&n?new Me(this):this.clone();return(a.__iteratees__||(a.__iteratees__=[])).push({done:!1,count:0,index:0,iteratee:yr(e,o,1),limit:-1,type:t}),a.__filtered__=i||r,a}}),$e(["drop","take"],function(e,t){var r=e+"While";Me.prototype[e]=function(r){var n=this.__filtered__,o=n&&!t?this.dropWhile():this.clone();return r=null==r?1:Ro(oo(r)||0,0),n?t?o.__takeCount__=Ao(o.__takeCount__,r):Hr(o.__iteratees__).limit=r:(o.__views__||(o.__views__=[])).push({size:r,type:e+(0>o.__dir__?"Right":"")}),o},Me.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()},Me.prototype[e+"RightWhile"]=function(e,t){return this.reverse()[r](e,t).reverse()}}),$e(["first","last"],function(e,t){var r="take"+(t?"Right":"");Me.prototype[e]=function(){return this[r](1).value()[0]}}),$e(["initial","rest"],function(e,t){var r="drop"+(t?"":"Right");Me.prototype[e]=function(){return this[r](1)}}),$e(["pluck","where"],function(e,t){var r=t?"filter":"map",n=t?bt:On;Me.prototype[e]=function(e){return this[r](n(e))}}),Me.prototype.compact=function(){return this.filter(Tn)},Me.prototype.reject=function(e,t){return e=yr(e,t,1),this.filter(function(t){return!e(t)})},Me.prototype.slice=function(e,t){e=null==e?0:+e||0;var r=this;return 0>e?r=this.takeRight(-e):e&&(r=this.drop(e)),t!==_&&(t=+t||0,r=0>t?r.dropRight(-t):r.take(t-e)),r},Me.prototype.toArray=function(){return this.drop(0)},pt(Me.prototype,function(e,t){var r=Be[t];if(r){var n=/^(?:filter|map|reject)|While$/.test(t),o=/^(?:first|last)$/.test(t);Be.prototype[t]=function(){function t(e){return e=[e],so.apply(e,i),r.apply(Be,e)}var i=arguments,a=this.__chain__,s=this.__wrapped__,l=!!this.__actions__.length,u=s instanceof Me,c=i[0],d=u||Oi(s);return d&&n&&"function"==typeof c&&1!=c.length&&(u=d=!1),u=u&&!l,o&&!a?u?e.call(s):r.call(Be,this.value()):d?(s=e.apply(u?s:new Me(this),i),o||!l&&!s.__actions__||(s.__actions__||(s.__actions__=[])).push({func:Wr,args:[t],thisArg:Be}),new ze(s,a)):this.thru(t)}}}),$e("concat join pop push replace shift sort splice split unshift".split(" "),function(e){var t=(/^(?:replace|split)$/.test(e)?Vn:$n)[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:join|pop|replace|shift)$/.test(e);Be.prototype[e]=function(){var e=arguments;return n&&!this.__chain__?t.apply(this.value(),e):this[r](function(r){return t.apply(r,e)})}}),pt(Me.prototype,function(e,t){var r=Be[t];if(r){var n=r.name;(Bo[n]||(Bo[n]=[])).push({name:t,func:r})}}),Bo[lr(null,A).name]=[{name:"wrapper",func:null}],Me.prototype.clone=function(){var e=this.__actions__,t=this.__iteratees__,r=this.__views__,n=new Me(this.__wrapped__);return n.__actions__=e?Ge(e):null,n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=t?Ge(t):null,n.__takeCount__=this.__takeCount__,n.__views__=r?Ge(r):null,n},Me.prototype.reverse=function(){if(this.__filtered__){var e=new Me(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e},Me.prototype.value=function(){var e=this.__wrapped__.value();if(!Oi(e))return Nt(e,this.__actions__);var t,r=this.__dir__,n=0>r;t=e.length;for(var o=this.__views__,i=0,a=-1,s=o?o.length:0;++a<s;){var l=o[a],u=l.size;switch(l.type){case"drop":i+=u;break;case"dropRight":t-=u;break;case"take":t=Ao(t,i+u);break;case"takeRight":i=Ro(i,t-u)}}t={start:i,end:t},o=t.start,i=t.end,t=i-o,o=n?i:o-1,i=Ao(t,this.__takeCount__),s=(a=this.__iteratees__)?a.length:0,l=0,u=[];e:for(;t--&&i>l;){for(var o=o+r,c=-1,d=e[o];++c<s;){var p=a[c],f=p.iteratee,m=p.type;if(m==N){if(p.done&&(n?o>p.index:o<p.index)&&(p.count=0,p.done=!1),p.index=o,!(p.done||(m=p.limit,p.done=m>-1?p.count++>=m:!f(d))))continue e}else if(p=f(d),m==D)d=p;else if(!p){if(m==B)continue e;break e}}u[l++]=d}return u},Be.prototype.chain=function(){return Jr(this)},Be.prototype.commit=function(){return new ze(this.value(),this.__chain__)},Be.prototype.plant=function(e){for(var t,r=this;r instanceof De;){var n=Dr(r);t?o.__wrapped__=n:t=n;var o=n,r=r.__wrapped__}return o.__wrapped__=e,t},Be.prototype.reverse=function(){var e=this.__wrapped__;return e instanceof Me?(this.__actions__.length&&(e=new Me(this)),new ze(e.reverse(),this.__chain__)):this.thru(function(e){return e.reverse()})},Be.prototype.toString=function(){return this.value()+""},Be.prototype.run=Be.prototype.toJSON=Be.prototype.valueOf=Be.prototype.value=function(){return Nt(this.__wrapped__,this.__actions__)},Be.prototype.collect=Be.prototype.map,Be.prototype.head=Be.prototype.first,Be.prototype.select=Be.prototype.filter,Be.prototype.tail=Be.prototype.rest,Be}var _,S="3.8.0",R=1,A=2,w=4,C=8,E=16,I=32,x=64,T=128,F=256,k=30,L="...",O=150,P=16,N=0,B=1,D=2,z="Expected a function",M="__lodash_placeholder__",j="[object Arguments]",U="[object Array]",H="[object Boolean]",G="[object Date]",$="[object Error]",Y="[object Function]",V="[object Number]",q="[object Object]",J="[object RegExp]",W="[object String]",K="[object ArrayBuffer]",X="[object Float32Array]",Z="[object Float64Array]",Q="[object Int8Array]",ee="[object Int16Array]",te="[object Int32Array]",re="[object Uint8Array]",ne="[object Uint8ClampedArray]",oe="[object Uint16Array]",ie="[object Uint32Array]",ae=/\b__p\+='';/g,se=/\b(__p\+=)''\+/g,le=/(__e\(.*?\)|\b__t\))\+'';/g,ue=/&(?:amp|lt|gt|quot|#39|#96);/g,ce=/[&<>"'`]/g,de=RegExp(ue.source),pe=RegExp(ce.source),fe=/<%-([\s\S]+?)%>/g,me=/<%([\s\S]+?)%>/g,ge=/<%=([\s\S]+?)%>/g,he=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,ye=/^\w*$/,ve=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,be=/[.*+?^${}()|[\]\/\\]/g,_e=RegExp(be.source),Se=/[\u0300-\u036f\ufe20-\ufe23]/g,Re=/\\(\\)?/g,Ae=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,we=/\w*$/,Ce=/^0[xX]/,Ee=/^\[object .+?Constructor\]$/,Ie=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,xe=/($^)/,Te=/['\n\r\u2028\u2029\\]/g,Fe=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),ke=" 	\x0B\f \ufeff\n\r\u2028\u2029 ᠎             　",Le="Array ArrayBuffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Math Number Object RegExp Set String _ clearTimeout document isFinite parseInt setTimeout TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap window".split(" "),Oe={};Oe[X]=Oe[Z]=Oe[Q]=Oe[ee]=Oe[te]=Oe[re]=Oe[ne]=Oe[oe]=Oe[ie]=!0,Oe[j]=Oe[U]=Oe[K]=Oe[H]=Oe[G]=Oe[$]=Oe[Y]=Oe["[object Map]"]=Oe[V]=Oe[q]=Oe[J]=Oe["[object Set]"]=Oe[W]=Oe["[object WeakMap]"]=!1;var Pe={};Pe[j]=Pe[U]=Pe[K]=Pe[H]=Pe[G]=Pe[X]=Pe[Z]=Pe[Q]=Pe[ee]=Pe[te]=Pe[V]=Pe[q]=Pe[J]=Pe[W]=Pe[re]=Pe[ne]=Pe[oe]=Pe[ie]=!0,Pe[$]=Pe[Y]=Pe["[object Map]"]=Pe["[object Set]"]=Pe["[object WeakMap]"]=!1;var Ne={leading:!1,maxWait:0,trailing:!1},Be={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},De={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},ze={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Me={"function":!0,object:!0},je={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ue=Me[typeof exports]&&exports&&!exports.nodeType&&exports,He=Me[typeof module]&&module&&!module.nodeType&&module,Ge=Me[typeof self]&&self&&self.Object&&self,$e=Me[typeof window]&&window&&window.Object&&window,Ye=He&&He.exports===Ue&&Ue,Ve=Ue&&He&&"object"==typeof global&&global&&global.Object&&global||$e!==(this&&this.window)&&$e||Ge||this,qe=b();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Ve._=qe,define("lodash",[],function(){return qe})):Ue&&He?Ye?(He.exports=qe)._=qe:Ue._=qe:Ve._=qe}.call(this),define("report/config",[],function(){var e="http://gis-gfw.wri.org/arcgis/rest/services/Utilities/Geometry/GeometryServer",t="http://gis-gfw.wri.org/arcgis/rest/services/image_services/forma_500/ImageServer",r="http://gis-gfw.wri.org/arcgis/rest/services/image_services/glad_alerts_analysis/ImageServer/computeHistograms",n="http://gis-gfw.wri.org/arcgis/rest/services/image_services/analysis/ImageServer",o="http://gis-potico.wri.org/arcgis/rest/services/suitabilitymapper/kpss_mosaic/ImageServer",i="http://gis-potico.wri.org/arcgis/rest/services/Fires/Global_Fires/MapServer",a="http://www.wri.org/publication/how-identify-degraded-land-sustainable-palm-oil-indonesia",s="http://gis-gfw.wri.org/arcgis/rest/services/image_services/analysis_wm/ImageServer",l="http://gis.wri.org/arcgis/rest/services/CountryBoundaries/CountryBoundaries/MapServer/0",u=[1,14],c=[2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],d=[1,14],p=[2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],f=["#25941F","#25941F","#25941F","#25941F","#25941F","#25941F","#209F1F","#459F1F","#279F1F","#257F1F","#269F1F","#459F1F","#253F1F","#25941F","#25941F"],m=[1,5],g=[2011,2012,2013,2014,2015],h=[1,14],y=[2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],v=["#25941F","#25941F","#25941F","#25941F","#25941F","#25941F","#209F1F","#459F1F","#279F1F","#257F1F","#269F1F","#459F1F","#253F1F","#25941F","#25941F"],b=[1,4],_=["Large industrial plantation","Clearing/ very young plantation","Mosaic of medium-sized plantations","Mosaic of small-sized plantations"],S=["#FEBEBF","#874546","#FEBFE7","#8ACD6B"],R=[1,6],A=["Oil palm","Wood Fiber/Timber","Oil Palm Mix","Wood fiber/timber mix","Other","Recently cleared"],w=["#FD8081","#FEBEBF","#B6D6A1","#FFFD7E","#6E4786","#22C6FC"],C=["31 - 50%","51 - 74%","75 - 100%"],E=[1,3],I=["#ccf1a5","#859a59","#4b5923"],x=[0,3],T=["#87CEEB","#00AA00","#DD0000","#8A2BE2"],F=["Primary Degraded","Primary Intact"],k=[1,2],L=["#259F1F","#186513"],O=["Convertible Production Forest","Limited Production Forest","Non-forest","Production Forest","Protected Area"],P=[1,5],N=["rgb(230, 152, 0)","rgb(116, 196, 118)","rgb(255, 255, 190)","rgb(199, 233, 192)","rgb(35, 139, 69)"],B=["Moratorium area"],D=[0,1],z=["#5fc29a"],M=["Protected Area"],j=[0,1],U=["#296eaa"],H=["0-100","101 - 200","201 - 300","301 - 400","401 - 500","Greater than 500"],G=[1,6],$=["#fdffcc","#faeeb9","#f6ddaa","#f4ca99","#f1bc8b","#eca97a"],Y=["Pampa","Caatinga","Cerrado","Amazônia","Mata Atlântica","Pantanal"],V=[0,5],q=["#4E7311","#A6FD7C","#C0E7AE","#76B276","#A3D3FD","#084E73"],J=["Intact Forest"],W=[0,1],K=["#186513"],X=["Peat"],Z=[0,1],Q=["#161D9C"],ee=[1,13],te=[2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013],re=["#d89827","#26fc79","#b1e3fc","#fdffb6","#000","#d89827","#5fa965","#161D9C","#eeb368","#c7ffb6","#fca0bf","#538996","#745b37"],ne=["Agriculture","Mixed agriculture and forest","Secondary forest","Primary forest","Mixed forest and grassland","Grassland / shrub","Swamp","Settlements","Bare land","Water bodies","Snow / ice"],oe=[1,11],ie=["#E0A828","#8BFB3B","#D4FEC0","#76B276","#B98D5A","#FFFEC1","#689AA7","#FCB7CB","#D3CE63","#77B5FC","#FFFFFF"],ae=["Agriculture","Agroforestry","Fish pond","Grassland / Shrub","Mining","Oil Palm Plantation","Primary Forest","Rubber Plantation","Secondary Forest","Settlements","Swamp","Timber Plantation","Water Bodies"],se=[1,13],le=["#d89827","#26fc79","#b1e3fc","#fdffb6","#000","#d89827","#5fa965","#eeb368","#c7ffb6","#fca0bf","#538996","#745b37","#65a2f8"],ue=["Agriculture","Estate crop plantation","Fish pond","Grassland / Shrub","Mining","Primary Forest","Secondary Forest","Settlements","Swamp","Timber Plantation","Water Bodies"],ce=[1,11],de=["#d89827","#eeb368","#b1e3fc","#fdffb6","#000","#5fa965","#c7ffb6","#fca0bf","#538996","#745b37","#65a2f8"];return{corsEnabledServers:["http://gis-potico.wri.org","http://175.41.139.43","http://54.164.126.73","http://46.137.239.227","https://gfw-fires.wri.org","http://gis-gfw.wri.org"],urls:{imageService:"http://gis-gfw.wri.org/arcgis/rest/services/image_services/analysis/ImageServer"},messages:{largeAreaWarning:"The area for this analysis request is quite large and may take some time to process."},rasterFunctions:{range:{rasterFunction:"histogram16bit",outputPixelType:"U16",rasterFunctionArguments:{Rasters:["$529"]}},combination:{rasterFunction:"Combination",variableName:"AnalysisRaster",rasterFunctionArguments:{RasterRange:[1,140],Raster2Length:[4],Raster:{rasterFunction:"Combination",variableName:"AnalysisRaster",rasterFunctionArguments:{RasterRange:[1,14],Raster2Length:[10],Raster:"$530",Raster2:"$2"}},Raster2:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[946,946,947,947,948,948,949,949],OutputValues:[1,2,3,4],Raster:"$529",AllowUnmatched:!1},variableName:"Raster"}}}},boundariesUrl:l,geometryServiceUrl:e,imageServiceUrl:n,clearanceAnalysisUrl:s,printUrl:"http://gis-potico.wri.org/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task/execute",alertUrl:{forma:"http://gfw-apis.appspot.com/subscribe",fires:"https://gfw-fires.wri.org/subscribe_by_polygon"},millPointInfo:{concession:{title:"Concession Analysis",content:"A risk assessment for concession areas within a 50km sourcing radius of a palm oil mill."},radius:{title:"Radius Analysis",content:"A risk assessment for the entire area within a 50km sourcing radius around a palm oil mill."}},pixelSize:100,totalLoss:{rasterId:"$530",bounds:u,labels:c},prodesLayer:{rasterId:"$555",bounds:d,labels:p},guyraLayer:{rasterId:"$565",bounds:m,labels:g},gladLayer:{rasterId:"$1",bounds:h,labels:y,clearanceChart:{title:"Glaaaaad",type:"pie"},lcHistogram:{renderRule:{rasterFunction:"Local",rasterFunctionArguments:{Operation:67,Rasters:[{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,150,150,366],OutputValues:[0,1],Raster:"$1",AllowUnmatched:!1}},{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,20,20,366],OutputValues:[0,1],Raster:"$2",AllowUnmatched:!1}}]}}}},clearanceAlerts:{rasterId:"$17"},millPoints:{url:"http://api.risk-api.appspot.com/",title:"PALM Risk Tool",rootNode:"millPoints"},suitability:{url:o,title:"Suitability",rootNode:"suitabilityAnalysis",rasterFunction:"PalmOilSuitability_Histogram",geometryType:"esriGeometryPolygon",lcHistogram:{renderRule:{rasterFunction:"lc_histogram",rasterFunctionArguments:{LCRaster:"$12",LCInpR:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8],LCOutV:[0,1,2,3,4,5,6,7,8]}},renderRuleSuitable:{rasterFunction:"classify_suitability",rasterFunctionArguments:{TargetRaster:"$12",InpTarget:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8],OutVTarget:[0,1,2,3,4,5,6,7,8]}},classIndices:{convertible:[1],production:[2,4],other:[3]}},roadHisto:{mosaicRule:{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[14],ascending:!0,mosaicOperation:"MT_FIRST"},className:"ROAD_DISTANCE_KM"},concessions:{url:"http://gis-potico.wri.org/arcgis/rest/services/CommoditiesAnalyzer/moremaps2_EN/MapServer",layer:"10"},localRights:{content:"Local rights/interests:  Unknown.  To be determined through field assessments.",fieldAssessmentUrl:a,fieldAssessmentLabel:"Learn about field assessments."},chart:{title:"Suitability by Legal Classification",suitable:{color:"#461D7C",name:"Suitable",id:"donut-Suitable"},unsuitable:{color:"#FDD023",name:"Unsuitable",id:"donut-Unsuitable"},childrenLabels:["HP/HPT","HPK","APL"],childrenColors:["#74C476","#E69800","#FFFFBE"]}},clearanceBounds:{url:t,baseYearLabel:15},rspo:{rootNode:"rspoData",title:"RSPO Land Use Change Analysis",rasterId:"$5",bounds:x,lossBounds:[5,13],colors:T},primaryForest:{rootNode:"primaryForest",title:"Primary Forests - Indonesia",rasterId:"$519",formaId:"$11",bounds:k,labels:F,clearanceChart:{title:"Clearance Alerts in Primary Forests since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) in Primary Forests",removeBelowYear:2005},compositionAnalysis:{rasterId:519,histogramSlice:1},colors:L,fireKey:"primaryForest"},treeCover:{rootNode:"treeCoverDensity",title:"Tree Cover Density",rasterId:"$520",formaId:"$12",includeFormaIdInRemap:!0,rasterRemap:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[31,51,51,75,75,101],OutputValues:[1,2,3],Raster:"$520",AllowUnmatched:!1}},bounds:E,labels:C,clearanceChart:{title:"Clearance Alerts on Tree Cover Density since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Tree Cover Density"},compositionAnalysis:{title:"Tree Cover Density (30%-100%)",rasterId:520,histogramSlice:31},colors:I,fireKey:"treeCover",errors:{composition:"No Tree Cover Density greater than 30% detected in this area."}},treeCoverLoss:{rootNode:"treeCoverLoss",title:"Tree Cover Loss",rasterId:"$517",mosaicRule:{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[530],ascending:!0,mosaicOperation:"MT_FIRST"},lossChart:{title:"Annual Tree Cover Loss (in hectares)"},compositionAnalysis:{rasterId:530,histogramSlice:1},bounds:E,color:"#DB6598",labels:[]},legalClass:{rootNode:"legalClasses",title:"Legal Classifications",rasterId:"$7",bounds:P,labels:O,clearanceChart:{title:"Clearance Alerts on Legal Classifications since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Legal Classifications",removeBelowYear:2005},colors:N,fireKey:"legalClass"},indonesiaMoratorium:{rootNode:"indoMoratorium",title:"Indonesia Moratorium",rasterId:"$522",formaId:"$14",bounds:D,labels:B,clearanceChart:{title:"Clearance alerts on Moratorium Areas since Jan 2015",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Indonesia Moratorium",removeBelowYear:2011},colors:z,fireKey:"indonesiaMoratorium",compositionAnalysis:{rasterId:522,histogramSlice:1}},prodes:{rootNode:"prodes",title:"Prodes Deforestation",rasterId:"$555",bounds:d,labels:p,mosaicRule:{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[555],ascending:!0,mosaicOperation:"MT_FIRST"},clearanceChart:{title:"PRODES",type:"bar"},lossChart:{title:"PRODES"},colors:f,fireKey:"prodes",compositionAnalysis:{rasterId:555,histogramSlice:1}},guyra:{rootNode:"guyra",title:"Gran Chaco deforestation (Asociación Guyra Paraguay)",rasterId:"$565",mosaicRule:{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[565],ascending:!0,mosaicOperation:"MT_FIRST"},lossChart:{title:"Guyra Loss (in hectares)"},fireKey:"guyra",compositionAnalysis:{rasterId:565,histogramSlice:1},bounds:m,color:"#DB6598",labels:g},glad:{rootNode:"glad",title:"GLAD Alerts",rasterId:["$6","$4"],url:r,bounds:h,labels:y,renderingRule:{rasterFunction:"Local",rasterFunctionArguments:{Operation:67,Rasters:[{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,150,150,366],OutputValues:[0,1],Raster:"$6",AllowUnmatched:!1}},{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,20,20,366],OutputValues:[0,1],Raster:"$4",AllowUnmatched:!1}}]}},colors:v,fireKey:"glad"},protectedArea:{rootNode:"protectedAreas",title:"Protected Areas",rasterId:"$10",bounds:j,labels:M,clearanceChart:{title:"Clearance Alerts on Protected Areas since Jan 2015",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Protected Areas"},compositionAnalysis:{rasterId:10,histogramSlice:1},colors:U,fireKey:"protectedArea",errors:{composition:"No protected areas detected in this area."}},carbonStock:{rootNode:"carbonStocks",title:"Aboveground Biomass Density",rasterId:"$560",bounds:G,labels:H,clearanceChart:{title:"Clearance Alerts on Aboveground Biomass Density since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Aboveground Biomass Density (Mg C /Ha)"},includeFormaIdInRemap:!0,formaId:"$28",rasterRemap:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,101,101,201,201,301,301,401,401,501,501,1e3],OutputValues:[1,2,3,4,5,6],Raster:"$560",AllowUnmatched:!1},outputPixelType:"U8"},colors:$,fireKey:"carbonStock"},plantationsTypeLayer:{rootNode:"plantationsTypeLayer",title:"Plantations by Type",rasterId:"$558",bounds:b,labels:_,clearanceChart:{title:"Plantations by Type",type:"pie"},lossChart:{title:"Plantations by Type"},colors:S,fireKey:"plantationsType"},plantationsSpeciesLayer:{rootNode:"plantationsSpeciesLayer",title:"Plantations by Species",rasterId:"$559",bounds:R,labels:A,clearanceChart:{title:"Plantations by Species",type:"pie"},lossChart:{title:"Plantations by Species"},colors:w,fireKey:"plantationsSpecies"},brazilBiomes:{rootNode:"brazilBiomes",title:"Brazil Biomes",rasterId:"$531",bounds:V,labels:Y,clearanceChart:{title:"Clearance Alerts on Brazil Biomes since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Brazil Biomes (Mg C /Ha)",removeBelowYear:2004},formaId:"$21",colors:q,fireKey:"brazilBiomes"},intactForest:{rootNode:"intactForestLandscape",title:"Intact Forest Landscapes",rasterId:"$9",bounds:W,labels:J,clearanceChart:{title:"Clearance Alerts on Intact Forest Landscapes since Jan 2015",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Intact Forest Landscapes"},colors:K,fireKey:"intactForest",errors:{composition:"No intact forest landscapes data available in this area."}},peatLands:{rootNode:"peatLands",title:"Peat Lands",rasterId:"$8",bounds:Z,labels:X,clearanceChart:{title:"Clearance Alerts on Peat Lands since Jan 2015",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Peat Lands",
removeBelowYear:2002},compositionAnalysis:{rasterId:8,histogramSlice:1},colors:Q,fireKey:"peatLands",errors:{composition:"No peat land detected in this area according to indonesia peat data."}},soy:{rootNode:"soy",title:"Soy on Tree Cover Loss",rasterId:"$566",bounds:ee,labels:te,clearanceChart:{title:"Clearance Alerts on Soy Lands since Jan 2015",type:"bar"},renderingRule:{rasterFunction:"Arithmetic",rasterFunctionArguments:{Operation:3,Raster:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,30,30,101],OutputValues:[0,1],Raster:"$520",AllowUnmatched:!1}},Raster2:{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:"$530",Raster2:"$566",Operation:3},outputPixelType:"U8"}}},lossChart:{title:"2013-2014 Cerrado Soy (in hectares) on <br>2001–2013 Annual Tree Cover Loss",removeBelowYear:2002},compositionAnalysis:{rasterId:566,histogramSlice:1},colors:re,fireKey:"soy",errors:{composition:"No Soy on Tree Cover Loss detected in this area."}},landCoverGlobal:{rootNode:"globalLandCover",title:"Land Cover - Global",rasterId:"$544",bounds:oe,labels:ne,clearanceChart:{title:"Clearance Alerts on Land Cover - Global since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Land Cover - Global",removeBelowYear:2004},formaId:"$22",colors:ie,fireKey:"landCoverGlobal"},landCoverAsia:{rootNode:"asiaLandCover",title:"Land Cover - Southeast Asia",rasterId:"$4",bounds:se,labels:ae,clearanceChart:{title:"Clearance Alerts on Land Cover - Southeast Asia since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Land Cover - Southeast Asia",removeBelowYear:2005},colors:le,fireKey:"landCoverAsia"},landCoverIndo:{rootNode:"indoLandCover",title:"Land Cover - Indonesia",rasterId:"$6",bounds:ce,labels:ue,clearanceChart:{title:"Clearance Alerts on Land Cover - Indonesia since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Land Cover - Indonesia",removeBelowYear:2006},colors:de,fireKey:"landCoverIndo"},fires:{url:i,primaryForest:{type:"pie",field:"primary_fo",labels:F,bounds:k,colors:L,title:"Active Fires in Primary Forests over the past 7 days",badgeDesc:"in primary forests out of"},treeCover:{type:"pie",field:"treecover",labels:C,bounds:[1,5],colors:I,title:"Active Fires by Tree Cover Density over the past 7 days",badgeDesc:"on tree cover density out of"},legalClass:{type:"pie",field:"legal",labels:O,bounds:P,colors:N,title:"Active Fires by Legal Classifications over the past 7 days",badgeDesc:"on legal classes out of"},carbonStock:{type:"pie",field:"carbon",labels:H,bounds:G,colors:$,title:"Active Fires by Aboveground Biomass Density over the past 7 days",badgeDesc:"on Aboveground Biomass Density out of"},plantationsTypeLayer:{type:"pie",field:"plantationsType",labels:_,bounds:b,colors:S,title:"Active Fires by Plantations (by Type) over the past 7 days",badgeDesc:"on fires by plantation out of"},plantationsSpeciesLayer:{type:"pie",field:"plantationsSpecies",labels:A,bounds:R,colors:w,title:"Active Fires by Plantations (by Species) over the past 7 days",badgeDesc:"on fires by plantation out of"},brazilBiomes:{type:"pie",field:"biomes",labels:Y,bounds:V,colors:q,title:"Active Fires by Brazilian Biomes over the past 7 days",badgeDesc:"on Brazilian Biomes out of"},protectedArea:{type:"badge",field:"wdpa",badgeDesc:"in protected areas out of"},intactForest:{type:"badge",field:"ifl",badgeDesc:"on intact forest landscapes out of"},peatLands:{type:"badge",field:"soy",badgeDesc:"on soy lands out of"},soy:{type:"badge",field:"peat",badgeDesc:"on peat lands out of"},landCoverGlobal:{type:"pie",field:"lc_global",labels:ne,bounds:oe,colors:ie,title:"Active Fires by Land Cover - Global over the past 7 days",badgeDesc:"on land cover global out of"},landCoverAsia:{type:"pie",field:"lc_seasia",labels:ae,bounds:se,colors:le,title:"Active Fires by Land Cover - Southeast Asia over the past 7 days",badgeDesc:"on land cover southeast asia out of"},landCoverIndo:{type:"pie",field:"lc_ind",labels:ue,bounds:ce,colors:de,title:"Active Fires by Land Cover - Indonesia over the past 7 days",badgeDesc:"on land cover indonesia out of"},indonesiaMoratorium:{type:"badge",field:"moratorium",badgeDesc:"on indonesia moratorium out of"},prodes:{type:"badge",field:"prodes",badgeDesc:"on Prodes out of"},plantationsType:{type:"badge",field:"plantationsType",badgeDesc:"on Plantations Type out of"},plantationsSpecies:{type:"badge",field:"plantationsSpecies",badgeDesc:"on Plantations Species out of"}},millCSVDescriptor:[{label:"Mill Name",info:{path:"mill_name"}},{label:"latitude",info:{path:"latitude"}},{label:"longitude",info:{path:"longitude"}},{label:"priority_risk",info:{path:"priority_level"}},{label:"total_historic_risk",info:{path:"historic_loss"}},{label:"total_future_risk",info:{path:"future_risk"}},{label:"combined_tree_loss_risk",info:{path:"tree_cover.risk"}},{label:"combined_primary_forest_risk",info:{path:"primary_forest.risk"}},{label:"combined_peat_risk",info:{path:"peat.risk"}},{label:"combined_protected_risk",info:{path:"protected_areas.risk"}},{label:"combined_carbon_dense_area_risk",info:{path:"carbon.risk"}},{label:"combined_fires_risk",info:{path:"fire.risk"}},{label:"historic_tree_loss_risk",info:{path:"tree_cover.loss.rank"}},{label:"historic_tree_loss_value (ha/year)",info:{path:"tree_cover.loss.amount",precision:0}},{label:"historic_primary_forest_risk",info:{path:"primary_forest.loss.rank"}},{label:"historic_primary_forest_value (ha)",info:{path:"primary_forest.loss.amount",precision:0}},{label:"historic_peat_risk",info:{path:"peat.loss.rank"}},{label:"historic_peat_value (ha)",info:{path:"peat.loss.amount",precision:0}},{label:"historic_protected_risk",info:{path:"protected_areas.loss.rank"}},{label:"historic_protected_value (ha)",info:{path:"protected_areas.loss.amount",precision:0}},{label:"historic_carbon_dense_area_risk",info:{path:"carbon.loss.rank"}},{label:"historic_carbon_dense_area_value (ha)",info:{path:"carbon.loss.amount",precision:0}},{label:"historic_fires_risk",info:{path:"fire.loss.rank"}},{label:"historic_fires_value (fires/ha/year)",info:{path:"fire.loss.amount",precision:5}},{label:"future_tree_loss_risk",info:{path:"tree_cover.extent.rank"}},{label:"future_tree_loss_value (ha/year)",info:{path:"tree_cover.extent.amount",precision:0}},{label:"future_primary_forest_risk",info:{path:"primary_forest.extent.rank"}},{label:"future_primary_forest_value (%)",info:{path:"primary_forest.extent.amount",precision:0}},{label:"future_peat_risk",info:{path:"peat.extent.rank"}},{label:"future_peat_value (%)",info:{path:"peat.extent.amount",precision:0}},{label:"future_protected_risk",info:{path:"protected_areas.extent.rank"}},{label:"future_protected_value (%)",info:{path:"protected_areas.extent.amount",precision:0}},{label:"future_carbon_dense_area_risk",info:{path:"carbon.extent.rank"}},{label:"future_high_carbon_value (%)",info:{path:"carbon.extent.amount",precision:0}},{label:"future_fires_risk",info:{path:"fire.extent.rank"}},{label:"future_fires_value (fires/ha/year)",info:{path:"fire.extent.amount",precision:5}}]}}),define("report/CSVExporter",["dojo/number","dojo/_base/array"],function(e,t){function r(e){var t,r,n,o,i,a,s,l,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,d=0,p="",f=[];if(!e)return e;do t=e.charCodeAt(c++),r=e.charCodeAt(c++),n=e.charCodeAt(c++),l=t<<16|r<<8|n,o=l>>18&63,i=l>>12&63,a=l>>6&63,s=63&l,f[d++]=u.charAt(o)+u.charAt(i)+u.charAt(a)+u.charAt(s);while(c<e.length);p=f.join("");var m=e.length%3;return(m?p.slice(0,m-3):p)+"===".slice(m||3)}function n(e,t){t=t||"";for(var r=1024,n=atob(e),o=n.length,i=Math.ceil(o/r),a=new Array(i),s=0;i>s;++s){for(var l=s*r,u=Math.min(l+r,o),c=new Array(u-l),d=0,p=l;u>p;++d,++p)c[d]=n[p].charCodeAt(0);a[s]=new Uint8Array(c)}return new Blob(a,{type:t})}function o(e){var r=e.series,n=[],o=[];return t.forEach(r[0].data,function(e){o.push(e.category)}),n.push("Suitability,"+o.join(",")),t.forEach(r,function(e){o=[],o.push(e.name),t.forEach(e.data,function(e){o.push(Math.abs(e.y.toFixed(2)))}),n.push(o.join(","))}),n}function i(e){var r,n=e.series,o=[],i=[];return r=e.xAxis[0].categories,t.forEach(r,function(e){i.push(e)}),o.push("Type,"+i.join(",")),t.forEach(n,function(e){i=[],i.push(e.name),t.forEach(e.data,function(e){i.push(e.y)}),o.push(i.join(","))}),o}function a(e){var r,n=["Unsuitable"],o=["Suitable"],i=e.series,a=0,s=0,l=0,u=0,c=0,d=0,p=[];return p.push("Suitability,Total,HP/HPT,HPK,APL"),r=i[0],t.forEach(r.data,function(e){"Suitable"===e.name?o.push(e.y):n.push(e.y)}),r=i[1],t.forEach(r.data,function(e){switch(e.name){case"HP/HPT":"donut-Suitable"===e.parentId?u=e.y||0:a=e.y||0;break;case"APL":"donut-Suitable"===e.parentId?d=e.y||0:l=e.y||0;break;case"HPK":"donut-Suitable"===e.parentId?c=e.y||0:s=e.y||0}}),o=o.concat([u,c,d]),n=n.concat([a,s,l]),p.push(o.join(",")),p.push(n.join(",")),p}function s(){var e,r=document.getElementById("title").innerHTML,n=$("#suitabilityAnalysis_content tr"),o=[];return o.push("Suitability Statistics"),o.push(r),o.push("Parameter, Value"),t.forEach(n,function(t){e=t.cells[1].innerHTML.replace(",",""),o.push(t.cells[0].innerHTML+","+e)}),o}function l(t,r){function n(t,r){var n=t.path.split("."),o=n.every(function(e){return void 0!==r[e]?(r=r[e],!0):void 0});return o?void 0!==t.precision?e.round(r,t.precision):r:a}var o,i="\r\n",a="N/A",s=[];return o=r.map(function(e){return e.label}),s.push(o.join(",")),t.forEach(function(e){o=r.map(function(t){return n(t.info,e)}),s.push(o.join(","))}),s.join(i)}var u={exportCSV:function(e){var t,o="data:application/vnd.ms-excel;base64,",i="text/csv;charset=utf-8",a="data.csv",s=document.createElement("a");saveAs&&new Blob?(t=n(r(e),i),saveAs(t,a)):""===s.download?(s.href=o+r(e),s.target="_blank",s.download=a,s.click()):window.open(o+r(e))},exportSuitabilityByLegalClass:a,exportSuitabilityStatistics:s,exportCompositionAnalysis:o,exportSimpleChartAnalysis:i,prepareMillAnalysis:l};return u}),define("report/Renderer",["report/config","dojo/number","dijit/Dialog","dojo/_base/array","dojo/on","dojo/dom","dojo/dom-style","report/CSVExporter","esri/geometry/geometryEngine","utils/Analytics"],function(e,t,r,n,o,i,a,s,l,u){"use strict";var c="url(./app/css/images/download-icon.svg)";return{renderContainers:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='result-block total-loss'><div class='top-panel' id='"+e.rootNode+"_composition'></div><div class='left-panel'><div class='loss-chart' id='"+e.rootNode+"_loss'><div class='loader-wheel'>total loss</div></div></div><div class='right-panel'><div class='fires-chart' id='"+e.rootNode+"_fire'><div class='loader-wheel'>active fires</div></div></div></div><div class='result-block clearance-alerts'><div class='clearance-chart' id='"+e.rootNode+"_clearance'><div class='loader-wheel'>clearance alerts</div></div></div><div class='result-block mill-points'><div class='mill-table' id='"+e.rootNode+"_mill'></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderTotalLossContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='result-block total-loss'><div class='top-panel' id='"+e.rootNode+"_composition'></div><div class='left-panel'><div class='loss-chart' id='"+e.rootNode+"_loss'><div class='loader-wheel'>total loss</div></div></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderProdesContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='result-block prodes'><div class='top-panel' id='"+e.rootNode+"_composition'></div><div class='left-panel'><div class='prodes-chart' id='"+e.rootNode+"_prodes'><div class='loader-wheel'>prodes</div></div></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderSoyContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='result-block soy'><div class='top-panel' id='"+e.rootNode+"_composition'></div><div class='left-panel'><div class='soy-chart' id='"+e.rootNode+"_soy'><div class='loader-wheel'>soy</div></div></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderGuyraContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='result-block guyra'><div><div class='guyra-chart' id='"+e.rootNode+"_guyra'><div class='loader-wheel'>guyra</div></div></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderRSPOContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='rspo-table-container' id='"+e.rootNode+"_table'><div class='loader-wheel'>rspo analysis</div></div><div class='rspo-chart-container' id='"+e.rootNode+"_chart'></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderSuitabilityContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='suitability-container'><div class='left-panel'><div id='suitability-table-csv' class='csv-download' title='Download CSV'></div><div id='"+e.rootNode+"_content' class='suitability-content'><div class='loader-wheel'>suitability</div></div></div><div class='right-panel'><div id='"+e.rootNode+"_chart' class='suitability-chart'><div class='loader-wheel'>suitability</div></div></div><div class='clearFix'></div><div class='left-panel'><div class='suitability-settings-table-header'>Suitability Settings</div><div id='suitability-settings-csv' class='csv-download' title='Download CSV'></div><div id='suitability-settings-table'></div></div><div class='right-panel'><div id='suitability-composition-analysis'><div class='loader-wheel'>composition</div></div></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderMillContainer:function(e){var t,r=document.createDocumentFragment(),n=document.createElement("div"),o=document.getElementById("print-map");t="<button id='mill-download' class='mill-download-button' title='Download csv'></button>",n.id=e.rootNode,n.className="result-container relative",n.innerHTML="<div class='title'>"+e.title+t+"</div><div id='mill-overall-container'></div><div class='mill-table-container' id='"+e.rootNode+"_table'><div class='loader-wheel'>risk assessment</div></div>",r.appendChild(n),document.getElementById("report-results-section").insertBefore(r,o)},renderCompositionAnalysisLoader:function(e){document.getElementById(e.rootNode+"_composition").innerHTML='<div class="loader-wheel">composition analysis</div>'},renderCompositionAnalysis:function(e,r,n){var o,i,a,s=document.createDocumentFragment(),l=document.createElement("div"),u=document.getElementById(n.rootNode+"_composition"),c=n.compositionAnalysis,d=c.title||n.title;return c.histogramSlice&&(a=e.slice(c.histogramSlice)),0===a.length?void this.renderAsUnavailable("composition",n):(a=a.reduce(function(e,t){return e+t})*r*r/1e4,o=t.format(a),void report.areaPromise.then(function(){if(i=t.format(a/report.area*100,{places:0}),l.className="composition-analysis-container","soy"===n.rootNode){var r=e.slice(1);console.log(e),console.log("soyD",r);for(var c=0,p=1;14>p;p++)c+=r[p-1]*p;var f=a,m=14*f,g=c/m;g=g.toFixed(2);var h=e[0],y=h/report.area;console.log("soyHectares",f),console.log("soyNumerator",c),console.log("soyRecentness",g),console.log("noData",h),console.log("reportArea",report.area),y=100*y,y=Math.round(y),l.innerHTML='<div class="tree-cover-density-label"><i>Tree canopy density analyzed at </i>'+report.minDensity+"% <i>(Default is 30%)</i></div><br><div> Total "+d+" in selected area: "+o+" ha <span class='layer-info-icon'><a class='whats-this-soy' href='//commodities.globalforestwatch.org' target='_blank'>?</a></span></div><div>Percent of area converted prior to 2001: "+y+"% <span class='layer-info-icon'><a class='whats-this-soy' href='//commodities.globalforestwatch.org' target='_blank'>?</a></span></div><div class='soy-recentness'>Recent Loss Index: "+g+" <span class='layer-info-icon'><a class='whats-this-soy' href='//commodities.globalforestwatch.org' target='_blank'>?</a></span></div>"}else l.innerHTML="<div>Total "+d+" in selected area: "+o+" ha</div><div>Percent of total area comprised of "+d+": "+i+"%</div>";s.appendChild(l),u.innerHTML="",u.appendChild(s)}))},renderLossData:function(t,r,o,i,a){var s,l,u,d,p,f=e.totalLoss,m=o.labels,g=f.labels,h=arrayFromBounds(o.bounds),y=arrayFromBounds(f.bounds),v=function(e){return e*r*r/1e4},b=[],_=[];if(a){if(u=t.slice(1).map(v),u.length!==g.length)for(var S=0;S<g.length;S++)void 0===u[S]&&(u[S]=0);b.push({name:m[0],data:u}),_.push(o.colors[0])}else for(d=0;d<h.length;d++){for(u=[],p=0;p<y.length;p++)s=i.encode(y[p],h[d]),u.push(t[s]||0);b.push({name:m[d],data:u.map(v)}),_.push(o.colors[d])}o.lossChart.removeBelowYear&&(l=g.indexOf(o.lossChart.removeBelowYear),g=g.slice(l),n.forEach(b,function(e){e.data=e.data.slice(l)})),$("#"+o.rootNode+"_loss").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null,type:"bar",events:{load:function(){}}},colors:_,title:{text:o.lossChart.title},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},xAxis:{categories:g,maxPadding:.35,title:{text:null}},yAxis:{stackLabels:{enabled:!0},title:{text:null}},legend:{enabled:!0,verticalAlign:"bottom"},plotOptions:{series:{stacking:"normal"}},series:b,credits:{enabled:!1}})},renderTreeCoverLossData:function(t,r,o){var i,a=e.totalLoss,s=o.labels,l=a.labels,u=(arrayFromBounds(o.bounds),arrayFromBounds(a.bounds),function(e){return e*r*r/1e4}),d=[],p=[];if(d.push({name:s[0],data:t.slice(1).map(u)}),p.push(o.color),o.lossChart.removeBelowYear&&(i=l.indexOf(o.lossChart.removeBelowYear),l=l.slice(i),n.forEach(d,function(e){e.data=e.data.slice(i)})),d[0].data.length!==l.length)for(var f=0;f<l.length;f++)void 0===d[0].data[f]&&(d[0].data[f]=0);$("#"+o.rootNode+"_loss").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null,type:"bar",events:{load:function(){}}},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},colors:p,title:{text:o.lossChart.title},xAxis:{categories:l,maxPadding:.35,title:{text:null}},yAxis:{stackLabels:{enabled:!0},title:{text:null}},legend:{enabled:!1,verticalAlign:"bottom"},plotOptions:{series:{stacking:"normal"}},series:d,credits:{enabled:!1}})},renderProdesData:function(t,r,n){var o=e.prodesLayer,i=n.labels,a=o.labels,s=function(e){return e*r*r/1e4},l=[],u=[];if(l.push({name:i[0],data:t.slice(1).map(s)}),u.push(n.color),l[0].data.length!==a.length)for(var d=0;d<a.length;d++)void 0===l[0].data[d]&&(l[0].data[d]=0);$("#"+n.rootNode+"_prodes").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null,type:"bar",events:{load:function(){}}},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},colors:u,title:{text:n.lossChart.title},xAxis:{categories:a,maxPadding:.35,title:{text:null}},yAxis:{stackLabels:{enabled:!0},title:{text:null}},legend:{enabled:!1,verticalAlign:"bottom"},plotOptions:{series:{stacking:"normal"}},series:l,credits:{enabled:!1}})},renderSoyData:function(t,r,n,o){var i=e.soy,a=n.labels,s=i.labels,l=function(e){return e*r*r/1e4},u=[],d=i.colors;if(u.push({name:a[0],data:t.slice(1).map(l)}),u[0].data.length!==s.length)for(var p=0;p<s.length;p++)void 0===u[0].data[p]&&(u[0].data[p]=0);$("#"+n.rootNode+"_soy").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null,type:"bar",events:{load:function(){}}},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},colors:d,title:{text:n.lossChart.title},xAxis:{categories:s,maxPadding:.35,title:{text:null}},yAxis:{stackLabels:{enabled:!0},title:{text:null}},legend:{enabled:!1,verticalAlign:"bottom"},plotOptions:{series:{stacking:"normal"}},series:u,credits:{enabled:!1}})},renderGuyraData:function(t,r,n){var o=e.guyraLayer,i=(n.labels,o.labels,function(e){return e*r*r/1e4}),a=[],s=[],l=t.slice(1).map(i),u=9;l.forEach(function(e,t){a.push([new Date("2011",t+u-1,1).getTime(),e])}),s.push(n.color),Highcharts.setOptions({lang:{thousandsSep:","}}),$("#"+n.rootNode+"_guyra").highcharts({chart:{zoomType:"x",resetZoomButton:{position:{align:"left",y:0}}},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},title:{text:null},xAxis:{type:"datetime"},credits:{enabled:!1},yAxis:{title:{text:"hectares"},min:0},plotOptions:{column:{color:n.color}},tooltip:{dateTimeLabelFormats:{hour:"%B, %Y"}},legend:{enabled:!1},series:[{type:"column",name:n.title,data:a,tooltip:{valueSuffix:" ha"}}]})},renderClearanceData:function(e,t,r,n,o){var i,a,s,l,u=r.labels,d=arrayFromBounds(r.bounds),p=arrayFromBounds(report.clearanceBounds),f=[],m=[];if("pie"===r.clearanceChart.type){for(s=0;s<d.length;s++){for(a=0,m=[],l=0;l<p.length;l++)i=n.encode(p[l],d[s]),m.push(e[i]||0);f.push({name:u[s],data:m})}$("#"+r.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},colors:r.colors,title:{text:r.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!0},credits:{enabled:!1},series:f})}else{if(o){if(f=e.slice(1),f.length!==p.length)for(var g=0;g<p.length;g++)void 0===f[g]&&(f[g]=0)}else for(s=0;s<p.length;s++){for(a=0,l=0;l<d.length;l++)i=n.encode(p[s],d[l]),a+=e[i]||0;f.push(a)}$("#"+r.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},colors:["#fb00b3"],title:{text:r.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!1},credits:{enabled:!1},series:[{name:r.title,data:f}]})}},renderGladData:function(e,t,r,n,o){var i,a,s,l,u=r.labels,d=arrayFromBounds(r.bounds),p=arrayFromBounds(report.gladLayer),f=[],m=[];if("pie"===r.clearanceChart.type){for(s=0;s<d.length;s++){for(a=0,m=[],l=0;l<p.length;l++)i=n.encode(p[l],d[s]),m.push(e[i]||0);f.push({name:u[s],data:m})}$("#"+r.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},colors:r.colors,title:{text:r.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!0},credits:{enabled:!1},series:f})}else{if(o){if(f=e.slice(1),f.length!==p.length)for(var g=0;g<p.length;g++)void 0===f[g]&&(f[g]=0)}else for(s=0;s<p.length;s++){for(a=0,l=0;l<d.length;l++)i=n.encode(p[s],d[l]),a+=e[i]||0;f.push(a)}$("#"+r.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},colors:["#fb00b3"],title:{text:r.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!1},credits:{enabled:!1},series:[{name:r.title,data:f}]})}},renderFireData:function(r,o){function i(e,r,n,o){var i=document.createDocumentFragment(),a=document.createElement("div"),s=document.getElementById(e+"_fire");a.className="active-fires-badge",a.innerHTML="<div>There are currently</div><div class='active-fires-label'><div>"+t.format(r)+"</div><span>active fires</span></div><div>"+o+"</div><div class='total-active-fires-label'><span>"+t.format(n)+" total active fires</span></div>",i.appendChild(a),s.innerHTML="",s.appendChild(i)}function a(e,r,n,o,i){for(var a=document.createDocumentFragment(),s=document.createElement("div"),l=document.getElementById(e+"_fire"),u=[],c=0;c<r.length;c++)c>=n[0]&&c<=n[1]&&u.push(r[c]);s.className="active-fires-badge special",s.innerHTML="<div>Active fires are detected in:</div><div class='active-fires-label'><span>"+o[0]+" Forests</span><div>"+t.format(u[0]||0)+"</div></div><div class='active-fires-label'><span>"+o[1]+" Forests</span><div>"+t.format(u[1]||0)+"</div></div><div class='total-active-fires-label'><span>out of "+t.format(i)+" total active fires</span></div></div>",a.appendChild(s),l.innerHTML="",l.appendChild(a)}function s(e,t,r,n,o,s,l){var u,d=[],p=0,f=[];for(u=0;u<t.length;u++)u>=o[0]&&u<=o[1]&&(0===t[u]||isNaN(t[u])||(d.push([r[p],t[u]]),f.push(n[p])),p++);0===d.length?i(e,0,0,l):2===r.length?a(e,t,o,r,m.length):$("#"+e+"_fire").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null},colors:f,title:{text:"Active Fires"},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},plotOptions:{pie:{size:"75%",allowPointSelect:!0,cursor:"pointer",showInLegend:!0,dataLabels:{enabled:!1}}},credits:{enabled:!0},legend:{enabled:!1},series:[{type:"pie",name:"Fires",data:d}]})}var l,u,d,p,f,m=o[0].features;n.forEach(r,function(t){if(d=t.rootNode,p=e.fires[t.fireKey],o.length>1&&"indonesiaMoratorium"===t.fireKey){var r=0;return n.forEach(o[1].features,function(e){r+=+e.attributes[p.field]}),void i(d,r,m.length,p.badgeDesc)}if(0===m.length)i(d,0,0,p.badgeDesc);else if("pie"===p.type){for(u=[],f=0;f<=p.labels.length;f++)u[f]=0;n.forEach(m,function(e){u[e.attributes[p.field]]++}),s(d,u,p.labels,p.colors,p.bounds,p.title,p.badgeDesc)}else l=0,n.forEach(m,function(e){l+=isNaN(parseInt(e.attributes[p.field]))?0:parseInt(e.attributes[p.field])}),i(d,l,m.length,p.badgeDesc)})},renderRSPOData:function(r,o,i){var a=arrayFromBounds(e.rspo.lossBounds);if(!(r.histograms.length>0))return void(document.getElementById(o.rootNode+"_table").innerHTML="<div class='data-not-available'>No RSPO Data Available for this Site.</div>");var l,c,d,p,f,m=2005,g=8,h="",y="",v="",b="",_="",S=[],R=[],A=[],w=[],C=[];for(h="<div id='rspo-table-csv' class='csv-download' title='Download CSV'></div><table class='rspo-results-table'><tr><th>Forest Type</th>",d=0;g>=d;d++)S.push(m+d),h+="<th>"+(m+d)+"</th>";for(h+="</tr>",c=r.histograms[0].counts,p=0;p<a.length;p++)l=i.encode(a[p],2),A.push(c[l]||0),l=i.encode(a[p],3),w.push(c[l]||0),l=i.encode(a[p],1),R.push(c[l]||0),l=i.encode(a[p],0),C.push(c[l]||0);for(v="<tr><td>Primary</td>",b="<tr><td>Secondary</td>",y="<tr><td>Agroforestry</td>",_="<tr><td>Non-Forest</td>",f=0;f<A.length;f++)v+="<td>"+(t.format(A[f])||0)+"</td>",b+="<td>"+(t.format(w[f])||0)+"</td>",y+="<td>"+(t.format(R[f])||0)+"</td>",_+="<td>"+(t.format(C[f])||0)+"</td>";v+="</tr>",b+="</tr>",y+="</tr>",_+="</tr>",h+=v+b+y+_+"</table>",h+="<div class='change-area-unit'>(Change in Hectares)</div>",document.getElementById(o.rootNode+"_table").innerHTML=h,this.renderRSPOChart(o,A,w,R,C,S),$("#rspo-table-csv").click(function(){var e="\r\n",t=[],r=[],o="";t.push("RSPO Land Use Change Analysis"),t.push(document.getElementById("title").innerHTML),n.forEach(S,function(e){r.push(e)}),t.push("Forest Type,"+r.join(",")),r=[],n.forEach(A,function(e){r.push(e)}),t.push("Primary,"+r.join(",")),r=[],n.forEach(w,function(e){r.push(e)}),t.push("Secondary,"+r.join(",")),r=[],n.forEach(R,function(e){r.push(e)}),t.push("Agroforestry,"+r.join(",")),r=[],n.forEach(C,function(e){r.push(e)}),t.push("Non-Forest,"+r.join(",")),o=t.join(e),s.exportCSV(o),u.sendEvent("Event","Download CSV","User downloaded RSPO results table.")})},renderRSPOChart:function(e,r,n,o,i,a){var s={color:"#000"},l={style:s};$("#"+e.rootNode+"_chart").highcharts({chart:{backgroundColor:"#FFF",type:"column"},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},colors:e.colors,title:{text:null},legend:{align:"center",verticalAlign:"top",enabled:!0},xAxis:{categories:a,labels:l},yAxis:{title:{text:"",style:s},labels:l},plotOptions:{column:{stacking:"normal"}},tooltip:{formatter:function(){return"<strong>"+this.key+"</strong><br/>"+this.series.name+": "+t.format(this.y)+"<br/>Total: "+t.format(this.point.stackTotal)}},credits:{enabled:!1},series:[{name:"Primary",data:r},{name:"Secondary",data:n},{name:"Agroforestry",data:o},{name:"Non-Forest",data:i}]})},renderSuitabilityData:function(e,r){var n,o,i,a,s,l,u,c,d,p=e.lcHistogram.classIndices,f="<table>";if(d=r[0],d?(n=Math.pow(d.pixelSize/100,2),d.data.counts[1]?(i=t.format(d.data.counts[1]*n)||d.data.counts[1],o=t.format(d.data.counts[0]*n)||d.data.counts[0]):(i=0,o=t.format(d.data.counts[0]*n))):(i="N/A",o="N/A"),d=r[1]){n=Math.pow(d.pixelSize/100,2);var m=function(e){for(var r=0,o=0;o<e.length;o++)d.data.counts[e[o]]&&(r+=d.data.counts[e[o]]*n);return t.format(r)};l=m(p.production),u=m(p.convertible),c=m(p.other)}else l="N/A",u="N/A",c="N/A";d=r[2],a=d?parseFloat(d.data.min/1e3).toFixed(1):"N/A",d=r[3],s=d?d.value:"N/A",f+="<tr><td>Suitable(ha):</td><td>"+i+"</td></tr>",f+="<tr><td>Unsuitable(ha):</td><td>"+o+"</td></tr>",f+="<tr><td>Distance to nearest road(km):</td><td>"+a+"</td></tr>",f+="<tr><td>Existing concessions(Yes/No):</td><td>"+s+"</td></tr>",f+="<tr><td>Legal Classification(ha):</td><td></td></tr>",f+="<tr><td class='child-row'>Production forest(HP/HPT):</td><td>"+l+"</td></tr>",f+="<tr><td class='child-row'>Convertible forest(HPK):</td><td>"+u+"</td></tr>",f+="<tr><td class='child-row'>Other land uses(APL):</td><td>"+c+"</td></tr>",f+="</table>",f+="<p>"+e.localRights.content+"</p>",f+="<div class='field-assessment-link'><a href='"+e.localRights.fieldAssessmentUrl+"'>"+e.localRights.fieldAssessmentLabel+"</a></div>",document.getElementById(e.rootNode+"_content").innerHTML=f,this.renderSuitabilityChart(e,r[4]),this.renderSuitabilitySettingsTable()},renderSuitabilitySettingsTable:function(){var e,t,r,o,i,a,s=payload&&payload.suitability&&payload.suitability.csv,l="<table><thead><tr>";s&&(r=s.split("\n"),e=r.splice(1),t=r[0].split(","),l+="<th>Parameter</th><th>Setting</th></tr></thead><tbody>",n.forEach(e,function(e){a=e.split(","),o=a[0],i=a[1],void 0!==o&&""!==o&&(l+="<tr><td>"+o+"</td><td>"+i.replace(/\;/g,",")+"</td></tr>")}),l+="</tbody></table>",$("#suitability-settings-table").html(l))},renderSuitabilityCompositionChart:function(e){var t,r=[],o=[],i=[];n.forEach(e,function(e){t=e.suitable+e.unsuitable,
e.suitable=e.suitable/t*100,e.unsuitable=e.unsuitable/t*100*-1}),e.sort(function(e,t){return e.suitable>t.suitable?1:t.suitable>e.suitable?-1:0}),n.forEach(e,function(e){r.push(e.unsuitable),o.push(e.suitable),i.push(e.label)}),$("#suitability-composition-analysis").highcharts({chart:{type:"bar"},title:{text:"Suitability Composition Analysis"},colors:["#FDD023","#461D7C"],credits:{enabled:!1},xAxis:[{categories:i,reversed:!1},{labels:{enabled:!1},opposite:!0,reversed:!1,linkedTo:0,tickLength:0}],yAxis:{title:{text:null},min:-100,max:100,labels:{formatter:function(){return Math.abs(this.value)+(0!==this.value?"%":"")}}},tooltip:{formatter:function(){return"<b>"+this.point.category+"</b><br/><b>"+this.series.name+":</b>	"+Highcharts.numberFormat(Math.abs(this.point.y),2)+"%"}},plotOptions:{series:{stacking:"normal"}},series:[{name:"Unsuitable",data:r},{name:"Suitable",data:o}],exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}}})},renderSuitabilityChart:function(e,t){function r(e){for(var r={suitable:0,unsuitable:0},n=0;n<e.length;n++)t.data.counts[e[n]]&&(r.unsuitable+=t.data.counts[e[n]]*s,r.suitable+=t.data.counts[e[n]+10]*s);return r}if(!t)return void(document.getElementById(e.rootNode+"_chart").innerHTML="<div class='data-not-available'>No Suitability Data Available to chart for this Site.</div>");var n,o,i,a=e.lcHistogram.classIndices,s=Math.pow(t.pixelSize/100,2),l=e.chart,u=[],d=[],p=[];n=r(a.convertible),o=r(a.production),i=r(a.other),u.push({y:n.suitable+o.suitable+i.suitable,color:l.suitable.color,name:l.suitable.name,id:l.suitable.id,children:{categories:l.childrenLabels,colors:l.childrenColors,data:[o.suitable,n.suitable,i.suitable]}}),u.push({y:n.unsuitable+o.unsuitable+i.unsuitable,color:l.unsuitable.color,name:l.unsuitable.name,id:l.unsuitable.id,children:{categories:l.childrenLabels,colors:l.childrenColors,data:[o.unsuitable,n.unsuitable,i.unsuitable]}});for(var f=0;f<u.length;f++)if(u[f].y>0){d.push({color:u[f].color,name:u[f].name,id:u[f].id,y:u[f].y});for(var m=0;m<u[f].children.data.length;m++)u[f].children.data[m]>0&&p.push({name:u[f].children.categories[m],color:u[f].children.colors[m],y:u[f].children.data[m],parentId:u[f].id})}$("#"+e.rootNode+"_chart").highcharts({chart:{type:"pie",backgroundColor:"#FFF",plotBorderWidth:null},title:{text:l.title},tooltip:{valueSuffix:""},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:c}}},plotOptions:{series:{point:{events:{legendItemClick:function(){var e=this.id,t=this.series.chart.series[1].data;t.forEach(function(t){t.parentId===e&&(t.visible?t.setVisible(!1):t.setVisible(!0))})}}}}},legend:{itemStyle:{color:"#000"}},credits:{enabled:!1},series:[{name:"Area",data:d,size:"60%",showInLegend:!0,dataLabels:{enabled:!1}},{name:"Legal Area",data:p,size:"80%",innerSize:"60%",dataLabels:{color:"black",distance:5}}]})},renderMillAssessment:function(t,r){function o(e){var t="'><span class='small-swatch'></span>",r="<tr class='data-row'>";return r+="<td class='mill_name'><span>"+e.mill_name+"</span></td>",r+="<td class='"+e.priority_level+t+e.priority_level+"</td>",r+="<td class='"+e.historic_loss+t+e.historic_loss+"</td>",r+="<td class='"+e.future_risk+t+e.future_risk+"</td>",r+="<td class='"+e.tree_cover.risk+t+e.tree_cover.risk+"</td>",r+="<td class='"+e.primary_forest.risk+t+e.primary_forest.risk+"</td>",r+="<td class='"+e.peat.risk+t+e.peat.risk+"</td>",r+="<td class='"+e.protected_areas.risk+t+e.protected_areas.risk+"</td>",r+="<td class='"+e.carbon.risk+t+e.carbon.risk+"</td>",r+="<td class='"+e.fire.risk+t+e.fire.risk+"</td>",r+="</tr>"}function i(e){var t,r="'><span class='small-swatch'></span>",n=e.mill_name?e.mill_name:"Unknown";t="low"===e.priority_level?"low":"medium low"===e.priority_level?"medium-low":"medium"===e.priority_level?"low":"medium high"===e.priority_level?"medium-high":"high";var o="<table class='single-mill-table-header-v2'>";return o+="<tr class='single-mill-header'><div class='mill-header-single-title'><span class='mill-title'>Mill Name: "+n+"</span><span class='mill-risk-level-single-title "+t+"'>Mill Priority: <span class='overall-risk'>"+e.priority_level+"</span></div></tr>",o+="<tr class=''>",o+="<tr><th>Combined Indicator</th><th>Rank </th><th>Combined Indicator</th><th>Rank </th></tr>",o+="<tr><td>Tree cover</td><td class='"+e.tree_cover.risk+r+e.tree_cover.risk+"</td><td>Protected Areas</td><td class='"+e.protected_areas.risk+r+e.protected_areas.risk+"</td></tr>",o+="<tr><td>Primary Forest</td><td class='"+e.primary_forest.risk+r+e.primary_forest.risk+"</td><td>Carbon</td><td class='"+e.carbon.risk+r+e.carbon.risk+"</td></tr>",o+="<tr><td>Peat</td><td class='"+e.peat.risk+r+e.peat.risk+"</td><td>Fire</td><td class='"+e.fire.risk+r+e.fire.risk+"</td></tr>",o+="</tr>",o+="</table>"}function a(e){var t='"><span class="small-swatch"></span>',r='<table class="single-mill-table-content-v2">';return r+='<thead><tr><th colspan="3" class="'+e.historic_loss+'">Historic loss: <span class="small-swatch"></span>'+e.historic_loss+' Risk</th><th colspan="3" class="'+e.future_risk+'">Potential for future loss:  <span class="small-swatch"></span>'+e.future_risk+" Risk</th></tr>",r+="<tr><td>Indicator</td><td>Rank</td><td>Amount</td><td>Indicator</td><td>Rank</td><td>Amount</td></tr></thead>",r+='<tr><td>Rate of tree cover loss</td><td class="'+e.tree_cover.loss.rank+t+e.tree_cover.loss.rank+"</td><td>"+Math.round(e.tree_cover.loss.amount)+' ha/year</td><td>Rate of tree cover loss</td><td class="'+e.tree_cover.extent.rank+t+e.tree_cover.extent.rank+"</td><td>"+Math.round(e.tree_cover.extent.amount)+" ha/year</td></tr>",r+='<tr><td>Tree cover loss on primary forest</td><td class="'+e.primary_forest.loss.rank+t+e.primary_forest.loss.rank+"</td><td>"+Math.round(e.primary_forest.loss.amount)+' ha</td><td>Area in primary forest</td><td class="'+e.primary_forest.extent.rank+t+e.primary_forest.extent.rank+"</td><td>"+Math.round(e.primary_forest.extent.amount)+"%</td></tr>",r+='<tr><td>Tree cover loss on peat</td><td class="'+e.peat.loss.rank+t+e.peat.loss.rank+"</td><td>"+Math.round(e.peat.loss.amount)+' ha</td><td>Area in peat</td><td class="'+e.peat.extent.rank+t+e.peat.extent.rank+"</td><td>"+Math.round(e.peat.extent.amount)+"%</td></tr>",r+='<tr><td>Tree cover loss on protected areas</td><td class="'+e.protected_areas.loss.rank+t+e.protected_areas.loss.rank+"</td><td>"+Math.round(e.protected_areas.loss.amount)+' ha</td><td>Area in protected areas</td><td class="'+e.protected_areas.extent.rank+t+e.protected_areas.extent.rank+"</td><td>"+Math.round(e.protected_areas.extent.amount)+"%</td></tr>",r+='<tr><td>Tree cover loss on carbon dense areas</td><td class="'+e.carbon.loss.rank+t+e.carbon.loss.rank+"</td><td>"+Math.round(e.carbon.loss.amount)+' ha</td><td>Area of high carbon density</td><td class="'+e.carbon.extent.rank+t+e.carbon.extent.rank+"</td><td>"+Math.round(e.carbon.extent.amount)+"%</td></tr>",r+='<tr><td>Fire activity</td><td class="'+e.fire.loss.rank+t+e.fire.loss.rank+"</td><td>"+e.fire.loss.amount.toFixed(5)+' fires/ha/year</td><td>Rate of fire activity last two years</td><td class="'+e.fire.extent.rank+t+e.fire.extent.rank+"</td><td>"+e.fire.extent.amount.toFixed(5)+" fires/ha/year</td></tr>",r+="</table>"}function l(e){var t=e.currentTarget,r=t.dataset?t.dataset["class"]:t.getAttribute("data-class");$(".mill-table-container .data-row.child."+r).toggle(),$(t).toggleClass("open")}var u,c=[],d="";n.forEach(t,function(e,r){if(d="",e.mill_name?u=e.mill_name:report.mills&&n.some(report.mills,function(t){return e.id===t.millId?(u=t.label,!0):void 0}),void 0===u&&(u=window.payload.title),t.length>1&&0==r){d+="<table class='mill-table-v2'><thead class='mill-table-header-v2'><tr><td class='dark' rowspan='2'></td><td class='dark' rowspan='2'>Overall Priority Level</td><td class='dark' rowspan='2'>Historic Loss</td><td class='dark' rowspan='2'>Future Potential Loss</td><td class='white span-60' colspan='6'>Environmental Indicators</td></tr><tr><td class='white'>Tree Cover</td><td class='white'>Primary Forest</td><td class='white'>Peat</td><td class='white'>Protected Areas</td><td class='white'>Carbon</td><td class='white'>Fires</td></tr></thead>",d+="<tbody class='mill-table-container-v2'>";for(var s=0;s<t.length;s++)d+=o(t[s])}d+=i(t[r]),d+=a(t[r]),c.push(d)}),document.getElementById(r.rootNode+"_table").innerHTML=c.join("<br />"),$(".mill-table-container tr.parent").click(l),$(".mill-table-container .info-icon").click(this.showMillPointInfo),$("#mill-download").click(function(){var r=s.prepareMillAnalysis(t,e.millCSVDescriptor);s.exportCSV(r)}),$(".mill-table-container .data-row.child").toggle()},showMillPointInfo:function(t){var n,o=t.currentTarget,i=o.dataset?o.dataset.type:o.getAttribute("data-type"),a=e.millPointInfo[i];n=new r({title:a.title,content:a.content,style:"width: 300px;"}),n.show()},renderAsUnavailable:function(e,t){var r=document.getElementById(t.rootNode+"_"+e),n="";n="loss"===e?"No tree cover loss detected.":"clearance"===e?"No clearance alerts occured in this area.":"composition"===e?t.errors&&t.errors.composition||"No Composition Analysis Data Available for this site.":"No data available for this site.",r&&(r.innerHTML=n)}}}),define("report/riskRequests",["dojo/Deferred","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/ImageServiceIdentifyTask","esri/tasks/ImageServiceIdentifyParameters","esri/tasks/StatisticDefinition","esri/request","esri/tasks/AreasAndLengthsParameters","esri/tasks/GeometryService","esri/SpatialReference","esri/tasks/ProjectParameters","esri/tasks/BufferParameters"],function(e,t,r,n,o,i,a,s,l,u,c,d){var p={},f=function(e,t){for(param in t)t.hasOwnProperty(param)&&t[param]&&(e[param]=t[param]);return e},m=function(e){return e.lengthUnit=l[e.lengthUnit],e.areaUnit=l[e.areaUnit],e},g=function(t,r,n){var o=new e;return n=n||"execute",t[n](r,function(e){o.resolve(e)},function(e){o.resolve(e)}),o};return p.getAreasLengths=function(t,r){var n=new e;r=m(r);var o=f(new s,r),i=new l(t);return i.areasAndLengths(o).then(function(e){n.resolve(e)}),n},p.project=function(t,r,n){var o=new e;r.outSR=new u(n);var i=new l(t),a=f(new c,r);return i.project(a).then(function(e){o.resolve(e)}),o},p.buffer=function(t,r,n){var o=new e,i=f(new d,r);i.unit=l[r.unit],i.spatialReference=r.geometries[0].spatialReference,i.outSpatialReference=new u(n);var a=new l(t);return a.buffer(i).then(function(e){o.resolve(e)}),o},p.loadServiceInfo=function(t){var r=new e,n=esri.request({url:t,content:{f:"json"},handleAs:"json"});return n.then(function(e){console.log("Success: ",e.layers),r.resolve(e)},function(e){console.log("Error: ",e.message),r.resolve(e)}),r},p.queryForStats=function(t,r,n){var o=(new e,n.map(function(e){return f(new i,e)}));return r.outStatistics=o,p.queryEsri(t,r)},p.queryEsri=function(e,n,o){var i=new t(e),a=f(new r,n),s=g(i,a,o);return s},p.computeHistogram=function(e,t){return a({url:e+"/computeHistograms",content:t,handleAs:"json",callbackParamName:"callback",timeout:6e4},{usePost:!0})},p.queryJson=function(){},p}),define("report/riskController",["lodash","dojo/Deferred","dojo/promise/all","dojo/_base/lang","esri/geometry/geometryEngine","esri/geometry/Polygon","report/riskRequests","report/config"],function(e,t,r,n,o,i,a,s){var l={},u=102100,c=["","low","medium","high"];s.carbonDensity={rasterId:"$560"};var d={commodities:"http://gis-gfw.wri.org/arcgis/rest/services/image_services/analysis/ImageServer",fires:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0",concessions:"http://gis-gfw.wri.org/arcgis/rest/services/CommoditiesAnalyzer/moremaps2_EN/MapServer/27"};return l.getRiskByGeometry=function(o,i,l,u,p,f,m){var g=i,h=function(e,t,r){return r>t?3:e>=r?1:2},y=function(e,t){return function(r){if(!r.histograms[0])return 1;var n=r.histograms[0].counts[1]||0;return n>t?3:e>=n?1:2}},v=function(e,t,r){return function(n){if(!n.histograms[0])return h(e,t,0);var o=n.histograms[0].counts[1]||0,i=I(o,r),a=i/g;return h(e,t,a)}},b=function(e){if(!e.histograms.length)return 1;var t=e.histograms[0].counts[1];return t>0?3:1},_=function(e){if(!e.histograms.length)return 1;var t=e.histograms[0].counts;return t[2]?3:t[1]?3:1},S=function(e,t,r){return{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:e,OutputValues:t,Raster:r,AllowUnmatched:!1},variableName:"Raster"}},R=function(e){return S([0,1,1,14],[0,1],e)},A=function(e){return S([1,22],[1],e)},w=function(e){return S([0,100,100,200,200,300,300,400,400,500,500,1e3],[1,2,3,4,5,6],e)},C=function(e,t,r){return{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:e,Raster2:t,Operation:r}}},E=function(e){return{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[parseInt(e.replace("$",""))],ascending:!0,mosaicOperation:"MT_FIRST"}},I=function(e,t){var r=t*t,n=e*r;return n},x={histogram:a.computeHistogram,query:a.queryEsri},T={low:7,high:12},F=[{label:"legal",categories:["legal"],singleIndicator:!0},{label:"deforestation",high:21,low:13},{label:"peat",high:7,low:4},{label:"rspo",categories:["rspo"]},{label:"fire",categories:["fire"],singleIndicator:!0}],k=[{key:"carbon",category:"deforestation",service:d.commodities,request:x.histogram,params:{renderingRule:C(R(s.treeCoverLoss.rasterId),S([0,100,100,200,200,300,300,400,400,500,500,1e3],[1,2,3,4,5,6],s.carbonDensity.rasterId),3),pixelSize:100},callbacks:{radius:_,concession:_}},{key:"forma",category:"deforestation",service:d.commodities,request:x.histogram,params:{renderingRule:A(s.clearanceAlerts.rasterId),pixelSize:500},callbacks:{radius:y(1,5),concession:y(25,295)}},{key:"forma_carbon",category:"deforestation",service:d.commodities,request:x.histogram,params:{renderingRule:C(A(s.clearanceAlerts.rasterId),w(s.carbonDensity.rasterId),3),pixelSize:30},callbacks:{radius:b,concession:b}},{key:"area_carbon",category:"deforestation",service:d.commodities,request:x.histogram,params:{renderingRule:w(s.carbonDensity.rasterId),pixelSize:30},callbacks:{radius:v(.747,.913,30),concession:v(0,.2,30)}},{key:"area_primary",category:"deforestation",service:d.commodities,request:x.histogram,ind_params:{renderingRule:S([0,1,1,3],[0,1],s.primaryForest.rasterId),pixelSize:100},params:{renderingRule:S([0,1,1,3],[0,1],s.intactForest.rasterId),pixelSize:100},callbacks:{radius:v(.12,.18,100),concession:v(0,.2,100)}},{key:"forma_primary",category:"deforestation",service:d.commodities,request:x.histogram,ind_params:{renderingRule:C(A(s.clearanceAlerts.rasterId),S([1,3],[1],s.primaryForest.rasterId),3),pixelSize:30},params:{renderingRule:C(A(s.clearanceAlerts.rasterId),s.intactForest.rasterId,3),pixelSize:30},callbacks:{radius:b,concession:b}},{key:"umd_loss",category:"deforestation",service:d.commodities,request:x.histogram,params:{renderingRule:R(s.treeCoverLoss.rasterId),pixelSize:30},callbacks:{radius:v(.001,.28*.02,30),concession:v(.05,.28,30)}},{key:"umd_loss_primary",category:"deforestation",service:d.commodities,request:x.histogram,ind_params:{renderingRule:C(R(s.treeCoverLoss.rasterId),s.primaryForest.rasterId,3),pixelSize:100},params:{renderingRule:C(R(s.treeCoverLoss.rasterId),s.intactForest.rasterId,3),pixelSize:100},callbacks:{radius:b,concession:b}},{key:"fire",category:"fire",service:d.fires,request:x.query,params:{where:"BRIGHTNESS>=330 AND CONFIDENCE>=30",geometry:""},execution:"executeForCount",callback:function(e){return e>0?3:1},callbacks:{radius:function(e){return e>0?3:1},concession:function(e){return e>0?3:1}}},{key:"legal",category:"legal",service:d.commodities,request:x.histogram,ind_params:{renderingRule:S([0,1,1,2,2,3,3,4,4,7],[1,0,1,0,1],s.legalClass.rasterId),pixelSize:100},params:{renderingRule:E(s.protectedArea.rasterId),pixelSize:100},callbacks:{radius:b,concession:b},ind_callback:b},{key:"clearance",category:"peat",service:d.commodities,request:x.histogram,params:{renderingRule:C(R(s.treeCoverLoss.rasterId),s.peatLands.rasterId,3),pixelSize:100},callbacks:{radius:b,concession:b}},{key:"alerts",category:"peat",service:d.commodities,request:x.histogram,params:{renderingRule:C(A(s.clearanceAlerts.rasterId),s.peatLands.rasterId,3),pixelSize:100},callbacks:{radius:b,concession:b}},{key:"presence",category:"peat",service:d.commodities,request:x.histogram,params:{renderingRule:S([0,1,1,2],[0,1],s.peatLands.rasterId),pixelSize:100},callbacks:{radius:v(.00531,.00693),concession:v(.00531,.00693)}}],L=function(t){var r=e.groupBy(k,"key"),t=r[t][0].category;return t},O=function(t,r){var o=n.clone(F),i=0;return e.forIn(t,function(t,n){var o=L(n);f[o]||(f[o]={});var a=e.result(e.find(F,{label:o}),"singleIndicator");a?(f[o][r]={risk:c[t]},i+=t):(f[o][n]||(f[o][n]={}),f[o][n][r]={risk:c[t]})}),o.forEach(function(n){var o=0;if(n.high){var a=[];e.pluck(e.groupBy(k,"category")[n.label],"key");k.forEach(function(e){o+=t[e],i+=t[e],a.push({key:e,risk:t[e]})}),n.categories=a;var s=h(n.high,n.low,o),l=n.label;n.risk=s,f[l]||(f[l]={});var u=n.label+"_"+r;f[l][u]=c[s]}}),i=h(T.low,T.high,i),f["priority_level_"+r]=c[i],i>f.total_mill_priority_level&&(f.total_mill_priority_level=i),f},P=new t;u=u,p=p,f.total_mill_priority_level=f.total_mill_priority_level||0;var N=[];if(!o){var B={};return e.pluck(k,"key").forEach(function(e){B[e]=0}),O(B,l),P.resolve(B),P.promise}var D=function(t,n,o,i){var a=t.map(function(e){return o.geometry=JSON.stringify(e),n.request(n.service,o,n.execution)});r(a).then(function(t){var r={histograms:[{counts:[]}]},o=e.pluck(e.flatten(e.pluck(t,"histograms")),"counts");o.forEach(function(e){e.forEach(function(e,t){r.histograms[0].counts[t]=r.histograms[0].counts[t]||0,r.histograms[0].counts[t]+=e})});var a={},s=n.callbacks[l];n.results=r,a[n.key]=s(r,i),i.resolve(a)},function(e){console.log("SPLIT ERROR",e)})};return k.forEach(function(e){var r=new t,n=p&&e.ind_params?e.ind_params:e.params;e.request===a.computeHistogram?(n.renderingRule=JSON.stringify(n.renderingRule),n.mosaicRule=n.mosaicRule?JSON.stringify(n.mosaicRule):"",n.geometryType="esriGeometryPolygon",n.geometry=JSON.stringify(o)):n.geometry=o,n.f="json",e.request(e.service,n,e.execution).then(function(t){var n={},o=e.callbacks[l];e.results=t,n[e.key]=o(t,r),r.resolve(n)},function(t){console.log("HISTOGRAM ERROR",t),m&&D(m,e,n,r)}),N.push(r.promise)}),r(N).then(function(e){var t={};e.forEach(function(e){n.mixin(t,e)}),console.log("calculatePriority");var r=O(t,l);P.resolve(r)}),P.promise},l.getGeometryArea=function(e,r){var n=new t,o={areaUnit:"UNIT_SQUARE_METERS",lengthUnit:"UNIT_METERS",calculationType:"geodesic",polygons:[r]};return a.getAreasLengths(e,o).then(function(e){n.resolve(e.areas[0])}),n},l.getConcessionRisk=function(e,r,n,c){var p=new t,f=d.concessions,m=new i(e),g={geometry:m,where:"CERT_SCHEME = 'RSPO' AND TYPE = 'Oil palm concession'",outFields:["OBJECTID"],returnGeometry:!0};return a.queryEsri(f,g).then(function(e){var t=s.geometryServiceUrl,d=e.features.map(function(e){return e.geometry});if(d.length<1)return l.getRiskByGeometry(!1,0,"concession",r,n,c),void p.resolve();var f=o.union(d),m=o.simplify(f),g=new i(m),h={geometries:[g]};a.project(t,h,u).then(function(e){var o=new i(e[0]);l.getGeometryArea(t,o).then(function(t){var o=l.getRiskByGeometry(e[0],t,"concession",r,n,c,d);o.then(function(){p.resolve()})})})}),p},l.printProjectGeom=function(e){var t=s.geometryServiceUrl,r=new i(e),n={geometries:[r]};a.project(t,n,102100).then(function(e){console.log("BUFFER GEOM",JSON.stringify(e[0]))})},l.getRadiusBuffer=function(e,r){var n=s.geometryServiceUrl,o=new t,i={unit:"UNIT_KILOMETER",distances:[r],geometries:[e]};return a.buffer(n,i,u).then(function(e){var t=e[0];l.getGeometryArea(n,t).then(function(t){o.resolve({geometry:e[0],area:t})})}),o},l.getRisk=function(e,o,i,a){var s=new t,u={};return l.getRadiusBuffer(e,o).then(function(e){var t=1e3*o*o*1e3*Math.PI,d=e.geometry,p=l.getRiskByGeometry(d,t,"radius",i,a,u),f=l.getConcessionRisk(d,i,a,u);r([p,f]).then(function(){u.total_mill_priority_level=c[u.total_mill_priority_level],s.resolve(n.clone(u))})}),s},l}),define("report/RiskHelper",["report/config","dojo/Deferred","dojo/_base/lang","dojo/promise/all","dojo/_base/array","esri/tasks/query","esri/tasks/QueryTask","report/riskController","esri/geometry/geometryEngine"],function(e,t,r,n,o,i,a,s,l){"use strict";var u={prepareFeatures:function(e){var r=new t,i=[],a=this;return o.forEach(e,function(e){var r=new t;a.getAreaAndIndoIntersect(e).then(function(e){r.resolve({feature:e.feature,inIndonesia:e.inIndonesia})}),i.push(r.promise)}),n(i).then(function(e){a.performAnalysis(e).then(function(e){r.resolve(e)})}),r.promise},getAreaAndIndoIntersect:function(e){var r=new t;return this.getIntersectionStatus(e).then(function(t){r.resolve({feature:e,inIndonesia:t})}),r.promise},getIntersectionStatus:function(r){var n,o,s=new t;return o=new a(e.boundariesUrl),n=new i,n.returnGeometry=!0,n.outFields=["OBJECTID"],n.where="ISO3 = 'IDN'",n.geometryPrecision=1,o.execute(n,function(e){var t=e.features[0]&&e.features[0].geometry;s.resolve(l.contains(t,r.geometry))},function(e){s.resolve(!1)}),s.promise},performAnalysis:function(e){var r,i,a,l,u=new t,c=this,d=[];return o.forEach(e,function(e){var o=new t;l=e.feature.isRSPO||!1,i=e.feature.geometry.getExtent().getCenter(),r=e.inIndonesia,a=JSON.parse(e.feature.buffer),n([s.getRisk(i,a,l,r)]).then(function(t){o.resolve({feature:e.feature,results:t})}),d.push(o)}),n(d).then(function(e){var t=c.formatData(e);u.resolve(t)}),u.promise},formatData:function(e){var t,n=[];return o.forEach(e,function(e){t=r.clone(e.results[0]),t.id=e.feature.millId,t.rspo={risk:e.feature.isRSPO},n.push(t)}),n}};return u}),define("report/Suitability",["esri/request","esri/tasks/query","esri/tasks/QueryTask","esri/geometry/Polygon","report/config","utils/Analytics","dojo/Deferred","dojo/_base/lang","dojo/_base/array","dojo/promise/all","report/CSVExporter"],function(e,t,r,n,o,i,a,s,l,u,c){return{getSuitabilityData:function(){function e(e){t.resolve(e),r.attachEvents()}var t=new a,r=this;return u([this.getSuitableAreas(),this.getLCHistogramData(),this.getRoadData(),this.getConcessionData(),this.computeLegalHistogram()]).then(e),t.promise},attachEvents:function(){$("#suitability-table-csv").click(this.downloadSuitabilityTable),$("#suitability-settings-csv").click(this.downloadSuitabiltiySettings)},downloadSuitabilityTable:function(){var e,t,r="\r\n";t=c.exportSuitabilityStatistics(),e=t.join(r),c.exportCSV(e),i.sendEvent("Event","Download CSV","User downloaded Suitability results table.")},downloadSuitabiltiySettings:function(){c.exportCSV(payload.suitability.csv),i.sendEvent("Event","Download CSV","User downloaded Suitability settings.")},getSuitableAreas:function(e){function t(e){e.histograms.length>0?(d.data=e.histograms[0],d.pixelSize=c.pixelSize,n.resolve(d)):n.resolve(!1)}function r(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==c.pixelSize?(c.pixelSize=500,u.getHistogram(l,c,t,r)):n.resolve(!1)}var n=new a,i=s.clone(report.suitable.renderRule),l=o.suitability.url,u=this,c={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry)},d={};return i.rasterFunction=o.suitability.rasterFunction,c.renderingRule=JSON.stringify(i),this.getHistogram(l,c,t,r),n.promise},getLCHistogramData:function(){function e(e){e.histograms.length>0?(c.data=e.histograms[0],c.pixelSize=u.pixelSize,r.resolve(c)):r.resolve(!1)}function t(n){n.details&&"The requested image exceeds the size limit."===n.details[0]&&500!==u.pixelSize?(u.pixelSize=500,l.getHistogram(s,u,e,t)):r.resolve(!1)}var r=new a,n=o.suitability.lcHistogram,i=n.renderRule,s=o.suitability.url,l=this,u={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry),renderingRule:JSON.stringify(i)},c={};return this.getHistogram(s,u,e,t),r.promise},getRoadData:function(){function e(e){e.histograms.length>0?(c.data=e.histograms[0],c.pixelSize=u.pixelSize,r.resolve(c)):r.resolve(!1)}function t(n){n.details&&"The requested image exceeds the size limit."===n.details[0]&&500!==u.pixelSize?(u.pixelSize=500,l.getHistogram(i,u,e,t)):r.resolve(!1)}var r=new a,n=o.suitability.roadHisto,i=o.suitability.url,s=n.mosaicRule,l=this,u={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify(s)},c={};return this.getHistogram(i,u,e,t),r.promise},getConcessionData:function(){var e=new a,i=o.suitability.concessions,s=new t,l=new r(i.url+"/"+i.layer);return s.returnGeometry=!1,s.geometry=new n(report.geometry),l.executeForCount(s,function(t){e.resolve({value:t>0?"Yes":"No"})},function(t){e.resolve(!1)}),e.promise},computeLegalHistogram:function(){function e(e){e.histograms.length>0?(p.data=e.histograms[0],p.pixelSize=d.pixelSize,r.resolve(p)):r.resolve(!1)}function t(n){n.details&&"The requested image exceeds the size limit."===n.details[0]&&500!==d.pixelSize?(d.pixelSize=500,c.getHistogram(u,d,e,t)):r.resolve(!1)}var r=new a,n=s.clone(report.suitable.renderRule),i=o.suitability.lcHistogram,l=i.renderRuleSuitable,u=o.suitability.url,c=this,d={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry)},p={};return s.mixin(n.rasterFunctionArguments,l.rasterFunctionArguments),n.rasterFunction=l.rasterFunction,d.renderingRule=JSON.stringify(n),this.getHistogram(u,d,e,t),r.promise},getCompositionAnalysis:function(){var e=new a,t=this;return u([t.getElevationComposition(),t.getSlopeComposition(),t.getWaterComposition(),t.getConservationComposition()]).then(function(r){u([t.getSoilTypeComposition(),t.getSoilDepthComposition(),t.getPeatComposition(),t.getSoilAcidityComposition()]).then(function(n){u([t.getSoilDrainComposition(),t.getRainfallComposition(),t.getLandCoverComposition()]).then(function(t){e.resolve(r.concat(n.concat(t)))})})}),e.promise},getElevationComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$1","ElevInpR","ElevOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Elevation"),r.resolve(t)}),r.promise},getSlopeComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$2","SlopeInpR","SlopeOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Slope"),r.resolve(t)}),r.promise},getWaterComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$3","WaterInpR","WaterOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Water Resource Buffers"),r.resolve(t)}),r.promise},getConservationComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$4","ConsInpR","ConsOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Conservation Area Buffers"),r.resolve(t)}),r.promise},getSoilTypeComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$5","STypeInpR","STypeOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Soil Type"),r.resolve(t)}),r.promise},getSoilDepthComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$6","SDepthInpR","SDepthOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Soil Depth"),r.resolve(t)}),r.promise},getPeatComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$7","PeatInpR","PeatOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Peat Depth"),r.resolve(t)}),r.promise},getSoilAcidityComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$8","SAcidInpR","SAcidOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Soil Acidity"),r.resolve(t)}),r.promise},getSoilDrainComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$9","SDrainInpR","SDrainOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Soil Drainage"),r.resolve(t)}),r.promise},getRainfallComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$10","RainfallInpR","RainfallOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Rainfall"),r.resolve(t)}),r.promise},getLandCoverComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$11","LCInpR","LCOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Land Cover"),r.resolve(t)}),r.promise},getCompositionRemapRule:function(e,t,r){var n=s.clone(report.suitable.renderRule);return{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:n.rasterFunctionArguments[t],OutputValues:n.rasterFunctionArguments[r],Raster:e},outputPixelType:"U2"}},queryComposition:function(e,t){function r(e){var r;e.histograms.length>0?(r=e.histograms[0]&&e.histograms[0].counts||[0,0],t(r)):(r=[0,0],t(r))}function n(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==a.pixelSize?(a.pixelSize=500,self.getHistogram(i,a,r,n)):t(!1)}var i=o.suitability.url,a={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry),renderingRule:JSON.stringify(e)};this.getHistogram(i,a,r,n)},formatCompositionResults:function(e,t){return{unsuitable:e[0]||0,suitable:e[1]||0,label:t}},getHistogram:function(t,r,n,o){var i=e({url:t+"/computeHistograms?",content:r,handleAs:"json",callbackParamName:"callback"});i.then(n,o)}}}),define("map/Symbols",["esri/Color","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol"],function(e,t,r,n){"use strict";var o={getPolygonSymbol:function(){return new t(t.STYLE_SOLID,new r(r.STYLE_SOLID,new e([255,0,0]),2),new e([103,200,255,0]))},getPointSymbol:function(){return new n(n.STYLE_CIRCLE,10,new r(r.STYLE_SOLID,new e([255,0,0]),1),new e([0,0,0,.25]))},getHighlightPolygonSymbol:function(){return new t(t.STYLE_SOLID,new r(r.STYLE_SOLID,new e([0,255,255]),2),new e([103,200,255,0]))},getHighlightPointSymbol:function(){return new n(n.STYLE_CIRCLE,10,new r(r.STYLE_SOLID,new e([0,255,255]),1),new e([0,0,0,.25]))}};return o}),define("utils/assert",[],function(){"use strict";return function(e,t){if(!e)throw new Error(["Assertion Error:",t].join(" "))}}),define("utils/request",["esri/request"],function(e){"use strict";return{get:function(t,r,n,o){var i=e({callbackParamName:"callback",content:r,handleAs:"json",url:t});i.then(n,o)},computeHistogram:function(t,r,n,o){var i=e({url:t+"/computeHistograms",callbackParamName:"callback",content:r,handleAs:"json",timeout:6e4},{usePost:!0});i.then(n,o)}}}),define("report/rasterArea",["lodash","utils/assert","utils/request","report/config","dojo/Deferred"],function(e,t,r,n,o){"use strict";function i(e){function t(e){e.histograms.length>0?i.resolve(e.histograms[0]):i.reject()}var i=new o,a={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(e),renderingRule:JSON.stringify(n.rasterFunctions.range),pixelSize:c,f:"json"};return r.computeHistogram(n.urls.imageService,a,t,u),i}function a(t){for(var r=t.counts,n=e.findIndex(r,function(e){return e>0}),o=t.size,i=0;o>n;)i+=n*r[n]*Math.pow(c/30,2),++n;return i}function s(t){for(var r=e.findIndex(t.counts,function(e){return e>0}),n=t.size,o=[];n>r;)o.push(r),o.push(r),++r;return o}function l(t,i,a){function s(e){console.log(e)}var l,d=new o,p=e.clone(n.rasterFunctions.combination),f=[];if(a.simpleRule)p.rasterFunctionArguments.RasterRange=[1,2],p.rasterFunctionArguments.Raster=a.simpleRule;else{var m=a.raster.bounds[1]*a.raster2.length[0]+a.raster.bounds[1];p.rasterFunctionArguments.RasterRange=[1,m],p.rasterFunctionArguments.Raster.rasterFunctionArguments={RasterRange:a.raster.bounds,Raster2Length:a.raster2.length,Raster:a.raster.id,Raster2:a.raster2.id}}for(var g=0;g<i.length/2;g++)f.push(g+1);return p.rasterFunctionArguments.Raster2.rasterFunctionArguments.InputRanges=i,
p.rasterFunctionArguments.Raster2.rasterFunctionArguments.OutputValues=f,l={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(t),renderingRule:JSON.stringify(p),pixelSize:c,f:"json"},r.computeHistogram(n.urls.imageService,l,s,u),d}function u(e){console.error(e)}var c=90;return{getArea:function(e,r){t(e&&"polygon"===e.type,"Invalid Parameter");var n,c,d=new o;return i(e).then(function(t){return void 0===r?(c=a(t),console.log(c),void d.resolve(c)):(n=s(t),void l(e,n,r).then(function(e){},u))},u),d}}}),define("report/mill-api",["exports","esri/geometry/geometryEngineAsync","esri/tasks/BufferParameters","esri/tasks/GeometryService","esri/SpatialReference","esri/geometry/Polygon","esri/request","esri/config","dojo/Deferred","dojo/promise/all"],function(e,t,r,n,o,i,a,s,l,u){"use strict";function c(e){return e&&e.__esModule?e:{"default":e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t,r){var n=new _["default"];return(0,S["default"])({BUFFER:V(e,r||w.RADIUS),INDO:$(e)}).then(function(r){var o=r.BUFFER[0];F=r.INDO,(0,S["default"])({AREA:q(o),LOSS_RATE:J(o),HISTORIC:ne(o),FUTURE:oe(o)}).then(function(r){n.resolve(ae(ie(r),e,t))})}),n}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=p;var f=c(t),m=c(r),g=c(n),h=c(o),y=c(i),v=c(a),b=c(s),_=c(l),S=c(u),R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},A=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),w={RADIUS:50,DENSITY:30,TIMEOUT:45e3,PIXEL_SIZE:100,FUTURE_YEAR_COUNT:2,CONTENT_FORMAT:"json",HISTORIC_YEAR_END_INDEX:11,HISTORIC_YEAR_START_INDEX:8,GEOMETRY_POINT:"esriGeometryPoint",GEOMETRY_POLYGON:"esriGeometryPolygon"},C={1:"low",2:"medium low",3:"medium",4:"medium high",5:"high"},E={ADD:1,MULTIPLY:3},I={mosaic:function(e){return{mosaicMethod:"esriMosaicLockRaster",mosaicOperation:"MT_FIRST",lockRasterIds:[e],ascending:!0}},arithmetic:function(e,t,r){return{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:e,Raster2:t,Operation:r}}},remap:function(e,t,r){return{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:t,OutputValues:r,Raster:e,AllowUnmatched:!1}}}},x={FIRES_RASTER_URL:"http://gis-gfw.wri.org/arcgis/rest/services/image_services/annual_fires/ImageServer",IMAGE_SERVICE_URL:"http://gis-gfw.wri.org/arcgis/rest/services/image_services/analysis/ImageServer",GEOMETRY_SERVICE_URL:"http://gis-gfw.wri.org/arcgis/rest/services/Utilities/Geometry/GeometryServer",BOUNDARY_SERVICE_URL:"http://gis-potico.wri.org/arcgis/rest/services/CommoditiesAnalyzer/mapfeatures/MapServer/6",CANOPY_DENSITY_REMAP:I.remap("$520",[0,w.DENSITY,w.DENSITY,101],[0,1]),TREE_COVER_LOSS:{id:"$530",bounds:[1,14]},PRIMARY_FOREST:{id:"$519",bounds:[1,2]},PEAT:{id:"$8",bounds:[0,1]},PROTECTED_AREA:{id:"$10",bounds:[0,1]},CARBON:{id:"$524",bounds:[0,1],remap:I.remap("$524",[0,21,21,1e3],[0,1])},TREE_COVER_EXTENT:{id:"$520"},INTACT_FOREST_LANDSCAPE:{id:"$9"},FIRES:{PIXEL_SIZE:890.5559263,ID_09:1,ID_10:2,ID_11:3,ID_12:4,ID_13:5,ID_14:6,ID_15:7}},T={CARBON_AREA:{type:"percent",mean:97.67173618,std_dev:5.775175366},CARBON_LOSS:{type:"number",mean:55479.66071,std_dev:31676.19725},FIRE_ACTIVITY_FUTURE:{type:"number",mean:463888e-9,std_dev:781948e-9},FIRE_ACTIVITY_HISTORIC:{type:"number",mean:287583e-9,std_dev:336257e-9},WDPA_AREA:{type:"percent",mean:7.228910262,std_dev:8.985175562},WDPA_LOSS:{type:"number",mean:1119.288265,std_dev:2797.828324},PEAT_AREA:{type:"percent",mean:9.817356171,std_dev:12.76025748},PEAT_LOSS:{type:"number",mean:10890.62372,std_dev:19728.76226},PRIMARY_FOREST_AREA:{type:"percent",mean:12.5132604,std_dev:16.9831375},PRIMARY_FOREST_LOSS:{type:"number",mean:11965.28699,std_dev:22059.03368},TREE_COVER_FUTURE_RATE:{type:"number",mean:9321.90051,std_dev:4551.812568},TREE_COVER_LOSS_RATE:{type:"number",mean:13952.03571,std_dev:7912.007913}},F=void 0,k=new g["default"](x.GEOMETRY_SERVICE_URL);b["default"].defaults.io.corsEnabledServers.push("gis-gfw.wri.org"),b["default"].defaults.io.corsEnabledServers.push("gis-potico.wri.org");var L=function(e){var t=e.histograms,r=e.noSlice,n=t&&1===t.length?t[0].counts:[];return r?n:n.slice(1)},O=function(e){return parseInt(e.replace(/\$/,""))},P=function(e,t){var r=e/t*100;return r>100?100:r},N=function(e,t,r){return(e-t)/r},B=function(e){var t=void 0;return t=e>=1?5:e>=.5&&.99>=e?4:e>=-.49&&.49>=e?3:e>=-.99&&-.49>=e?2:1,{score:t,zScore:e,rank:C[t]}},D=function(){return{score:1,zScore:-1,rank:C[1]}},z=function(e,t){var r=e*t,n=void 0;return n=r>=21?5:r>=16&&20>=r?4:r>=11&&15>=r?3:r>=5&&10>=r?2:1,C[n]},M=function(e){for(var t=0,r=w.HISTORIC_YEAR_START_INDEX;r<=w.HISTORIC_YEAR_END_INDEX;r++)e[r]&&(t+=e[r]);return t},j=function(e){for(var t=[],r=w.FUTURE_YEAR_COUNT;r>0;r--)t.push(e[e.length-r]||0);return t.reduce(function(e,t){return e+t},0)/t.length},U=function(e){for(var t=[],r=w.HISTORIC_YEAR_START_INDEX;r<=w.HISTORIC_YEAR_END_INDEX;r++)t.push(e[r]||0);return t.reduce(function(e,t){return e+t},0)/t.length},H=function(){function e(t,r){d(this,e),this.fromBounds=function(e){for(var t=[],r=e[1],n=e[0];r>=n;n++)t.push(n);return t},this.A=this.fromBounds(t),this.B=this.fromBounds(r)}return A(e,[{key:"encode",value:function(e,t){return this.B.length*e+t}},{key:"decode",value:function(e){var t=e%this.B.length,r=(e-t)/this.B.length;return[r,t]}},{key:"getSimpleRule",value:function(e,t){var r=x.CANOPY_DENSITY_REMAP,n=I.arithmetic(r,I.arithmetic(e,t,E.MULTIPLY),E.MULTIPLY);return n.rasterFunctionArguments.Raster2.outputPixelType="U8",n}},{key:"getRule",value:function(e,t){var r=I.remap(e,[this.A[0],this.A[this.A.length-1]+1],[this.B.length]),n=x.CANOPY_DENSITY_REMAP,o=I.arithmetic(n,I.arithmetic(I.arithmetic(r,e,E.MULTIPLY),t,E.ADD),E.MULTIPLY);return o.rasterFunctionArguments.Raster2.outputPixelType="U8",o}}]),e}(),G=function(e,t){return t.geometry&&(t.geometry=JSON.stringify(t.geometry)),t.renderingRule&&(t.renderingRule=JSON.stringify(t.renderingRule)),t.mosaicRule&&(t.mosaicRule=JSON.stringify(t.mosaicRule)),t.geometryType=t.geometryType||w.GEOMETRY_POLYGON,t.pixelSize=t.pixelSize||w.PIXEL_SIZE,t.f=t.f||w.CONTENT_FORMAT,(0,v["default"])({url:e+"/computeHistograms",callbackParamName:"callback",timeout:w.TIMEOUT,content:t,handleAs:"json"},{usePost:!0})},$=function(e){var t=new _["default"],r={where:"ISO = 'IDN'",geometryType:w.GEOMETRY_POINT,geometry:JSON.stringify(e),returnGeometry:!1,outFields:[],f:"json"};return(0,v["default"])({url:x.BOUNDARY_SERVICE_URL+"/query",callbackParamName:"callback",timeout:w.TIMEOUT,content:r,handleAs:"json"},{usePost:!0}).then(function(e){t.resolve(e&&e.features&&e.features.length>0)}),t},Y=function(e){var t=new _["default"],r={geometryType:w.GEOMETRY_POLYGON,spatialRel:"esriSpatialRelIntersects",geometry:JSON.stringify(e),returnGeometry:!0,outFields:[""],outSR:54010,f:"json"};return(0,v["default"])({url:x.BOUNDARY_SERVICE_URL+"/query",callbackParamName:"callback",timeout:w.TIMEOUT,content:r,handleAs:"json"},{usePost:!0}).then(function(e){t.resolve(e.features)}),t},V=function(e,t){var r=new _["default"],n=new m["default"];return n.geometries=[e],n.distances=[t],n.unit=g["default"].UNIT_KILOMETER,n.outSpatialReference=new h["default"](54010),k.buffer(n,r.resolve,console.error),r},q=function(e){var t=new _["default"],r={areaUnit:'{"areaUnit": "esriHectares"}',calculationType:"preserveShape",sr:54010,f:"json"};return Y(e).then(function(n){var o=n.map(function(e){return new y["default"](e.geometry)});f["default"].intersect(o,e).then(function(e){r.polygons=JSON.stringify(e),(0,v["default"])({url:x.GEOMETRY_SERVICE_URL+"/areasAndLengths",callbackParamName:"callback",timeout:w.TIMEOUT,content:r,handleAs:"json"},{usePost:!0}).then(function(e){t.resolve(e.areas.reduce(function(e,t){return e+t},0))})})}),t},J=function(e){var t=new _["default"],r={geometry:e,pixelSize:w.PIXEL_SIZE,renderingRule:I.arithmetic(x.CANOPY_DENSITY_REMAP,x.TREE_COVER_LOSS.id,E.MULTIPLY)};return G(x.IMAGE_SERVICE_URL,r).then(function(e){t.resolve(L({histograms:e.histograms}))}),t},W=function(e){var t=new _["default"],r=new H(x.TREE_COVER_LOSS.bounds,x.PRIMARY_FOREST.bounds),n=r.getRule(x.TREE_COVER_LOSS.id,x.PRIMARY_FOREST.id),o={geometry:e,pixelSize:w.PIXEL_SIZE,renderingRule:n};return G(x.IMAGE_SERVICE_URL,o).then(function(e){for(var n=r.A,o=r.B,i=L({histograms:e.histograms,noSlice:!0}),a=[],s=0;s<n.length;s++){for(var l=0,u=0;u<o.length;u++){var c=r.encode(n[s],o[u]);l+=i[c]||0}a.push(l)}t.resolve(a)}),t},K=function(e){var t=new _["default"],r=new H(x.TREE_COVER_LOSS.bounds,x.PEAT.bounds),n=r.getSimpleRule(x.TREE_COVER_LOSS.id,x.PEAT.id),o={geometry:e,pixelSize:w.PIXEL_SIZE,renderingRule:n};return G(x.IMAGE_SERVICE_URL,o).then(function(e){t.resolve(L({histograms:e.histograms}))}),t},X=function(e){var t=new _["default"],r=new H(x.TREE_COVER_LOSS.bounds,x.PROTECTED_AREA.bounds),n=r.getSimpleRule(x.TREE_COVER_LOSS.id,x.PROTECTED_AREA.id),o={geometry:e,pixelSize:w.PIXEL_SIZE,renderingRule:n};return G(x.IMAGE_SERVICE_URL,o).then(function(e){t.resolve(L({histograms:e.histograms}))}),t},Z=function(e){var t=new _["default"],r=new H(x.TREE_COVER_LOSS.bounds,x.CARBON.bounds),n=r.getRule(x.TREE_COVER_LOSS.id,x.CARBON.remap),o={geometry:e,pixelSize:w.PIXEL_SIZE,renderingRule:n};return G(x.IMAGE_SERVICE_URL,o).then(function(e){for(var n=r.A,o=r.B,i=L({histograms:e.histograms,noSlice:!0}),a=[],s=0;s<n.length;s++){for(var l=0,u=1;u<o.length;u++){var c=r.encode(n[s],o[u]);l+=i[c]||0}a.push(l)}t.resolve(a)}),t},Q=function(e,t){var r=new _["default"],n={geometry:t,pixelSize:w.PIXEL_SIZE,mosaicRule:I.mosaic(O(e))};return G(x.IMAGE_SERVICE_URL,n).then(function(e){if(e.histograms.length){var t=L({histograms:e.histograms});r.resolve(t.length?t.reduce(function(e,t){return e+t},0):0)}else r.resolve(0)},function(){r.resolve(0)}),r},ee=function(e){var t=new _["default"],r={geometry:e,pixelSize:w.PIXEL_SIZE,renderingRule:x.CARBON.remap};return G(x.IMAGE_SERVICE_URL,r).then(function(e){if(e.histograms.length){var r=L({histograms:e.histograms});t.resolve(r.length?r[0]:0)}else t.resolve(0)},function(){t.resolve(0)}),t},te=function(e){var t=new _["default"],r={geometry:e,pixelSize:x.FIRES.PIXEL_SIZE},n=R({},r,{mosaicRule:I.mosaic(x.FIRES.ID_09)}),o=R({},r,{mosaicRule:I.mosaic(x.FIRES.ID_10)}),i=R({},r,{mosaicRule:I.mosaic(x.FIRES.ID_11)}),a=R({},r,{mosaicRule:I.mosaic(x.FIRES.ID_12)});return(0,S["default"])([G(x.FIRES_RASTER_URL,n),G(x.FIRES_RASTER_URL,o),G(x.FIRES_RASTER_URL,i),G(x.FIRES_RASTER_URL,a)]).then(function(e){var r=e.map(function(e){var t=L({histograms:e.histograms,noSlice:!0});return t.reduce(function(e,t,r){return e+t*r},0)});t.resolve(r.reduce(function(e,t){return e+t},0)/r.length)}),t},re=function(e){var t=new _["default"],r={geometry:e,pixelSize:x.FIRES.PIXEL_SIZE},n=R({},r,{mosaicRule:I.mosaic(x.FIRES.ID_13)}),o=R({},r,{mosaicRule:I.mosaic(x.FIRES.ID_14)});return(0,S["default"])([G(x.FIRES_RASTER_URL,n),G(x.FIRES_RASTER_URL,o)]).then(function(e){var r=e.map(function(e){var t=L({histograms:e.histograms,noSlice:!0});return t.reduce(function(e,t,r){return e+t*r},0)});t.resolve(r.reduce(function(e,t){return e+t},0)/r.length)}),t},ne=function(e){return(0,S["default"])({PRIMARY_FOREST:W(e),PEAT:K(e),PROTECTED_AREA:X(e),CARBON:Z(e),FIRE:te(e)})},oe=function(e){return(0,S["default"])({PRIMARY_FOREST:Q(x.PRIMARY_FOREST.id,e),PEAT:Q(x.PEAT.id,e),PROTECTED_AREA:Q(x.PROTECTED_AREA.id,e),CARBON:ee(e),IFL:Q(x.INTACT_FOREST_LANDSCAPE.id,e),FIRE:re(e)})},ie=function(e){var t=e.AREA,r=e.LOSS_RATE,n=e.HISTORIC,o=e.FUTURE,i=j(r,w.FUTURE_YEAR_COUNT),a=P(F?o.PRIMARY_FOREST:o.IFL,t),s=P(o.PEAT,t),l=P(o.PROTECTED_AREA,t),u=P(o.CARBON,t),c=o.FIRE/t,d=a?B(N(a,T.PRIMARY_FOREST_AREA.mean,T.PRIMARY_FOREST_AREA.std_dev)):D(),p=s?B(N(s,T.PEAT_AREA.mean,T.PEAT_AREA.std_dev)):D(),f=l?B(N(l,T.WDPA_AREA.mean,T.WDPA_AREA.std_dev)):D(),m=u?B(N(u,T.CARBON_AREA.mean,T.CARBON_AREA.std_dev)):D(),g=i?B(N(i,T.TREE_COVER_FUTURE_RATE.mean,T.TREE_COVER_FUTURE_RATE.std_dev)):D(),h=c?B(N(c,T.FIRE_ACTIVITY_FUTURE.mean,T.FIRE_ACTIVITY_FUTURE.std_dev)):D(),y=U(r),v=M(n.PRIMARY_FOREST),b=M(n.PEAT),_=M(n.PROTECTED_AREA),S=M(n.CARBON),A=n.FIRE/t,C=y?B(N(y,T.TREE_COVER_LOSS_RATE.mean,T.TREE_COVER_LOSS_RATE.std_dev)):D(),E=v?B(N(v,T.PRIMARY_FOREST_LOSS.mean,T.PRIMARY_FOREST_LOSS.std_dev)):D(),I=b?B(N(b,T.PEAT_LOSS.mean,T.PEAT_LOSS.std_dev)):D(),x=_?B(N(_,T.WDPA_LOSS.mean,T.WDPA_LOSS.std_dev)):D(),k=S?B(N(S,T.CARBON_LOSS.mean,T.CARBON_LOSS.std_dev)):D(),L=A?B(N(A,T.FIRE_ACTIVITY_HISTORIC.mean,T.FIRE_ACTIVITY_HISTORIC.std_dev)):D();return{HISTORIC:{primary_forest:R({amount:v},E),peat:R({amount:b},I),protected_areas:R({amount:_},x),carbon:R({amount:S},k),tree_cover:R({amount:y},C),fire:R({amount:A},L)},FUTURE:{primary_forest:R({amount:a},d),peat:R({amount:s},p),protected_areas:R({amount:l},f),carbon:R({amount:u},m),tree_cover:R({amount:i},g),fire:R({amount:c},h)}}},ae=function(e,t,r){var n=e.HISTORIC,o=e.FUTURE,i=0===o.tree_cover.zScore&&0===n.tree_cover.zScore,a=0===o.primary_forest.zScore&&0===n.primary_forest.zScore,s=0===o.peat.zScore&&0===n.peat.zScore,l=0===o.protected_areas.zScore&&0===n.protected_areas.zScore,u=0===o.carbon.zScore&&0===n.carbon.zScore,c=0===o.fire.zScore&&0===n.fire.zScore,d=(n.tree_cover.zScore+n.primary_forest.zScore+n.peat.zScore+n.protected_areas.zScore+n.carbon.zScore+n.fire.zScore)/6,p=(o.tree_cover.zScore+o.primary_forest.zScore+o.peat.zScore+o.protected_areas.zScore+o.carbon.zScore+o.fire.zScore)/6,f=B(d),m=B(p),g={};return t.getLatitude&&(g.latitude=t.getLatitude().toFixed(4)),t.getLongitude&&(g.longitude=t.getLongitude().toFixed(4)),R({tree_cover:{extent:{amount:o.tree_cover.amount,rank:o.tree_cover.rank},loss:{amount:n.tree_cover.amount,rank:n.tree_cover.rank},risk:i?D().rank:B((o.tree_cover.zScore+n.tree_cover.zScore)/2).rank},primary_forest:{extent:{amount:o.primary_forest.amount,rank:o.primary_forest.rank},loss:{amount:n.primary_forest.amount,rank:n.primary_forest.rank},risk:a?D().rank:B((o.primary_forest.zScore+n.primary_forest.zScore)/2).rank},peat:{extent:{amount:o.peat.amount,rank:o.peat.rank},loss:{amount:n.peat.amount,rank:n.peat.rank},risk:s?D().rank:B((o.peat.zScore+n.peat.zScore)/2).rank},protected_areas:{extent:{amount:o.protected_areas.amount,rank:o.protected_areas.rank},loss:{amount:n.protected_areas.amount,rank:n.protected_areas.rank},risk:l?D().rank:B((o.protected_areas.zScore+n.protected_areas.zScore)/2).rank},carbon:{extent:{amount:o.carbon.amount,rank:o.carbon.rank},loss:{amount:n.carbon.amount,rank:n.carbon.rank},risk:u?D().rank:B((o.carbon.zScore+n.carbon.zScore)/2).rank},fire:{extent:{amount:o.fire.amount,rank:o.fire.rank},loss:{amount:n.fire.amount,rank:n.fire.rank},risk:c?D().rank:B((o.fire.zScore+n.fire.zScore)/2).rank},historic_loss:f.rank,future_risk:m.rank,priority_level:z(f.score,m.score),mill_name:r||""},g)}}),define("report/Fetcher",["lodash","dojo/number","dojo/Deferred","dojo/promise/all","dojo/_base/array","dojo/dom","dojo/dom-construct","report/config","report/Renderer","report/RiskHelper","report/Suitability","map/Symbols","esri/map","esri/request","esri/tasks/query","esri/dijit/Scalebar","esri/dijit/Legend","esri/tasks/QueryTask","esri/SpatialReference","esri/geometry/Polygon","esri/geometry/Point","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/tasks/GeometryService","esri/geometry/geometryEngine","esri/tasks/AreasAndLengthsParameters","esri/Color","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","esri/layers/RasterFunction","esri/layers/ImageParameters","esri/layers/ArcGISImageServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/LayerDrawingOptions","esri/graphic","report/rasterArea","report/mill-api"],function(e,t,r,n,o,i,a,s,l,u,c,d,p,f,m,g,h,y,v,b,_,S,R,A,w,C,E,I,x,T,F,k,L,O,P,N,B,D){var z=[];return{getAreaFromGeometry:function(e){function n(e){1===e.areas.length?(i=t.format(e.areas[0],{places:0}),report.area=e.areas[0],a.resolve(i)):(i=p,a.resolve(!1))}function o(){a.resolve(!1)}this._debug("Fetcher >>> getAreaFromGeometry");var i,a=new r,l=new A(s.geometryServiceUrl),u=new C,c=new v(54012),d=new b(e),p="Not Available";return u.areaUnit=A.UNIT_HECTARES,l.project([d],c,function(e){e.length>0?(d.rings=e[0].rings,d.setSpatialReference(c)):o(),l.simplify([d],function(e){u.polygons=e,l.areasAndLengths(u,n,o)},o)},o),a.promise},setupMap:function(){function e(){if(o.graphics.clear(),o.resize(),t=new g({map:o,scalebarUnit:"metric",attachTo:"bottom-center"}),n=new b(report.mapGeometry),report.datasets.soy){var e=new k;e.layerOption=k.LAYER_OPTION_SHOW,e.format="png32";var i;switch(report.minDensity){case 10:i="soy11";break;case 15:i="soy16";break;case 20:i="soy21";break;case 25:i="soy26";break;case 30:i="soy31";break;case 50:i="soy51";break;case 75:i="soy76";break;default:i="soy31"}var a=new F;a.functionName=i;var s=new k;s.layerOption=k.LAYER_OPTION_SHOW,s.layerIds=[4];var l=new R("http://gis-gfw.wri.org/arcgis/rest/services/cached/soy_cached/MapServer",{visible:!0,imageParameters:s,id:"soy",opacity:.4,visibleLayers:[0]});o.addLayer(l);var u=new L("http://gis-gfw.wri.org/arcgis/rest/services/image_services/soy_vizz_service/ImageServer",{imageParameters:e,id:"soyImageLayer",visible:!0});u.setRenderingRule(a),o.addLayer(u),console.log("soyImageLayer",u),$("#print-map-legend-soy").removeClass("hidden")}if(r=new N,r.setGeometry(n),r.setSymbol(d.getPolygonSymbol()),report.centerPoints)for(var c=0;c<report.centerPoints.length;c++){var p,f=new N,m=new T(T.STYLE_CIRCLE,5,new x(x.STYLE_SOLID,new E([255,0,0]),2),new E([255,0,0,1]));report.centerPoints[c].geometry.x?p=new _(report.centerPoints[c].geometry.x,report.centerPoints[c].geometry.y,report.centerPoints[c].geometry.spatialReference):report.centerPoints[c].geometry.center.x&&(p=new _(report.centerPoints[c].geometry.center.x,report.centerPoints[c].geometry.center.y,report.centerPoints[c].geometry.center.spatialReference)),f.setGeometry(p),f.setSymbol(m),o.graphics.add(f)}window.map=o,o.graphics.add(r),o.setExtent(r.geometry.getExtent().expand(1),!0)}var t,r,n,o;o=new p("print-map",{basemap:"topo",sliderPosition:"top-right"}),o.loaded?e():o.on("load",e)},getPrimaryForestResults:function(){this._debug("Fetcher >>> getPrimaryForestResults");var e=new r,t=s.primaryForest;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getTreeCoverResults:function(){this._debug("Fetcher >>> getTreeCoverResults");var e=new r,t=s.treeCover;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getTreeCoverLossResults:function(){function e(e){e.histograms.length>0?(l.renderTreeCoverLossData(e.histograms[0].counts,a.pixelSize,o),l.renderCompositionAnalysis(e.histograms[0].counts,a.pixelSize,o)):l.renderAsUnavailable("loss",o),n.resolve(!0)}function t(r){var o=function(){n.resolve(!1)};if(r.details)if("The requested image exceeds the size limit."===r.details[0]&&500!==a.pixelSize)a.pixelSize=500,u._computeHistogram(i,a,e,t);else if(0===r.details.length){var s=10;a.geometry=JSON.stringify(w.generalize(report.geometry,s,!0,"miles")),u._computeHistogram(i,a,e,o)}else n.resolve(!1);else n.resolve(!1)}this._debug("Fetcher >>> getTreeCoverLossResults");var n=new r,o=s.treeCoverLoss,i=s.imageServiceUrl,a={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify(o.mosaicRule),pixelSize:s.pixelSize,f:"json"},u=this;return l.renderTotalLossContainer(o),l.renderCompositionAnalysisLoader(o),this._computeHistogram(i,a,e,t),n.promise},getProdesResults:function(){function e(e){e.histograms.length>0?l.renderProdesData(e.histograms[0].counts,a.pixelSize,o):l.renderAsUnavailable("prodes",o),n.resolve(!0)}function t(r){var o=function(){n.resolve(!1)};if(r.details)if("The requested image exceeds the size limit."===r.details[0]&&500!==a.pixelSize)a.pixelSize=500,u._computeHistogram(i,a,e,t);else if(0===r.details.length){var s=10;a.geometry=JSON.stringify(w.generalize(report.geometry,s,!0,"miles")),u._computeHistogram(i,a,e,o)}else n.resolve(!1);else n.resolve(!1)}this._debug("Fetcher >>> getProdesResults");var n=new r,o=s.prodes,i=s.imageServiceUrl,a={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify(o.mosaicRule),pixelSize:s.pixelSize,f:"json"},u=this;return l.renderProdesContainer(o),this._computeHistogram(i,a,e,t),n.promise},getGuyraResults:function(){function e(e){e.histograms.length>0?l.renderGuyraData(e.histograms[0].counts,a.pixelSize,o):l.renderAsUnavailable("guyra",o),n.resolve(!0)}function t(r){var o=function(){n.resolve(!1)};if(r.details)if("The requested image exceeds the size limit."===r.details[0]&&500!==a.pixelSize)a.pixelSize=500,u._computeHistogram(i,a,e,t);else if(0===r.details.length){var s=10;a.geometry=JSON.stringify(w.generalize(report.geometry,s,!0,"miles")),u._computeHistogram(i,a,e,o)}else n.resolve(!1);else n.resolve(!1)}this._debug("Fetcher >>> getGuyraResults");var n=new r,o=s.guyra,i=s.imageServiceUrl,a={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify(o.mosaicRule),pixelSize:s.pixelSize,f:"json"},u=this;return l.renderGuyraContainer(o),this._computeHistogram(i,a,e,t),n.promise},getLegalClassResults:function(){this._debug("Fetcher >>> getLegalClassResults");var e=new r,t=s.legalClass;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getIndonesiaMoratoriumResults:function(){this._debug("Fetcher >>> getIndonesiaMoratoriumResults");var e=new r,t=s.indonesiaMoratorium;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getProtectedAreaResults:function(){this._debug("Fetcher >>> getProtectedAreaResults");var e=new r,t=s.protectedArea;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getCarbonStocksResults:function(){this._debug("Fetcher >>> getCarbonStocksResults");var e=new r,t=s.carbonStock;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getPlantationsSpeciesResults:function(){this._debug("Fetcher >>> getPlantationsSpeciesResults");var e=new r,t=s.plantationsSpeciesLayer;return console.dir(t),l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getPlantationsTypeResults:function(){this._debug("Fetcher >>> getPlantationsTypeResults");var e=new r,t=s.plantationsTypeLayer;return console.dir(t),l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getBrazilBiomesResults:function(){this._debug("Fetcher >>> getBrazilBiomesResults");var e=new r,t=s.brazilBiomes;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getIntactForestResults:function(){this._debug("Fetcher >>> getIntactForestResults");var e=new r,t=s.intactForest;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0)]).then(function(){e.resolve(!0)}),e.promise},getLandCoverGlobalResults:function(){this._debug("Fetcher >>> getLandCoverGlobalResults");var e=new r,t=s.landCoverGlobal;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getLandCoverAsiaResults:function(){this._debug("Fetcher >>> getLandCoverAsiaResults");var e=new r,t=s.landCoverAsia;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getLandCoverIndonesiaResults:function(){this._debug("Fetcher >>> getLandCoverIndonesiaResults");var e=new r,t=s.landCoverIndo;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getPeatLandsResults:function(){this._debug("Fetcher >>> getPeatLandsResults");var e=new r,t=s.peatLands;return l.renderContainers(t),z.push(t),n([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getSoyResults:function(){function e(e){e.histograms.length>0?(l.renderSoyData(e.histograms[0].counts,d.pixelSize,o,i.soyGeom),l.renderCompositionAnalysis(e.histograms[0].counts,d.pixelSize,o)):l.renderAsUnavailable("soy",o),n.resolve(!0)}function t(r){var o=function(){n.resolve(!1)};if(r.details)if("The requested image exceeds the size limit."===r.details[0]&&500!==d.pixelSize)d.pixelSize=500,i._computeHistogram(a,d,e,t);else if(0===r.details.length){var s=10;d.geometry=JSON.stringify(w.generalize(report.geometry,s,!0,"miles")),i._computeHistogram(a,d,e,o)}else n.resolve(!1);else n.resolve(!1)}this._debug("Fetcher >>> getSoyResults");var n=new r,o=s.soy,i=this,a=s.imageServiceUrl,u=o.renderingRule;report.minDensity&&(u.rasterFunctionArguments.Raster.rasterFunctionArguments.InputRanges=[0,report.minDensity,report.minDensity,100]);var c=JSON.stringify(u);console.log(c);var d={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:c,pixelSize:s.pixelSize,f:"json"};return i.soyGeom=report.geometry,l.renderSoyContainer(o),this._computeHistogram(a,d,e,t),n.promise},getRSPOResults:function(){function e(e){l.renderRSPOData(e,o,a),n.resolve(!0)}function t(r){r.details&&"The requested image exceeds the size limit."===r.details[0]&&500!==c.pixelSize?(c.pixelSize=500,d._computeHistogram(i,c,e,t)):n.resolve(!1)}this._debug("Fetcher >>> getRSPOResults");var n=new r,o=s.rspo,i=s.imageServiceUrl,a=this._getEncodingFunction(o.lossBounds,o.bounds),u=a.render(s.totalLoss.rasterId,o.rasterId),c={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:u,pixelSize:s.pixelSize,f:"json"},d=this;return l.renderRSPOContainer(o),this._computeHistogram(i,c,e,t),n.promise},_getTotalLossAnalysis:function(e,t){function n(r){if(r.histograms.length>0)l.renderLossData(r.histograms[0].counts,f.pixelSize,e,c,t);else{var n=Array.apply(null,new Array(a.labels.length)).map(Number.prototype.valueOf,0);l.renderLossData(n,f.pixelSize,e,c,t)}i.resolve(!0)}function o(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==f.pixelSize?(f.pixelSize=500,m._computeHistogram(u,f,n,o)):i.resolve(!1)}this._debug("Fetcher >>> _getTotalLossAnalysis");var i=new r,a=s.totalLoss,u=s.imageServiceUrl,c=this._getEncodingFunction(a.bounds,e.bounds),d=e.rasterRemap?e.rasterRemap:e.rasterId,p=t?c.getSimpleRule(a.rasterId,d):c.render(a.rasterId,d),f={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:p,pixelSize:s.pixelSize,f:"json"},m=this;return this._computeHistogram(u,f,n,o),i.promise},_getClearanceAlertAnalysis:function(t,n){function i(e){if(e.histograms.length>0)l.renderClearanceData(e.histograms[0].counts,d.pixelSize,t,p,n);else{var r=Array.apply(null,new Array(report.clearanceLabels.length)).map(Number.prototype.valueOf,0);l.renderClearanceData(r,d.pixelSize,t,p,n)}f.resolve(!0)}function a(e){var t=function(){f.resolve(!1)};if(e.details)if("Invalid cell size"===e.details[0]){var r=[];o.forEach(report.geometry.rings,function(e){e&&(r=r.concat(e))});var n=new b(r);report.mapGeometry=n,d.geometry=JSON.stringify(report.geometry),h._computeHistogram(g,d,i,t)}else f.resolve(!1);else f.resolve(!1)}this._debug("Fetcher >>> _getClearanceAlertAnalysis");var u,c,d,p,f=new r,m=s.clearanceAlerts,g=s.clearanceAnalysisUrl,h=this;return t=e.clone(t),t.formaId&&(t.rasterId=t.formaId,t.includeFormaIdInRemap&&(t.rasterRemap.rasterFunctionArguments.Raster=t.formaId)),p=this._getEncodingFunction(report.clearanceBounds,t.bounds),c=t.rasterRemap?t.rasterRemap:t.rasterId,u=n?p.getSimpleRule(m.rasterId,c):p.render(m.rasterId,c),d={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:u,pixelSize:500,f:"json"},this._computeHistogram(g,d,i,a),f.promise},getGladResults:function(t,n){function o(e){if(e.histograms.length>0)l.renderGladData(e.histograms[0].counts,a.pixelSize,t,u,n);else{var r=Array.apply(null,new Array(report.clearanceLabels.length)).map(Number.prototype.valueOf,0);l.renderGladData(r,a.pixelSize,t,u,n)}c.resolve(!0)}function i(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==a.pixelSize?(a.pixelSize=500,f._computeHistogram(p,a,o,i)):c.resolve(!1)}this._debug("Fetcher >>> getGladResults");var a,u,c=new r,d=s.glad,p=d.url,f=this;return t=e.clone(d),u=this._getEncodingFunction(report.clearanceBounds,t.bounds),a={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:JSON.stringify(t.renderingRule),pixelSize:30,f:"json"},this._computeHistogram(p,a,o,i),c.promise},_getCompositionAnalysis:function(e){function t(t){t.histograms.length>0?l.renderCompositionAnalysis(t.histograms[0].counts,u.pixelSize,e):l.renderAsUnavailable("composition",e),o.resolve(!0)}function n(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==u.pixelSize?(u.pixelSize=500,c._computeHistogram(i,u,t,n)):o.resolve(!1)}l.renderCompositionAnalysisLoader(e);var o=new r,i=s.imageServiceUrl,a=e.compositionAnalysis,u={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify({mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[a.rasterId],ascending:!0,mosaicOperation:"MT_FIRST"}),pixelSize:s.pixelSize,f:"json"},c=this;return this._computeHistogram(i,u,t,n),o.promise},_getSuitabilityAnalysis:function(){this._debug("Fetcher >>> _getSuitabilityAnalysis");var e=new r,t=s.suitability;return l.renderSuitabilityContainer(t),c.getSuitabilityData().then(function(r){l.renderSuitabilityData(t,r),c.getCompositionAnalysis().then(function(t){l.renderSuitabilityCompositionChart(t),e.resolve(!0)})}),e.promise},_getMillPointAnalysis:function(){function e(r){c.push(r),t=u.pop(),t?D["default"](t.point,t.name).then(e):(l.renderMillAssessment(c,a),i.resolve(!0))}this._debug("Fetcher >>> _getMillPointAnalysis");var t,n,i=new r,a=s.millPoints,u=[],c=[];return l.renderMillContainer(a),o.forEach(report.mills,function(e){if("circle"===e.type){var t=new b(e.geometry),r=t&&t.getExtent();n=r&&r.getCenter()}else n=new _(e.point.geometry);n&&u.push({point:n,name:e.label})}),t=u.pop(),D["default"](t.point,t.name).then(e),i.promise},_getFireAlertAnalysis:function(){this._debug("Fetcher >>> _getFireAlertAnalysis");var e,t,o,i,a=new r,u=new b(report.geometry),c=new Date,d="";return t=new m,i=new y(s.fires.url+"/4"),t.geometry=u,t.returnGeometry=!1,t.outFields=["*"],t.where="1 = 1",o=new y("http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0"),e=new m,e.geometry=u,e.returnGeometry=!1,e.outFields=["moratorium"],c.setDate(c.getDate()-8),d=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds(),e.where="ACQ_DATE > date '"+d+"'",n([i.execute(t),o.execute(e)]).then(function(e){l.renderFireData(z,e),a.resolve(!0)}),i.on("error",function(){a.resolve(!1)}),a.promise},_getClearanceBounds:function(){this._debug("Fetcher >>> _getClearanceBounds");
var e,t,n=s.clearanceBounds,o=new r,i=0;return t=f({url:n.url,content:{f:"pjson"},handleAs:"json",callbackParamName:"callback"}),t.then(function(t){report.clearanceBounds=[t.minValues[0],t.maxValues[0]],report.clearanceLabels=[];for(var r=t.minValues[0],a=t.maxValues[0];a>=r;r++)e=r%12===0?12:r%12,report.clearanceLabels.push(e+"-"+(n.baseYearLabel+i)),r%12===0&&++i;o.resolve(!0)},function(e){o.resolve(!1,e)}),o.promise},_getEncodingFunction:function(e,t,r){return{A:arrayFromBounds(e),B:arrayFromBounds(t),getSimpleRule:function(e,t){return JSON.stringify({rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:e,Raster2:t,Operation:3}})},renderRule:function(e,t){return{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[this.A[0],this.A[this.A.length-1]+1],OutputValues:[this.B.length],Raster:e,AllowUnmatched:!1}},Raster2:e,Operation:3}},Raster2:t,Operation:1}}},render:function(e,t){return JSON.stringify(this.renderRule(e,t))},encode:function(e,t){return this.B.length*e+t},decode:function(e){var t=e%this.B.length,r=(e-t)/this.B.length;return[r,t]}}},_computeHistogram:function(e,t,r,n){var o=f({url:e+"/computeHistograms",content:t,handleAs:"json",callbackParamName:"callback",timeout:6e4},{usePost:!0});o.then(r,n)},_debug:function(e){console.log(e)}}}),define("report/Generator",["dojo/on","dojo/dom","dojo/query","esri/config","dojo/request/xhr","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/promise/all","dojo/_base/array","dijit/Dialog","dojox/validate/web","esri/geometry/Point","esri/geometry/Polygon","esri/SpatialReference","esri/tasks/GeometryService","esri/geometry/geometryEngine","esri/geometry/webMercatorUtils","utils/Analytics","lodash","report/config","report/Fetcher","report/CSVExporter","esri/units","esri/geometry/Circle"],function(e,t,r,n,o,i,a,s,l,u,c,d,p,f,m,g,h,y,v,b,_,S,R,A,w){return window.report={},{init:function(){window.payload&&(this.addConfigurations(),this.prepareForAnalysis(),this.addContentAndEvents())},addConfigurations:function(){u.forEach(_.corsEnabledServers,function(e){n.defaults.io.corsEnabledServers.push(e)}),Highcharts.setOptions({chart:{style:{fontFamily:"Fira Sans', 'fira_sans_otregular', Georgia, serif"}}})},addContentAndEvents:function(){var e=report.mills&&report.mills.length>1?"Selected mills":window.payload.title;this.setTitle(e),this.setupHeader(),this.addSubscriptionDialog(),this.addCSVOptionToHighcharts()},setTitle:function(e){document.getElementById("title").innerHTML=e},setupHeader:function(){var r=t.byId("total-area-info-icon");e(r,"click",function(e){a.remove("total-area-info-popup","hidden")}),r=t.byId("total-area-close-info-icon"),e(r,"click",function(e){a.add("total-area-info-popup","hidden")})},addSubscriptionDialog:function(){var r=new c({title:"Subscribe to Alerts!",style:"width: 300px;"}),n=this,o="<div class='subscription-content'><div class='checkbox-container'><label><input id='fires_check' type='checkbox' value='fires' />Fire Alerts</label></div><div class='email-container'><input id='user-email' type='text' placeholder='something@gmail.com'/></div><div class='submit-container'><button id='subscribe-now'>Subscribe</button></div><div id='form-response' class='message-container'></div></div>";r.setContent(o),e(t.byId("subscribeToAlerts"),"click",function(){r.show()}),e(t.byId("subscribe-now"),"click",function(){n.subscribeToAlerts()})},addCSVOptionToHighcharts:function(){function e(){var e,t,r=document.getElementById("title").innerHTML,n=this,o=n.options.chart.type,i="\r\n",a=[];a.push("column"===o?"RSPO Land Use Change Analysis":n.title.textStr),a.push(r),"bar"===o&&n.xAxis.length>1?(e=R.exportCompositionAnalysis(n),a=a.concat(e)):"pie"===o?(e=R.exportSuitabilityByLegalClass(n),a=a.concat(e)):(e=R.exportSimpleChartAnalysis(n),a=a.concat(e)),a.length>1&&(t=a.join(i)),t&&R.exportCSV(t);var s="column"===o?"RSPO Land Use Change Analysis":n.title.textStr;v.sendEvent("Event","Download CSV",s)}Highcharts.getOptions().exporting.buttons.contextButton.menuItems.push({text:"Download CSV",onclick:e})},prepareForAnalysis:function(){var e,t,r,n=this,o=new g(_.geometryServiceUrl),i=new m(102100);report.suitable=window.payload.suitability,window.payload.minDensity&&(report.minDensity=window.payload.minDensity),report.datasets=window.payload.datasets;var a=JSON.parse(window.payload.geometry);if(1===a.length){var s=a[0];s.geometry.center&&!s.point?(report.geometry=new f(s.geometry),report.centerPoints=[{geometry:s.geometry.center}]):s.geometry.radius?(r=new f(i),r.addRing(s.geometry.rings[s.geometry.rings.length-1]),report.geometry=r,s.point.geometry.x?report.centerPoints=[s.point]:report.centerPoints=[{geometry:s.geometry.center}],s.geometry=report.geometry,report.mills=[s]):"polygon"===s.geometry.type&&(report.geometry=new f(s.geometry)),this.beginAnalysis()}else e=[],t=[],report.centerPoints=[],u.forEach(a,function(n){if(t.push(n.point),"polygon"===n.geometry.type&&(r=new f(n.geometry),e.push(r)),n.geometry.center){var o=b.clone(n);report.centerPoints.push(o),r=new f(i),r.addRing(n.geometry.rings[n.geometry.rings.length-1]),e.push(r),n.geometry=r}}),report.mills=a,o.union(e,function(e){r=new f(e),report.geometry=r,n.beginAnalysis()})},beginAnalysis:function(){function t(){o.length>0?(r=o.shift(),l(i._getDeferredsForItems(r)).then(t)):i.getFiresAnalysis()}var r,n,o=this._getArrayOfRequests(),i=this;if(report.geometry=h.simplify(report.geometry),n=h.planarArea(report.geometry)/1e4,n>5e6){var a=$("#warning-popup"),s=$("#warning-popup-content");s.html(_.messages.largeAreaWarning),a.toggleClass("hidden"),e.once($("#warning-popup-close-icon"),"click",function(){s.html(""),a.toggleClass("hidden")}),report.mapGeometry=report.geometry,report.geometry=h.generalize(report.geometry,2e3,!0)}else report.mapGeometry=report.geometry,report.geometry=h.generalize(report.geometry,200,!0);report.areaPromise=S.getAreaFromGeometry(report.geometry),report.areaPromise.then(function(e){document.getElementById("total-area").innerHTML=e?e:"Not Available"}),l([S._getClearanceBounds()]).then(function(){o.length<3?l(i._getDeferredsForItems(o)).then(i.getFiresAnalysis.bind(i)):(o=arrayChunk(o,3),t())})},getFiresAnalysis:function(){var e=this;l([S._getFireAlertAnalysis()]).then(e.analysisComplete)},analysisComplete:function(){S.setupMap(),a.remove("print","disabled"),e(t.byId("print"),"click",function(){s.set("total-area-info-popup","visibility","hidden"),window.print()}),r(".loader-wheel").forEach(function(e){"total-area"!==e.parentNode.id&&"print-map"!==e.parentNode.id&&(e.parentNode.innerHTML="There was an error getting these results at this time.")})},_getArrayOfRequests:function(){var e=[];for(var t in report.datasets)report.datasets[t]&&e.push(t);return e},_getDeferredsForItems:function(e){var t=[];return u.forEach(e,function(e){switch(e){case"suit":t.push(S._getSuitabilityAnalysis());break;case"mill":t.push(S._getMillPointAnalysis());break;case"carbon":t.push(S.getCarbonStocksResults());break;case"plantationsSpeciesLayer":t.push(S.getPlantationsSpeciesResults());break;case"plantationsTypeLayer":t.push(S.getPlantationsTypeResults());break;case"biomes":t.push(S.getBrazilBiomesResults());break;case"intact":t.push(S.getIntactForestResults());break;case"landCoverGlob":t.push(S.getLandCoverGlobalResults());break;case"landCoverAsia":t.push(S.getLandCoverAsiaResults());break;case"landCoverIndo":t.push(S.getLandCoverIndonesiaResults());break;case"legal":t.push(S.getLegalClassResults());break;case"peat":t.push(S.getPeatLandsResults());break;case"soy":t.push(S.getSoyResults());break;case"primForest":t.push(S.getPrimaryForestResults());break;case"protected":t.push(S.getProtectedAreaResults());break;case"rspo":t.push(S.getRSPOResults());break;case"treeDensity":t.push(S.getTreeCoverResults());break;case"treeCoverLoss":t.push(S.getTreeCoverLossResults());break;case"indonesiaMoratorium":t.push(S.getIndonesiaMoratoriumResults());break;case"prodes":t.push(S.getProdesResults());break;case"guyraAlerts":t.push(S.getGuyraResults())}}),t},subscribeToAlerts:function(){var e=(this.convertGeometryToGeometric(report.geometry),t.byId("user-email").value),r=t.byId("fires_check").checked,n=[],o={};return o.invalidEmail="You must provide a valid email in the form.",o.noSelection="You must select a checkbox from the form.",o.formaSuccess="Thank you for subscribing to Forma Alerts.  You should receive a confirmation email soon.",o.formaFail="There was an error with your request to subscribe to Forma alerts.  Please try again later.",o.fireSuccess="Thank you for subscribing to Fires Alerts.  You should receive a confirmation email soon.",o.fireFail="There was an error with your request to subscribe to Fires alerts.  Please try again later.",d.isEmailAddress(e)||n.push(o.invalidEmail),r||n.push(o.noSelection),n.length>0?void alert("Please fill in the following:\n"+n.join("\n")):(t.byId("form-response").innerHTML="<div class='loader-wheel subscribe'>subscribing</div>",void this.subscribeToFires(report.geometry,e).then(function(e){e?t.byId("form-response").innerHTML=o.fireSuccess:t.byId("form-response").innerHTML=o.fireFail}))},subscribeToForma:function(e,t){var r,n=_.alertUrl.forma,o=new i,a=new XMLHttpRequest,s=JSON.stringify({topic:"updates/forma",geom:'{"type": "'+e.type+'", "coordinates":['+JSON.stringify(e.geom)+"]}",email:t});return a.open("POST",n,!0),a.onreadystatechange=function(){4===a.readyState&&(r=JSON.parse(a.response),o.resolve(r.subscribe))},a.addEventListener("error",function(){o.resolve(!1)},!1),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(s),o.promise},subscribeToFires:function(e,t){var r=_.alertUrl.fires,n=new i,a={features:JSON.stringify({rings:e.rings,spatialReference:e.spatialReference}),msg_addr:t,msg_type:"email",area_name:payload.title};return o(r,{handleAs:"json",method:"POST",data:a}).then(function(){n.resolve(!0)},function(e){n.resolve(!1)}),n.promise},convertGeometryToGeometric:function(e){function t(e,t){var r=!1;return u.forEach(e,function(e){e[0]===t[0]&&e[1]===t[1]&&(r=!0)}),r}var r,n,o=new m({wkid:102100}),i=[],a=[];return u.forEach(e.rings,function(e){u.forEach(e,function(e){n=new p(e,o),r=y.xyToLngLat(n.x,n.y),t(a,r)?(a.push(r),i.push(a),a=[]):a.push(r)})}),{geom:i.length>1?i:i[0],type:i.length>1?"MultiPolygon":"Polygon"}}}}),function(){function e(e,t){var r,n,o;n=!1,r=document.createElement("script"),r.type="text/javascript",r.src=e,r.onload=r.onreadystatechange=function(){n||this.readyState&&"complete"!=this.readyState||(n=!0,t())},o=document.getElementsByTagName("script")[0],o.parentNode.insertBefore(r,o)}var t=function(e){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)};t("http://js.arcgis.com/3.16/esri/css/esri.css"),t("http://js.arcgis.com/3.16/dijit/themes/tundra/tundra.css"),t("app/css/report.css"),window.arrayFromBounds=function(e){var t=[],r=e[0],n=e[1];for(r;n>=r;r++)t.push(r);return t},window.arrayChunk=function(e,t){var r=[],n=0;for(n;n<e.length;n+=t)r.push(e.slice(n,n+t));return r},window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}(),require(["report/Generator"],function(t){var r=!1;e("http://code.highcharts.com/highcharts.js",function(){e("http://code.highcharts.com/modules/exporting.js",function(){localStorage?(window.payload=JSON.parse(localStorage.getItem("payload")),window.payload&&(r=!0)):window.payload&&(r=!0),r?t.init():(document.addEventListener("PayloadReady",function(){r=!0}),setTimeout(function(){r&&window.payload?t.init():alert("There was an error generating the report at this time.  Please make sure your pop-up blocker is disabled and try again.")},5e3))})})})}(),define("app/js/report/reportBundle",function(){});