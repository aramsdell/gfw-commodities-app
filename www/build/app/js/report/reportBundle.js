/**
 * @license
 * lodash 3.8.0 (Custom Build) lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
 * Build: `lodash modern -o ./lodash.js`
 */

define("utils/Analytics",[],function(){"use strict";return{sendEvent:function(e,t,r,n){var o={hitType:"event",eventCategory:e,eventAction:t,eventLabel:r,eventValue:n||1};ga&&(ga("A.send",o),ga("B.send",o),ga("C.send",o))},sendPageview:function(e,t){var r={hitType:"pageview"};e&&(r.page=e),t&&(r.title=t),ga&&(ga("A.send",r),ga("B.send",r),ga("C.send",r))}}}),define("report/config",[],function(){var e="http://gis-gfw.wri.org/arcgis/rest/services/Utilities/Geometry/GeometryServer",t="http://gis-gfw.wri.org/arcgis/rest/services/image_services/forma_500/ImageServer",r="http://gis-gfw.wri.org/arcgis/rest/services/image_services/glad_alerts_analysis/ImageServer/computeHistograms",n="http://gis-gfw.wri.org/arcgis/rest/services/image_services/analysis/ImageServer",o="http://gis-potico.wri.org/arcgis/rest/services/suitabilitymapper/kpss_mosaic/ImageServer",i="http://gis-potico.wri.org/arcgis/rest/services/Fires/Global_Fires/MapServer",a="http://www.wri.org/publication/how-identify-degraded-land-sustainable-palm-oil-indonesia",s="http://gis-gfw.wri.org/arcgis/rest/services/image_services/analysis_wm/ImageServer",l="http://gis.wri.org/arcgis/rest/services/CountryBoundaries/CountryBoundaries/MapServer/0",u=[1,14],c=[2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],d=[1,14],p=[2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],f=["#25941F","#25941F","#25941F","#25941F","#25941F","#25941F","#209F1F","#459F1F","#279F1F","#257F1F","#269F1F","#459F1F","#253F1F","#25941F","#25941F"],g=[1,14],h=[2e3,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],m=["#25941F","#25941F","#25941F","#25941F","#25941F","#25941F","#209F1F","#459F1F","#279F1F","#257F1F","#269F1F","#459F1F","#253F1F","#25941F","#25941F"],y=[1,4],v=["Large industrial plantation","Clearing/ very young plantation","Mosaic of medium-sized plantations","Mosaic of small-sized plantations"],b=["#FEBEBF","#874546","#FEBFE7","#8ACD6B"],_=[1,6],w=["Oil palm","Wood Fiber/Timber","Oil Palm Mix","Wood fiber/timber mix","Other","Recently cleared"],A=["#FD8081","#FEBEBF","#B6D6A1","#FFFD7E","#6E4786","#22C6FC"],S=["31 - 50%","51 - 74%","75 - 100%"],C=[1,3],R=["#ccf1a5","#859a59","#4b5923"],x=[0,3],F=["#87CEEB","#00AA00","#DD0000","#8A2BE2"],I=["Primary Degraded","Primary Intact"],k=[1,2],L=["#259F1F","#186513"],T=["Convertible Production Forest","Limited Production Forest","Non-forest","Production Forest","Protected Area"],E=[1,5],P=["rgb(230, 152, 0)","rgb(116, 196, 118)","rgb(255, 255, 190)","rgb(199, 233, 192)","rgb(35, 139, 69)"],B=["Moratorium area"],O=[0,1],N=["#5fc29a"],D=["Protected Area"],j=[0,1],z=["#296eaa"],H=["0-100","101 - 200","201 - 300","301 - 400","401 - 500","Greater than 500"],M=[1,6],$=["#fdffcc","#faeeb9","#f6ddaa","#f4ca99","#f1bc8b","#eca97a"],U=["Pampa","Caatinga","Cerrado","Amazônia","Mata Atlântica","Pantanal"],q=[0,5],G=["#4E7311","#A6FD7C","#C0E7AE","#76B276","#A3D3FD","#084E73"],J=["Intact Forest"],V=[0,1],W=["#186513"],Y=["Peat"],K=[0,1],Q=["#161D9C"],Z=["Agriculture","Mixed agriculture and forest","Secondary forest","Primary forest","Mixed forest and grassland","Grassland / shrub","Swamp","Settlements","Bare land","Water bodies","Snow / ice"],X=[1,11],ee=["#E0A828","#8BFB3B","#D4FEC0","#76B276","#B98D5A","#FFFEC1","#689AA7","#FCB7CB","#D3CE63","#77B5FC","#FFFFFF"],te=["Agriculture","Agroforestry","Fish pond","Grassland / Shrub","Mining","Oil Palm Plantation","Primary Forest","Rubber Plantation","Secondary Forest","Settlements","Swamp","Timber Plantation","Water Bodies"],re=[1,13],ne=["#d89827","#26fc79","#b1e3fc","#fdffb6","#000","#d89827","#5fa965","#eeb368","#c7ffb6","#fca0bf","#538996","#745b37","#65a2f8"],oe=["Agriculture","Estate crop plantation","Fish pond","Grassland / Shrub","Mining","Primary Forest","Secondary Forest","Settlements","Swamp","Timber Plantation","Water Bodies"],ie=[1,11],ae=["#d89827","#eeb368","#b1e3fc","#fdffb6","#000","#5fa965","#c7ffb6","#fca0bf","#538996","#745b37","#65a2f8"];return{corsEnabledServers:["http://gis-potico.wri.org","http://175.41.139.43","http://54.164.126.73","http://46.137.239.227","https://gfw-fires.wri.org","http://gis-gfw.wri.org"],urls:{imageService:"http://gis-gfw.wri.org/arcgis/rest/services/image_services/analysis/ImageServer"},messages:{largeAreaWarning:"The area for this analysis request is quite large and may take some time to process."},rasterFunctions:{range:{rasterFunction:"histogram16bit",outputPixelType:"U16",rasterFunctionArguments:{Rasters:["$529"]}},combination:{rasterFunction:"Combination",variableName:"AnalysisRaster",rasterFunctionArguments:{RasterRange:[1,140],Raster2Length:[4],Raster:{rasterFunction:"Combination",variableName:"AnalysisRaster",rasterFunctionArguments:{RasterRange:[1,14],Raster2Length:[10],Raster:"$530",Raster2:"$2"}},Raster2:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[946,946,947,947,948,948,949,949],OutputValues:[1,2,3,4],Raster:"$529",AllowUnmatched:!1},variableName:"Raster"}}}},boundariesUrl:l,geometryServiceUrl:e,imageServiceUrl:n,clearanceAnalysisUrl:s,printUrl:"http://gis-potico.wri.org/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task/execute",alertUrl:{forma:"http://gfw-apis.appspot.com/subscribe",fires:"https://gfw-fires.wri.org/subscribe_by_polygon"},millPointInfo:{concession:{title:"Concession Analysis",content:"A risk assessment for concession areas within a 50km sourcing radius of a palm oil mill."},radius:{title:"Radius Analysis",content:"A risk assessment for the entire area within a 50km sourcing radius around a palm oil mill."}},pixelSize:100,totalLoss:{rasterId:"$530",bounds:u,labels:c},prodesLayer:{rasterId:"$555",bounds:d,labels:p},gladLayer:{rasterId:"$1",bounds:g,labels:h,clearanceChart:{title:"Glaaaaad",type:"pie"},lcHistogram:{renderRule:{rasterFunction:"Local",rasterFunctionArguments:{Operation:67,Rasters:[{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,150,150,366],OutputValues:[0,1],Raster:"$1",AllowUnmatched:!1}},{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,20,20,366],OutputValues:[0,1],Raster:"$2",AllowUnmatched:!1}}]}}}},clearanceAlerts:{rasterId:"$17"},millPoints:{url:"http://api.risk-api.appspot.com/",title:"Palm Oil Mill Risk Assessment",rootNode:"millPoints"},suitability:{url:o,title:"Suitability",rootNode:"suitabilityAnalysis",rasterFunction:"PalmOilSuitability_Histogram",geometryType:"esriGeometryPolygon",lcHistogram:{renderRule:{rasterFunction:"lc_histogram",rasterFunctionArguments:{LCRaster:"$12",LCInpR:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8],LCOutV:[0,1,2,3,4,5,6,7,8]}},renderRuleSuitable:{rasterFunction:"classify_suitability",rasterFunctionArguments:{TargetRaster:"$12",InpTarget:[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8],OutVTarget:[0,1,2,3,4,5,6,7,8]}},classIndices:{convertible:[1],production:[2,4],other:[3]}},roadHisto:{mosaicRule:{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[14],ascending:!0,mosaicOperation:"MT_FIRST"},className:"ROAD_DISTANCE_KM"},concessions:{url:"http://gis-potico.wri.org/arcgis/rest/services/CommoditiesAnalyzer/moremaps2_EN/MapServer",layer:"10"},localRights:{content:"Local rights/interests:  Unknown.  To be determined through field assessments.",fieldAssessmentUrl:a,fieldAssessmentLabel:"Learn about field assessments."},chart:{title:"Suitability by Legal Classification",suitable:{color:"#461D7C",name:"Suitable",id:"donut-Suitable"},unsuitable:{color:"#FDD023",name:"Unsuitable",id:"donut-Unsuitable"},childrenLabels:["HP/HPT","HPK","APL"],childrenColors:["#74C476","#E69800","#FFFFBE"]}},clearanceBounds:{url:t,baseYearLabel:15},rspo:{rootNode:"rspoData",title:"RSPO Land Use Change Analysis",rasterId:"$5",bounds:x,lossBounds:[5,13],colors:F},primaryForest:{rootNode:"primaryForest",title:"Primary Forests - Indonesia",rasterId:"$519",formaId:"$11",bounds:k,labels:I,clearanceChart:{title:"Clearance Alerts in Primary Forests since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) in Primary Forests",removeBelowYear:2005},compositionAnalysis:{rasterId:519,histogramSlice:1},colors:L,fireKey:"primaryForest"},treeCover:{rootNode:"treeCoverDensity",title:"Tree Cover Density",rasterId:"$520",formaId:"$12",includeFormaIdInRemap:!0,rasterRemap:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[31,51,51,75,75,101],OutputValues:[1,2,3],Raster:"$520",AllowUnmatched:!1}},bounds:C,labels:S,clearanceChart:{title:"Clearance Alerts on Tree Cover Density since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Tree Cover Density"},compositionAnalysis:{title:"Tree Cover Density (30%-100%)",rasterId:520,histogramSlice:31},colors:R,fireKey:"treeCover",errors:{composition:"No Tree Cover Density greater than 30% detected in this area."}},treeCoverLoss:{rootNode:"treeCoverLoss",title:"Tree Cover Loss",rasterId:"$517",mosaicRule:{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[530],ascending:!0,mosaicOperation:"MT_FIRST"},lossChart:{title:"Annual Tree Cover Loss (in hectares)"},compositionAnalysis:{rasterId:530,histogramSlice:1},bounds:C,color:"#DB6598",labels:[]},legalClass:{rootNode:"legalClasses",title:"Legal Classifications",rasterId:"$7",bounds:E,labels:T,clearanceChart:{title:"Clearance Alerts on Legal Classifications since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Legal Classifications",removeBelowYear:2005},colors:P,fireKey:"legalClass"},indonesiaMoratorium:{rootNode:"indoMoratorium",title:"Indonesia Moratorium",rasterId:"$522",formaId:"$14",bounds:O,labels:B,clearanceChart:{title:"Clearance alerts on Moratorium Areas since Jan 2015",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Indonesia Moratorium",removeBelowYear:2011},colors:N,fireKey:"indonesiaMoratorium",compositionAnalysis:{rasterId:522,histogramSlice:1}},prodes:{rootNode:"prodes",title:"Prodes Deforestation",rasterId:"$555",bounds:d,labels:p,mosaicRule:{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[555],ascending:!0,mosaicOperation:"MT_FIRST"},clearanceChart:{title:"PRODES",type:"bar"},lossChart:{title:"PRODES"},colors:f,fireKey:"prodes",compositionAnalysis:{rasterId:555,histogramSlice:1}},glad:{rootNode:"glad",title:"GLAD Alerts",rasterId:["$1","$2"],url:r,bounds:g,labels:h,rasterFunction:"Local",rasterFunctionArguments:{Operation:67,Rasters:[{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,150,150,366],OutputValues:[0,1],Raster:"$1",AllowUnmatched:!1}},{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,20,20,366],OutputValues:[0,1],Raster:"$2",AllowUnmatched:!1}}]},colors:m,fireKey:"glad"},protectedArea:{rootNode:"protectedAreas",title:"Protected Areas",rasterId:"$10",bounds:j,labels:D,clearanceChart:{title:"Clearance Alerts on Protected Areas since Jan 2015",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Protected Areas"},compositionAnalysis:{rasterId:10,histogramSlice:1},colors:z,fireKey:"protectedArea",errors:{composition:"No protected areas detected in this area."}},carbonStock:{rootNode:"carbonStocks",title:"Aboveground Biomass Density",rasterId:"$560",bounds:M,labels:H,clearanceChart:{title:"Clearance Alerts on Aboveground Biomass Density since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Aboveground Biomass Density (Mg C /Ha)"},includeFormaIdInRemap:!0,formaId:"$28",rasterRemap:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[0,101,101,201,201,301,301,401,401,501,501,1e3],OutputValues:[1,2,3,4,5,6],Raster:"$560",AllowUnmatched:!1},outputPixelType:"U8"},colors:$,fireKey:"carbonStock"},plantationsTypeLayer:{rootNode:"plantationsTypeLayer",title:"Plantations by Type",rasterId:"$558",bounds:y,labels:v,clearanceChart:{title:"Plantations by Type",type:"pie"},lossChart:{title:"Plantations by Type"},colors:b,fireKey:"plantationsType"},plantationsSpeciesLayer:{rootNode:"plantationsSpeciesLayer",title:"Plantations by Species",rasterId:"$559",bounds:_,labels:w,clearanceChart:{title:"Plantations by Species",type:"pie"},lossChart:{title:"Plantations by Species"},colors:A,fireKey:"plantationsSpecies"},brazilBiomes:{rootNode:"brazilBiomes",title:"Brazil Biomes",rasterId:"$531",bounds:q,labels:U,clearanceChart:{title:"Clearance Alerts on Brazil Biomes since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Brazil Biomes (Mg C /Ha)",removeBelowYear:2004},formaId:"$21",colors:G,fireKey:"brazilBiomes"},intactForest:{rootNode:"intactForestLandscape",title:"Intact Forest Landscapes",rasterId:"$9",bounds:V,labels:J,clearanceChart:{title:"Clearance Alerts on Intact Forest Landscapes since Jan 2015",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Intact Forest Landscapes"},colors:W,fireKey:"intactForest",errors:{composition:"No intact forest landscapes data available in this area."}},peatLands:{rootNode:"peatLands",title:"Peat Lands",rasterId:"$8",bounds:K,labels:Y,clearanceChart:{title:"Clearance Alerts on Peat Lands since Jan 2015",type:"bar"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Peat Lands",removeBelowYear:2002},compositionAnalysis:{rasterId:8,histogramSlice:1},colors:Q,fireKey:"peatLands",errors:{composition:"Np peat land detected in this area according to indonesia peat data."}},landCoverGlobal:{rootNode:"globalLandCover",title:"Land Cover - Global",rasterId:"$544",bounds:X,labels:Z,clearanceChart:{title:"Clearance Alerts on Land Cover - Global since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Land Cover - Global",removeBelowYear:2004},formaId:"$22",colors:ee,fireKey:"landCoverGlobal"},landCoverAsia:{rootNode:"asiaLandCover",title:"Land Cover - Southeast Asia",rasterId:"$4",bounds:re,labels:te,clearanceChart:{title:"Clearance Alerts on Land Cover - Southeast Asia since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Land Cover - Southeast Asia",removeBelowYear:2005},colors:ne,fireKey:"landCoverAsia"},landCoverIndo:{rootNode:"indoLandCover",title:"Land Cover - Indonesia",rasterId:"$6",bounds:ie,labels:oe,clearanceChart:{title:"Clearance Alerts on Land Cover - Indonesia since Jan 2015",type:"pie"},lossChart:{title:"Annual Tree Cover Loss (in hectares) on Land Cover - Indonesia",removeBelowYear:2006},colors:ae,fireKey:"landCoverIndo"},fires:{url:i,primaryForest:{type:"pie",field:"primary_fo",labels:I,bounds:k,colors:L,title:"Active Fires in Primary Forests over the past 7 days",badgeDesc:"in primary forests out of"},treeCover:{type:"pie",field:"treecover",labels:S,bounds:[1,5],colors:R,title:"Active Fires by Tree Cover Density over the past 7 days",badgeDesc:"on tree cover density out of"},legalClass:{type:"pie",field:"legal",labels:T,bounds:E,colors:P,title:"Active Fires by Legal Classifications over the past 7 days",badgeDesc:"on legal classes out of"},carbonStock:{type:"pie",field:"carbon",labels:H,bounds:M,colors:$,title:"Active Fires by Aboveground Biomass Density over the past 7 days",badgeDesc:"on Aboveground Biomass Density out of"},plantationsTypeLayer:{type:"pie",field:"plantationsType",labels:v,bounds:y,colors:b,title:"Active Fires by Plantations (by Type) over the past 7 days",badgeDesc:"on fires by plantation out of"},plantationsSpeciesLayer:{type:"pie",field:"plantationsSpecies",labels:w,bounds:_,colors:A,title:"Active Fires by Plantations (by Species) over the past 7 days",badgeDesc:"on fires by plantation out of"},brazilBiomes:{type:"pie",field:"biomes",labels:U,bounds:q,colors:G,title:"Active Fires by Brazilian Biomes over the past 7 days",badgeDesc:"on Brazilian Biomes out of"},protectedArea:{type:"badge",field:"wdpa",badgeDesc:"in protected areas out of"},intactForest:{type:"badge",field:"ifl",badgeDesc:"on intact forest landscapes out of"},peatLands:{type:"badge",field:"peat",badgeDesc:"on peat lands out of"},landCoverGlobal:{type:"pie",field:"lc_global",labels:Z,bounds:X,colors:ee,title:"Active Fires by Land Cover - Global over the past 7 days",badgeDesc:"on land cover global out of"},landCoverAsia:{type:"pie",field:"lc_seasia",labels:te,bounds:re,colors:ne,title:"Active Fires by Land Cover - Southeast Asia over the past 7 days",badgeDesc:"on land cover southeast asia out of"},landCoverIndo:{type:"pie",field:"lc_ind",labels:oe,bounds:ie,colors:ae,title:"Active Fires by Land Cover - Indonesia over the past 7 days",badgeDesc:"on land cover indonesia out of"},indonesiaMoratorium:{type:"badge",field:"moratorium",badgeDesc:"on indonesia moratorium out of"},prodes:{type:"badge",field:"prodes",badgeDesc:"on Prodes out of"},plantationsType:{type:"badge",field:"plantationsType",badgeDesc:"on Plantations Type out of"},plantationsSpecies:{type:"badge",field:"plantationsSpecies",badgeDesc:"on Plantations Species out of"}}}}),function(){function e(e,t){if(e!==t){var r=e===e,n=t===t;if(e>t||!r||e===_&&n)return 1;if(t>e||!n||t===_&&r)return-1}return 0}function t(e,t,r){for(var n=e.length,o=r?n:-1;r?o--:++o<n;)if(t(e[o],o,e))return o;return-1}function r(e,t,r){if(t!==t)return p(e,r);r-=1;for(var n=e.length;++r<n;)if(e[r]===t)return r;return-1}function n(e){return"function"==typeof e||!1}function o(e){return"string"==typeof e?e:null==e?"":e+""}function i(e){return e.charCodeAt(0)}function a(e,t){for(var r=-1,n=e.length;++r<n&&-1<t.indexOf(e.charAt(r)););return r}function s(e,t){for(var r=e.length;r--&&-1<t.indexOf(e.charAt(r)););return r}function l(t,r){return e(t.a,r.a)||t.b-r.b}function u(e){return Ne[e]}function c(e){return De[e]}function d(e){return"\\"+He[e]}function p(e,t,r){var n=e.length;for(t+=r?0:-1;r?t--:++t<n;){var o=e[t];if(o!==o)return t}return-1}function f(e){return!!e&&"object"==typeof e}function g(e){return 160>=e&&e>=9&&13>=e||32==e||160==e||5760==e||6158==e||e>=8192&&(8202>=e||8232==e||8233==e||8239==e||8287==e||12288==e||65279==e)}function h(e,t){for(var r=-1,n=e.length,o=-1,i=[];++r<n;)e[r]===t&&(e[r]=z,i[++o]=r);return i}function m(e){for(var t=-1,r=e.length;++t<r&&g(e.charCodeAt(t)););return t}function y(e){for(var t=e.length;t--&&g(e.charCodeAt(t)););return t}function v(e){return je[e]}function b(g){function Ne(e){if(f(e)&&!(Pi(e)||e instanceof ze)){if(e instanceof je)return e;if(Yn.call(e,"__chain__")&&Yn.call(e,"__wrapped__"))return Dr(e)}return new je(e)}function De(){}function je(e,t,r){this.__wrapped__=e,this.__actions__=r||[],this.__chain__=!!t}function ze(e){this.__wrapped__=e,this.__actions__=null,this.__dir__=1,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=ko,this.__views__=null}function He(){this.__data__={}}function Me(e){var t=e?e.length:0;for(this.data={hash:bo(null),set:new co};t--;)this.push(e[t])}function $e(e,t){var r=e.data;return("string"==typeof t||dn(t)?r.set.has(t):r.hash[t])?0:-1}function Ue(e,t){var r=-1,n=e.length;for(t||(t=Bn(n));++r<n;)t[r]=e[r];return t}function qe(e,t){for(var r=-1,n=e.length;++r<n&&!1!==t(e[r],r,e););return e}function Ge(e,t){for(var r=-1,n=e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function We(e,t){for(var r=-1,n=e.length,o=-1,i=[];++r<n;){var a=e[r];t(a,r,e)&&(i[++o]=a)}return i}function Ye(e,t){for(var r=-1,n=e.length,o=Bn(n);++r<n;)o[r]=t(e[r],r,e);return o}function Ke(e,t,r,n){var o=-1,i=e.length;for(n&&i&&(r=e[++o]);++o<i;)r=t(r,e[o],o,e);return r}function Qe(e,t){for(var r=-1,n=e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function Ze(e,t){return e===_?t:e}function Xe(e,t,r,n){return e!==_&&Yn.call(n,r)?e:t}function et(e,t,r){var n=Gi(t);so.apply(n,Yo(t));for(var o=-1,i=n.length;++o<i;){var a=n[o],s=e[a],l=r(s,t[a],a,e,t);(l===l?l===s:s!==s)&&(s!==_||a in e)||(e[a]=l)}return e}function tt(e,t){for(var r=-1,n=null==e,o=!n&&Sr(e),i=o&&e.length,a=t.length,s=Bn(a);++r<a;){var l=t[r];s[r]=o?Cr(l,i)?e[l]:_:n?_:e[l]}return s}function rt(e,t,r){r||(r={});for(var n=-1,o=t.length;++n<o;){var i=t[n];r[i]=e[i]}return r}function nt(e,t,r){var n=typeof e;return"function"==n?t===_?e:jt(e,t,r):null==e?kn:"object"==n?bt(e):t===_?Pn(e):_t(e,t)}function ot(e,t,r,n,o,i,a){var s;if(r&&(s=o?r(e,n,o):r(e)),s!==_)return s;if(!dn(e))return e;if(n=Pi(e)){if(s=br(e),!t)return Ue(e,s)}else{var l=Qn.call(e),u=l==G;if(l!=V&&l!=H&&(!u||o))return Be[l]?wr(e,l,t):o?e:{};if(s=_r(u?{}:e),!t)return jo(s,e)}for(i||(i=[]),a||(a=[]),o=i.length;o--;)if(i[o]==e)return a[o];return i.push(e),a.push(s),(n?qe:pt)(e,function(n,o){s[o]=ot(n,t,r,o,e,i,a)}),s}function it(e,t,r){if("function"!=typeof e)throw new Un(j);return po(function(){e.apply(_,r)},t)}function at(e,t){var n=e?e.length:0,o=[];if(!n)return o;var i=-1,a=vr(),s=a==r,l=s&&200<=t.length?Go(t):null,u=t.length;l&&(a=$e,s=!1,t=l);e:for(;++i<n;)if(l=e[i],s&&l===l){for(var c=u;c--;)if(t[c]===l)continue e;o.push(l)}else 0>a(t,l,0)&&o.push(l);return o}function st(e,t){var r=!0;return Ho(e,function(e,n,o){return r=!!t(e,n,o)}),r}function lt(e,t){var r=[];return Ho(e,function(e,n,o){t(e,n,o)&&r.push(e)}),r}function ut(e,t,r,n){var o;return r(e,function(e,r,i){return t(e,r,i)?(o=n?r:e,!1):void 0}),o}function ct(e,t,r){for(var n=-1,o=e.length,i=-1,a=[];++n<o;){var s=e[n];if(f(s)&&Sr(s)&&(r||Pi(s)||ln(s))){t&&(s=ct(s,t,r));for(var l=-1,u=s.length;++l<u;)a[++i]=s[l]}else r||(a[++i]=s)}return a}function dt(e,t){$o(e,t,bn)}function pt(e,t){return $o(e,t,Gi)}function ft(e,t){return Uo(e,t,Gi)}function gt(e,t){for(var r=-1,n=t.length,o=-1,i=[];++r<n;){var a=t[r];Oi(e[a])&&(i[++o]=a)}return i}function ht(e,t,r){if(null!=e){r!==_&&r in Or(e)&&(t=[r]),r=-1;for(var n=t.length;null!=e&&++r<n;)e=e[t[r]];return r&&r==n?e:_}}function mt(e,t,r,n,o,i){if(e===t)return!0;var a=typeof e,s=typeof t;if("function"!=a&&"object"!=a&&"function"!=s&&"object"!=s||null==e||null==t)e=e!==e&&t!==t;else e:{var a=mt,s=Pi(e),l=Pi(t),u=M,c=M;s||(u=Qn.call(e),u==H?u=V:u!=V&&(s=mn(e))),l||(c=Qn.call(t),c==H?c=V:c!=V&&mn(t));var d=u==V,l=c==V,c=u==c;if(!c||s||d){if(!n&&(u=d&&Yn.call(e,"__wrapped__"),l=l&&Yn.call(t,"__wrapped__"),u||l)){e=a(u?e.value():e,l?t.value():t,r,n,o,i);break e}if(c){for(o||(o=[]),i||(i=[]),u=o.length;u--;)if(o[u]==e){e=i[u]==t;break e}o.push(e),i.push(t),e=(s?fr:hr)(e,t,a,r,n,o,i),o.pop(),i.pop()}else e=!1}else e=gr(e,t,u)}return e}function yt(e,t,r,n,o){for(var i=-1,a=t.length,s=!o;++i<a;)if(s&&n[i]?r[i]!==e[t[i]]:!(t[i]in e))return!1;for(i=-1;++i<a;){var l=t[i],u=e[l],c=r[i];if(s&&n[i]?l=u!==_||l in e:(l=o?o(u,c,l):_,l===_&&(l=mt(c,u,o,!0))),!l)return!1}return!0}function vt(e,t){var r=-1,n=Sr(e)?Bn(e.length):[];return Ho(e,function(e,o,i){n[++r]=t(e,o,i)}),n}function bt(e){var t=Gi(e),r=t.length;if(!r)return In(!0);if(1==r){var n=t[0],o=e[n];if(kr(o))return function(e){return null==e?!1:e[n]===o&&(o!==_||n in Or(e))}}for(var i=Bn(r),a=Bn(r);r--;)o=e[t[r]],i[r]=o,a[r]=kr(o);return function(e){return null!=e&&yt(Or(e),t,i,a)}}function _t(e,t){var r=Pi(e),n=xr(e)&&kr(t),o=e+"";return e=Nr(e),function(i){if(null==i)return!1;var a=o;if(i=Or(i),!(!r&&n||a in i)){if(i=1==e.length?i:ht(i,Ft(e,0,-1)),null==i)return!1;a=$r(e),i=Or(i)}return i[a]===t?t!==_||a in i:mt(t,i[a],null,!0)}}function wt(e,t,r,n,o){if(!dn(e))return e;var i=Sr(t)&&(Pi(t)||mn(t));if(!i){var a=Gi(t);so.apply(a,Yo(t))}return qe(a||t,function(s,l){if(a&&(l=s,s=t[l]),f(s)){n||(n=[]),o||(o=[]);e:{for(var u=l,c=n,d=o,p=c.length,g=t[u];p--;)if(c[p]==g){e[u]=d[p];break e}var p=e[u],h=r?r(p,g,u,e,t):_,m=h===_;m&&(h=g,Sr(g)&&(Pi(g)||mn(g))?h=Pi(p)?p:Sr(p)?Ue(p):[]:Ni(g)||ln(g)?h=ln(p)?yn(p):Ni(p)?p:{}:m=!1),c.push(g),d.push(h),m?e[u]=wt(h,g,r,c,d):(h===h?h!==p:p===p)&&(e[u]=h)}}else u=e[l],c=r?r(u,s,l,e,t):_,(d=c===_)&&(c=s),!i&&c===_||!d&&(c===c?c===u:u!==u)||(e[l]=c)}),e}function At(e){return function(t){return null==t?_:t[e]}}function St(e){var t=e+"";return e=Nr(e),function(r){return ht(r,e,t)}}function Ct(e,t){for(var r=e?t.length:0;r--;){var n=parseFloat(t[r]);if(n!=o&&Cr(n)){var o=n;fo.call(e,n,1)}}}function Rt(e,t){return e+oo(Fo()*(t-e+1))}function xt(e,t,r,n,o){return o(e,function(e,o,i){r=n?(n=!1,e):t(r,e,o,i)}),r}function Ft(e,t,r){var n=-1,o=e.length;for(t=null==t?0:+t||0,0>t&&(t=-t>o?0:o+t),r=r===_||r>o?o:+r||0,0>r&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0,r=Bn(o);++n<o;)r[n]=e[n+t];return r}function It(e,t){var r;return Ho(e,function(e,n,o){return r=t(e,n,o),!r}),!!r}function kt(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].c;return e}function Lt(t,r,n){var o=yr(),i=-1;return r=Ye(r,function(e){return o(e)}),t=vt(t,function(e){return{a:Ye(r,function(t){return t(e)}),b:++i,c:e}}),kt(t,function(t,r){var o;e:{o=-1;for(var i=t.a,a=r.a,s=i.length,l=n.length;++o<s;){var u=e(i[o],a[o]);if(u){o=l>o?u*(n[o]?1:-1):u;break e}}o=t.b-r.b}return o})}function Tt(e,t){var r=0;return Ho(e,function(e,n,o){r+=+t(e,n,o)||0}),r}function Et(e,t){var n=-1,o=vr(),i=e.length,a=o==r,s=a&&i>=200,l=s?Go():null,u=[];l?(o=$e,a=!1):(s=!1,l=t?[]:u);e:for(;++n<i;){var c=e[n],d=t?t(c,n,e):c;if(a&&c===c){for(var p=l.length;p--;)if(l[p]===d)continue e;t&&l.push(d),u.push(c)}else 0>o(l,d,0)&&((t||s)&&l.push(d),u.push(c))}return u}function Pt(e,t){for(var r=-1,n=t.length,o=Bn(n);++r<n;)o[r]=e[t[r]];return o}function Bt(e,t,r,n){for(var o=e.length,i=n?o:-1;(n?i--:++i<o)&&t(e[i],i,e););return r?Ft(e,n?0:i,n?i+1:o):Ft(e,n?i+1:0,n?o:i)}function Ot(e,t){var r=e;r instanceof ze&&(r=r.value());for(var n=-1,o=t.length;++n<o;){var r=[r],i=t[n];so.apply(r,i.args),r=i.func.apply(i.thisArg,r)}return r}function Nt(e,t,r){var n=0,o=e?e.length:n;if("number"==typeof t&&t===t&&Eo>=o){for(;o>n;){var i=n+o>>>1,a=e[i];(r?t>=a:t>a)?n=i+1:o=i}return o}return Dt(e,t,kn,r)}function Dt(e,t,r,n){t=r(t);for(var o=0,i=e?e.length:0,a=t!==t,s=t===_;i>o;){var l=oo((o+i)/2),u=r(e[l]),c=u===u;(a?c||n:s?c&&(n||u!==_):n?t>=u:t>u)?o=l+1:i=l}return So(i,To)}function jt(e,t,r){if("function"!=typeof e)return kn;if(t===_)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,o){return e.call(t,r,n,o)};case 4:return function(r,n,o,i){return e.call(t,r,n,o,i)};case 5:return function(r,n,o,i,a){return e.call(t,r,n,o,i,a)}}return function(){return e.apply(t,arguments)}}function zt(e){return to.call(e,0)}function Ht(e,t,r){for(var n=r.length,o=-1,i=Ao(e.length-n,0),a=-1,s=t.length,l=Bn(i+s);++a<s;)l[a]=t[a];for(;++o<n;)l[r[o]]=e[o];for(;i--;)l[a++]=e[o++];return l}function Mt(e,t,r){for(var n=-1,o=r.length,i=-1,a=Ao(e.length-o,0),s=-1,l=t.length,u=Bn(a+l);++i<a;)u[i]=e[i];for(a=i;++s<l;)u[a+s]=t[s];for(;++n<o;)u[a+r[n]]=e[i++];return u}function $t(e,t){return function(r,n,o){var i=t?t():{};if(n=yr(n,o,3),Pi(r)){o=-1;for(var a=r.length;++o<a;){var s=r[o];e(i,s,n(s,o,r),r)}}else Ho(r,function(t,r,o){e(i,t,n(t,r,o),o)});return i}}function Ut(e){return sn(function(t,r){var n=-1,o=null==t?0:r.length,i=o>2&&r[o-2],a=o>2&&r[2],s=o>1&&r[o-1];for("function"==typeof i?(i=jt(i,s,5),o-=2):(i="function"==typeof s?s:null,o-=i?1:0),a&&Rr(r[0],r[1],a)&&(i=3>o?null:i,o=1);++n<o;)(a=r[n])&&e(t,a,i);return t})}function qt(e,t){return function(r,n){var o=r?Wo(r):0;if(!Ir(o))return e(r,n);for(var i=t?o:-1,a=Or(r);(t?i--:++i<o)&&!1!==n(a[i],i,a););return r}}function Gt(e){return function(t,r,n){var o=Or(t);n=n(t);for(var i=n.length,a=e?i:-1;e?a--:++a<i;){var s=n[a];if(!1===r(o[s],s,o))break}return t}}function Jt(e,t){function r(){return(this&&this!==Je&&this instanceof r?n:e).apply(t,arguments)}var n=Wt(e);return r}function Vt(e){return function(t){var r=-1;t=xn(wn(t));for(var n=t.length,o="";++r<n;)o=e(o,t[r],r);return o}}function Wt(e){return function(){var t=zo(e.prototype),r=e.apply(t,arguments);return dn(r)?r:t}}function Yt(e){function t(r,n,o){return o&&Rr(r,n,o)&&(n=null),r=pr(r,e,null,null,null,null,null,n),r.placeholder=t.placeholder,r}return t}function Kt(e,t){return function(r,n,o){o&&Rr(r,n,o)&&(n=null);var a=yr(),s=null==n;if(a===nt&&s||(s=!1,n=a(n,o,3)),s){if(n=Pi(r),n||!hn(r))return e(n?r:Br(r));n=i}return mr(r,n,t)}}function Qt(e,r){return function(n,o,i){return o=yr(o,i,3),Pi(n)?(o=t(n,o,r),o>-1?n[o]:_):ut(n,o,e)}}function Zt(e){return function(r,n,o){return r&&r.length?(n=yr(n,o,3),t(r,n,e)):-1}}function Xt(e){return function(t,r,n){return r=yr(r,n,3),ut(t,r,e,!0)}}function er(e){return function(){var t=arguments.length;if(!t)return function(){return arguments[0]};for(var r,n=e?t:-1,o=0,i=Bn(t);e?n--:++n<t;){var a=i[o++]=arguments[n];if("function"!=typeof a)throw new Un(j);var s=r?"":Vo(a);r="wrapper"==s?new je([]):r}for(n=r?-1:t;++n<t;)a=i[n],s=Vo(a),r=(o="wrapper"==s?Jo(a):null)&&Fr(o[0])&&o[1]==(k|R|F|L)&&!o[4].length&&1==o[9]?r[Vo(o[0])].apply(r,o[3]):1==a.length&&Fr(a)?r[s]():r.thru(a);return function(){var e=arguments;if(r&&1==e.length&&Pi(e[0]))return r.plant(e[0]).value();for(var n=0,e=i[n].apply(this,e);++n<t;)e=i[n].call(this,e);return e}}}function tr(e,t){return function(r,n,o){return"function"==typeof n&&o===_&&Pi(r)?e(r,n):t(r,jt(n,o,3))}}function rr(e){return function(t,r,n){return("function"!=typeof r||n!==_)&&(r=jt(r,n,3)),e(t,r,bn)}}function nr(e){return function(t,r,n){return("function"!=typeof r||n!==_)&&(r=jt(r,n,3)),e(t,r)}}function or(e){return function(t,r,n){var o={};return r=yr(r,n,3),pt(t,function(t,n,i){i=r(t,n,i),n=e?i:n,t=e?t:i,o[n]=t}),o}}function ir(e){return function(t,r,n){return t=o(t),(e?t:"")+ur(t,r,n)+(e?"":t)}}function ar(e){var t=sn(function(r,n){var o=h(n,t.placeholder);return pr(r,e,null,n,o)});return t}function sr(e,t){return function(r,n,o,i){var a=3>arguments.length;return"function"==typeof n&&i===_&&Pi(r)?e(r,n,o,a):xt(r,yr(n,i,4),o,a,t)}}function lr(e,t,r,n,o,i,a,s,l,u){function c(){for(var w=arguments.length,C=w,R=Bn(w);C--;)R[C]=arguments[C];if(n&&(R=Ht(R,n,o)),i&&(R=Mt(R,i,a)),g||y){var C=c.placeholder,x=h(R,C),w=w-x.length;if(u>w){var k=s?Ue(s):null,w=Ao(u-w,0),L=g?x:null,x=g?null:x,T=g?R:null,R=g?null:R;return t|=g?F:I,t&=~(g?I:F),m||(t&=~(A|S)),R=[e,t,r,T,L,R,x,k,l,w],k=lr.apply(_,R),Fr(e)&&Ko(k,R),k.placeholder=C,k}}if(C=p?r:this,f&&(e=C[b]),s)for(k=R.length,w=So(s.length,k),L=Ue(R);w--;)x=s[w],R[w]=Cr(x,k)?L[x]:_;return d&&l<R.length&&(R.length=l),(this&&this!==Je&&this instanceof c?v||Wt(e):e).apply(C,R)}var d=t&k,p=t&A,f=t&S,g=t&R,m=t&C,y=t&x,v=!f&&Wt(e),b=e;return c}function ur(e,t,r){return e=e.length,t=+t,t>e&&_o(t)?(t-=e,r=null==r?" ":r+"",Cn(r,ro(t/r.length)).slice(0,t)):""}function cr(e,t,r,n){function o(){for(var t=-1,s=arguments.length,l=-1,u=n.length,c=Bn(s+u);++l<u;)c[l]=n[l];for(;s--;)c[l++]=arguments[++t];return(this&&this!==Je&&this instanceof o?a:e).apply(i?r:this,c)}var i=t&A,a=Wt(e);return o}function dr(e){return function(t,r,n,o){var i=yr(n);return i===nt&&null==n?Nt(t,r,e):Dt(t,r,i(n,o,1),e)}}function pr(e,t,r,n,o,i,a,s){var l=t&S;if(!l&&"function"!=typeof e)throw new Un(j);var u=n?n.length:0;if(u||(t&=~(F|I),n=o=null),u-=o?o.length:0,t&I){var c=n,d=o;n=o=null}var p=l?null:Jo(e);return r=[e,t,r,n,o,c,d,i,a,s],p&&(n=r[1],t=p[1],s=n|t,o=t==k&&n==R||t==k&&n==L&&r[7].length<=p[8]||t==(k|L)&&n==R,(k>s||o)&&(t&A&&(r[2]=p[2],s|=n&A?0:C),(n=p[3])&&(o=r[3],r[3]=o?Ht(o,n,p[4]):Ue(n),r[4]=o?h(r[3],z):Ue(p[4])),(n=p[5])&&(o=r[5],r[5]=o?Mt(o,n,p[6]):Ue(n),r[6]=o?h(r[5],z):Ue(p[6])),(n=p[7])&&(r[7]=Ue(n)),t&k&&(r[8]=null==r[8]?p[8]:So(r[8],p[8])),null==r[9]&&(r[9]=p[9]),r[0]=p[0],r[1]=s),t=r[1],s=r[9]),r[9]=null==s?l?0:e.length:Ao(s-u,0)||0,(p?qo:Ko)(t==A?Jt(r[0],r[2]):t!=F&&t!=(A|F)||r[4].length?lr.apply(_,r):cr.apply(_,r),r)}function fr(e,t,r,n,o,i,a){var s=-1,l=e.length,u=t.length,c=!0;if(l!=u&&(!o||l>=u))return!1;for(;c&&++s<l;){var d=e[s],p=t[s],c=_;if(n&&(c=o?n(p,d,s):n(d,p,s)),c===_)if(o)for(var f=u;f--&&(p=t[f],!(c=d&&d===p||r(d,p,n,o,i,a))););else c=d&&d===p||r(d,p,n,o,i,a)}return!!c}function gr(e,t,r){switch(r){case $:case U:return+e==+t;case q:return e.name==t.name&&e.message==t.message;case J:return e!=+e?t!=+t:e==+t;case W:case Y:return e==t+""}return!1}function hr(e,t,r,n,o,i,a){var s=Gi(e),l=s.length,u=Gi(t).length;if(l!=u&&!o)return!1;for(var u=o,c=-1;++c<l;){var d=s[c],p=o?d in t:Yn.call(t,d);if(p){var f=e[d],g=t[d],p=_;n&&(p=o?n(g,f,d):n(f,g,d)),p===_&&(p=f&&f===g||r(f,g,n,o,i,a))}if(!p)return!1;u||(u="constructor"==d)}return u||(r=e.constructor,n=t.constructor,!(r!=n&&"constructor"in e&&"constructor"in t)||"function"==typeof r&&r instanceof r&&"function"==typeof n&&n instanceof n)?!0:!1;
}function mr(e,t,r){var n=r?ko:Io,o=n,i=o;return Ho(e,function(e,a,s){a=t(e,a,s),((r?o>a:a>o)||a===n&&a===i)&&(o=a,i=e)}),i}function yr(e,t,r){var n=Ne.callback||Fn,n=n===Fn?nt:n;return r?n(e,t,r):n}function vr(e,t,n){var o=Ne.indexOf||Mr,o=o===Mr?r:o;return e?o(e,t,n):o}function br(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Yn.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function _r(e){return e=e.constructor,"function"==typeof e&&e instanceof e||(e=Hn),new e}function wr(e,t,r){var n=e.constructor;switch(t){case K:return zt(e);case $:case U:return new n(+e);case Q:case Z:case X:case ee:case te:case re:case ne:case oe:case ie:return t=e.buffer,new n(r?zt(t):t,e.byteOffset,e.length);case J:case Y:return new n(e);case W:var o=new n(e.source,Ce.exec(e));o.lastIndex=e.lastIndex}return o}function Ar(e,t,r){return null==e||xr(t,e)||(t=Nr(t),e=1==t.length?e:ht(e,Ft(t,0,-1)),t=$r(t)),t=null==e?e:e[t],null==t?_:t.apply(e,r)}function Sr(e){return null!=e&&Ir(Wo(e))}function Cr(e,t){return e=+e,t=null==t?Bo:t,e>-1&&0==e%1&&t>e}function Rr(e,t,r){if(!dn(r))return!1;var n=typeof t;return("number"==n?Sr(r)&&Cr(t,r.length):"string"==n&&t in r)?(t=r[t],e===e?e===t:t!==t):!1}function xr(e,t){var r=typeof e;return"string"==r&&ye.test(e)||"number"==r?!0:Pi(e)?!1:!me.test(e)||null!=t&&e in Or(t)}function Fr(e){var t=Vo(e);return!!t&&e===Ne[t]&&t in ze.prototype}function Ir(e){return"number"==typeof e&&e>-1&&0==e%1&&Bo>=e}function kr(e){return e===e&&!dn(e)}function Lr(e,t){e=Or(e);for(var r=-1,n=t.length,o={};++r<n;){var i=t[r];i in e&&(o[i]=e[i])}return o}function Tr(e,t){var r={};return dt(e,function(e,n,o){t(e,n,o)&&(r[n]=e)}),r}function Er(e){var t;if(!f(e)||Qn.call(e)!=V||!(Yn.call(e,"constructor")||(t=e.constructor,"function"!=typeof t||t instanceof t)))return!1;var r;return dt(e,function(e,t){r=t}),r===_||Yn.call(e,r)}function Pr(e){for(var t=bn(e),r=t.length,n=r&&e.length,o=Ne.support,o=n&&Ir(n)&&(Pi(e)||o.nonEnumArgs&&ln(e)),i=-1,a=[];++i<r;){var s=t[i];(o&&Cr(s,n)||Yn.call(e,s))&&a.push(s)}return a}function Br(e){return null==e?[]:Sr(e)?dn(e)?e:Hn(e):_n(e)}function Or(e){return dn(e)?e:Hn(e)}function Nr(e){if(Pi(e))return e;var t=[];return o(e).replace(ve,function(e,r,n,o){t.push(n?o.replace(Ae,"$1"):r||e)}),t}function Dr(e){return e instanceof ze?e.clone():new je(e.__wrapped__,e.__chain__,Ue(e.__actions__))}function jr(e,t,r){return e&&e.length?((r?Rr(e,t,r):null==t)&&(t=1),Ft(e,0>t?0:t)):[]}function zr(e,t,r){var n=e?e.length:0;return n?((r?Rr(e,t,r):null==t)&&(t=1),t=n-(+t||0),Ft(e,0,0>t?0:t)):[]}function Hr(e){return e?e[0]:_}function Mr(e,t,n){var o=e?e.length:0;if(!o)return-1;if("number"==typeof n)n=0>n?Ao(o+n,0):n;else if(n)return n=Nt(e,t),e=e[n],(t===t?t===e:e!==e)?n:-1;return r(e,t,n||0)}function $r(e){var t=e?e.length:0;return t?e[t-1]:_}function Ur(e){return jr(e,1)}function qr(e,t,n,o){if(!e||!e.length)return[];null!=t&&"boolean"!=typeof t&&(o=n,n=Rr(e,t,o)?null:t,t=!1);var i=yr();if((i!==nt||null!=n)&&(n=i(n,o,3)),t&&vr()==r){t=n;var a;n=-1,o=e.length;for(var i=-1,s=[];++n<o;){var l=e[n],u=t?t(l,n,e):l;n&&a===u||(a=u,s[++i]=l)}e=s}else e=Et(e,n);return e}function Gr(e){if(!e||!e.length)return[];var t=-1,r=0;e=We(e,function(e){return Sr(e)?(r=Ao(e.length,r),!0):void 0});for(var n=Bn(r);++t<r;)n[t]=Ye(e,At(t));return n}function Jr(e,t,r){return e&&e.length?(e=Gr(e),null==t?e:(t=jt(t,r,4),Ye(e,function(e){return Ke(e,t,_,!0)}))):[]}function Vr(e,t){var r=-1,n=e?e.length:0,o={};for(!n||t||Pi(e[0])||(t=[]);++r<n;){var i=e[r];t?o[i]=t[r]:i&&(o[i[0]]=i[1])}return o}function Wr(e){return e=Ne(e),e.__chain__=!0,e}function Yr(e,t,r){return t.call(r,e)}function Kr(e,t,r){var n=Pi(e)?Ge:st;return r&&Rr(e,t,r)&&(t=null),("function"!=typeof t||r!==_)&&(t=yr(t,r,3)),n(e,t)}function Qr(e,t,r){var n=Pi(e)?We:lt;return t=yr(t,r,3),n(e,t)}function Zr(e,t,r,n){var o=e?Wo(e):0;return Ir(o)||(e=_n(e),o=e.length),o?(r="number"!=typeof r||n&&Rr(t,r,n)?0:0>r?Ao(o+r,0):r||0,"string"==typeof e||!Pi(e)&&hn(e)?o>r&&-1<e.indexOf(t,r):-1<vr(e,t,r)):!1}function Xr(e,t,r){var n=Pi(e)?Ye:vt;return t=yr(t,r,3),n(e,t)}function en(e,t,r){return(r?Rr(e,t,r):null==t)?(e=Br(e),t=e.length,t>0?e[Rt(0,t-1)]:_):(e=tn(e),e.length=So(0>t?0:+t||0,e.length),e)}function tn(e){e=Br(e);for(var t=-1,r=e.length,n=Bn(r);++t<r;){var o=Rt(0,t);t!=o&&(n[t]=n[o]),n[o]=e[t]}return n}function rn(e,t,r){var n=Pi(e)?Qe:It;return r&&Rr(e,t,r)&&(t=null),("function"!=typeof t||r!==_)&&(t=yr(t,r,3)),n(e,t)}function nn(e,t){var r;if("function"!=typeof t){if("function"!=typeof e)throw new Un(j);var n=e;e=t,t=n}return function(){return 0<--e&&(r=t.apply(this,arguments)),1>=e&&(t=null),r}}function on(e,t,r){function n(){var r=t-(_i()-u);0>=r||r>t?(s&&no(s),r=p,s=d=p=_,r&&(f=_i(),l=e.apply(c,a),d||s||(a=c=null))):d=po(n,r)}function o(){d&&no(d),s=d=p=_,(h||g!==t)&&(f=_i(),l=e.apply(c,a),d||s||(a=c=null))}function i(){if(a=arguments,u=_i(),c=this,p=h&&(d||!m),!1===g)var r=m&&!d;else{s||m||(f=u);var i=g-(u-f),y=0>=i||i>g;y?(s&&(s=no(s)),f=u,l=e.apply(c,a)):s||(s=po(o,i))}return y&&d?d=no(d):d||t===g||(d=po(n,t)),r&&(y=!0,l=e.apply(c,a)),!y||d||s||(a=c=null),l}var a,s,l,u,c,d,p,f=0,g=!1,h=!0;if("function"!=typeof e)throw new Un(j);if(t=0>t?0:+t||0,!0===r)var m=!0,h=!1;else dn(r)&&(m=r.leading,g="maxWait"in r&&Ao(+r.maxWait||0,t),h="trailing"in r?r.trailing:h);return i.cancel=function(){d&&no(d),s&&no(s),s=d=p=_},i}function an(e,t){function r(){var n=arguments,o=r.cache,i=t?t.apply(this,n):n[0];return o.has(i)?o.get(i):(n=e.apply(this,n),o.set(i,n),n)}if("function"!=typeof e||t&&"function"!=typeof t)throw new Un(j);return r.cache=new an.Cache,r}function sn(e,t){if("function"!=typeof e)throw new Un(j);return t=Ao(t===_?e.length-1:+t||0,0),function(){for(var r=arguments,n=-1,o=Ao(r.length-t,0),i=Bn(o);++n<o;)i[n]=r[t+n];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,r[0],i);case 2:return e.call(this,r[0],r[1],i)}for(o=Bn(t+1),n=-1;++n<t;)o[n]=r[n];return o[t]=i,e.apply(this,o)}}function ln(e){return f(e)&&Sr(e)&&Qn.call(e)==H}function un(e){return!!e&&1===e.nodeType&&f(e)&&-1<Qn.call(e).indexOf("Element")}function cn(e){return f(e)&&"string"==typeof e.message&&Qn.call(e)==q}function dn(e){var t=typeof e;return"function"==t||!!e&&"object"==t}function pn(e){return null==e?!1:Qn.call(e)==G?Xn.test(Wn.call(e)):f(e)&&xe.test(e)}function fn(e){return"number"==typeof e||f(e)&&Qn.call(e)==J}function gn(e){return f(e)&&Qn.call(e)==W}function hn(e){return"string"==typeof e||f(e)&&Qn.call(e)==Y}function mn(e){return f(e)&&Ir(e.length)&&!!Pe[Qn.call(e)]}function yn(e){return rt(e,bn(e))}function vn(e){return gt(e,bn(e))}function bn(e){if(null==e)return[];dn(e)||(e=Hn(e));for(var t=e.length,t=t&&Ir(t)&&(Pi(e)||Do.nonEnumArgs&&ln(e))&&t||0,r=e.constructor,n=-1,r="function"==typeof r&&r.prototype===e,o=Bn(t),i=t>0;++n<t;)o[n]=n+"";for(var a in e)i&&Cr(a,t)||"constructor"==a&&(r||!Yn.call(e,a))||o.push(a);return o}function _n(e){return Pt(e,Gi(e))}function wn(e){return(e=o(e))&&e.replace(Fe,u).replace(we,"")}function An(e){return(e=o(e))&&_e.test(e)?e.replace(be,"\\$&"):e}function Sn(e,t,r){return r&&Rr(e,t,r)&&(t=0),xo(e,t)}function Cn(e,t){var r="";if(e=o(e),t=+t,1>t||!e||!_o(t))return r;do t%2&&(r+=e),t=oo(t/2),e+=e;while(t);return r}function Rn(e,t,r){var n=e;return(e=o(e))?(r?Rr(n,t,r):null==t)?e.slice(m(e),y(e)+1):(t+="",e.slice(a(e,t),s(e,t)+1)):e}function xn(e,t,r){return r&&Rr(e,t,r)&&(t=null),e=o(e),e.match(t||Le)||[]}function Fn(e,t,r){return r&&Rr(e,t,r)&&(t=null),f(e)?Ln(e):nt(e,t)}function In(e){return function(){return e}}function kn(e){return e}function Ln(e){return bt(ot(e,!0))}function Tn(e,t,r){if(null==r){var n=dn(t),o=n&&Gi(t);((o=o&&o.length&&gt(t,o))?o.length:n)||(o=!1,r=t,t=e,e=this)}o||(o=gt(t,Gi(t)));var i=!0,n=-1,a=Oi(e),s=o.length;!1===r?i=!1:dn(r)&&"chain"in r&&(i=r.chain);for(;++n<s;){r=o[n];var l=t[r];e[r]=l,a&&(e.prototype[r]=function(t){return function(){var r=this.__chain__;if(i||r){var n=e(this.__wrapped__);return(n.__actions__=Ue(this.__actions__)).push({func:t,args:arguments,thisArg:e}),n.__chain__=r,n}return r=[this.value()],so.apply(r,arguments),t.apply(e,r)}}(l))}return e}function En(){}function Pn(e){return xr(e)?At(e):St(e)}g=g?Ve.defaults(Je.Object(),g,Ve.pick(Je,Ee)):Je;var Bn=g.Array,On=g.Date,Nn=g.Error,Dn=g.Function,jn=g.Math,zn=g.Number,Hn=g.Object,Mn=g.RegExp,$n=g.String,Un=g.TypeError,qn=Bn.prototype,Gn=Hn.prototype,Jn=$n.prototype,Vn=(Vn=g.window)&&Vn.document,Wn=Dn.prototype.toString,Yn=Gn.hasOwnProperty,Kn=0,Qn=Gn.toString,Zn=g._,Xn=Mn("^"+An(Qn).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),eo=pn(eo=g.ArrayBuffer)&&eo,to=pn(to=eo&&new eo(0).slice)&&to,ro=jn.ceil,no=g.clearTimeout,oo=jn.floor,io=pn(io=Hn.getOwnPropertySymbols)&&io,ao=pn(ao=Hn.getPrototypeOf)&&ao,so=qn.push,lo=pn(lo=Hn.preventExtensions)&&lo,uo=Gn.propertyIsEnumerable,co=pn(co=g.Set)&&co,po=g.setTimeout,fo=qn.splice,go=pn(go=g.Uint8Array)&&go,ho=pn(ho=g.WeakMap)&&ho,mo=function(){try{var e=pn(e=g.Float64Array)&&e,t=new e(new eo(10),0,1)&&e}catch(r){}return t}(),yo=function(){var e=lo&&pn(e=Hn.assign)&&e;try{if(e){var t=lo({1:0});t[0]=1}}catch(r){try{e(t,"xo")}catch(n){}return!t[1]&&e}return!1}(),vo=pn(vo=Bn.isArray)&&vo,bo=pn(bo=Hn.create)&&bo,_o=g.isFinite,wo=pn(wo=Hn.keys)&&wo,Ao=jn.max,So=jn.min,Co=pn(Co=On.now)&&Co,Ro=pn(Ro=zn.isFinite)&&Ro,xo=g.parseInt,Fo=jn.random,Io=zn.NEGATIVE_INFINITY,ko=zn.POSITIVE_INFINITY,Lo=jn.pow(2,32)-1,To=Lo-1,Eo=Lo>>>1,Po=mo?mo.BYTES_PER_ELEMENT:0,Bo=jn.pow(2,53)-1,Oo=ho&&new ho,No={},Do=Ne.support={};!function(e){function t(){this.x=e}var r=arguments,n=[];t.prototype={valueOf:e,y:e};for(var o in new t)n.push(o);Do.funcDecomp=/\bthis\b/.test(function(){return this}),Do.funcNames="string"==typeof Dn.name;try{Do.dom=11===Vn.createDocumentFragment().nodeType}catch(i){Do.dom=!1}try{Do.nonEnumArgs=!uo.call(r,1)}catch(a){Do.nonEnumArgs=!0}}(1,0),Ne.templateSettings={escape:fe,evaluate:ge,interpolate:he,variable:"",imports:{_:Ne}};var jo=yo||function(e,t){return null==t?e:rt(t,Yo(t),rt(t,Gi(t),e))},zo=function(){function e(){}return function(t){if(dn(t)){e.prototype=t;var r=new e;e.prototype=null}return r||g.Object()}}(),Ho=qt(pt),Mo=qt(ft,!0),$o=Gt(),Uo=Gt(!0),qo=Oo?function(e,t){return Oo.set(e,t),e}:kn;to||(zt=eo&&go?function(e){var t=e.byteLength,r=mo?oo(t/Po):0,n=r*Po,o=new eo(t);if(r){var i=new mo(o,0,r);i.set(new mo(e,0,r))}return t!=n&&(i=new go(o,n),i.set(new go(e,n))),o}:In(null));var Go=bo&&co?function(e){return new Me(e)}:In(null),Jo=Oo?function(e){return Oo.get(e)}:En,Vo=function(){return Do.funcNames?"constant"==In.name?At("name"):function(e){for(var t=e.name,r=No[t],n=r?r.length:0;n--;){var o=r[n],i=o.func;if(null==i||i==e)return o.name}return t}:In("")}(),Wo=At("length"),Yo=io?function(e){return io(Or(e))}:In([]),Ko=function(){var e=0,t=0;return function(r,n){var o=_i(),i=B-(o-t);if(t=o,i>0){if(++e>=P)return r}else e=0;return qo(r,n)}}(),Qo=sn(function(e,t){return Sr(e)?at(e,ct(t,!1,!0)):[]}),Zo=Zt(),Xo=Zt(!0),ei=sn(function(t,r){r=ct(r);var n=tt(t,r);return Ct(t,r.sort(e)),n}),ti=dr(),ri=dr(!0),ni=sn(function(e){return Et(ct(e,!1,!0))}),oi=sn(function(e,t){return Sr(e)?at(e,t):[]}),ii=sn(Gr),ai=sn(function(e){var t=e.length,r=e[t-2],n=e[t-1];return t>2&&"function"==typeof r?t-=2:(r=t>1&&"function"==typeof n?(--t,n):_,n=_),e.length=t,Jr(e,r,n)}),si=sn(function(e,t){return tt(e,ct(t))}),li=$t(function(e,t,r){Yn.call(e,r)?++e[r]:e[r]=1}),ui=Qt(Ho),ci=Qt(Mo,!0),di=tr(qe,Ho),pi=tr(function(e,t){for(var r=e.length;r--&&!1!==t(e[r],r,e););return e},Mo),fi=$t(function(e,t,r){Yn.call(e,r)?e[r].push(t):e[r]=[t]}),gi=$t(function(e,t,r){e[r]=t}),hi=sn(function(e,t,r){var n=-1,o="function"==typeof t,i=xr(t),a=Sr(e)?Bn(e.length):[];return Ho(e,function(e){var s=o?t:i&&null!=e&&e[t];a[++n]=s?s.apply(e,r):Ar(e,t,r)}),a}),mi=$t(function(e,t,r){e[r?0:1].push(t)},function(){return[[],[]]}),yi=sr(Ke,Ho),vi=sr(function(e,t,r,n){var o=e.length;for(n&&o&&(r=e[--o]);o--;)r=t(r,e[o],o,e);return r},Mo),bi=sn(function(e,t){if(null==e)return[];var r=t[2];return r&&Rr(t[0],t[1],r)&&(t.length=1),Lt(e,ct(t),[])}),_i=Co||function(){return(new On).getTime()},wi=sn(function(e,t,r){var n=A;if(r.length)var o=h(r,wi.placeholder),n=n|F;return pr(e,n,t,r,o)}),Ai=sn(function(e,t){t=t.length?ct(t):vn(e);for(var r=-1,n=t.length;++r<n;){var o=t[r];e[o]=pr(e[o],A,e)}return e}),Si=sn(function(e,t,r){var n=A|S;if(r.length)var o=h(r,Si.placeholder),n=n|F;return pr(t,n,e,r,o)}),Ci=Yt(R),Ri=Yt(x),xi=sn(function(e,t){return it(e,1,t)}),Fi=sn(function(e,t,r){return it(e,t,r)}),Ii=er(),ki=er(!0),Li=ar(F),Ti=ar(I),Ei=sn(function(e,t){return pr(e,L,null,null,null,ct(t))}),Pi=vo||function(e){return f(e)&&Ir(e.length)&&Qn.call(e)==M};Do.dom||(un=function(e){return!!e&&1===e.nodeType&&f(e)&&!Ni(e)});var Bi=Ro||function(e){return"number"==typeof e&&_o(e)},Oi=n(/x/)||go&&!n(go)?function(e){return Qn.call(e)==G}:n,Ni=ao?function(e){if(!e||Qn.call(e)!=V)return!1;var t=e.valueOf,r=pn(t)&&(r=ao(t))&&ao(r);return r?e==r||ao(e)==r:Er(e)}:Er,Di=Ut(function(e,t,r){return r?et(e,t,r):jo(e,t)}),ji=sn(function(e){var t=e[0];return null==t?t:(e.push(Ze),Di.apply(_,e))}),zi=Xt(pt),Hi=Xt(ft),Mi=rr($o),$i=rr(Uo),Ui=nr(pt),qi=nr(ft),Gi=wo?function(e){var t=null!=e&&e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&Sr(e)?Pr(e):dn(e)?wo(e):[]}:Pr,Ji=or(!0),Vi=or(),Wi=Ut(wt),Yi=sn(function(e,t){if(null==e)return{};if("function"!=typeof t[0])return t=Ye(ct(t),$n),Lr(e,at(bn(e),t));var r=jt(t[0],t[1],3);return Tr(e,function(e,t,n){return!r(e,t,n)})}),Ki=sn(function(e,t){return null==e?{}:"function"==typeof t[0]?Tr(e,jt(t[0],t[1],3)):Lr(e,ct(t))}),Qi=Vt(function(e,t,r){return t=t.toLowerCase(),e+(r?t.charAt(0).toUpperCase()+t.slice(1):t)}),Zi=Vt(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}),Xi=ir(),ea=ir(!0);8!=xo(Te+"08")&&(Sn=function(e,t,r){return(r?Rr(e,t,r):null==t)?t=0:t&&(t=+t),e=Rn(e),xo(e,t||(Re.test(e)?16:10))});var ta=Vt(function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}),ra=Vt(function(e,t,r){return e+(r?" ":"")+(t.charAt(0).toUpperCase()+t.slice(1))}),na=sn(function(e,t){try{return e.apply(_,t)}catch(r){return cn(r)?r:new Nn(r)}}),oa=sn(function(e,t){return function(r){return Ar(r,e,t)}}),ia=sn(function(e,t){return function(r){return Ar(e,r,t)}}),aa=Kt(function(e){for(var t=-1,r=e.length,n=Io;++t<r;){var o=e[t];o>n&&(n=o)}return n}),sa=Kt(function(e){for(var t=-1,r=e.length,n=ko;++t<r;){var o=e[t];n>o&&(n=o)}return n},!0);return Ne.prototype=De.prototype,je.prototype=zo(De.prototype),je.prototype.constructor=je,ze.prototype=zo(De.prototype),ze.prototype.constructor=ze,He.prototype["delete"]=function(e){return this.has(e)&&delete this.__data__[e]},He.prototype.get=function(e){return"__proto__"==e?_:this.__data__[e]},He.prototype.has=function(e){return"__proto__"!=e&&Yn.call(this.__data__,e)},He.prototype.set=function(e,t){return"__proto__"!=e&&(this.__data__[e]=t),this},Me.prototype.push=function(e){var t=this.data;"string"==typeof e||dn(e)?t.set.add(e):t.hash[e]=!0},an.Cache=He,Ne.after=function(e,t){if("function"!=typeof t){if("function"!=typeof e)throw new Un(j);var r=e;e=t,t=r}return e=_o(e=+e)?e:0,function(){return 1>--e?t.apply(this,arguments):void 0}},Ne.ary=function(e,t,r){return r&&Rr(e,t,r)&&(t=null),t=e&&null==t?e.length:Ao(+t||0,0),pr(e,k,null,null,null,null,t)},Ne.assign=Di,Ne.at=si,Ne.before=nn,Ne.bind=wi,Ne.bindAll=Ai,Ne.bindKey=Si,Ne.callback=Fn,Ne.chain=Wr,Ne.chunk=function(e,t,r){t=(r?Rr(e,t,r):null==t)?1:Ao(+t||1,1),r=0;for(var n=e?e.length:0,o=-1,i=Bn(ro(n/t));n>r;)i[++o]=Ft(e,r,r+=t);return i},Ne.compact=function(e){for(var t=-1,r=e?e.length:0,n=-1,o=[];++t<r;){var i=e[t];i&&(o[++n]=i)}return o},Ne.constant=In,Ne.countBy=li,Ne.create=function(e,t,r){var n=zo(e);return r&&Rr(e,t,r)&&(t=null),t?jo(n,t):n},Ne.curry=Ci,Ne.curryRight=Ri,Ne.debounce=on,Ne.defaults=ji,Ne.defer=xi,Ne.delay=Fi,Ne.difference=Qo,Ne.drop=jr,Ne.dropRight=zr,Ne.dropRightWhile=function(e,t,r){return e&&e.length?Bt(e,yr(t,r,3),!0,!0):[]},Ne.dropWhile=function(e,t,r){return e&&e.length?Bt(e,yr(t,r,3),!0):[]},Ne.fill=function(e,t,r,n){var o=e?e.length:0;if(!o)return[];for(r&&"number"!=typeof r&&Rr(e,t,r)&&(r=0,n=o),o=e.length,r=null==r?0:+r||0,0>r&&(r=-r>o?0:o+r),n=n===_||n>o?o:+n||0,0>n&&(n+=o),o=r>n?0:n>>>0,r>>>=0;o>r;)e[r++]=t;return e},Ne.filter=Qr,Ne.flatten=function(e,t,r){var n=e?e.length:0;return r&&Rr(e,t,r)&&(t=!1),n?ct(e,t):[]},Ne.flattenDeep=function(e){return e&&e.length?ct(e,!0):[]},Ne.flow=Ii,Ne.flowRight=ki,Ne.forEach=di,Ne.forEachRight=pi,Ne.forIn=Mi,Ne.forInRight=$i,Ne.forOwn=Ui,Ne.forOwnRight=qi,Ne.functions=vn,Ne.groupBy=fi,Ne.indexBy=gi,Ne.initial=function(e){return zr(e,1)},Ne.intersection=function(){for(var e=[],t=-1,n=arguments.length,o=[],i=vr(),a=i==r,s=[];++t<n;){var l=arguments[t];Sr(l)&&(e.push(l),o.push(a&&120<=l.length?Go(t&&l):null))}if(n=e.length,2>n)return s;var a=e[0],u=-1,c=a?a.length:0,d=o[0];e:for(;++u<c;)if(l=a[u],0>(d?$e(d,l):i(s,l,0))){for(t=n;--t;){var p=o[t];if(0>(p?$e(p,l):i(e[t],l,0)))continue e}d&&d.push(l),s.push(l)}return s},Ne.invert=function(e,t,r){r&&Rr(e,t,r)&&(t=null),r=-1;for(var n=Gi(e),o=n.length,i={};++r<o;){var a=n[r],s=e[a];t?Yn.call(i,s)?i[s].push(a):i[s]=[a]:i[s]=a}return i},Ne.invoke=hi,Ne.keys=Gi,Ne.keysIn=bn,Ne.map=Xr,Ne.mapKeys=Ji,Ne.mapValues=Vi,Ne.matches=Ln,Ne.matchesProperty=function(e,t){return _t(e,ot(t,!0))},Ne.memoize=an,Ne.merge=Wi,Ne.method=oa,Ne.methodOf=ia,Ne.mixin=Tn,Ne.negate=function(e){if("function"!=typeof e)throw new Un(j);return function(){return!e.apply(this,arguments)}},Ne.omit=Yi,Ne.once=function(e){return nn(2,e)},Ne.pairs=function(e){for(var t=-1,r=Gi(e),n=r.length,o=Bn(n);++t<n;){var i=r[t];o[t]=[i,e[i]]}return o},Ne.partial=Li,Ne.partialRight=Ti,Ne.partition=mi,Ne.pick=Ki,Ne.pluck=function(e,t){return Xr(e,Pn(t))},Ne.property=Pn,Ne.propertyOf=function(e){return function(t){return ht(e,Nr(t),t+"")}},Ne.pull=function(){var e=arguments,t=e[0];if(!t||!t.length)return t;for(var r=0,n=vr(),o=e.length;++r<o;)for(var i=0,a=e[r];-1<(i=n(t,a,i));)fo.call(t,i,1);return t},Ne.pullAt=ei,Ne.range=function(e,t,r){r&&Rr(e,t,r)&&(t=r=null),e=+e||0,r=null==r?1:+r||0,null==t?(t=e,e=0):t=+t||0;var n=-1;t=Ao(ro((t-e)/(r||1)),0);for(var o=Bn(t);++n<t;)o[n]=e,e+=r;return o},Ne.rearg=Ei,Ne.reject=function(e,t,r){var n=Pi(e)?We:lt;return t=yr(t,r,3),n(e,function(e,r,n){return!t(e,r,n)})},Ne.remove=function(e,t,r){var n=[];if(!e||!e.length)return n;var o=-1,i=[],a=e.length;for(t=yr(t,r,3);++o<a;)r=e[o],t(r,o,e)&&(n.push(r),i.push(o));return Ct(e,i),n},Ne.rest=Ur,Ne.restParam=sn,Ne.set=function(e,t,r){if(null==e)return e;var n=t+"";t=null!=e[n]||xr(t,e)?[n]:Nr(t);for(var n=-1,o=t.length,i=o-1,a=e;null!=a&&++n<o;){var s=t[n];dn(a)&&(n==i?a[s]=r:null==a[s]&&(a[s]=Cr(t[n+1])?[]:{})),a=a[s]}return e},Ne.shuffle=tn,Ne.slice=function(e,t,r){var n=e?e.length:0;return n?(r&&"number"!=typeof r&&Rr(e,t,r)&&(t=0,r=n),Ft(e,t,r)):[]},Ne.sortBy=function(e,t,r){if(null==e)return[];r&&Rr(e,t,r)&&(t=null);var n=-1;return t=yr(t,r,3),e=vt(e,function(e,r,o){return{a:t(e,r,o),b:++n,c:e}}),kt(e,l)},Ne.sortByAll=bi,Ne.sortByOrder=function(e,t,r,n){return null==e?[]:(n&&Rr(t,r,n)&&(r=null),Pi(t)||(t=null==t?[]:[t]),Pi(r)||(r=null==r?[]:[r]),Lt(e,t,r))},Ne.spread=function(e){if("function"!=typeof e)throw new Un(j);return function(t){return e.apply(this,t)}},Ne.take=function(e,t,r){return e&&e.length?((r?Rr(e,t,r):null==t)&&(t=1),Ft(e,0,0>t?0:t)):[]},Ne.takeRight=function(e,t,r){var n=e?e.length:0;return n?((r?Rr(e,t,r):null==t)&&(t=1),t=n-(+t||0),Ft(e,0>t?0:t)):[]},Ne.takeRightWhile=function(e,t,r){return e&&e.length?Bt(e,yr(t,r,3),!1,!0):[]},Ne.takeWhile=function(e,t,r){return e&&e.length?Bt(e,yr(t,r,3)):[]},Ne.tap=function(e,t,r){return t.call(r,e),e},Ne.throttle=function(e,t,r){var n=!0,o=!0;if("function"!=typeof e)throw new Un(j);return!1===r?n=!1:dn(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),Oe.leading=n,Oe.maxWait=+t,Oe.trailing=o,on(e,t,Oe)},Ne.thru=Yr,Ne.times=function(e,t,r){if(e=oo(e),1>e||!_o(e))return[];var n=-1,o=Bn(So(e,Lo));for(t=jt(t,r,1);++n<e;)Lo>n?o[n]=t(n):t(n);return o},Ne.toArray=function(e){var t=e?Wo(e):0;return Ir(t)?t?Ue(e):[]:_n(e)},Ne.toPlainObject=yn,Ne.transform=function(e,t,r,n){var o=Pi(e)||mn(e);return t=yr(t,n,4),null==r&&(o||dn(e)?(n=e.constructor,r=o?Pi(e)?new n:[]:zo(Oi(n)&&n.prototype)):r={}),(o?qe:pt)(e,function(e,n,o){return t(r,e,n,o)}),r},Ne.union=ni,Ne.uniq=qr,Ne.unzip=Gr,Ne.unzipWith=Jr,Ne.values=_n,Ne.valuesIn=function(e){return Pt(e,bn(e))},Ne.where=function(e,t){return Qr(e,bt(t))},Ne.without=oi,Ne.wrap=function(e,t){return t=null==t?kn:t,pr(t,F,null,[e],[])},Ne.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var r=arguments[e];if(Sr(r))var n=n?at(n,r).concat(at(r,n)):r}return n?Et(n):[]},Ne.zip=ii,Ne.zipObject=Vr,Ne.zipWith=ai,Ne.backflow=ki,Ne.collect=Xr,Ne.compose=ki,Ne.each=di,Ne.eachRight=pi,Ne.extend=Di,Ne.iteratee=Fn,Ne.methods=vn,Ne.object=Vr,Ne.select=Qr,Ne.tail=Ur,Ne.unique=qr,Tn(Ne,Ne),Ne.add=function(e,t){return(+e||0)+(+t||0)},Ne.attempt=na,Ne.camelCase=Qi,Ne.capitalize=function(e){return(e=o(e))&&e.charAt(0).toUpperCase()+e.slice(1)},Ne.clone=function(e,t,r,n){return t&&"boolean"!=typeof t&&Rr(e,t,r)?t=!1:"function"==typeof t&&(n=r,r=t,t=!1),r="function"==typeof r&&jt(r,n,1),ot(e,t,r)},Ne.cloneDeep=function(e,t,r){return t="function"==typeof t&&jt(t,r,1),ot(e,!0,t)},Ne.deburr=wn,Ne.endsWith=function(e,t,r){e=o(e),t+="";var n=e.length;return r=r===_?n:So(0>r?0:+r||0,n),r-=t.length,r>=0&&e.indexOf(t,r)==r},Ne.escape=function(e){return(e=o(e))&&pe.test(e)?e.replace(ce,c):e},Ne.escapeRegExp=An,Ne.every=Kr,Ne.find=ui,Ne.findIndex=Zo,Ne.findKey=zi,Ne.findLast=ci,Ne.findLastIndex=Xo,Ne.findLastKey=Hi,Ne.findWhere=function(e,t){return ui(e,bt(t))},Ne.first=Hr,Ne.get=function(e,t,r){return e=null==e?_:ht(e,Nr(t),t+""),e===_?r:e},Ne.has=function(e,t){if(null==e)return!1;var r=Yn.call(e,t);return r||xr(t)||(t=Nr(t),e=1==t.length?e:ht(e,Ft(t,0,-1)),t=$r(t),r=null!=e&&Yn.call(e,t)),r},Ne.identity=kn,Ne.includes=Zr,Ne.indexOf=Mr,Ne.inRange=function(e,t,r){return t=+t||0,"undefined"==typeof r?(r=t,t=0):r=+r||0,e>=So(t,r)&&e<Ao(t,r)},Ne.isArguments=ln,Ne.isArray=Pi,Ne.isBoolean=function(e){return!0===e||!1===e||f(e)&&Qn.call(e)==$},Ne.isDate=function(e){return f(e)&&Qn.call(e)==U},Ne.isElement=un,Ne.isEmpty=function(e){return null==e?!0:Sr(e)&&(Pi(e)||hn(e)||ln(e)||f(e)&&Oi(e.splice))?!e.length:!Gi(e).length},Ne.isEqual=function(e,t,r,n){return r="function"==typeof r&&jt(r,n,3),!r&&kr(e)&&kr(t)?e===t:(n=r?r(e,t):_,n===_?mt(e,t,r):!!n)},Ne.isError=cn,Ne.isFinite=Bi,Ne.isFunction=Oi,Ne.isMatch=function(e,t,r,n){var o=Gi(t),i=o.length;if(!i)return!0;if(null==e)return!1;if(r="function"==typeof r&&jt(r,n,3),e=Or(e),!r&&1==i){var a=o[0];if(n=t[a],kr(n))return n===e[a]&&(n!==_||a in e)}for(var a=Bn(i),s=Bn(i);i--;)n=a[i]=t[o[i]],s[i]=kr(n);return yt(e,o,a,s,r)},Ne.isNaN=function(e){return fn(e)&&e!=+e},Ne.isNative=pn,Ne.isNull=function(e){return null===e},Ne.isNumber=fn,Ne.isObject=dn,Ne.isPlainObject=Ni,Ne.isRegExp=gn,Ne.isString=hn,Ne.isTypedArray=mn,Ne.isUndefined=function(e){return e===_},Ne.kebabCase=Zi,Ne.last=$r,Ne.lastIndexOf=function(e,t,r){var n=e?e.length:0;if(!n)return-1;var o=n;if("number"==typeof r)o=(0>r?Ao(n+r,0):So(r||0,n-1))+1;else if(r)return o=Nt(e,t,!0)-1,e=e[o],(t===t?t===e:e!==e)?o:-1;if(t!==t)return p(e,o,!0);for(;o--;)if(e[o]===t)return o;return-1},Ne.max=aa,Ne.min=sa,Ne.noConflict=function(){return g._=Zn,this},Ne.noop=En,Ne.now=_i,Ne.pad=function(e,t,r){e=o(e),t=+t;var n=e.length;return t>n&&_o(t)?(n=(t-n)/2,t=oo(n),n=ro(n),r=ur("",n,r),r.slice(0,t)+e+r):e},Ne.padLeft=Xi,Ne.padRight=ea,Ne.parseInt=Sn,Ne.random=function(e,t,r){r&&Rr(e,t,r)&&(t=r=null);var n=null==e,o=null==t;return null==r&&(o&&"boolean"==typeof e?(r=e,e=1):"boolean"==typeof t&&(r=t,o=!0)),n&&o&&(t=1,o=!1),e=+e||0,o?(t=e,e=0):t=+t||0,r||e%1||t%1?(r=Fo(),So(e+r*(t-e+parseFloat("1e-"+((r+"").length-1))),t)):Rt(e,t)},Ne.reduce=yi,Ne.reduceRight=vi,Ne.repeat=Cn,Ne.result=function(e,t,r){var n=null==e?_:e[t];return n===_&&(null==e||xr(t,e)||(t=Nr(t),e=1==t.length?e:ht(e,Ft(t,0,-1)),n=null==e?_:e[$r(t)]),n=n===_?r:n),Oi(n)?n.call(e):n},Ne.runInContext=b,Ne.size=function(e){var t=e?Wo(e):0;return Ir(t)?t:Gi(e).length},Ne.snakeCase=ta,Ne.some=rn,Ne.sortedIndex=ti,Ne.sortedLastIndex=ri,Ne.startCase=ra,Ne.startsWith=function(e,t,r){return e=o(e),r=null==r?0:So(0>r?0:+r||0,e.length),e.lastIndexOf(t,r)==r},Ne.sum=function(e,t,r){r&&Rr(e,t,r)&&(t=null);var n=yr(),o=null==t;if(n===nt&&o||(o=!1,t=n(t,r,3)),o){for(e=Pi(e)?e:Br(e),t=e.length,r=0;t--;)r+=+e[t]||0;e=r}else e=Tt(e,t);return e},Ne.template=function(e,t,r){var n=Ne.templateSettings;r&&Rr(e,t,r)&&(t=r=null),e=o(e),t=et(jo({},r||t),n,Xe),r=et(jo({},t.imports),n.imports,Xe);var i,a,s=Gi(r),l=Pt(r,s),u=0;r=t.interpolate||Ie;var c="__p+='";r=Mn((t.escape||Ie).source+"|"+r.source+"|"+(r===he?Se:Ie).source+"|"+(t.evaluate||Ie).source+"|$","g");var p="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"";if(e.replace(r,function(t,r,n,o,s,l){return n||(n=o),c+=e.slice(u,l).replace(ke,d),r&&(i=!0,c+="'+__e("+r+")+'"),s&&(a=!0,c+="';"+s+";\n__p+='"),n&&(c+="'+((__t=("+n+"))==null?'':__t)+'"),u=l+t.length,t}),c+="';",(t=t.variable)||(c="with(obj){"+c+"}"),c=(a?c.replace(ae,""):c).replace(se,"$1").replace(le,"$1;"),c="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(i?",__e=_.escape":"")+(a?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+c+"return __p}",t=na(function(){return Dn(s,p+"return "+c).apply(_,l)}),t.source=c,cn(t))throw t;return t},Ne.trim=Rn,Ne.trimLeft=function(e,t,r){var n=e;return(e=o(e))?e.slice((r?Rr(n,t,r):null==t)?m(e):a(e,t+"")):e},Ne.trimRight=function(e,t,r){var n=e;return(e=o(e))?(r?Rr(n,t,r):null==t)?e.slice(0,y(e)+1):e.slice(0,s(e,t+"")+1):e},Ne.trunc=function(e,t,r){r&&Rr(e,t,r)&&(t=null);var n=T;if(r=E,null!=t)if(dn(t)){var i="separator"in t?t.separator:i,n="length"in t?+t.length||0:n;r="omission"in t?o(t.omission):r}else n=+t||0;if(e=o(e),n>=e.length)return e;if(n-=r.length,1>n)return r;if(t=e.slice(0,n),null==i)return t+r;if(gn(i)){if(e.slice(n).search(i)){var a,s=e.slice(0,n);for(i.global||(i=Mn(i.source,(Ce.exec(i)||"")+"g")),i.lastIndex=0;e=i.exec(s);)a=e.index;t=t.slice(0,null==a?n:a)}}else e.indexOf(i,n)!=n&&(i=t.lastIndexOf(i),i>-1&&(t=t.slice(0,i)));return t+r},Ne.unescape=function(e){return(e=o(e))&&de.test(e)?e.replace(ue,v):e},Ne.uniqueId=function(e){var t=++Kn;return o(e)+t},Ne.words=xn,Ne.all=Kr,Ne.any=rn,Ne.contains=Zr,Ne.detect=ui,Ne.foldl=yi,Ne.foldr=vi,Ne.head=Hr,Ne.include=Zr,Ne.inject=yi,Tn(Ne,function(){var e={};return pt(Ne,function(t,r){Ne.prototype[r]||(e[r]=t)}),e}(),!1),Ne.sample=en,Ne.prototype.sample=function(e){return this.__chain__||null!=e?this.thru(function(t){return en(t,e)}):en(this.value())},Ne.VERSION=w,qe("bind bindKey curry curryRight partial partialRight".split(" "),function(e){Ne[e].placeholder=Ne}),qe(["dropWhile","filter","map","takeWhile"],function(e,t){var r=t!=D,n=t==O;ze.prototype[e]=function(e,o){var i=this.__filtered__,a=i&&n?new ze(this):this.clone();return(a.__iteratees__||(a.__iteratees__=[])).push({done:!1,count:0,index:0,iteratee:yr(e,o,1),limit:-1,type:t}),a.__filtered__=i||r,a}}),qe(["drop","take"],function(e,t){var r=e+"While";ze.prototype[e]=function(r){var n=this.__filtered__,o=n&&!t?this.dropWhile():this.clone();return r=null==r?1:Ao(oo(r)||0,0),n?t?o.__takeCount__=So(o.__takeCount__,r):$r(o.__iteratees__).limit=r:(o.__views__||(o.__views__=[])).push({size:r,type:e+(0>o.__dir__?"Right":"")}),o},ze.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()},ze.prototype[e+"RightWhile"]=function(e,t){return this.reverse()[r](e,t).reverse()}}),qe(["first","last"],function(e,t){var r="take"+(t?"Right":"");ze.prototype[e]=function(){return this[r](1).value()[0]}}),qe(["initial","rest"],function(e,t){var r="drop"+(t?"":"Right");ze.prototype[e]=function(){return this[r](1)}}),qe(["pluck","where"],function(e,t){var r=t?"filter":"map",n=t?bt:Pn;ze.prototype[e]=function(e){return this[r](n(e))}}),ze.prototype.compact=function(){return this.filter(kn)},ze.prototype.reject=function(e,t){return e=yr(e,t,1),this.filter(function(t){return!e(t)})},ze.prototype.slice=function(e,t){e=null==e?0:+e||0;var r=this;return 0>e?r=this.takeRight(-e):e&&(r=this.drop(e)),t!==_&&(t=+t||0,r=0>t?r.dropRight(-t):r.take(t-e)),r},ze.prototype.toArray=function(){return this.drop(0)},pt(ze.prototype,function(e,t){var r=Ne[t];if(r){var n=/^(?:filter|map|reject)|While$/.test(t),o=/^(?:first|last)$/.test(t);Ne.prototype[t]=function(){function t(e){return e=[e],so.apply(e,i),r.apply(Ne,e)}var i=arguments,a=this.__chain__,s=this.__wrapped__,l=!!this.__actions__.length,u=s instanceof ze,c=i[0],d=u||Pi(s);return d&&n&&"function"==typeof c&&1!=c.length&&(u=d=!1),u=u&&!l,o&&!a?u?e.call(s):r.call(Ne,this.value()):d?(s=e.apply(u?s:new ze(this),i),o||!l&&!s.__actions__||(s.__actions__||(s.__actions__=[])).push({func:Yr,args:[t],thisArg:Ne}),new je(s,a)):this.thru(t)}}}),qe("concat join pop push replace shift sort splice split unshift".split(" "),function(e){var t=(/^(?:replace|split)$/.test(e)?Jn:qn)[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:join|pop|replace|shift)$/.test(e);Ne.prototype[e]=function(){var e=arguments;return n&&!this.__chain__?t.apply(this.value(),e):this[r](function(r){return t.apply(r,e)})}}),pt(ze.prototype,function(e,t){var r=Ne[t];if(r){var n=r.name;(No[n]||(No[n]=[])).push({name:t,func:r})}}),No[lr(null,S).name]=[{name:"wrapper",func:null}],ze.prototype.clone=function(){var e=this.__actions__,t=this.__iteratees__,r=this.__views__,n=new ze(this.__wrapped__);return n.__actions__=e?Ue(e):null,n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=t?Ue(t):null,n.__takeCount__=this.__takeCount__,n.__views__=r?Ue(r):null,n},ze.prototype.reverse=function(){if(this.__filtered__){var e=new ze(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e},ze.prototype.value=function(){var e=this.__wrapped__.value();if(!Pi(e))return Ot(e,this.__actions__);var t,r=this.__dir__,n=0>r;t=e.length;for(var o=this.__views__,i=0,a=-1,s=o?o.length:0;++a<s;){var l=o[a],u=l.size;switch(l.type){case"drop":i+=u;break;case"dropRight":t-=u;break;case"take":t=So(t,i+u);break;case"takeRight":i=Ao(i,t-u)}}t={start:i,end:t},o=t.start,i=t.end,t=i-o,o=n?i:o-1,i=So(t,this.__takeCount__),s=(a=this.__iteratees__)?a.length:0,l=0,u=[];e:for(;t--&&i>l;){for(var o=o+r,c=-1,d=e[o];++c<s;){var p=a[c],f=p.iteratee,g=p.type;if(g==O){if(p.done&&(n?o>p.index:o<p.index)&&(p.count=0,p.done=!1),p.index=o,!(p.done||(g=p.limit,p.done=g>-1?p.count++>=g:!f(d))))continue e}else if(p=f(d),g==D)d=p;else if(!p){if(g==N)continue e;break e}}u[l++]=d}return u},Ne.prototype.chain=function(){return Wr(this)},Ne.prototype.commit=function(){return new je(this.value(),this.__chain__)},Ne.prototype.plant=function(e){for(var t,r=this;r instanceof De;){var n=Dr(r);t?o.__wrapped__=n:t=n;var o=n,r=r.__wrapped__}return o.__wrapped__=e,t},Ne.prototype.reverse=function(){var e=this.__wrapped__;return e instanceof ze?(this.__actions__.length&&(e=new ze(this)),new je(e.reverse(),this.__chain__)):this.thru(function(e){return e.reverse()})},Ne.prototype.toString=function(){return this.value()+""},Ne.prototype.run=Ne.prototype.toJSON=Ne.prototype.valueOf=Ne.prototype.value=function(){return Ot(this.__wrapped__,this.__actions__)},Ne.prototype.collect=Ne.prototype.map,Ne.prototype.head=Ne.prototype.first,Ne.prototype.select=Ne.prototype.filter,Ne.prototype.tail=Ne.prototype.rest,Ne}var _,w="3.8.0",A=1,S=2,C=4,R=8,x=16,F=32,I=64,k=128,L=256,T=30,E="...",P=150,B=16,O=0,N=1,D=2,j="Expected a function",z="__lodash_placeholder__",H="[object Arguments]",M="[object Array]",$="[object Boolean]",U="[object Date]",q="[object Error]",G="[object Function]",J="[object Number]",V="[object Object]",W="[object RegExp]",Y="[object String]",K="[object ArrayBuffer]",Q="[object Float32Array]",Z="[object Float64Array]",X="[object Int8Array]",ee="[object Int16Array]",te="[object Int32Array]",re="[object Uint8Array]",ne="[object Uint8ClampedArray]",oe="[object Uint16Array]",ie="[object Uint32Array]",ae=/\b__p\+='';/g,se=/\b(__p\+=)''\+/g,le=/(__e\(.*?\)|\b__t\))\+'';/g,ue=/&(?:amp|lt|gt|quot|#39|#96);/g,ce=/[&<>"'`]/g,de=RegExp(ue.source),pe=RegExp(ce.source),fe=/<%-([\s\S]+?)%>/g,ge=/<%([\s\S]+?)%>/g,he=/<%=([\s\S]+?)%>/g,me=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,ye=/^\w*$/,ve=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,be=/[.*+?^${}()|[\]\/\\]/g,_e=RegExp(be.source),we=/[\u0300-\u036f\ufe20-\ufe23]/g,Ae=/\\(\\)?/g,Se=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ce=/\w*$/,Re=/^0[xX]/,xe=/^\[object .+?Constructor\]$/,Fe=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Ie=/($^)/,ke=/['\n\r\u2028\u2029\\]/g,Le=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?=[A-Z\\xc0-\\xd6\\xd8-\\xde][a-z\\xdf-\\xf6\\xf8-\\xff]+)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|[0-9]+","g"),Te=" 	\x0B\f \ufeff\n\r\u2028\u2029 ᠎             　",Ee="Array ArrayBuffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Math Number Object RegExp Set String _ clearTimeout document isFinite parseInt setTimeout TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap window".split(" "),Pe={};
Pe[Q]=Pe[Z]=Pe[X]=Pe[ee]=Pe[te]=Pe[re]=Pe[ne]=Pe[oe]=Pe[ie]=!0,Pe[H]=Pe[M]=Pe[K]=Pe[$]=Pe[U]=Pe[q]=Pe[G]=Pe["[object Map]"]=Pe[J]=Pe[V]=Pe[W]=Pe["[object Set]"]=Pe[Y]=Pe["[object WeakMap]"]=!1;var Be={};Be[H]=Be[M]=Be[K]=Be[$]=Be[U]=Be[Q]=Be[Z]=Be[X]=Be[ee]=Be[te]=Be[J]=Be[V]=Be[W]=Be[Y]=Be[re]=Be[ne]=Be[oe]=Be[ie]=!0,Be[q]=Be[G]=Be["[object Map]"]=Be["[object Set]"]=Be["[object WeakMap]"]=!1;var Oe={leading:!1,maxWait:0,trailing:!1},Ne={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},De={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},je={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},ze={"function":!0,object:!0},He={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Me=ze[typeof exports]&&exports&&!exports.nodeType&&exports,$e=ze[typeof module]&&module&&!module.nodeType&&module,Ue=ze[typeof self]&&self&&self.Object&&self,qe=ze[typeof window]&&window&&window.Object&&window,Ge=$e&&$e.exports===Me&&Me,Je=Me&&$e&&"object"==typeof global&&global&&global.Object&&global||qe!==(this&&this.window)&&qe||Ue||this,Ve=b();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Je._=Ve,define("lodash",[],function(){return Ve})):Me&&$e?Ge?($e.exports=Ve)._=Ve:Me._=Ve:Je._=Ve}.call(this),define("report/CSVExporter",["dojo/_base/array"],function(e){"use strict";function t(e){var t,r,n,o,i,a,s,l,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,d=0,p="",f=[];if(!e)return e;do t=e.charCodeAt(c++),r=e.charCodeAt(c++),n=e.charCodeAt(c++),l=t<<16|r<<8|n,o=l>>18&63,i=l>>12&63,a=l>>6&63,s=63&l,f[d++]=u.charAt(o)+u.charAt(i)+u.charAt(a)+u.charAt(s);while(c<e.length);p=f.join("");var g=e.length%3;return(g?p.slice(0,g-3):p)+"===".slice(g||3)}function r(e,t){t=t||"";for(var r=1024,n=atob(e),o=n.length,i=Math.ceil(o/r),a=new Array(i),s=0;i>s;++s){for(var l=s*r,u=Math.min(l+r,o),c=new Array(u-l),d=0,p=l;u>p;++d,++p)c[d]=n[p].charCodeAt(0);a[s]=new Uint8Array(c)}return new Blob(a,{type:t})}function n(t){var r=t.series,n=[],o=[];return e.forEach(r[0].data,function(e){o.push(e.category)}),n.push("Suitability,"+o.join(",")),e.forEach(r,function(t){o=[],o.push(t.name),e.forEach(t.data,function(e){o.push(Math.abs(e.y.toFixed(2)))}),n.push(o.join(","))}),n}function o(t){var r,n=t.series,o=[],i=[];return r=t.xAxis[0].categories,e.forEach(r,function(e){i.push(e)}),o.push("Type,"+i.join(",")),e.forEach(n,function(t){i=[],i.push(t.name),e.forEach(t.data,function(e){i.push(e.y)}),o.push(i.join(","))}),o}function i(t){var r,n=["Unsuitable"],o=["Suitable"],i=t.series,a=0,s=0,l=0,u=0,c=0,d=0,p=[];return p.push("Suitability,Total,HP/HPT,HPK,APL"),r=i[0],e.forEach(r.data,function(e){"Suitable"===e.name?o.push(e.y):n.push(e.y)}),r=i[1],e.forEach(r.data,function(e){switch(e.name){case"HP/HPT":"donut-Suitable"===e.parentId?u=e.y||0:a=e.y||0;break;case"APL":"donut-Suitable"===e.parentId?d=e.y||0:l=e.y||0;break;case"HPK":"donut-Suitable"===e.parentId?c=e.y||0:s=e.y||0}}),o=o.concat([u,c,d]),n=n.concat([a,s,l]),p.push(o.join(",")),p.push(n.join(",")),p}function a(){var t,r=document.getElementById("title").innerHTML,n=$("#suitabilityAnalysis_content tr"),o=[];return o.push("Suitability Statistics"),o.push(r),o.push("Parameter, Value"),e.forEach(n,function(e){t=e.cells[1].innerHTML.replace(",",""),o.push(e.cells[0].innerHTML+","+t)}),o}var s={exportCSV:function(e){var n,o="data:application/vnd.ms-excel;base64,",i="text/csv;charset=utf-8",a="data.csv",s=document.createElement("a");saveAs&&new Blob?(n=r(t(e),i),saveAs(n,a)):""===s.download?(s.href=o+t(e),s.target="_blank",s.download=a,s.click()):window.open(o+t(e))},exportSuitabilityByLegalClass:i,exportSuitabilityStatistics:a,exportCompositionAnalysis:n,exportSimpleChartAnalysis:o};return s}),define("report/Renderer",["report/config","dojo/number","dijit/Dialog","dojo/_base/array","dojo/on","dojo/dom","dojo/dom-style","report/CSVExporter","utils/Analytics"],function(e,t,r,n,o,i,a,s,l){"use strict";var u="url(./app/css/images/download-icon.svg)";return{renderContainers:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='result-block total-loss'><div class='top-panel' id='"+e.rootNode+"_composition'></div><div class='left-panel'><div class='loss-chart' id='"+e.rootNode+"_loss'><div class='loader-wheel'>total loss</div></div></div><div class='right-panel'><div class='fires-chart' id='"+e.rootNode+"_fire'><div class='loader-wheel'>active fires</div></div></div></div><div class='result-block clearance-alerts'><div class='clearance-chart' id='"+e.rootNode+"_clearance'><div class='loader-wheel'>clearance alerts</div></div></div><div class='result-block mill-points'><div class='mill-table' id='"+e.rootNode+"_mill'></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderTotalLossContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='result-block total-loss'><div class='top-panel' id='"+e.rootNode+"_composition'></div><div class='left-panel'><div class='loss-chart' id='"+e.rootNode+"_loss'><div class='loader-wheel'>total loss</div></div></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderProdesContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='result-block prodes'><div class='top-panel' id='"+e.rootNode+"_composition'></div><div class='left-panel'><div class='prodes-chart' id='"+e.rootNode+"_prodes'><div class='loader-wheel'>prodes</div></div></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderRSPOContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='rspo-table-container' id='"+e.rootNode+"_table'><div class='loader-wheel'>rspo analysis</div></div><div class='rspo-chart-container' id='"+e.rootNode+"_chart'></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderSuitabilityContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container",r.innerHTML="<div class='title'>"+e.title+"</div><div class='suitability-container'><div class='left-panel'><div id='suitability-table-csv' class='csv-download' title='Download CSV'></div><div id='"+e.rootNode+"_content' class='suitability-content'><div class='loader-wheel'>suitability</div></div></div><div class='right-panel'><div id='"+e.rootNode+"_chart' class='suitability-chart'><div class='loader-wheel'>suitability</div></div></div><div class='clearFix'></div><div class='left-panel'><div class='suitability-settings-table-header'>Suitability Settings</div><div id='suitability-settings-csv' class='csv-download' title='Download CSV'></div><div id='suitability-settings-table'></div></div><div class='right-panel'><div id='suitability-composition-analysis'><div class='loader-wheel'>composition</div></div></div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderMillContainer:function(e){var t=document.createDocumentFragment(),r=document.createElement("div"),n=document.getElementById("print-map");r.id=e.rootNode,r.className="result-container relative",r.innerHTML="<div class='title'>"+e.title+"</div><div id='mill-overall-container'></div><div class='mill-table-container' id='"+e.rootNode+"_table'><div class='loader-wheel'>risk assessment</div></div>",t.appendChild(r),document.getElementById("report-results-section").insertBefore(t,n)},renderCompositionAnalysisLoader:function(e){document.getElementById(e.rootNode+"_composition").innerHTML='<div class="loader-wheel">composition analysis</div>'},renderCompositionAnalysis:function(e,r,n){var o,i,a,s=document.createDocumentFragment(),l=document.createElement("div"),u=document.getElementById(n.rootNode+"_composition"),c=n.compositionAnalysis,d=c.title||n.title;return c.histogramSlice&&(a=e.slice(c.histogramSlice)),0===a.length?void this.renderAsUnavailable("composition",n):(a=a.reduce(function(e,t){return e+t})*r*r/1e4,o=t.format(a),void report.areaPromise.then(function(){i=t.format(a/report.area*100,{places:0}),l.className="composition-analysis-container",l.innerHTML="<div>Total "+d+" in selected area: "+o+" ha</div><div>Percent of total area comprised of "+d+": "+i+"%</div>",s.appendChild(l),u.innerHTML="",u.appendChild(s)}))},renderLossData:function(t,r,o,i,a){var s,l,c,d,p,f=e.totalLoss,g=o.labels,h=f.labels,m=arrayFromBounds(o.bounds),y=arrayFromBounds(f.bounds),v=function(e){return e*r*r/1e4},b=[],_=[];if(a){if(c=t.slice(1).map(v),c.length!==h.length)for(var w=0;w<h.length;w++)void 0===c[w]&&(c[w]=0);b.push({name:g[0],data:c}),_.push(o.colors[0])}else for(d=0;d<m.length;d++){for(c=[],p=0;p<y.length;p++)s=i.encode(y[p],m[d]),c.push(t[s]||0);b.push({name:g[d],data:c.map(v)}),_.push(o.colors[d])}o.lossChart.removeBelowYear&&(l=h.indexOf(o.lossChart.removeBelowYear),h=h.slice(l),n.forEach(b,function(e){e.data=e.data.slice(l)})),$("#"+o.rootNode+"_loss").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null,type:"bar",events:{load:function(){}}},colors:_,title:{text:o.lossChart.title},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},xAxis:{categories:h,maxPadding:.35,title:{text:null}},yAxis:{stackLabels:{enabled:!0},title:{text:null}},legend:{enabled:!0,verticalAlign:"bottom"},plotOptions:{series:{stacking:"normal"}},series:b,credits:{enabled:!1}})},renderTreeCoverLossData:function(t,r,o){var i,a=e.totalLoss,s=o.labels,l=a.labels,c=(arrayFromBounds(o.bounds),arrayFromBounds(a.bounds),function(e){return e*r*r/1e4}),d=[],p=[];if(d.push({name:s[0],data:t.slice(1).map(c)}),p.push(o.color),o.lossChart.removeBelowYear&&(i=l.indexOf(o.lossChart.removeBelowYear),l=l.slice(i),n.forEach(d,function(e){e.data=e.data.slice(i)})),d[0].data.length!==l.length)for(var f=0;f<l.length;f++)void 0===d[0].data[f]&&(d[0].data[f]=0);$("#"+o.rootNode+"_loss").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null,type:"bar",events:{load:function(){}}},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},colors:p,title:{text:o.lossChart.title},xAxis:{categories:l,maxPadding:.35,title:{text:null}},yAxis:{stackLabels:{enabled:!0},title:{text:null}},legend:{enabled:!1,verticalAlign:"bottom"},plotOptions:{series:{stacking:"normal"}},series:d,credits:{enabled:!1}})},renderProdesData:function(t,r,n){var o=e.prodesLayer,i=n.labels,a=o.labels,s=function(e){return e*r*r/1e4},l=[],c=[];if(l.push({name:i[0],data:t.slice(1).map(s)}),c.push(n.color),l[0].data.length!==a.length)for(var d=0;d<a.length;d++)void 0===l[0].data[d]&&(l[0].data[d]=0);$("#"+n.rootNode+"_prodes").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null,type:"bar",events:{load:function(){}}},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},colors:c,title:{text:n.lossChart.title},xAxis:{categories:a,maxPadding:.35,title:{text:null}},yAxis:{stackLabels:{enabled:!0},title:{text:null}},legend:{enabled:!1,verticalAlign:"bottom"},plotOptions:{series:{stacking:"normal"}},series:l,credits:{enabled:!1}})},renderClearanceData:function(e,t,r,n,o){var i,a,s,l,c=r.labels,d=arrayFromBounds(r.bounds),p=arrayFromBounds(report.clearanceBounds),f=[],g=[];if("pie"===r.clearanceChart.type){for(s=0;s<d.length;s++){for(a=0,g=[],l=0;l<p.length;l++)i=n.encode(p[l],d[s]),g.push(e[i]||0);f.push({name:c[s],data:g})}$("#"+r.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},colors:r.colors,title:{text:r.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!0},credits:{enabled:!1},series:f})}else{if(o){if(f=e.slice(1),f.length!==p.length)for(var h=0;h<p.length;h++)void 0===f[h]&&(f[h]=0)}else for(s=0;s<p.length;s++){for(a=0,l=0;l<d.length;l++)i=n.encode(p[s],d[l]),a+=e[i]||0;f.push(a)}$("#"+r.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},colors:["#fb00b3"],title:{text:r.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!1},credits:{enabled:!1},series:[{name:r.title,data:f}]})}},renderGladData:function(e,t,r,n,o){var i,a,s,l,c=r.labels,d=arrayFromBounds(r.bounds),p=arrayFromBounds(report.gladLayer),f=[],g=[];if("pie"===r.clearanceChart.type){for(s=0;s<d.length;s++){for(a=0,g=[],l=0;l<p.length;l++)i=n.encode(p[l],d[s]),g.push(e[i]||0);f.push({name:c[s],data:g})}$("#"+r.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},colors:r.colors,title:{text:r.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!0},credits:{enabled:!1},series:f})}else{if(o){if(f=e.slice(1),f.length!==p.length)for(var h=0;h<p.length;h++)void 0===f[h]&&(f[h]=0)}else for(s=0;s<p.length;s++){for(a=0,l=0;l<d.length;l++)i=n.encode(p[s],d[l]),a+=e[i]||0;f.push(a)}$("#"+r.rootNode+"_clearance").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},colors:["#fb00b3"],title:{text:r.clearanceChart.title},xAxis:{categories:report.clearanceLabels},yAxis:{title:null,min:0},legend:{enabled:!1},credits:{enabled:!1},series:[{name:r.title,data:f}]})}},renderFireData:function(r,o){function i(e,r,n,o){var i=document.createDocumentFragment(),a=document.createElement("div"),s=document.getElementById(e+"_fire");a.className="active-fires-badge",a.innerHTML="<div>There are currently</div><div class='active-fires-label'><div>"+t.format(r)+"</div><span>active fires</span></div><div>"+o+"</div><div class='total-active-fires-label'><span>"+t.format(n)+" total active fires</span></div>",i.appendChild(a),s.innerHTML="",s.appendChild(i)}function a(e,r,n,o,i){for(var a=document.createDocumentFragment(),s=document.createElement("div"),l=document.getElementById(e+"_fire"),u=[],c=0;c<r.length;c++)c>=n[0]&&c<=n[1]&&u.push(r[c]);s.className="active-fires-badge special",s.innerHTML="<div>Active fires are detected in:</div><div class='active-fires-label'><span>"+o[0]+" Forests</span><div>"+t.format(u[0]||0)+"</div></div><div class='active-fires-label'><span>"+o[1]+" Forests</span><div>"+t.format(u[1]||0)+"</div></div><div class='total-active-fires-label'><span>out of "+t.format(i)+" total active fires</span></div></div>",a.appendChild(s),l.innerHTML="",l.appendChild(a)}function s(e,t,r,n,o,s,l){var c,d=[],p=0,f=[];for(c=0;c<t.length;c++)c>=o[0]&&c<=o[1]&&(0===t[c]||isNaN(t[c])||(d.push([r[p],t[c]]),f.push(n[p])),p++);0===d.length?i(e,0,0,l):2===r.length?a(e,t,o,r,g.length):$("#"+e+"_fire").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null},colors:f,title:{text:"Active Fires"},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},plotOptions:{pie:{size:"75%",allowPointSelect:!0,cursor:"pointer",showInLegend:!0,dataLabels:{enabled:!1}}},credits:{enabled:!0},legend:{enabled:!1},series:[{type:"pie",name:"Fires",data:d}]})}var l,c,d,p,f,g=o[0].features;n.forEach(r,function(t){if(d=t.rootNode,p=e.fires[t.fireKey],console.log("item.fireKey",t.fireKey),console.log(e.fires),console.log("config"),console.log(p),o.length>1&&"indonesiaMoratorium"===t.fireKey){var r=0;return n.forEach(o[1].features,function(e){r+=+e.attributes[p.field]}),void i(d,r,g.length,p.badgeDesc)}if(0===g.length)i(d,0,0,p.badgeDesc);else if("pie"===p.type){for(c=[],f=0;f<=p.labels.length;f++)c[f]=0;n.forEach(g,function(e){c[e.attributes[p.field]]++}),s(d,c,p.labels,p.colors,p.bounds,p.title,p.badgeDesc)}else l=0,n.forEach(g,function(e){l+=isNaN(parseInt(e.attributes[p.field]))?0:parseInt(e.attributes[p.field])}),i(d,l,g.length,p.badgeDesc)})},renderRSPOData:function(r,o,i){var a=arrayFromBounds(e.rspo.lossBounds);if(!(r.histograms.length>0))return void(document.getElementById(o.rootNode+"_table").innerHTML="<div class='data-not-available'>No RSPO Data Available for this Site.</div>");var u,c,d,p,f,g=2005,h=8,m="",y="",v="",b="",_="",w=[],A=[],S=[],C=[],R=[];for(m="<div id='rspo-table-csv' class='csv-download' title='Download CSV'></div><table class='rspo-results-table'><tr><th>Forest Type</th>",d=0;h>=d;d++)w.push(g+d),m+="<th>"+(g+d)+"</th>";for(m+="</tr>",c=r.histograms[0].counts,p=0;p<a.length;p++)u=i.encode(a[p],2),S.push(c[u]||0),u=i.encode(a[p],3),C.push(c[u]||0),u=i.encode(a[p],1),A.push(c[u]||0),u=i.encode(a[p],0),R.push(c[u]||0);for(v="<tr><td>Primary</td>",b="<tr><td>Secondary</td>",y="<tr><td>Agroforestry</td>",_="<tr><td>Non-Forest</td>",f=0;f<S.length;f++)v+="<td>"+(t.format(S[f])||0)+"</td>",b+="<td>"+(t.format(C[f])||0)+"</td>",y+="<td>"+(t.format(A[f])||0)+"</td>",_+="<td>"+(t.format(R[f])||0)+"</td>";v+="</tr>",b+="</tr>",y+="</tr>",_+="</tr>",m+=v+b+y+_+"</table>",m+="<div class='change-area-unit'>(Change in Hectares)</div>",document.getElementById(o.rootNode+"_table").innerHTML=m,this.renderRSPOChart(o,S,C,A,R,w),$("#rspo-table-csv").click(function(){var e="\r\n",t=[],r=[],o="";t.push("RSPO Land Use Change Analysis"),t.push(document.getElementById("title").innerHTML),n.forEach(w,function(e){r.push(e)}),t.push("Forest Type,"+r.join(",")),r=[],n.forEach(S,function(e){r.push(e)}),t.push("Primary,"+r.join(",")),r=[],n.forEach(C,function(e){r.push(e)}),t.push("Secondary,"+r.join(",")),r=[],n.forEach(A,function(e){r.push(e)}),t.push("Agroforestry,"+r.join(",")),r=[],n.forEach(R,function(e){r.push(e)}),t.push("Non-Forest,"+r.join(",")),o=t.join(e),s.exportCSV(o),l.sendEvent("Event","Download CSV","User downloaded RSPO results table.")})},renderRSPOChart:function(e,r,n,o,i,a){var s={color:"#000"},l={style:s};$("#"+e.rootNode+"_chart").highcharts({chart:{backgroundColor:"#FFF",type:"column"},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},colors:e.colors,title:{text:null},legend:{align:"center",verticalAlign:"top",enabled:!0},xAxis:{categories:a,labels:l},yAxis:{title:{text:"",style:s},labels:l},plotOptions:{column:{stacking:"normal"}},tooltip:{formatter:function(){return"<strong>"+this.key+"</strong><br/>"+this.series.name+": "+t.format(this.y)+"<br/>Total: "+t.format(this.point.stackTotal)}},credits:{enabled:!1},series:[{name:"Primary",data:r},{name:"Secondary",data:n},{name:"Agroforestry",data:o},{name:"Non-Forest",data:i}]})},renderSuitabilityData:function(e,r){var n,o,i,a,s,l,u,c,d,p=e.lcHistogram.classIndices,f="<table>";if(d=r[0],d?(n=Math.pow(d.pixelSize/100,2),d.data.counts[1]?(i=t.format(d.data.counts[1]*n)||d.data.counts[1],o=t.format(d.data.counts[0]*n)||d.data.counts[0]):(i=0,o=t.format(d.data.counts[0]*n))):(i="N/A",o="N/A"),d=r[1]){n=Math.pow(d.pixelSize/100,2);var g=function(e){for(var r=0,o=0;o<e.length;o++)d.data.counts[e[o]]&&(r+=d.data.counts[e[o]]*n);return t.format(r)};l=g(p.production),u=g(p.convertible),c=g(p.other)}else l="N/A",u="N/A",c="N/A";d=r[2],a=d?parseFloat(d.data.min/1e3).toFixed(1):"N/A",d=r[3],s=d?d.value:"N/A",f+="<tr><td>Suitable(ha):</td><td>"+i+"</td></tr>",f+="<tr><td>Unsuitable(ha):</td><td>"+o+"</td></tr>",f+="<tr><td>Distance to nearest road(km):</td><td>"+a+"</td></tr>",f+="<tr><td>Existing concessions(Yes/No):</td><td>"+s+"</td></tr>",f+="<tr><td>Legal Classification(ha):</td><td></td></tr>",f+="<tr><td class='child-row'>Production forest(HP/HPT):</td><td>"+l+"</td></tr>",f+="<tr><td class='child-row'>Convertible forest(HPK):</td><td>"+u+"</td></tr>",f+="<tr><td class='child-row'>Other land uses(APL):</td><td>"+c+"</td></tr>",f+="</table>",f+="<p>"+e.localRights.content+"</p>",f+="<div class='field-assessment-link'><a href='"+e.localRights.fieldAssessmentUrl+"'>"+e.localRights.fieldAssessmentLabel+"</a></div>",document.getElementById(e.rootNode+"_content").innerHTML=f,this.renderSuitabilityChart(e,r[4]),this.renderSuitabilitySettingsTable()},renderSuitabilitySettingsTable:function(){var e,t,r,o,i,a,s=payload&&payload.suitability&&payload.suitability.csv,l="<table><thead><tr>";s&&(r=s.split("\n"),e=r.splice(1),t=r[0].split(","),l+="<th>Parameter</th><th>Setting</th></tr></thead><tbody>",n.forEach(e,function(e){a=e.split(","),o=a[0],i=a[1],void 0!==o&&""!==o&&(l+="<tr><td>"+o+"</td><td>"+i.replace(/\;/g,",")+"</td></tr>")}),l+="</tbody></table>",$("#suitability-settings-table").html(l))},renderSuitabilityCompositionChart:function(e){var t,r=[],o=[],i=[];n.forEach(e,function(e){t=e.suitable+e.unsuitable,e.suitable=e.suitable/t*100,e.unsuitable=e.unsuitable/t*100*-1}),e.sort(function(e,t){return e.suitable>t.suitable?1:t.suitable>e.suitable?-1:0}),n.forEach(e,function(e){r.push(e.unsuitable),o.push(e.suitable),i.push(e.label)}),$("#suitability-composition-analysis").highcharts({chart:{type:"bar"},title:{text:"Suitability Composition Analysis"},colors:["#FDD023","#461D7C"],credits:{enabled:!1},xAxis:[{categories:i,reversed:!1},{labels:{enabled:!1},opposite:!0,reversed:!1,linkedTo:0,tickLength:0}],yAxis:{title:{text:null},min:-100,max:100,labels:{formatter:function(){return Math.abs(this.value)+(0!==this.value?"%":"")}}},tooltip:{formatter:function(){return"<b>"+this.point.category+"</b><br/><b>"+this.series.name+":</b>	"+Highcharts.numberFormat(Math.abs(this.point.y),2)+"%"}},plotOptions:{series:{stacking:"normal"}},series:[{name:"Unsuitable",data:r},{name:"Suitable",data:o}],exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}}})},renderSuitabilityChart:function(e,t){function r(e){for(var r={suitable:0,unsuitable:0},n=0;n<e.length;n++)t.data.counts[e[n]]&&(r.unsuitable+=t.data.counts[e[n]]*s,r.suitable+=t.data.counts[e[n]+10]*s);return r}if(!t)return void(document.getElementById(e.rootNode+"_chart").innerHTML="<div class='data-not-available'>No Suitability Data Available to chart for this Site.</div>");var n,o,i,a=e.lcHistogram.classIndices,s=Math.pow(t.pixelSize/100,2),l=e.chart,c=[],d=[],p=[];n=r(a.convertible),o=r(a.production),i=r(a.other),c.push({y:n.suitable+o.suitable+i.suitable,color:l.suitable.color,name:l.suitable.name,id:l.suitable.id,children:{categories:l.childrenLabels,colors:l.childrenColors,data:[o.suitable,n.suitable,i.suitable]}}),c.push({y:n.unsuitable+o.unsuitable+i.unsuitable,color:l.unsuitable.color,name:l.unsuitable.name,id:l.unsuitable.id,children:{categories:l.childrenLabels,colors:l.childrenColors,data:[o.unsuitable,n.unsuitable,i.unsuitable]}});for(var f=0;f<c.length;f++)if(c[f].y>0){d.push({color:c[f].color,name:c[f].name,id:c[f].id,y:c[f].y});for(var g=0;g<c[f].children.data.length;g++)c[f].children.data[g]>0&&p.push({name:c[f].children.categories[g],color:c[f].children.colors[g],y:c[f].children.data[g],parentId:c[f].id})}$("#"+e.rootNode+"_chart").highcharts({chart:{type:"pie",backgroundColor:"#FFF",plotBorderWidth:null},title:{text:l.title},tooltip:{valueSuffix:""},exporting:{buttons:{contextButton:{enabled:!1},exportButton:{menuItems:Highcharts.getOptions().exporting.buttons.contextButton.menuItems,symbol:u}}},plotOptions:{series:{point:{events:{legendItemClick:function(){var e=this.id,t=this.series.chart.series[1].data;t.forEach(function(t){t.parentId===e&&(t.visible?t.setVisible(!1):t.setVisible(!0))})}}}}},legend:{itemStyle:{color:"#000"}},credits:{enabled:!1},series:[{name:"Area",data:d,size:"60%",showInLegend:!0,dataLabels:{enabled:!1}},{name:"Legal Area",data:p,size:"80%",innerSize:"60%",dataLabels:{color:"black",distance:5}}]})},renderMillAssessment:function(e,t){function r(e){var t="'><span class='small-swatch'></span>",r="<tr class='data-row'>";return r+="<td class='mill_name'><span>"+e.mill_name+"</span></td>",r+="<td class='"+e.priority_level+t+e.priority_level+"</td>",r+="<td class='"+e.historic_loss+t+e.historic_loss+"</td>",r+="<td class='"+e.future_risk+t+e.future_risk+"</td>",r+="<td class='"+e.tree_cover.risk+t+e.tree_cover.risk+"</td>",r+="<td class='"+e.primary_forest.risk+t+e.primary_forest.risk+"</td>",r+="<td class='"+e.peat.risk+t+e.peat.risk+"</td>",r+="<td class='"+e.protected_areas.risk+t+e.protected_areas.risk+"</td>",r+="<td class='"+e.carbon.risk+t+e.carbon.risk+"</td>",r+="<td class='"+e.fire.risk+t+e.fire.risk+"</td>",r+="</tr>"}function o(e){var t,r="'><span class='small-swatch'></span>",n=e.mill_name?e.mill_name:"Unknown";t="low"===e.priority_level?"low":"medium low"===e.priority_level?"medium-low":"medium"===e.priority_level?"low":"medium high"===e.priority_level?"medium-high":"high";var o="<table class='single-mill-table-header-v2'>";return o+="<tr class='single-mill-header'><div class='mill-header-single-title'><span class='mill-title'>"+n+"</span><span class='mill-risk-level-single-title "+t+"'>Total Mill Priority Level: <span class='overall-risk'>"+e.priority_level+"</span></div></tr>",o+="<tr class=''>",o+="<tr><th>Combined Indicator</th><th>Rank </th><th>Combined Indicator</th><th>Rank </th></tr>",o+="<tr><td>Tree cover</td><td class='"+e.tree_cover.risk+r+e.tree_cover.risk+"</td><td>Protected Areas</td><td class='"+e.protected_areas.risk+r+e.protected_areas.risk+"</td></tr>",o+="<tr><td>Primary Forest</td><td class='"+e.primary_forest.risk+r+e.primary_forest.risk+"</td><td>Carbon</td><td class='"+e.carbon.risk+r+e.carbon.risk+"</td></tr>",o+="<tr><td>Peat</td><td class='"+e.peat.risk+r+e.peat.risk+"</td><td>Fire</td><td class='"+e.fire.risk+r+e.fire.risk+"</td></tr>",o+="</tr>",o+="</table>"}function i(e){var t="'><span class='small-swatch'></span>",r="<table class='single-mill-table-content-v2'>";return r+="<thead><tr><th colspan='3' class='"+e.historic_loss+"'>Historic behavior: <span class='small-swatch'></span>"+e.historic_loss+" Risk</th><th colspan='3' class='"+e.future_risk+"'>Potential for future loss:  <span class='small-swatch'></span>"+e.future_risk+" Risk</th></tr>",r+="<tr><td>Indicator</td><td>Rank</td><td>Amount</td><td>Indicator</td><td>Rank</td><td>Amount</td></tr></thead>",r+="<tr><td>Rate of tree cover loss</td><td class='"+e.tree_cover.loss.rank+t+e.tree_cover.loss.rank+"</td><td>"+e.tree_cover.loss.amount+" ha/year</td><td>Tree cover extent</td><td class='"+e.tree_cover.extent.rank+t+e.tree_cover.extent.rank+"</td><td>"+e.tree_cover.extent.amount+" ha</td></tr>",r+="<tr><td>Tree cover loss on primary forest</td><td class='"+e.primary_forest.loss.rank+t+e.primary_forest.loss.rank+"</td><td>"+e.primary_forest.loss.amount+" ha</td><td>Area in primary forest</td><td class='"+e.primary_forest.extent.rank+t+e.primary_forest.extent.rank+"</td><td>"+e.primary_forest.extent.amount+" ha</td></tr>",r+="<tr><td>Tree cover loss on peat</td><td class='"+e.peat.loss.rank+t+e.peat.loss.rank+"</td><td>"+e.peat.loss.amount+" ha</td><td>Area in peat</td><td class='"+e.peat.extent.rank+t+e.peat.extent.rank+"</td><td>"+e.peat.extent.amount+" ha</td></tr>",r+="<tr><td>Tree cover loss on protected areas</td><td class='"+e.protected_areas.loss.rank+t+e.protected_areas.loss.rank+"</td><td>"+e.protected_areas.loss.amount+" ha</td><td>Area in protected areas</td><td class='"+e.protected_areas.extent.rank+t+e.protected_areas.extent.rank+"</td><td>"+e.protected_areas.extent.amount+" ha</td></tr>",r+="<tr><td>Tree cover loss on carbon dense areas</td><td class='"+e.carbon.loss.rank+t+e.carbon.loss.rank+"</td><td>"+e.carbon.loss.amount.toFixed(3)+" ha</td><td>Area of high carbon density</td><td class='"+e.carbon.extent.rank+t+e.carbon.extent.rank+"</td><td>"+e.carbon.extent.amount+" ha</td></tr>",r+="<tr><td>Fire activity</td><td class='"+e.fire.extent.rank+t+e.fire.extent.rank+"</td><td>"+e.fire.extent.amount.toFixed(3)+" fires/1000 ha</td><td>Rate of fire activity last three years</td><td class='"+e.fire.loss.rank+t+e.fire.loss.rank+"</td><td>"+e.fire.loss.amount+" fires/1000 ha per year</td></tr>",r+="</table>"}function a(e){var t=e.currentTarget,r=t.dataset?t.dataset["class"]:t.getAttribute("data-class");$(".mill-table-container .data-row.child."+r).toggle(),$(t).toggleClass("open")}var s,l=[],u="";n.forEach(e,function(t,a){if(u="",t.mill_name?s=t.mill_name:report.mills&&n.some(report.mills,function(e){return t.id===e.millId?(s=e.label,!0):void 0}),void 0===s&&(s=window.payload.title),e.length>1&&0==a){u+="<table class='mill-table-v2'><thead class='mill-table-header-v2'><tr><td class='dark' rowspan='2'></td><td class='dark' rowspan='2'>Overall Priority Level</td><td class='dark' rowspan='2'>Historic Behavior</td><td class='dark' rowspan='2'>Future Potential Loss</td><td class='white span-60' colspan='6'>Environmental Indicators</td></tr><tr><td class='white'>Tree Cover</td><td class='white'>Primary Forest</td><td class='white'>Peat</td><td class='white'>Protected Areas</td><td class='white'>Carbon</td><td class='white'>Fires</td></tr></thead>",u+="<tbody class='mill-table-container-v2'>";for(var c=0;c<e.length;c++)u+=r(e[c])}u+=o(e[a]),u+=i(e[a]),l.push(u)}),document.getElementById(t.rootNode+"_table").innerHTML=l.join("<br />"),$(".mill-table-container tr.parent").click(a),$(".mill-table-container .info-icon").click(this.showMillPointInfo),$(".mill-table-container .data-row.child").toggle()},showMillPointInfo:function(t){var n,o=t.currentTarget,i=o.dataset?o.dataset.type:o.getAttribute("data-type"),a=e.millPointInfo[i];n=new r({title:a.title,content:a.content,style:"width: 300px;"}),n.show()},renderAsUnavailable:function(e,t){var r=document.getElementById(t.rootNode+"_"+e),n="";n="loss"===e?"No tree cover loss detected.":"clearance"===e?"No clearance alerts occured in this area.":"composition"===e?t.errors&&t.errors.composition||"No Composition Analysis Data Available for this site.":"No Mill Point Data Available for this site.",r&&(r.innerHTML=n)}}}),define("report/riskRequests",["dojo/Deferred","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/ImageServiceIdentifyTask","esri/tasks/ImageServiceIdentifyParameters","esri/tasks/StatisticDefinition","esri/request","esri/tasks/AreasAndLengthsParameters","esri/tasks/GeometryService","esri/SpatialReference","esri/tasks/ProjectParameters","esri/tasks/BufferParameters"],function(e,t,r,n,o,i,a,s,l,u,c,d){
var p={},f=function(e,t){for(param in t)t.hasOwnProperty(param)&&t[param]&&(e[param]=t[param]);return e},g=function(e){return e.lengthUnit=l[e.lengthUnit],e.areaUnit=l[e.areaUnit],e},h=function(t,r,n){var o=new e;return n=n||"execute",t[n](r,function(e){o.resolve(e)},function(e){o.resolve(e)}),o};return p.getAreasLengths=function(t,r){var n=new e;r=g(r);var o=f(new s,r),i=new l(t);return i.areasAndLengths(o).then(function(e){n.resolve(e)}),n},p.project=function(t,r,n){var o=new e;r.outSR=new u(n);var i=new l(t),a=f(new c,r);return i.project(a).then(function(e){o.resolve(e)}),o},p.buffer=function(t,r,n){var o=new e,i=f(new d,r);i.unit=l[r.unit],i.spatialReference=r.geometries[0].spatialReference,i.outSpatialReference=new u(n);var a=new l(t);return a.buffer(i).then(function(e){o.resolve(e)}),o},p.loadServiceInfo=function(t){var r=new e,n=esri.request({url:t,content:{f:"json"},handleAs:"json"});return n.then(function(e){console.log("Success: ",e.layers),r.resolve(e)},function(e){console.log("Error: ",e.message),r.resolve(e)}),r},p.queryForStats=function(t,r,n){var o=(new e,n.map(function(e){return f(new i,e)}));return r.outStatistics=o,p.queryEsri(t,r)},p.queryEsri=function(e,n,o){var i=new t(e),a=f(new r,n),s=h(i,a,o);return s},p.computeHistogram=function(e,t){return a({url:e+"/computeHistograms",content:t,handleAs:"json",callbackParamName:"callback",timeout:6e4},{usePost:!0})},p.queryJson=function(){},p}),define("report/riskController",["lodash","dojo/Deferred","dojo/promise/all","dojo/_base/lang","esri/geometry/geometryEngine","esri/geometry/Polygon","report/riskRequests","report/config"],function(e,t,r,n,o,i,a,s){var l={},u=102100,c=["","low","medium","high"];s.carbonDensity={rasterId:"$560"};var d={commodities:"http://gis-gfw.wri.org/arcgis/rest/services/image_services/analysis/ImageServer",fires:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0",concessions:"http://gis-gfw.wri.org/arcgis/rest/services/CommoditiesAnalyzer/moremaps2_EN/MapServer/27"};return l.getRiskByGeometry=function(o,i,l,u,p,f,g){var h=i,m=function(e,t,r){return r>t?3:e>=r?1:2},y=function(e,t){return function(r){if(!r.histograms[0])return 1;var n=r.histograms[0].counts[1]||0;return n>t?3:e>=n?1:2}},v=function(e,t,r){return function(n){if(!n.histograms[0])return m(e,t,0);var o=n.histograms[0].counts[1]||0,i=F(o,r),a=i/h;return m(e,t,a)}},b=function(e){if(!e.histograms.length)return 1;var t=e.histograms[0].counts[1];return t>0?3:1},_=function(e){if(!e.histograms.length)return 1;var t=e.histograms[0].counts;return t[2]?3:t[1]?3:1},w=function(e,t,r){return{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:e,OutputValues:t,Raster:r,AllowUnmatched:!1},variableName:"Raster"}},A=function(e){return w([0,1,1,14],[0,1],e)},S=function(e){return w([1,22],[1],e)},C=function(e){return w([0,100,100,200,200,300,300,400,400,500,500,1e3],[1,2,3,4,5,6],e)},R=function(e,t,r){return{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:e,Raster2:t,Operation:r}}},x=function(e){return{mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[parseInt(e.replace("$",""))],ascending:!0,mosaicOperation:"MT_FIRST"}},F=function(e,t){var r=t*t,n=e*r;return n},I={histogram:a.computeHistogram,query:a.queryEsri},k={low:7,high:12},L=[{label:"legal",categories:["legal"],singleIndicator:!0},{label:"deforestation",high:21,low:13},{label:"peat",high:7,low:4},{label:"rspo",categories:["rspo"]},{label:"fire",categories:["fire"],singleIndicator:!0}],T=[{key:"carbon",category:"deforestation",service:d.commodities,request:I.histogram,params:{renderingRule:R(A(s.treeCoverLoss.rasterId),w([0,100,100,200,200,300,300,400,400,500,500,1e3],[1,2,3,4,5,6],s.carbonDensity.rasterId),3),pixelSize:100},callbacks:{radius:_,concession:_}},{key:"forma",category:"deforestation",service:d.commodities,request:I.histogram,params:{renderingRule:S(s.clearanceAlerts.rasterId),pixelSize:500},callbacks:{radius:y(1,5),concession:y(25,295)}},{key:"forma_carbon",category:"deforestation",service:d.commodities,request:I.histogram,params:{renderingRule:R(S(s.clearanceAlerts.rasterId),C(s.carbonDensity.rasterId),3),pixelSize:30},callbacks:{radius:b,concession:b}},{key:"area_carbon",category:"deforestation",service:d.commodities,request:I.histogram,params:{renderingRule:C(s.carbonDensity.rasterId),pixelSize:30},callbacks:{radius:v(.747,.913,30),concession:v(0,.2,30)}},{key:"area_primary",category:"deforestation",service:d.commodities,request:I.histogram,ind_params:{renderingRule:w([0,1,1,3],[0,1],s.primaryForest.rasterId),pixelSize:100},params:{renderingRule:w([0,1,1,3],[0,1],s.intactForest.rasterId),pixelSize:100},callbacks:{radius:v(.12,.18,100),concession:v(0,.2,100)}},{key:"forma_primary",category:"deforestation",service:d.commodities,request:I.histogram,ind_params:{renderingRule:R(S(s.clearanceAlerts.rasterId),w([1,3],[1],s.primaryForest.rasterId),3),pixelSize:30},params:{renderingRule:R(S(s.clearanceAlerts.rasterId),s.intactForest.rasterId,3),pixelSize:30},callbacks:{radius:b,concession:b}},{key:"umd_loss",category:"deforestation",service:d.commodities,request:I.histogram,params:{renderingRule:A(s.treeCoverLoss.rasterId),pixelSize:30},callbacks:{radius:v(.001,.28*.02,30),concession:v(.05,.28,30)}},{key:"umd_loss_primary",category:"deforestation",service:d.commodities,request:I.histogram,ind_params:{renderingRule:R(A(s.treeCoverLoss.rasterId),s.primaryForest.rasterId,3),pixelSize:100},params:{renderingRule:R(A(s.treeCoverLoss.rasterId),s.intactForest.rasterId,3),pixelSize:100},callbacks:{radius:b,concession:b}},{key:"fire",category:"fire",service:d.fires,request:I.query,params:{where:"BRIGHTNESS>=330 AND CONFIDENCE>=30",geometry:""},execution:"executeForCount",callback:function(e){return e>0?3:1},callbacks:{radius:function(e){return e>0?3:1},concession:function(e){return e>0?3:1}}},{key:"legal",category:"legal",service:d.commodities,request:I.histogram,ind_params:{renderingRule:w([0,1,1,2,2,3,3,4,4,7],[1,0,1,0,1],s.legalClass.rasterId),pixelSize:100},params:{renderingRule:x(s.protectedArea.rasterId),pixelSize:100},callbacks:{radius:b,concession:b},ind_callback:b},{key:"clearance",category:"peat",service:d.commodities,request:I.histogram,params:{renderingRule:R(A(s.treeCoverLoss.rasterId),s.peatLands.rasterId,3),pixelSize:100},callbacks:{radius:b,concession:b}},{key:"alerts",category:"peat",service:d.commodities,request:I.histogram,params:{renderingRule:R(S(s.clearanceAlerts.rasterId),s.peatLands.rasterId,3),pixelSize:100},callbacks:{radius:b,concession:b}},{key:"presence",category:"peat",service:d.commodities,request:I.histogram,params:{renderingRule:w([0,1,1,2],[0,1],s.peatLands.rasterId),pixelSize:100},callbacks:{radius:v(.00531,.00693),concession:v(.00531,.00693)}}],E=function(t){var r=e.groupBy(T,"key"),t=r[t][0].category;return t},P=function(t,r){var o=n.clone(L),i=0;return e.forIn(t,function(t,n){var o=E(n);f[o]||(f[o]={});var a=e.result(e.find(L,{label:o}),"singleIndicator");a?(f[o][r]={risk:c[t]},i+=t):(f[o][n]||(f[o][n]={}),f[o][n][r]={risk:c[t]})}),o.forEach(function(n){var o=0;if(n.high){var a=[];e.pluck(e.groupBy(T,"category")[n.label],"key");T.forEach(function(e){o+=t[e],i+=t[e],a.push({key:e,risk:t[e]})}),n.categories=a;var s=m(n.high,n.low,o),l=n.label;n.risk=s,f[l]||(f[l]={});var u=n.label+"_"+r;f[l][u]=c[s]}}),i=m(k.low,k.high,i),f["priority_level_"+r]=c[i],i>f.total_mill_priority_level&&(f.total_mill_priority_level=i),f},B=new t;u=u,p=p,f.total_mill_priority_level=f.total_mill_priority_level||0;var O=[];if(!o){var N={};return e.pluck(T,"key").forEach(function(e){N[e]=0}),P(N,l),B.resolve(N),B.promise}var D=function(t,n,o,i){var a=t.map(function(e){return o.geometry=JSON.stringify(e),n.request(n.service,o,n.execution)});r(a).then(function(t){var r={histograms:[{counts:[]}]},o=e.pluck(e.flatten(e.pluck(t,"histograms")),"counts");o.forEach(function(e){e.forEach(function(e,t){r.histograms[0].counts[t]=r.histograms[0].counts[t]||0,r.histograms[0].counts[t]+=e})});var a={},s=n.callbacks[l];n.results=r,a[n.key]=s(r,i),i.resolve(a)},function(e){console.log("SPLIT ERROR",e)})};return T.forEach(function(e){var r=new t,n=p&&e.ind_params?e.ind_params:e.params;e.request===a.computeHistogram?(n.renderingRule=JSON.stringify(n.renderingRule),n.mosaicRule=n.mosaicRule?JSON.stringify(n.mosaicRule):"",n.geometryType="esriGeometryPolygon",n.geometry=JSON.stringify(o)):n.geometry=o,n.f="json",e.request(e.service,n,e.execution).then(function(t){var n={},o=e.callbacks[l];e.results=t,n[e.key]=o(t,r),r.resolve(n)},function(t){console.log("HISTOGRAM ERROR",t),g&&D(g,e,n,r)}),O.push(r.promise)}),r(O).then(function(e){var t={};e.forEach(function(e){n.mixin(t,e)}),console.log("calculatePriority");var r=P(t,l);B.resolve(r)}),B.promise},l.getGeometryArea=function(e,r){var n=new t,o={areaUnit:"UNIT_SQUARE_METERS",lengthUnit:"UNIT_METERS",calculationType:"geodesic",polygons:[r]};return a.getAreasLengths(e,o).then(function(e){n.resolve(e.areas[0])}),n},l.getConcessionRisk=function(e,r,n,c){var p=new t,f=d.concessions,g=new i(e),h={geometry:g,where:"CERT_SCHEME = 'RSPO' AND TYPE = 'Oil palm concession'",outFields:["OBJECTID"],returnGeometry:!0};return a.queryEsri(f,h).then(function(e){var t=s.geometryServiceUrl,d=e.features.map(function(e){return e.geometry});if(d.length<1)return l.getRiskByGeometry(!1,0,"concession",r,n,c),void p.resolve();var f=o.union(d),g=o.simplify(f),h=new i(g),m={geometries:[h]};a.project(t,m,u).then(function(e){var o=new i(e[0]);l.getGeometryArea(t,o).then(function(t){var o=l.getRiskByGeometry(e[0],t,"concession",r,n,c,d);o.then(function(){p.resolve()})})})}),p},l.printProjectGeom=function(e){var t=s.geometryServiceUrl,r=new i(e),n={geometries:[r]};a.project(t,n,102100).then(function(e){console.log("BUFFER GEOM",JSON.stringify(e[0]))})},l.getRadiusBuffer=function(e,r){var n=s.geometryServiceUrl,o=new t,i={unit:"UNIT_KILOMETER",distances:[r],geometries:[e]};return a.buffer(n,i,u).then(function(e){var t=e[0];l.getGeometryArea(n,t).then(function(t){o.resolve({geometry:e[0],area:t})})}),o},l.getRisk=function(e,o,i,a){var s=new t,u={};return l.getRadiusBuffer(e,o).then(function(e){var t=1e3*o*o*1e3*Math.PI,d=e.geometry,p=l.getRiskByGeometry(d,t,"radius",i,a,u),f=l.getConcessionRisk(d,i,a,u);r([p,f]).then(function(){u.total_mill_priority_level=c[u.total_mill_priority_level],s.resolve(n.clone(u))})}),s},l}),define("report/RiskHelper",["report/config","dojo/Deferred","dojo/_base/lang","dojo/promise/all","dojo/_base/array","esri/tasks/query","esri/tasks/QueryTask","report/riskController","esri/geometry/geometryEngine"],function(e,t,r,n,o,i,a,s,l){"use strict";var u={prepareFeatures:function(e){var r=new t,i=[],a=this;return o.forEach(e,function(e){var r=new t;a.getAreaAndIndoIntersect(e).then(function(e){r.resolve({feature:e.feature,inIndonesia:e.inIndonesia})}),i.push(r.promise)}),n(i).then(function(e){a.performAnalysis(e).then(function(e){r.resolve(e)})}),r.promise},getAreaAndIndoIntersect:function(e){var r=new t;return this.getIntersectionStatus(e).then(function(t){r.resolve({feature:e,inIndonesia:t})}),r.promise},getIntersectionStatus:function(r){var n,o,s=new t;return o=new a(e.boundariesUrl),n=new i,n.returnGeometry=!0,n.outFields=["OBJECTID"],n.where="ISO3 = 'IDN'",n.geometryPrecision=1,o.execute(n,function(e){var t=e.features[0]&&e.features[0].geometry;s.resolve(l.contains(t,r.geometry))},function(e){s.resolve(!1)}),s.promise},performAnalysis:function(e){var r,i,a,l,u=new t,c=this,d=[];return o.forEach(e,function(e){var o=new t;l=e.feature.isRSPO||!1,i=e.feature.geometry.getExtent().getCenter(),r=e.inIndonesia,a=JSON.parse(e.feature.buffer),n([s.getRisk(i,a,l,r)]).then(function(t){o.resolve({feature:e.feature,results:t})}),d.push(o)}),n(d).then(function(e){var t=c.formatData(e);u.resolve(t)}),u.promise},formatData:function(e){var t,n=[];return o.forEach(e,function(e){t=r.clone(e.results[0]),t.id=e.feature.millId,t.rspo={risk:e.feature.isRSPO},n.push(t)}),n}};return u}),define("report/Suitability",["esri/request","esri/tasks/query","esri/tasks/QueryTask","esri/geometry/Polygon","report/config","utils/Analytics","dojo/Deferred","dojo/_base/lang","dojo/_base/array","dojo/promise/all","report/CSVExporter"],function(e,t,r,n,o,i,a,s,l,u,c){return{getSuitabilityData:function(){function e(e){t.resolve(e),r.attachEvents()}var t=new a,r=this;return u([this.getSuitableAreas(),this.getLCHistogramData(),this.getRoadData(),this.getConcessionData(),this.computeLegalHistogram()]).then(e),t.promise},attachEvents:function(){$("#suitability-table-csv").click(this.downloadSuitabilityTable),$("#suitability-settings-csv").click(this.downloadSuitabiltiySettings)},downloadSuitabilityTable:function(){var e,t,r="\r\n";t=c.exportSuitabilityStatistics(),e=t.join(r),c.exportCSV(e),i.sendEvent("Event","Download CSV","User downloaded Suitability results table.")},downloadSuitabiltiySettings:function(){c.exportCSV(payload.suitability.csv),i.sendEvent("Event","Download CSV","User downloaded Suitability settings.")},getSuitableAreas:function(e){function t(e){e.histograms.length>0?(d.data=e.histograms[0],d.pixelSize=c.pixelSize,n.resolve(d)):n.resolve(!1)}function r(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==c.pixelSize?(c.pixelSize=500,u.getHistogram(l,c,t,r)):n.resolve(!1)}var n=new a,i=s.clone(report.suitable.renderRule),l=o.suitability.url,u=this,c={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry)},d={};return i.rasterFunction=o.suitability.rasterFunction,c.renderingRule=JSON.stringify(i),this.getHistogram(l,c,t,r),n.promise},getLCHistogramData:function(){function e(e){e.histograms.length>0?(c.data=e.histograms[0],c.pixelSize=u.pixelSize,r.resolve(c)):r.resolve(!1)}function t(n){n.details&&"The requested image exceeds the size limit."===n.details[0]&&500!==u.pixelSize?(u.pixelSize=500,l.getHistogram(s,u,e,t)):r.resolve(!1)}var r=new a,n=o.suitability.lcHistogram,i=n.renderRule,s=o.suitability.url,l=this,u={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry),renderingRule:JSON.stringify(i)},c={};return this.getHistogram(s,u,e,t),r.promise},getRoadData:function(){function e(e){e.histograms.length>0?(c.data=e.histograms[0],c.pixelSize=u.pixelSize,r.resolve(c)):r.resolve(!1)}function t(n){n.details&&"The requested image exceeds the size limit."===n.details[0]&&500!==u.pixelSize?(u.pixelSize=500,l.getHistogram(i,u,e,t)):r.resolve(!1)}var r=new a,n=o.suitability.roadHisto,i=o.suitability.url,s=n.mosaicRule,l=this,u={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify(s)},c={};return this.getHistogram(i,u,e,t),r.promise},getConcessionData:function(){var e=new a,i=o.suitability.concessions,s=new t,l=new r(i.url+"/"+i.layer);return s.returnGeometry=!1,s.geometry=new n(report.geometry),l.executeForCount(s,function(t){e.resolve({value:t>0?"Yes":"No"})},function(t){e.resolve(!1)}),e.promise},computeLegalHistogram:function(){function e(e){e.histograms.length>0?(p.data=e.histograms[0],p.pixelSize=d.pixelSize,r.resolve(p)):r.resolve(!1)}function t(n){n.details&&"The requested image exceeds the size limit."===n.details[0]&&500!==d.pixelSize?(d.pixelSize=500,c.getHistogram(u,d,e,t)):r.resolve(!1)}var r=new a,n=s.clone(report.suitable.renderRule),i=o.suitability.lcHistogram,l=i.renderRuleSuitable,u=o.suitability.url,c=this,d={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry)},p={};return s.mixin(n.rasterFunctionArguments,l.rasterFunctionArguments),n.rasterFunction=l.rasterFunction,d.renderingRule=JSON.stringify(n),this.getHistogram(u,d,e,t),r.promise},getCompositionAnalysis:function(){var e=new a,t=this;return u([t.getElevationComposition(),t.getSlopeComposition(),t.getWaterComposition(),t.getConservationComposition()]).then(function(r){u([t.getSoilTypeComposition(),t.getSoilDepthComposition(),t.getPeatComposition(),t.getSoilAcidityComposition()]).then(function(n){u([t.getSoilDrainComposition(),t.getRainfallComposition(),t.getLandCoverComposition()]).then(function(t){e.resolve(r.concat(n.concat(t)))})})}),e.promise},getElevationComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$1","ElevInpR","ElevOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Elevation"),r.resolve(t)}),r.promise},getSlopeComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$2","SlopeInpR","SlopeOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Slope"),r.resolve(t)}),r.promise},getWaterComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$3","WaterInpR","WaterOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Water Resource Buffers"),r.resolve(t)}),r.promise},getConservationComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$4","ConsInpR","ConsOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Conservation Area Buffers"),r.resolve(t)}),r.promise},getSoilTypeComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$5","STypeInpR","STypeOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Soil Type"),r.resolve(t)}),r.promise},getSoilDepthComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$6","SDepthInpR","SDepthOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Soil Depth"),r.resolve(t)}),r.promise},getPeatComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$7","PeatInpR","PeatOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Peat Depth"),r.resolve(t)}),r.promise},getSoilAcidityComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$8","SAcidInpR","SAcidOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Soil Acidity"),r.resolve(t)}),r.promise},getSoilDrainComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$9","SDrainInpR","SDrainOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Soil Drainage"),r.resolve(t)}),r.promise},getRainfallComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$10","RainfallInpR","RainfallOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Rainfall"),r.resolve(t)}),r.promise},getLandCoverComposition:function(){var e,t,r=new a,n=this;return e=this.getCompositionRemapRule("$11","LCInpR","LCOutV"),this.queryComposition(e,function(e){t=n.formatCompositionResults(e,"Land Cover"),r.resolve(t)}),r.promise},getCompositionRemapRule:function(e,t,r){var n=s.clone(report.suitable.renderRule);return{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:n.rasterFunctionArguments[t],OutputValues:n.rasterFunctionArguments[r],Raster:e},outputPixelType:"U2"}},queryComposition:function(e,t){function r(e){var r;e.histograms.length>0?(r=e.histograms[0]&&e.histograms[0].counts||[0,0],t(r)):(r=[0,0],t(r))}function n(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==a.pixelSize?(a.pixelSize=500,self.getHistogram(i,a,r,n)):t(!1)}var i=o.suitability.url,a={f:"json",pixelSize:o.pixelSize,geometryType:o.suitability.geometryType,geometry:JSON.stringify(report.geometry),renderingRule:JSON.stringify(e)};this.getHistogram(i,a,r,n)},formatCompositionResults:function(e,t){return{unsuitable:e[0]||0,suitable:e[1]||0,label:t}},getHistogram:function(t,r,n,o){var i=e({url:t+"/computeHistograms?",content:r,handleAs:"json",callbackParamName:"callback"});i.then(n,o)}}}),define("map/Symbols",["esri/Color","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol"],function(e,t,r,n){"use strict";var o={getPolygonSymbol:function(){return new t(t.STYLE_SOLID,new r(r.STYLE_SOLID,new e([255,0,0]),2),new e([103,200,255,0]))},getPointSymbol:function(){return new n(n.STYLE_CIRCLE,10,new r(r.STYLE_SOLID,new e([255,0,0]),1),new e([0,0,0,.25]))},getHighlightPolygonSymbol:function(){return new t(t.STYLE_SOLID,new r(r.STYLE_SOLID,new e([0,255,255]),2),new e([103,200,255,0]))},getHighlightPointSymbol:function(){return new n(n.STYLE_CIRCLE,10,new r(r.STYLE_SOLID,new e([0,255,255]),1),new e([0,0,0,.25]))}};return o}),define("utils/assert",[],function(){"use strict";return function(e,t){if(!e)throw new Error(["Assertion Error:",t].join(" "))}}),define("utils/request",["esri/request"],function(e){"use strict";return{get:function(t,r,n,o){var i=e({callbackParamName:"callback",content:r,handleAs:"json",url:t});i.then(n,o)},computeHistogram:function(t,r,n,o){var i=e({url:t+"/computeHistograms",callbackParamName:"callback",content:r,handleAs:"json",timeout:6e4},{usePost:!0});i.then(n,o)}}}),define("report/rasterArea",["lodash","utils/assert","utils/request","report/config","dojo/Deferred"],function(e,t,r,n,o){"use strict";function i(e){function t(e){e.histograms.length>0?i.resolve(e.histograms[0]):i.reject()}var i=new o,a={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(e),renderingRule:JSON.stringify(n.rasterFunctions.range),pixelSize:c,f:"json"};return r.computeHistogram(n.urls.imageService,a,t,u),i}function a(t){for(var r=t.counts,n=e.findIndex(r,function(e){return e>0}),o=t.size,i=0;o>n;)i+=n*r[n]*Math.pow(c/30,2),++n;return i}function s(t){for(var r=e.findIndex(t.counts,function(e){return e>0}),n=t.size,o=[];n>r;)o.push(r),o.push(r),++r;return o}function l(t,i,a){function s(e){console.log(e)}var l,d=new o,p=e.clone(n.rasterFunctions.combination),f=[];if(a.simpleRule)p.rasterFunctionArguments.RasterRange=[1,2],p.rasterFunctionArguments.Raster=a.simpleRule;else{var g=a.raster.bounds[1]*a.raster2.length[0]+a.raster.bounds[1];p.rasterFunctionArguments.RasterRange=[1,g],p.rasterFunctionArguments.Raster.rasterFunctionArguments={RasterRange:a.raster.bounds,Raster2Length:a.raster2.length,Raster:a.raster.id,Raster2:a.raster2.id}}for(var h=0;h<i.length/2;h++)f.push(h+1);return p.rasterFunctionArguments.Raster2.rasterFunctionArguments.InputRanges=i,p.rasterFunctionArguments.Raster2.rasterFunctionArguments.OutputValues=f,l={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(t),renderingRule:JSON.stringify(p),pixelSize:c,f:"json"},r.computeHistogram(n.urls.imageService,l,s,u),d}function u(e){console.error(e)}var c=90;return{getArea:function(e,r){t(e&&"polygon"===e.type,"Invalid Parameter");var n,c,d=new o;return i(e).then(function(t){return void 0===r?(c=a(t),console.log(c),void d.resolve(c)):(n=s(t),void l(e,n,r).then(function(e){},u))},u),d}}}),define("report/Fetcher",["lodash","dojo/number","dojo/Deferred","dojo/promise/all","dojo/_base/array","report/config","report/Renderer","report/RiskHelper","report/Suitability","map/Symbols","esri/map","esri/request","esri/tasks/query","esri/dijit/Scalebar","esri/tasks/QueryTask","esri/SpatialReference","esri/geometry/Polygon","esri/geometry/Point","esri/tasks/GeometryService","esri/geometry/geometryEngine","esri/tasks/AreasAndLengthsParameters","esri/Color","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleMarkerSymbol","esri/graphic","report/rasterArea"],function(e,t,r,n,o,i,a,s,l,u,c,d,p,f,g,h,m,y,v,b,_,w,A,S,C,R,x){"use strict";var F=[];return{getAreaFromGeometry:function(e){function n(e){1===e.areas.length?(a=t.format(e.areas[0],{places:0}),report.area=e.areas[0],s.resolve(a)):(a=p,s.resolve(!1))}function o(e){s.resolve(!1)}this._debug("Fetcher >>> getAreaFromGeometry");var a,s=new r,l=new v(i.geometryServiceUrl),u=new _,c=new h(54012),d=new m(e),p="Not Available";return u.areaUnit=v.UNIT_HECTARES,l.project([d],c,function(e){e.length>0?(d.rings=e[0].rings,d.setSpatialReference(c)):o(),l.simplify([d],function(e){u.polygons=e,l.areasAndLengths(u,n,o)},o)},o),s.promise},setupMap:function(){function e(){if(o.graphics.clear(),o.resize(),t=new f({map:o,scalebarUnit:"metric"}),n=new m(report.mapGeometry),r=new R,r.setGeometry(n),r.setSymbol(u.getPolygonSymbol()),report.centerPoints)for(var e=0;e<report.centerPoints.length;e++){var i=new R,a=new C(C.STYLE_CIRCLE,2,new S(S.STYLE_SOLID,new w([255,0,0]),1),new w([0,0,0,.25])),s=new y(report.centerPoints[e].geometry.x,report.centerPoints[e].geometry.y,report.centerPoints[e].geometry.spatialReference);i.setGeometry(s),i.setSymbol(a),o.graphics.add(i)}window.map=o,o.graphics.add(r),o.setExtent(r.geometry.getExtent().expand(3),!0)}console.log();var t,r,n,o;o=new c("print-map",{basemap:"topo",sliderPosition:"top-right"}),o.loaded?e():o.on("load",e)},getPrimaryForestResults:function(){this._debug("Fetcher >>> getPrimaryForestResults");var e=new r,t=i.primaryForest;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getTreeCoverResults:function(){this._debug("Fetcher >>> getTreeCoverResults");var e=new r,t=i.treeCover;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getTreeCoverLossResults:function(){function e(e){e.histograms.length>0?(a.renderTreeCoverLossData(e.histograms[0].counts,l.pixelSize,o),a.renderCompositionAnalysis(e.histograms[0].counts,l.pixelSize,o)):a.renderAsUnavailable("loss",o),n.resolve(!0)}function t(r){var o=function(e){n.resolve(!1)};if(r.details)if("The requested image exceeds the size limit."===r.details[0]&&500!==l.pixelSize)l.pixelSize=500,u._computeHistogram(s,l,e,t);else if(0===r.details.length){var i=10;l.geometry=JSON.stringify(b.generalize(report.geometry,i,!0,"miles")),u._computeHistogram(s,l,e,o)}else n.resolve(!1);else n.resolve(!1)}this._debug("Fetcher >>> getTreeCoverLossResults");var n=new r,o=i.treeCoverLoss,s=i.imageServiceUrl,l=(o.rasterId,{geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify(o.mosaicRule),pixelSize:i.pixelSize,f:"json"}),u=this;return a.renderTotalLossContainer(o),a.renderCompositionAnalysisLoader(o),this._computeHistogram(s,l,e,t),n.promise},getProdesResults:function(){function e(e){e.histograms.length>0?(a.renderProdesData(e.histograms[0].counts,l.pixelSize,o),a.renderCompositionAnalysis(e.histograms[0].counts,l.pixelSize,o)):a.renderAsUnavailable("prodes",o),n.resolve(!0)}function t(r){var o=function(e){n.resolve(!1)};if(r.details)if("The requested image exceeds the size limit."===r.details[0]&&500!==l.pixelSize)l.pixelSize=500,u._computeHistogram(s,l,e,t);else if(0===r.details.length){var i=10;l.geometry=JSON.stringify(b.generalize(report.geometry,i,!0,"miles")),u._computeHistogram(s,l,e,o)}else n.resolve(!1);else n.resolve(!1)}this._debug("Fetcher >>> getProdesResults");var n=new r,o=i.prodes,s=i.imageServiceUrl,l={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify(o.mosaicRule),pixelSize:i.pixelSize,f:"json"},u=this;return a.renderProdesContainer(o),a.renderCompositionAnalysisLoader(o),this._computeHistogram(s,l,e,t),n.promise},getLegalClassResults:function(){this._debug("Fetcher >>> getLegalClassResults");var e=new r,t=i.legalClass;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getIndonesiaMoratoriumResults:function(){this._debug("Fetcher >>> getIndonesiaMoratoriumResults");var e=new r,t=i.indonesiaMoratorium;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getProtectedAreaResults:function(){this._debug("Fetcher >>> getProtectedAreaResults");var e=new r,t=i.protectedArea;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getCarbonStocksResults:function(){this._debug("Fetcher >>> getCarbonStocksResults");var e=new r,t=i.carbonStock;return console.dir(t),a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getPlantationsSpeciesResults:function(){this._debug("Fetcher >>> getPlantationsSpeciesResults");var e=new r,t=i.plantationsSpeciesLayer;return console.dir(t),a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getPlantationsTypeResults:function(){this._debug("Fetcher >>> getPlantationsTypeResults");var e=new r,t=i.plantationsTypeLayer;return console.dir(t),a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getBrazilBiomesResults:function(){this._debug("Fetcher >>> getBrazilBiomesResults");var e=new r,t=i.brazilBiomes;return console.dir(t),a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getIntactForestResults:function(){this._debug("Fetcher >>> getIntactForestResults");var e=new r,t=i.intactForest;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0)]).then(function(){e.resolve(!0)}),e.promise},getLandCoverGlobalResults:function(){this._debug("Fetcher >>> getLandCoverGlobalResults");var e=new r,t=i.landCoverGlobal;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getLandCoverAsiaResults:function(){this._debug("Fetcher >>> getLandCoverAsiaResults");var e=new r,t=i.landCoverAsia;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getLandCoverIndonesiaResults:function(){this._debug("Fetcher >>> getLandCoverIndonesiaResults");var e=new r,t=i.landCoverIndo;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t),this._getClearanceAlertAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getPeatLandsResults:function(){this._debug("Fetcher >>> getPeatLandsResults");var e=new r,t=i.peatLands;return a.renderContainers(t),F.push(t),n([this._getTotalLossAnalysis(t,!0),this._getClearanceAlertAnalysis(t,!0),this._getCompositionAnalysis(t)]).then(function(){e.resolve(!0)}),e.promise},getRSPOResults:function(){function e(e){a.renderRSPOData(e,o,l),n.resolve(!0)}function t(r){r.details&&"The requested image exceeds the size limit."===r.details[0]&&500!==c.pixelSize?(c.pixelSize=500,d._computeHistogram(s,c,e,t)):n.resolve(!1)}this._debug("Fetcher >>> getRSPOResults");var n=new r,o=i.rspo,s=i.imageServiceUrl,l=this._getEncodingFunction(o.lossBounds,o.bounds),u=l.render(i.totalLoss.rasterId,o.rasterId),c={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:u,pixelSize:i.pixelSize,f:"json"},d=this;return a.renderRSPOContainer(o),this._computeHistogram(s,c,e,t),n.promise},_getTotalLossAnalysis:function(e,t){function n(r){if(r.histograms.length>0)a.renderLossData(r.histograms[0].counts,f.pixelSize,e,c,t);else{var n=Array.apply(null,new Array(l.labels.length)).map(Number.prototype.valueOf,0);a.renderLossData(n,f.pixelSize,e,c,t)}s.resolve(!0)}function o(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==f.pixelSize?(f.pixelSize=500,g._computeHistogram(u,f,n,o)):s.resolve(!1)}this._debug("Fetcher >>> _getTotalLossAnalysis");var s=new r,l=i.totalLoss,u=i.imageServiceUrl,c=this._getEncodingFunction(l.bounds,e.bounds),d=e.rasterRemap?e.rasterRemap:e.rasterId,p=t?c.getSimpleRule(l.rasterId,d):c.render(l.rasterId,d),f={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),
renderingRule:p,pixelSize:i.pixelSize,f:"json"},g=this;return console.log(f),this._computeHistogram(u,f,n,o),s.promise},_getClearanceAlertAnalysis:function(t,n){function s(e){if(e.histograms.length>0)a.renderClearanceData(e.histograms[0].counts,d.pixelSize,t,p,n);else{var r=Array.apply(null,new Array(report.clearanceLabels.length)).map(Number.prototype.valueOf,0);a.renderClearanceData(r,d.pixelSize,t,p,n)}f.resolve(!0)}function l(e){var t=function(){f.resolve(!1)};if(e.details)if("Invalid cell size"===e.details[0]){var r=[];o.forEach(report.geometry.rings,function(e){e&&(r=r.concat(e))});var n=new m(r);console.log(report.geometry),report.mapGeometry=n,d.geometry=JSON.stringify(report.geometry),y._computeHistogram(h,d,s,t)}else f.resolve(!1);else f.resolve(!1)}this._debug("Fetcher >>> _getClearanceAlertAnalysis");var u,c,d,p,f=new r,g=i.clearanceAlerts,h=i.clearanceAnalysisUrl,y=this;return t=e.clone(t),t.formaId&&(t.rasterId=t.formaId,t.includeFormaIdInRemap&&(t.rasterRemap.rasterFunctionArguments.Raster=t.formaId)),p=this._getEncodingFunction(report.clearanceBounds,t.bounds),c=t.rasterRemap?t.rasterRemap:t.rasterId,u=n?p.getSimpleRule(g.rasterId,c):p.render(g.rasterId,c),console.log("renderingRule",u),d={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),renderingRule:u,pixelSize:500,f:"json"},this._computeHistogram(h,d,s,l),f.promise},getGladResults:function(t,n){function o(e){if(console.log("GLAD success"),e.histograms.length>0)a.renderGladData(e.histograms[0].counts,l.pixelSize,t,u,n);else{console.log("GLAD failurrre");var r=Array.apply(null,new Array(report.clearanceLabels.length)).map(Number.prototype.valueOf,0);a.renderGladData(r,l.pixelSize,t,u,n)}c.resolve(!0)}function s(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==l.pixelSize?(l.pixelSize=500,p._computeHistogram(d,l,o,s)):c.resolve(!1)}this._debug("Fetcher >>> getGladResults");var l,u,c=new r,d=(i.gladLayer,i.glad.url),p=this;return console.log(d),t=e.clone(t),l={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),pixelSize:30,f:"json"},console.log("url",d),console.log(l),this._computeHistogram(d,l,o,s),c.promise},_getCompositionAnalysis:function(e){function t(t){t.histograms.length>0?a.renderCompositionAnalysis(t.histograms[0].counts,u.pixelSize,e):a.renderAsUnavailable("composition",e),o.resolve(!0)}function n(e){e.details&&"The requested image exceeds the size limit."===e.details[0]&&500!==u.pixelSize?(u.pixelSize=500,c._computeHistogram(s,u,t,n)):o.resolve(!1)}a.renderCompositionAnalysisLoader(e);var o=new r,s=i.imageServiceUrl,l=e.compositionAnalysis,u={geometryType:"esriGeometryPolygon",geometry:JSON.stringify(report.geometry),mosaicRule:JSON.stringify({mosaicMethod:"esriMosaicLockRaster",lockRasterIds:[l.rasterId],ascending:!0,mosaicOperation:"MT_FIRST"}),pixelSize:i.pixelSize,f:"json"},c=this;return this._computeHistogram(s,u,t,n),o.promise},_getSuitabilityAnalysis:function(){this._debug("Fetcher >>> _getSuitabilityAnalysis");var e=new r,t=i.suitability;return a.renderSuitabilityContainer(t),l.getSuitabilityData().then(function(r){a.renderSuitabilityData(t,r),l.getCompositionAnalysis().then(function(t){a.renderSuitabilityCompositionChart(t),e.resolve(!0)})}),e.promise},_getMillPointAnalysis:function(){function e(){var e,t=new XMLHttpRequest;t.open("POST",u.url,!0),t.onreadystatechange=function(r){4===t.readyState&&(200===t.status?(e=JSON.parse(t.response),e.mills?d.resolve(e.mills):d.resolve(!1)):d.resolve(!1))},t.addEventListener("error",function(){d.resolve(!1)},!1);var r=new FormData;r.append("mills",f.map(function(e){return e.millId}).join(",")),t.send(r)}function t(){s.prepareFeatures(p).then(function(e){c.resolve(e)})}this._debug("Fetcher >>> _getMillPointAnalysis");var l=new r,u=i.millPoints,c=new r,d=new r,p=[],f=[];return a.renderMillContainer(u),o.forEach(report.mills,function(e){e.isCustom?p.push(e):f.push(e)}),f.length>0?e():d.resolve(),p.length>0?t():c.resolve(!1),n([c,d]).then(function(e){var t=[];o.forEach(e,function(e){e&&(t=t.concat(e))}),a.renderMillAssessment(t,u),l.resolve(!0)}),l.promise},_getFireAlertAnalysis:function(){this._debug("Fetcher >>> _getFireAlertAnalysis");var e,t,o,s,l=new r,u=new m(report.geometry),c=new Date,d="";return t=new p,s=new g(i.fires.url+"/4"),t.geometry=u,t.returnGeometry=!1,t.outFields=["*"],t.where="1 = 1",o=new g("http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0"),e=new p,e.geometry=u,e.returnGeometry=!1,e.outFields=["moratorium"],c.setDate(c.getDate()-8),d=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds(),e.where="ACQ_DATE > date '"+d+"'",n([s.execute(t),o.execute(e)]).then(function(e){a.renderFireData(F,e),l.resolve(!0)}),s.on("error",function(){l.resolve(!1)}),l.promise},_getClearanceBounds:function(){this._debug("Fetcher >>> _getClearanceBounds");var e,t,n=i.clearanceBounds,o=new r,a=0;return t=d({url:n.url,content:{f:"pjson"},handleAs:"json",callbackParamName:"callback"}),t.then(function(t){report.clearanceBounds=[t.minValues[0],t.maxValues[0]],report.clearanceLabels=[];for(var r=t.minValues[0],i=t.maxValues[0];i>=r;r++)e=r%12===0?12:r%12,report.clearanceLabels.push(e+"-"+(n.baseYearLabel+a)),r%12===0&&++a;o.resolve(!0)},function(e){o.resolve(!1,e)}),o.promise},_getEncodingFunction:function(e,t,r){return{A:arrayFromBounds(e),B:arrayFromBounds(t),getSimpleRule:function(e,t){return JSON.stringify({rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:e,Raster2:t,Operation:3}})},renderRule:function(e,t){return{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:{rasterFunction:"Arithmetic",rasterFunctionArguments:{Raster:{rasterFunction:"Remap",rasterFunctionArguments:{InputRanges:[this.A[0],this.A[this.A.length-1]+1],OutputValues:[this.B.length],Raster:e,AllowUnmatched:!1}},Raster2:e,Operation:3}},Raster2:t,Operation:1}}},render:function(e,t){return JSON.stringify(this.renderRule(e,t))},encode:function(e,t){return this.B.length*e+t},decode:function(e){var t=e%this.B.length,r=(e-t)/this.B.length;return[r,t]}}},_computeHistogram:function(e,t,r,n){var o=d({url:e+"/computeHistograms",content:t,handleAs:"json",callbackParamName:"callback",timeout:6e4},{usePost:!0});o.then(r,n)},_debug:function(e){console.log(e)}}}),define("report/Generator",["dojo/on","dojo/dom","dojo/query","esri/config","dojo/request/xhr","dojo/Deferred","dojo/dom-class","dojo/dom-style","dojo/promise/all","dojo/_base/array","dijit/Dialog","dojox/validate/web","esri/geometry/Point","esri/geometry/Polygon","esri/SpatialReference","esri/tasks/GeometryService","esri/geometry/geometryEngine","esri/geometry/webMercatorUtils","utils/Analytics","report/config","report/Fetcher","report/CSVExporter","esri/units","esri/geometry/Circle"],function(e,t,r,n,o,i,a,s,l,u,c,d,p,f,g,h,m,y,v,b,_,w,A,S){"use strict";return window.report={},{init:function(){window.payload&&(this.addConfigurations(),this.addContentAndEvents(),this.prepareForAnalysis())},addConfigurations:function(){u.forEach(b.corsEnabledServers,function(e){n.defaults.io.corsEnabledServers.push(e)}),Highcharts.setOptions({chart:{style:{fontFamily:"'Fira Sans', 'fira_sans_otregular', Georgia, serif"}}})},addContentAndEvents:function(){this.setTitle(window.payload.title),this.setupHeader(),this.addSubscriptionDialog(),this.addCSVOptionToHighcharts()},setTitle:function(e){document.getElementById("title").innerHTML=e},setupHeader:function(){var r=t.byId("total-area-info-icon");e(r,"click",function(e){a.remove("total-area-info-popup","hidden")}),r=t.byId("total-area-close-info-icon"),e(r,"click",function(e){a.add("total-area-info-popup","hidden")})},addSubscriptionDialog:function(){var r=new c({title:"Subscribe to Alerts!",style:"width: 300px;"}),n=this,o="<div class='subscription-content'><div class='checkbox-container'><label><input id='forma_check' type='checkbox' value='clearance' />Monthly Clearance Alerts</label></div><div class='checkbox-container'><label><input id='fires_check' type='checkbox' value='fires' />Fire Alerts</label></div><div class='email-container'><input id='user-email' type='text' placeholder='something@gmail.com'/></div><div class='submit-container'><button id='subscribe-now'>Subscribe</button></div><div id='form-response' class='message-container'></div></div>";r.setContent(o),e(t.byId("subscribeToAlerts"),"click",function(){r.show()}),e(t.byId("subscribe-now"),"click",function(){t.byId("form-response").innerHTML="<div class='loader-wheel subscribe'>subscribing</div>",n.subscribeToAlerts()})},addCSVOptionToHighcharts:function(){function e(){var e,t,r=document.getElementById("title").innerHTML,n=this,o=n.options.chart.type,i="\r\n",a=[];a.push("column"===o?"RSPO Land Use Change Analysis":n.title.textStr),a.push(r),"bar"===o&&n.xAxis.length>1?(e=w.exportCompositionAnalysis(n),a=a.concat(e)):"pie"===o?(e=w.exportSuitabilityByLegalClass(n),a=a.concat(e)):(e=w.exportSimpleChartAnalysis(n),a=a.concat(e)),a.length>1&&(t=a.join(i)),t&&w.exportCSV(t);var s="column"===o?"RSPO Land Use Change Analysis":n.title.textStr;v.sendEvent("Event","Download CSV",s)}Highcharts.getOptions().exporting.buttons.contextButton.menuItems.push({text:"Download CSV",onclick:e})},prepareForAnalysis:function(){var e,t,r,n=this,o=new h(b.geometryServiceUrl),i=new g(102100);report.suitable=window.payload.suitability,report.datasets=window.payload.datasets;var a=JSON.parse(window.payload.geometry);if(console.log(a),1===a.length){var s=a[0];s.geometry.radius?(r=new f(i),r.addRing(s.geometry.rings[s.geometry.rings.length-1]),report.geometry=r,report.centerPoints=[s.point],s.geometry=report.geometry,report.mills=[s]):"polygon"===s.geometry.type&&(report.geometry=new f(s.geometry)),console.log(report.centerPoints),this.beginAnalysis()}else e=[],t=[],u.forEach(a,function(n){t.push(n.point),"polygon"===n.geometry.type&&(r=new f(n.geometry),e.push(r)),n.geometry.center&&(r=new f(i),r.addRing(n.geometry.rings[n.geometry.rings.length-1]),e.push(r),n.geometry=r)}),report.centerPoints=t,console.log(report.centerPoints),report.mills=a,o.union(e,function(e){r=new f(e),report.geometry=r,n.beginAnalysis()})},beginAnalysis:function(){function t(){o.length>0?(r=o.shift(),l(i._getDeferredsForItems(r)).then(t)):i.getFiresAnalysis()}var r,n,o=this._getArrayOfRequests(),i=this;if(report.geometry=m.simplify(report.geometry),n=m.planarArea(report.geometry)/1e4,n>5e6){var a=$("#warning-popup"),s=$("#warning-popup-content");s.html(b.messages.largeAreaWarning),a.toggleClass("hidden"),e.once($("#warning-popup-close-icon"),"click",function(){s.html(""),a.toggleClass("hidden")}),report.mapGeometry=report.geometry,report.geometry=m.generalize(report.geometry,2e3,!0)}else report.mapGeometry=report.geometry,report.geometry=m.generalize(report.geometry,200,!0);report.areaPromise=_.getAreaFromGeometry(report.geometry),report.areaPromise.then(function(e){document.getElementById("total-area").innerHTML=e?e:"Not Available"}),l([_._getClearanceBounds()]).then(function(){o.length<3?l(i._getDeferredsForItems(o)).then(i.getFiresAnalysis.bind(i)):(o=arrayChunk(o,3),t())})},getFiresAnalysis:function(){var e=this;l([_._getFireAlertAnalysis()]).then(e.analysisComplete)},analysisComplete:function(){_.setupMap(),a.remove("print","disabled"),e(t.byId("print"),"click",function(){s.set("total-area-info-popup","visibility","hidden"),window.print()}),r(".loader-wheel").forEach(function(e){"total-area"!==e.parentNode.id&&"print-map"!==e.parentNode.id&&(e.parentNode.innerHTML="There was an error getting these results at this time.")})},_getArrayOfRequests:function(){var e=[];for(var t in report.datasets)report.datasets[t]&&e.push(t);return e},_getDeferredsForItems:function(e){var t=[];return console.log(e),u.forEach(e,function(e){switch(console.log(e),e){case"suit":t.push(_._getSuitabilityAnalysis());break;case"mill":t.push(_._getMillPointAnalysis());break;case"carbon":t.push(_.getCarbonStocksResults());break;case"plantationsSpeciesLayer":t.push(_.getPlantationsSpeciesResults());break;case"plantationsTypeLayer":t.push(_.getPlantationsTypeResults());break;case"biomes":t.push(_.getBrazilBiomesResults());break;case"intact":t.push(_.getIntactForestResults());break;case"landCoverGlob":t.push(_.getLandCoverGlobalResults());break;case"landCoverAsia":t.push(_.getLandCoverAsiaResults());break;case"landCoverIndo":t.push(_.getLandCoverIndonesiaResults());break;case"legal":t.push(_.getLegalClassResults());break;case"peat":t.push(_.getPeatLandsResults());break;case"primForest":t.push(_.getPrimaryForestResults());break;case"protected":t.push(_.getProtectedAreaResults());break;case"rspo":t.push(_.getRSPOResults());break;case"treeDensity":t.push(_.getTreeCoverResults());break;case"treeCoverLoss":t.push(_.getTreeCoverLossResults());break;case"indonesiaMoratorium":t.push(_.getIndonesiaMoratoriumResults());break;case"prodes":t.push(_.getProdesResults());break;case"gladAlerts":t.push(_.getGladResults())}}),t},subscribeToAlerts:function(){var e=this.convertGeometryToGeometric(report.geometry),r=t.byId("user-email").value,n=t.byId("forma_check").checked,o=t.byId("fires_check").checked,i=[],a={};if(a.invalidEmail="You must provide a valid email in the form.",a.noSelection="You must select at least one checkbox from the form.",a.formaSuccess="Thank you for subscribing to Forma Alerts.  You should receive a confirmation email soon.",a.formaFail="There was an error with your request to subscribe to Forma alerts.  Please try again later.",a.fireSuccess="Thank you for subscribing to Fires Alerts.  You should receive a confirmation email soon.",a.fireFail="There was an error with your request to subscribe to Fires alerts.  Please try again later.",d.isEmailAddress(r)||i.push(a.invalidEmail),n||o||i.push(a.noSelection),i.length>0)alert("Please fill in the following:\n"+i.join("\n"));else if(n&&o){var s=[];l([this.subscribeToForma(e,r),this.subscribeToFires(report.geometry,r)]).then(function(e){e[0]?s.push(a.formaSuccess):s.push(a.formaFail),e[1]?s.push(a.fireSuccess):s.push(a.fireFail),t.byId("form-response").innerHTML=s.join("<br />")})}else n?this.subscribeToForma(e,r).then(function(e){e?t.byId("form-response").innerHTML=a.formaSuccess:t.byId("form-response").innerHTML=a.formaFail}):o&&this.subscribeToFires(report.geometry,r).then(function(e){e?t.byId("form-response").innerHTML=a.fireSuccess:t.byId("form-response").innerHTML=a.fireFail})},subscribeToForma:function(e,t){var r,n=b.alertUrl.forma,o=new i,a=new XMLHttpRequest,s=JSON.stringify({topic:"updates/forma",geom:'{"type": "'+e.type+'", "coordinates":['+JSON.stringify(e.geom)+"]}",email:t});return a.open("POST",n,!0),a.onreadystatechange=function(){4===a.readyState&&(r=JSON.parse(a.response),o.resolve(r.subscribe))},a.addEventListener("error",function(){o.resolve(!1)},!1),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(s),o.promise},subscribeToFires:function(e,t){var r=b.alertUrl.fires,n=new i,a={features:JSON.stringify({rings:e.rings,spatialReference:e.spatialReference}),msg_addr:t,msg_type:"email",area_name:payload.title};return o(r,{handleAs:"json",method:"POST",data:a}).then(function(){n.resolve(!0)},function(e){n.resolve(!1)}),n.promise},convertGeometryToGeometric:function(e){function t(e,t){var r=!1;return u.forEach(e,function(e){e[0]===t[0]&&e[1]===t[1]&&(r=!0)}),r}var r,n,o=new g({wkid:102100}),i=[],a=[];return u.forEach(e.rings,function(e){u.forEach(e,function(e){n=new p(e,o),r=y.xyToLngLat(n.x,n.y),t(a,r)?(a.push(r),i.push(a),a=[]):a.push(r)})}),{geom:i.length>1?i:i[0],type:i.length>1?"MultiPolygon":"Polygon"}}}}),function(){function e(e,t){var r,n,o;n=!1,r=document.createElement("script"),r.type="text/javascript",r.src=e,r.onload=r.onreadystatechange=function(){n||this.readyState&&"complete"!=this.readyState||(n=!0,t())},o=document.getElementsByTagName("script")[0],o.parentNode.insertBefore(r,o)}var t=function(e){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)};t("http://js.arcgis.com/3.13/esri/css/esri.css"),t("http://js.arcgis.com/3.13/dijit/themes/tundra/tundra.css"),t("app/css/report.css"),window.arrayFromBounds=function(e){var t=[],r=e[0],n=e[1];for(r;n>=r;r++)t.push(r);return t},window.arrayChunk=function(e,t){var r=[],n=0;for(n;n<e.length;n+=t)r.push(e.slice(n,n+t));return r},window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}(),require(["report/Generator"],function(t){var r=!1;e("http://code.jquery.com/jquery-1.11.0.min.js",function(){e("http://code.highcharts.com/highcharts.js",function(){e("http://code.highcharts.com/modules/exporting.js",function(){localStorage?(window.payload=JSON.parse(localStorage.getItem("payload")),window.payload&&(r=!0)):window.payload&&(r=!0),r?t.init():(document.addEventListener("PayloadReady",function(){r=!0}),setTimeout(function(){r&&window.payload?t.init():alert("There was an error generating the report at this time.  Please make sure your pop-up blocker is disabled and try again.")},5e3))})})})})}(),define("app/js/report/reportBundle",function(){});